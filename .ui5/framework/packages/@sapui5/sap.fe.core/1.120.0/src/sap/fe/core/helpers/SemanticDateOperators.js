/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/ui/mdc/condition/FilterOperatorUtil","sap/ui/mdc/condition/Operator","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/ValidateException","../templating/DisplayModeFormatter"],function(e,t,a,o,r,n){"use strict";var s=n.ODATA_TYPE_MAPPING;const l=["DATE","FROM","TO","DATERANGE"];const i="DYNAMIC.DATE";const c="FIXED.DATE";const T="DYNAMIC.DATE.INT";const u="DYNAMIC.DATERANGE";const E="DYNAMIC.MONTH";const y="FIXED.WEEK";const p="FIXED.MONTH";const A="FIXED.QUARTER";const f="FIXED.YEAR";const d="DYNAMIC.WEEK.INT";const O="DYNAMIC.MONTH.INT";const D="DYNAMIC.QUARTER.INT";const R="DYNAMIC.YEAR.INT";const g="DYNAMIC.MINUTE.INT";const S="DYNAMIC.HOUR.INT";const M={EQ:{key:"EQ",category:i},BT:{key:"BT",category:u}};const N={DATE:{key:"DATE",category:i},FROM:{key:"FROM",category:i},TO:{key:"TO",category:i},DATERANGE:{key:"DATERANGE",category:u},SPECIFICMONTH:{key:"SPECIFICMONTH",category:E},TODAY:{key:"TODAY",category:c},TODAYFROMTO:{key:"TODAYFROMTO",category:T},YESTERDAY:{key:"YESTERDAY",category:c},TOMORROW:{key:"TOMORROW",category:c},LASTDAYS:{key:"LASTDAYS",category:T},NEXTDAYS:{key:"NEXTDAYS",category:T},THISWEEK:{key:"THISWEEK",category:y},LASTWEEK:{key:"LASTWEEK",category:y},LASTWEEKS:{key:"LASTWEEKS",category:d},NEXTWEEK:{key:"NEXTWEEK",category:y},NEXTWEEKS:{key:"NEXTWEEKS",category:d},THISMONTH:{key:"THISMONTH",category:p},LASTMONTH:{key:"LASTMONTH",category:p},LASTMONTHS:{key:"LASTMONTHS",category:O},NEXTMONTH:{key:"NEXTMONTH",category:p},NEXTMONTHS:{key:"NEXTMONTHS",category:O},THISQUARTER:{key:"THISQUARTER",category:A},LASTQUARTER:{key:"LASTQUARTER",category:A},LASTQUARTERS:{key:"LASTQUARTERS",category:D},NEXTQUARTER:{key:"NEXTQUARTER",category:A},NEXTQUARTERS:{key:"NEXTQUARTERS",category:D},QUARTER1:{key:"QUARTER1",category:A},QUARTER2:{key:"QUARTER2",category:A},QUARTER3:{key:"QUARTER3",category:A},QUARTER4:{key:"QUARTER4",category:A},THISYEAR:{key:"THISYEAR",category:f},LASTYEAR:{key:"LASTYEAR",category:f},LASTYEARS:{key:"LASTYEARS",category:R},NEXTYEAR:{key:"NEXTYEAR",category:f},NEXTYEARS:{key:"NEXTYEARS",category:R},LASTMINUTES:{key:"LASTMINUTES",category:g},NEXTMINUTES:{key:"NEXTMINUTES",category:g},LASTHOURS:{key:"LASTHOURS",category:S},NEXTHOURS:{key:"NEXTHOURS",category:S},YEARTODATE:{key:"YEARTODATE",category:f},DATETOYEAR:{key:"DATETOYEAR",category:f}};const m=["TODAY","TOMORROW","YESTERDAY"];function F(){return new t({name:"DATERANGE",filterOperator:o.BT,alias:{Date:"DATERANGE",DateTime:"DATERANGE"},valueTypes:[{name:"sap.ui.model.odata.type.Date"},{name:"sap.ui.model.odata.type.Date"}],getModelFilter:function(e,t,a){return H.getModelFilterForDateRange(e,t,a,this)},validate:function(e,a){if(e.length<2){throw new r("Date Range must have two values")}else{const t=new Date(e[0]);const a=new Date(e[1]);if(t.getTime()>a.getTime()){throw new r("From Date Should Be Less Than To Date")}}t.prototype.validate.apply(this,[e,a])}})}function k(){return new t({name:"DATE",alias:{Date:"DATE",DateTime:"DATE"},filterOperator:o.EQ,valueTypes:[{name:"sap.ui.model.odata.type.Date"}],getModelFilter:function(e,t,a){return H.getModelFilterForDate(e,t,a,this)}})}function v(){return new t({name:"FROM",alias:{Date:"FROM",DateTime:"FROM"},filterOperator:o.GE,valueTypes:[{name:"sap.ui.model.odata.type.Date"}],getModelFilter:function(e,t,a){return H.getModelFilterForFrom(e,t,a,this)}})}function I(){return new t({name:"TO",alias:{Date:"TO",DateTime:"TO"},filterOperator:o.LE,valueTypes:[{name:"sap.ui.model.odata.type.Date"}],getModelFilter:function(e,t,a){return H.getModelFilterForTo(e,t,a,this)}})}function Y(e,t){if(!t){return true}t=Array.isArray(t)?t:[t];let a;t.some(function(t){let o;if(!t.path){return false}const r=e[t.path];const n=t.exclude||false;let s;if(t.contains&&r){s=t.contains.split(",");a=n;for(o=0;o<s.length;o++){if(n&&r.indexOf(s[o])>-1){a=false;return true}else if(!n&&r.indexOf(s[o])>-1){a=true;return true}}}if(t.equals&&r){s=t.equals.split(",");a=n;for(o=0;o<s.length;o++){if(n&&r===s[o]){a=false;return true}else if(!n&&r===s[o]){a=true;return true}}}return false});return a}function h(e){return e==="Edm.DateTimeOffset"?Object.assign({},N,M):N}const H={addSemanticDateOperators:function(){e.addOperator(F());e.addOperator(k());e.addOperator(v());e.addOperator(I())},getSupportedOperations:function(){return l},getSemanticDateOperations:function(e){const t=h(e);return Object.keys(t)},removeSemanticDateOperators:function(){},getFilterOperations:function(e,t){const a=[];const o=h(t);for(const t in o){const r=o[t];if(Y(r,e)){a.push(r)}}return a.map(function(e){return e.key})},hasSemanticDateOperations:function(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;const a=this.getSemanticDateOperations();for(const o in e){const r=e[o];const n=r.find(function(e){return a.includes(e.operator)});if(n){if(t){return true}else{return!l.includes(n.operator)}}}return false},getSemanticOpsFilterProperties:function(e){const t=[];for(const[a,o]of Object.entries(e)){const e=o[0].SemanticDates;if(e&&!l.includes(e.operator)){t.push({filterName:a,filterSemanticInfo:e,filterType:""})}}return t},getModelFilterForDate:function(e,t,r,n){if(r.isA("sap.ui.model.odata.type.DateTimeOffset")){const s=n._createLocalType(n.valueTypes[0]);let l=e.values[0];const i=s.getModelFormat();const c=i.parse(l,false);l=r.getModelValue(c);c.setHours(23);c.setMinutes(59);c.setSeconds(59);c.setMilliseconds(999);const T=r.getModelValue(c);return new a({path:t,operator:o.BT,value1:l,value2:T})}else{return new a({path:t,operator:n.filterOperator,value1:e.values[0]})}},getModelFilterForTo:function(e,t,r,n){if(r.isA("sap.ui.model.odata.type.DateTimeOffset")){const s=n._createLocalType(n.valueTypes[0]);const l=e.values[0];const i=s.getModelFormat();const c=i.parse(l,false);c.setHours(23);c.setMinutes(59);c.setSeconds(59);c.setMilliseconds(999);const T=r.getModelValue(c);return new a({path:t,operator:o.LE,value1:T})}else{return new a({path:t,operator:n.filterOperator,value1:e.values[0]})}},getModelFilterForFrom:function(e,t,r,n){if(r.isA("sap.ui.model.odata.type.DateTimeOffset")){const s=n._createLocalType(n.valueTypes[0]);const l=e.values[0];const i=s.getModelFormat();const c=i.parse(l,false);c.setHours(0);c.setMinutes(0);c.setSeconds(0);c.setMilliseconds(0);const T=r.getModelValue(c);return new a({path:t,operator:o.GE,value1:T})}else{return new a({path:t,operator:n.filterOperator,value1:e.values[0]})}},getModelFilterForDateRange:function(e,t,r,n){if(r.isA("sap.ui.model.odata.type.DateTimeOffset")){let s=n._createLocalType(n.valueTypes[0]);let l=e.values[0];let i=s.getModelFormat();let c=i.parse(l,false);l=r.getModelValue(c);s=n._createLocalType(n.valueTypes[1]);i=s.getModelFormat();let T=e.values[1];c=i.parse(T,false);c.setHours(23);c.setMinutes(59);c.setSeconds(59);c.setMilliseconds(999);T=r.getModelValue(c);return new a({path:t,operator:o.BT,value1:l,value2:T})}else{return new a({path:t,operator:n.filterOperator,value1:e.values[0],value2:e.values[1]})}},getSemanticDateFiltersWithFlpPlaceholders(e,t){const o=[];const r={};e.forEach(e=>{var n;let{filterName:l,filterSemanticInfo:i,filterType:c}=e;const T=t.find(e=>e.key===l);if(T&&(n=T.typeConfig)!==null&&n!==void 0&&n.className){var u;c=s[(u=T.typeConfig)===null||u===void 0?void 0:u.className]}const E=i.operator;const y=i.high;const p=i.low;if(E){let e;if(m.includes(E)&&c!=="Edm.DateTimeOffset"){const t=`${l}placeholder`;e=new a({path:l,operator:"EQ",value1:t});r[t]=`{${c}%%DynamicDate.${E}%%}`}else{const t=[E,y,p].filter(e=>e!==undefined&&e!==null).join(".");const o=`${l}placeholderStart`;const n=`${l}placeholderEnd`;const s=`${c}%%DynamicDate.${t}`;e=new a({filters:[new a({path:l,operator:"GE",value1:o}),new a({path:l,operator:"LE",value1:n})],and:true});r[o]=`{${s}.start%%}`;r[n]=`{${s}.end%%}`}o.push(e)}});return[r,o]}};return H},false);
//# sourceMappingURL=SemanticDateOperators.js.map