/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/controllerextensions/collaboration/ActivitySync","sap/fe/core/helpers/EditState","../../controls/DataLossOrDraftDiscard/DraftDataLossDialog.block"],function(e,t,a,n){"use strict";var i;(function(e){e["BackNavigation"]="BackNavigation";e["ForwardNavigation"]="ForwardNavigation"})(i||(i={}));var o;(function(e){e["Save"]="draftDataLossOptionSave";e["Keep"]="draftDataLossOptionKeep";e["Discard"]="draftDataLossOptionDiscard"})(o||(o={}));const r=new n({});function c(e){var t,a;let n=false;const i=e.getAppComponent().getManifest();n=(i===null||i===void 0?void 0:(t=i["sap.fe"])===null||t===void 0?void 0:(a=t.app)===null||a===void 0?void 0:a.silentlyKeepDraftOnForwardNavigation)||false;return n}async function s(e,t,a,n,i){if(e.CreationDateTime!==e.LastChangeDateTime){return r.open(a).then(e=>w.handleDialogSelection(e,n,t,a,i))}else{n()}}async function l(t,n,o,c,s,l,d){if(a.isEditStateDirty()){if(t.CreationDateTime===t.LastChangeDateTime&&s===i.BackNavigation){try{await w.discardDraft(o,d);c()}catch(t){e.error("Error while canceling the document",t)}}else if(s===i.ForwardNavigation&&l){c()}else{return r.open(o).then(e=>w.handleDialogSelection(e,c,n,o,d))}}else{c()}}async function d(t,a,n,o){if(o===i.BackNavigation){const i={skipDiscardPopover:true};try{await t.editFlow.cancelDocument(a,i);n()}catch(t){e.error("Error while canceling the document",t)}}else{n()}}async function f(e,t,a,n,o,c){if(n===i.ForwardNavigation&&o){a()}else{return r.open(e).then(n=>w.handleDialogSelection(n,a,t,e,c))}}async function g(e,n,o,r,g,u){let D=arguments.length>6&&arguments[6]!==undefined?arguments[6]:i.BackNavigation;const p=t.isConnected(g.getView());const v=!p?n:function(){t.disconnect(g.getView());for(var e=arguments.length,a=new Array(e),i=0;i<e;i++){a[i]=arguments[i]}n.apply(null,...a)};const w=c(g);if(e){if(g.getAppComponent().getRootViewController().isFclEnabled()){await s(e,o,g,v,u)}else if(!r.getObject().HasActiveEntity){l(e,o,g,v,D,w,u)}else if(e.CreationDateTime===e.LastChangeDateTime){d(g,r,v,D)}else if(a.isEditStateDirty()){f(g,o,v,D,w,u)}else{v()}}else{n()}}async function u(t,a,n,o,r){let c=arguments.length>5&&arguments[5]!==undefined?arguments[5]:i.BackNavigation;const s=o.getView();const l=n.getModel();const d=l.getMetaModel();const f=s.getViewData().entitySet??"";const u=f&&d.getObject("/"+f+"@com.sap.vocabularies.Common.v1.DraftRoot");const D=s.getModel("ui");const p=D.getProperty("/isEditable");const v=l.bindContext(`${n.getPath()}/DraftAdministrativeData`).getBoundContext();if(n&&(n.isDeleted()||n.getObject())&&(!u&&c===i.BackNavigation||!p)){t()}else{try{const e=await v.requestObject();await g(e,t,a,n,o,r,c)}catch(t){e.error("Cannot retrieve draftDataContext information",t)}}}async function D(e){const t=e.getView().getBindingContext();if(e.isA("sap.fe.templates.ObjectPage.ObjectPageController")){return e._saveDocument(t)}else{return e.editFlow.saveDocument(t,{})}}async function p(e,t){const a=e.getView().getBindingContext();const n={skipBackNavigation:true,skipDiscardPopover:true,skipBindingToView:t!==undefined?t:true};return e.editFlow.cancelDocument(a,n)}function v(t,a,n,i,c){switch(t){case o.Save:w.saveDocument(i).then(e=>a(e)).catch(function(t){if(t==="Cancel"){return n()}e.error("Error while saving document",t)});r.close();break;case o.Keep:a(i.getView().getBindingContext());r.close();break;case o.Discard:w.discardDraft(i,c).then(e=>a(e)).catch(function(t){e.error("Error while discarding draft",t)});r.close();break;default:n();r.close()}}const w={processDataLossOrDraftDiscardConfirmation:u,silentlyKeepDraftOnForwardNavigation:c,NavigationType:i,processFclMode:s,processNoActiveEntityMode:l,processEditingDraftForExistingEntity:d,processEditStateDirty:f,handleDialogSelection:v,saveDocument:D,discardDraft:p};return w},false);
//# sourceMappingURL=draftDataLossPopup.js.map