/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/util/UriParameters","sap/fe/core/controllerextensions/collaboration/CollaborationCommon","sap/fe/core/helpers/ResourceModelHelper","sap/m/MessageBox","sap/ui/core/ws/SapPcpWebSocket"],function(e,t,o,n,r){"use strict";var s={};var i=r.SUPPORTED_PROTOCOLS;var a=o.getResourceModel;var c=t.Activity;const l="/collaboration";const C="/collaboration/connection";const u="/collaboration/DraftID";const p="/collaboration/websocket_status";let f;(function(e){e[e["CLOSED"]=0]="CLOSED";e[e["CLOSING"]=1]="CLOSING";e[e["CONNECTING"]=2]="CONNECTING";e[e["CONNECTED"]=3]="CONNECTED";e[e["ERROR"]=4]="ERROR"})(f||(f={}));s.WEBSOCKET_STATUS=f;function N(e){return e.getProperty(p)===f.CONNECTED}s.isCollaborationConnected=N;function O(t,o,r,s,i,c,N){let O=arguments.length>7&&arguments[7]!==undefined?arguments[7]:false;if(i.getProperty(C)){if(i.getProperty(u)===r){return false}else{E(i)}}const d=[t];i.setProperty(l,{activeUsers:d,activities:{}});O=O||e.fromQuery(window.location.search).get("useFLPUser")==="true";const g=P(t,o,r,s,O);i.setProperty(p,f.CONNECTING);i.setProperty(C,g);i.setProperty(u,r);g.attachMessage(function(e){const t=e.getParameter("pcpFields");if(t){c(t)}});g.attachOpen(function(){i.setProperty(p,f.CONNECTED)});g.attachError(function(){if([f.CONNECTING,f.CONNECTED].includes(i.getProperty(p))){const e=a(N);const t=e.getText("C_COLLABORATIONDRAFT_CONNECTION_LOST");n.warning(t,{actions:[n.Action.OK],emphasizedAction:n.Action.OK})}i.setProperty(p,f.ERROR)});g.attachClose(function(){i.setProperty(p,f.CLOSED)});return true}s.initializeCollaboration=O;function d(e,t,o,n,r,s){if(N(o)){const i=o.getProperty(C);i.send("",{clientAction:e,clientContent:t,clientTriggeredActionName:n,clientRefreshListBinding:r,clientRequestedProperties:s});if(e===c.Activate||e===c.Discard){E(o)}}}s.broadcastCollaborationMessage=d;function E(e){const t=e.getProperty(C);e.setProperty(l,{});e.setProperty(p,f.CLOSING);t===null||t===void 0?void 0:t.close()}s.endCollaboration=E;function P(t,o,n,s){let a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;const c=window.location;let l;const C=e.fromQuery(window.location.search).get("useBackendUrl");if(C){l=C.replace("https","wss")}else{l=c.protocol==="https:"?"wss:":"ws:";l+=`//${c.host}`}l+=`${(o.startsWith("/")?"":"/")+o}?draft=${n}&relatedService=${s}`;if(a){l+=`&userID=${encodeURI(t.id)}&userName=${encodeURI(t.initialName||"")}`}return new r(l,[i.v10])}return s},false);
//# sourceMappingURL=ActivityBase.js.map