/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/objectPage/HeaderAndFooterAction","sap/fe/core/helpers/BindingToolkit","../../helpers/BindingHelper","../ManifestSettings","../controls/ObjectPage/Avatar","../controls/ObjectPage/HeaderFacet","../controls/ObjectPage/SubSection","../helpers/ConfigurableObject","../helpers/ID"],function(e,t,n,o,i,a,s,r,c,l){"use strict";var d={};var v=l.getSectionID;var u=l.getEditableHeaderSectionID;var f=l.getCustomSectionID;var b=c.insertCustomElements;var g=c.Placement;var p=c.OverrideType;var y=r.createSubSections;var h=r.createCustomSubSections;var m=r.createCustomHeaderFacetSubSections;var E=r.SubSectionType;var A=s.getHeaderFacetsFromManifest;var S=s.getHeaderFacetsFromAnnotations;var C=a.getAvatar;var T=i.VisualizationType;var w=i.TemplateType;var H=o.singletonPathVisitor;var I=o.UI;var F=n.not;var k=n.ifElse;var L=n.getExpressionFromAnnotation;var M=n.equal;var O=n.constant;var P=n.compileExpression;var j=t.getHiddenHeaderActions;var z=t.getHeaderDefaultActions;var x=t.getFooterDefaultActions;var D=e.removeDuplicateActions;var V=e.getActionsFromManifest;const B=(e,t)=>{var n,o;return((n=e.ID)===null||n===void 0?void 0:n.toString())||((o=e.Label)===null||o===void 0?void 0:o.toString())||t};function U(e,t){var n,o;const i=u();const a=(n=e.getEntityType().annotations)===null||n===void 0?void 0:(o=n.UI)===null||o===void 0?void 0:o.HeaderFacets;const s=a?y(a,e,true):[];const r=m(e);let c=[];if(r.length>0){let e=0;t.forEach(function(t){while(s.length>e&&s[e].visible==="false"){c.push(s[e]);e++}if(s.length>e&&(t.key===s[e].key||t.key.slice(t.key.lastIndexOf("::")+2)===s[e].key.slice(s[e].key.lastIndexOf("::")+2))){c.push(s[e]);e++}else{r.forEach(function(e){if(t.key===e.key){c.push(e)}})}})}else{c=s}const l={id:i,key:"EditableHeaderContent",title:"{sap.fe.i18n>T_COMMON_OBJECT_PAGE_HEADER_SECTION}",visible:P(I.IsEditable),subSections:c};return l}d.createEditableHeaderSection=U;function W(e){var t,n,o;const i=e.getEntityType();const a=((t=i.annotations)===null||t===void 0?void 0:(n=t.UI)===null||n===void 0?void 0:(o=n.Facets)===null||o===void 0?void 0:o.map(t=>_(t,e)))||[];return a}function _(e,t){var n,o;const i=v(e);const a=L((n=e.annotations)===null||n===void 0?void 0:(o=n.UI)===null||o===void 0?void 0:o.Hidden,[],false,e=>H(e,t.getConvertedTypes(),[]));const s={id:i,key:B(e,i),title:e.Label?P(L(e.Label)):undefined,showTitle:!!e.Label,visible:P(F(M(a,true))),subSections:y([e],t)};return s}function N(e,t){const n={};Object.keys(e).forEach(o=>{n[o]=R(e[o],o,t)});return n}function R(e,t,n){const o=e.id||f(t);let i=e.position;if(!i){i={placement:g.After}}let a;if(!e.subSections){a={[t]:{...e,position:undefined,visible:"true"}}}else{a=e.subSections}const s=h(a,n);const r={id:o,key:t,title:e.title,showTitle:!!e.title,visible:e.visible!==undefined?e.visible:"true",position:i,subSections:s};return r}const q=function(e){const t=z(e);const n=e.getManifestWrapper();const o=V(n.getHeaderActions(),e,t,undefined,undefined,j(e));const i={isNavigable:p.overwrite,enabled:p.overwrite,visible:p.overwrite,defaultValuesExtensionFunction:p.overwrite,command:p.overwrite};const a=b(t,o.actions,i);return{actions:D(a),commandActions:o.commandActions}};d.getHeaderActions=q;const G=function(e){const t=e.getManifestWrapper();const n=x(t.getViewLevel(),e);const o=V(t.getFooterActions(),e,n);const i={isNavigable:p.overwrite,enabled:p.overwrite,visible:p.overwrite,defaultValuesExtensionFunction:p.overwrite,command:p.overwrite};const a=b(n,o.actions,i);return{actions:a,commandActions:o.commandActions}};d.getFooterActions=G;function J(e){var t;return e!==null&&e!==void 0&&(t=e.presentation)!==null&&t!==void 0&&t.visualizations[0]?e.presentation.visualizations[0]:undefined}function K(e,t){var n,o;return e.visible==="true"&&(e===null||e===void 0?void 0:(n=e.presentation)===null||n===void 0?void 0:n.visualizations)&&(t===null||t===void 0?void 0:t.type)==="Table"&&(t===null||t===void 0?void 0:(o=t.control)===null||o===void 0?void 0:o.type)!=="ResponsiveTable"}function Q(e,t,n,o){if(K(t,n)){const t=n.control;if(!(o==="Page"&&e.length>1)){t.rowCountMode="Auto"}if(o!=="Tabs"){t.useCondensedTableLayout=false}}}function X(e,t){var n;if((e===null||e===void 0?void 0:(n=e.content)===null||n===void 0?void 0:n.length)===1){var o;const n=((o=e.content[0].presentation)===null||o===void 0?void 0:o.visualizations[0]).control;if(n.type!=="ResponsiveTable"){n.rowCountMode="Auto";if(t!=="Tabs"){n.useCondensedTableLayout=false}}}}function Y(e,t,n){let o;let i;const a=t.subSections;if(a.length===1){o=a[0];switch(a[0].type){case"DataVisualization":i=J(o);Q(e,o,i,n);break;case"Mixed":X(o,n);break;default:break}return}Z(a)}function Z(e){let t;e.forEach(e=>{var n,o,i;t=e;if((n=t)!==null&&n!==void 0&&(o=n.presentation)!==null&&o!==void 0&&o.visualizations){var a,s;(a=t)===null||a===void 0?void 0:(s=a.presentation)===null||s===void 0?void 0:s.visualizations.forEach(e=>{if(e.type===T.Table){e.control.useCondensedTableLayout=false}})}if((i=t)!==null&&i!==void 0&&i.content){t.content.forEach(e=>{var t;(t=e.presentation)===null||t===void 0?void 0:t.visualizations.forEach(e=>{if(e.type===T.Table){e.control.useCondensedTableLayout=false}})})}})}const $=function(e){const t=e.getManifestWrapper();const n=b(W(e),N(t.getSections(),e),{title:p.overwrite,visible:p.overwrite,subSections:{actions:p.merge,title:p.overwrite,sideContent:p.overwrite,objectPageLazyLoaderEnabled:p.overwrite}});n.forEach(function(e){var o;Y(n,e,t.getSectionLayout());(o=e.subSections)===null||o===void 0?void 0:o.forEach(function(e){var t;e.title=e.title==="undefined"?undefined:e.title;if(e.type==="Mixed"){var n;(n=e.content)===null||n===void 0?void 0:n.forEach(t=>{t.objectPageLazyLoaderEnabled=e.objectPageLazyLoaderEnabled})}if(e.type==="Mixed"&&(t=e.content)!==null&&t!==void 0&&t.length){var o;const t=e.content.find(e=>e.type===E.Form);if(e.sideContent){if(t){t.sideContent=e.sideContent}else{e.content[0].sideContent=e.sideContent}e.sideContent=undefined}if(t&&(o=e.actions)!==null&&o!==void 0&&o.length){t.actions=e.actions;e.actions=[]}}})});return n};d.getSections=$;function ee(e){var t,n;const o=e.getManifestWrapper();return(((t=e.getEntityType().annotations)===null||t===void 0?void 0:(n=t.UI)===null||n===void 0?void 0:n.HeaderFacets)||[]).length>0||Object.keys(o.getHeaderFacets()).length>0}function te(e){const t=e.getManifestWrapper();return k(!ee(e),O(false),k(M(t.isHeaderEditable(),false),O(true),F(I.IsEditable)))}const ne=function(e){return P(te(e))};d.getShowHeaderContent=ne;const oe=function(e){return P(F(te(e)))};d.getExpandedImageVisible=oe;const ie=function(e){var t,n;const o=e.getManifestWrapper();let i;const a=e.getEntityType();const s=b(S(e),A(o.getHeaderFacets()));const r=q(e);const c=G(e);if(o.isHeaderEditable()&&((t=a.annotations.UI)!==null&&t!==void 0&&t.HeaderFacets||(n=a.annotations.UI)!==null&&n!==void 0&&n.HeaderInfo)){i=U(e,s)}const l=$(e);return{template:w.ObjectPage,header:{visible:o.getShowObjectPageHeader(),section:i,facets:s,actions:r.actions,showContent:ne(e),hasContent:ee(e),avatar:C(e),title:{expandedImageVisible:oe(e)}},sections:l,footerActions:c.actions,headerCommandActions:r.commandActions,footerCommandActions:c.commandActions,showAnchorBar:o.getShowAnchorBar(),useIconTabBar:o.useIconTabBar()}};d.convertPage=ie;return d},false);
//# sourceMappingURL=ObjectPageConverter.js.map