/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/TypeGuards","sap/ui/model/BindingMode","sap/ui/model/json/JSONModel"],function(t,e,n,o){"use strict";var i=e.isEntitySet;var r=t.getInvolvedDataModelObjects;const a={disableCollaborationDraft:false,isStickySessionSupported:function(t){const e=t.getObject("/");for(const n in e){if(e[n].$kind==="EntitySet"&&t.getObject(`/${n}@com.sap.vocabularies.Session.v1.StickySessionSupported`)){return true}}return false},isDraftSupported:function(t,e){const n=t.getMetaContext(e);const o=r(n);return this.isObjectPathDraftSupported(o)},isObjectPathDraftSupported:function(t){var e,n,o,i,r,s,d;const l=t.targetEntitySet;const c=a.isDraftRoot(l);const u=a.isDraftNode(l);const g=(e=t.targetObject)!==null&&e!==void 0&&e.containsTarget&&((n=t.startingEntitySet)!==null&&n!==void 0&&(o=n.annotations)!==null&&o!==void 0&&(i=o.Common)!==null&&i!==void 0&&i.DraftRoot||(r=t.startingEntitySet)!==null&&r!==void 0&&(s=r.annotations)!==null&&s!==void 0&&(d=s.Common)!==null&&d!==void 0&&d.DraftNode)?true:false;return c||u||!l&&g},isCollaborationDraftSupported:function(t,e){if(!this.disableCollaborationDraft){var n;const o=(e===null||e===void 0?void 0:(n=e.context)===null||n===void 0?void 0:n.getModel())||t;const i=o.getObject("/");for(const t in i){if(i[t].$kind==="EntitySet"&&o.getObject(`/${t}@com.sap.vocabularies.Common.v1.DraftRoot/ShareAction`)){return true}}}return false},getDraftRootPath:function(e){const n=e.getModel().getMetaModel();const o=function(e,i){var r;let a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;const s=a?e:(r=new RegExp(/.*(?=\/)/).exec(e))===null||r===void 0?void 0:r[0];if(s&&s!=="/"){var d,l;const e=n.getMetaPath(s);const r=t.getInvolvedDataModelObjects(n.getContext(e));if((d=r.targetEntitySet)!==null&&d!==void 0&&(l=d.annotations.Common)!==null&&l!==void 0&&l.DraftRoot){return s}return o(s,i,false)}return undefined};return o(e.getPath(),e.getModel())},getStickyRootPath:function(e){const n=e.getModel().getMetaModel();const o=function(e,i){var r;let a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;const s=a?e:(r=new RegExp(/.*(?=\/)/).exec(e))===null||r===void 0?void 0:r[0];if(s&&s!=="/"){var d,l,c;const e=n.getMetaPath(s);const r=t.getInvolvedDataModelObjects(n.getContext(e));if((d=r.targetEntitySet)!==null&&d!==void 0&&(l=d.annotations)!==null&&l!==void 0&&(c=l.Session)!==null&&c!==void 0&&c.StickySessionSupported){return s}return o(s,i,false)}return undefined};return o(e.getPath(),e.getModel())},getTargetEntitySet:function(t){const e=t.getPath();if(t.getObject("$kind")==="EntitySet"||t.getObject("$kind")==="Action"||t.getObject("0/$kind")==="Action"){return e}const n=a.getEntitySetPath(e);return`/${t.getObject(n)}`},getEntitySetPath:function(t,e){let n="";if(!e){n=`/${t.split("/").filter(a.filterOutNavPropBinding).join("/$NavigationPropertyBinding/")}`}else{const o=t.split("/").filter(a.filterOutNavPropBinding);if(o.length>1){const t={growingPath:"/",pendingNavPropBinding:""};const i=o.reduce((t,n,o)=>{const i=!!o&&"/$NavigationPropertyBinding/"||"";let{growingPath:r,pendingNavPropBinding:a}=t;const s=r+i;const d=e.getObject(s);const l=a?`${a}/${n}`:n;if(d&&Object.keys(d).length>0&&d.hasOwnProperty(l)){r=s+l.replace("/","%2F");a=""}else{a+=a?`/${n}`:n}return{growingPath:r,pendingNavPropBinding:a}},t);n=i.growingPath}else{n=`/${o[0]}`}}return n},getActionParameterItemsModelPath:function(t){return t&&t.$Name?`{path: 'mvfview>/${t.$Name}'}`:undefined},filterOutNavPropBinding:function(t){return t!==""&&t!=="$NavigationPropertyBinding"},enhanceInternalJSONModel:function(t){const e=t.bindContext;t.bindContext=function(t,n,o){for(var i=arguments.length,r=new Array(i>3?i-3:0),a=3;a<i;a++){r[a-3]=arguments[a]}n=e.apply(this,[t,n,o,...r]);const s=n.getBoundContext;n.getBoundContext=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++){e[n]=arguments[n]}const o=s.apply(this,...e);if(o&&!o.setProperty){o.setProperty=function(t,e){if(this.getObject()===undefined){this.getModel().setProperty(this.getPath(),{})}const n=t.split("/");for(let t=0;t<n.length-1;t++){if(this.getObject(n[t])===undefined){this.getModel().setProperty(this.getPath(n[t]),{})}}this.getModel().setProperty(t,e,this)}}return o};return n}},enhanceUiJSONModel:function(t,e){const n=t.setProperty;t.setProperty=function(){for(var o=arguments.length,i=new Array(o),r=0;r<o;r++){i[r]=arguments[r]}const a=i[1];if(i[0]==="/isEditable"){t.setProperty("/editMode",a?e.EditMode.Editable:e.EditMode.Display,i[2],i[3])}return n.apply(this,[...i])}},enhanceViewJSONModel:function(t){const e=t._getObject;t._getObject=function(t,n){if(t===undefined||t===""){t="/"}return e.apply(this,[t,n])}},isFilteringCaseSensitive:function(t){if(!t){return undefined}const e=t.getObject("/@Org.OData.Capabilities.V1.FilterFunctions");return e?e.indexOf("tolower")===-1:true},getMetaPathForContext:function(t){const e=t.getModel(),n=e.getMetaModel(),o=t.getPath();return n&&o&&n.getMetaPath(o)},getRootEntitySetPath:function(t){let e="";const n=t?t.split("/"):[];if(n.length>1){e=n[1]}return e},getAbsoluteMetaPathForListBinding:function(t,e){const n=t.getModel().getMetaModel();let o;if(typeof e==="string"){if(e.startsWith("/")){o=n.getMetaPath(e)}else{const i=t.getBindingContext();const r=i.getPath();o=n.getMetaPath(`${r}/${e}`)}}else{const t=e;const i=t.getRootBinding();if(t===i){o=n.getMetaPath(t.getPath())}else{const e=i.getPath();const r=t.getPath();o=n.getMetaPath(`${e}/${r}`)}}return o},isDraftRoot:function(t){return this.getDraftRoot(t)!==undefined},isDraftNode:function(t){return this.getDraftNode(t)!==undefined},isSticky:function(t){return this.getStickySession(t)!==undefined},isUpdateHidden:function(t,e){if(i(t)){var n,o;return((n=t.annotations.UI)===null||n===void 0?void 0:n.UpdateHidden)??(e===null||e===void 0?void 0:(o=e.annotations.UI)===null||o===void 0?void 0:o.UpdateHidden)}},getDraftRoot:function(t){var e;return i(t)?(e=t.annotations.Common)===null||e===void 0?void 0:e.DraftRoot:undefined},getDraftNode:function(t){var e;return i(t)?(e=t.annotations.Common)===null||e===void 0?void 0:e.DraftNode:undefined},getStickySession:function(t){var e;return i(t)?(e=t.annotations.Session)===null||e===void 0?void 0:e.StickySessionSupported:undefined},getDeleteHidden:function(t,e){if(i(t)){var n,o;return((n=t.annotations.UI)===null||n===void 0?void 0:n.DeleteHidden)??((o=e.annotations.UI)===null||o===void 0?void 0:o.DeleteHidden)}},getAbsolutePathFromListBinding(t){const e=t.getModel().getMetaModel();let n;const o=t.getRootBinding();if(t===o){n=e.getMetaPath(t.getPath())}else{const i=o===null||o===void 0?void 0:o.getPath();const r=t.getPath();n=e.getMetaPath(`${i}/${r}`)}return n},enhanceODataModel(t){const e=t.setMessages;const i=new o({});i.setDefaultBindingMode(n.OneWay);const r=i.setProperty;i.setProperty=function(t,e,n,o){let i=t;if(n){i=n.getPath(t)}const a=i.split("/");let s="";for(let t=0;t<a.length-1;t++){if(t>0){s+="/"}s+=a[t];if(this.getObject(s)===undefined){this.setProperty(s,{})}}return r.apply(this,[t,e,n,o])};function a(t,e){for(const n in e){if(typeof e[n]==="object"){e[n]=a(t,e[n]);if(Object.keys(e[n]).length===0){delete e[n]}}for(const o of t){if(n.endsWith(o)){delete e[n]}}}return e}t._localAnnotationModel=i;t.getLocalAnnotationModel=function(){return this._localAnnotationModel};t.setMessages=function(t){const n=a(["@$ui5.fe.messageType","@$ui5.fe.messageText"],this._localAnnotationModel.getData());this._localAnnotationModel.setData(n);for(const e in t){this._localAnnotationModel.setProperty(`${e}@$ui5.fe.messageType`,t[e][0].getType());this._localAnnotationModel.setProperty(`${e}@$ui5.fe.messageText`,t[e][0].getMessage())}e.apply(this,[t])};const s=t.bindProperty.bind(t);t.bindProperty=function(t,e,n){if(t.includes("@$ui5.fe.")){return this._localAnnotationModel.bindProperty(t)}return s(t,e,n)};const d=t.destroy.bind(t);t.destroy=function(){this._localAnnotationModel.destroy();return d.apply(this)}}};return a},false);
//# sourceMappingURL=ModelHelper.js.map