/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/CommonUtils","sap/fe/core/controls/filterbar/utils/VisualFilterUtils","sap/fe/core/helpers/ClassSupport","sap/fe/macros/CommonHelper","sap/fe/macros/filter/FilterUtils","sap/m/VBox","sap/ui/core/Core","../../templating/FilterHelper"],function(e,t,r,n,i,a,o,s){"use strict";var l,c,u,p,f,g,d,h,m,_,I;var b=s.getFiltersConditionsFromSelectionVariant;var v=r.property;var y=r.implementInterface;var E=r.event;var P=r.defineUI5Class;function R(e,t,r,n){if(!r)return;Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function S(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function C(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;T(e,t)}function T(e,t){T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return T(e,t)}function O(e,t,r,n,i){var a={};Object.keys(n).forEach(function(e){a[e]=n[e]});a.enumerable=!!a.enumerable;a.configurable=!!a.configurable;if("value"in a||a.initializer){a.writable=true}a=r.slice().reverse().reduce(function(r,n){return n(e,t,r)||r},a);if(i&&a.initializer!==void 0){a.value=a.initializer?a.initializer.call(i):void 0;a.initializer=undefined}if(a.initializer===void 0){Object.defineProperty(e,t,a);a=null}return a}function F(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}let L=(l=P("sap.fe.core.controls.filterbar.VisualFilter"),c=y("sap.ui.core.IFormContent"),u=v({type:"boolean"}),p=v({type:"string"}),f=E(),l(g=(d=function(r){C(a,r);function a(){var e;for(var t=arguments.length,n=new Array(t),i=0;i<t;i++){n[i]=arguments[i]}e=r.call(this,...n)||this;R(e,"__implements__sap_ui_core_IFormContent",h,S(e));R(e,"showValueHelp",m,S(e));R(e,"valueHelpIconSrc",_,S(e));R(e,"valueHelpRequest",I,S(e));return e}var s=a.prototype;s.onAfterRendering=function e(){var r;let a;const s=this.getItems()[1].getItems()[0];const l=this.data("infoPath");const c=s.getBinding("segments")||s.getBinding("bars")||s.getBinding("points");const u=s.getBindingContext("internal");const p=o.getLibraryResourceBundle("sap.fe.macros");const f=s.data("showOverlayInitially");const g=s.data("selectionVariantAnnotation")?n.parseCustomData(s.data("selectionVariantAnnotation")):{SelectOptions:[]};const d=s.data("requiredProperties")?n.parseCustomData(s.data("requiredProperties")):[];const h=s.getModel().getMetaModel();const m=c?c.getPath():"";let _=(r=this.getParent())===null||r===void 0?void 0:r.getParent();if(_.getMetadata().getElementName()==="sap.ui.mdc.filterbar.p13n.AdaptationFilterBar"){var I;_=(I=_.getParent())===null||I===void 0?void 0:I.getParent()}let v={};let y=[];let E;if(_.getMetadata().getElementName()==="sap.fe.core.controls.FilterBar"){v=_.getConditions();y=_.getPropertyInfoSet();E=_.data("entityType").split("/")[1]}const P=s.data("parameters")?s.data("parameters").customData:[];const R=b(m,h,g,t.getCustomConditions.bind(t));const S=t.convertFilterCondions(R);const C={};Object.keys(v).forEach(function(e){if(v[e].length){C[e]=v[e]}});Object.keys(S).forEach(function(e){if(!C[e]){C[e]=S[e]}});if(f==="true"){if(!Object.keys(g).length){if(d.length>1){u.setProperty(l,{showError:true,errorMessageTitle:p.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"),errorMessage:p.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_MULTIPLEVF")})}else{a=h.getObject(`${m}/${d[0]}@com.sap.vocabularies.Common.v1.Label`)||d[0];u.setProperty(l,{showError:true,errorMessageTitle:p.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"),errorMessage:p.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_SINGLEVF",a)})}}else{const e=[];const r=[];if(g.SelectOptions){g.SelectOptions.forEach(function(t){e.push(t.PropertyName.$PropertyPath)})}if(g.Parameters){g.Parameters.forEach(function(t){e.push(t.PropertyName.$PropertyPath)})}d.forEach(function(t){if(!e.includes(t)){r.push(t)}});const n=t.getErrorInfoForNoInitialOverlay(r,p,m,h);u.setProperty(l,n)}}if(!this._oChartBinding||this._oChartBinding!==c){if(this._oChartBinding){this.detachDataReceivedHandler(this._oChartBinding)}this.attachDataRecivedHandler(c);this._oChartBinding=c}const T=u.getProperty(l)&&u.getProperty(l).showError;const O=m!==""?m.split("/")[1].split("(")[0]:"";if(P&&P.length&&E===O){const e=i.getBindingPathForParameters(_,C,y,P);if(e){c.sPath=e}}if(c&&c.isSuspended()&&!T){c.resume()}};s.attachDataRecivedHandler=function e(t){if(t){t.attachEvent("dataReceived",this.onInternalDataReceived,this);this._oChartBinding=t}};s.detachDataReceivedHandler=function e(t){if(t){t.detachEvent("dataReceived",this.onInternalDataReceived,this);this._oChartBinding=undefined}};s.setShowValueHelp=function e(t){if(this.getItems().length>0){const e=this.getItems()[0].getItems()[0];e.getContent().some(function(e){if(e.isA("sap.m.Button")){e.setVisible(t)}});this.setProperty("showValueHelp",t)}};s.setValueHelpIconSrc=function e(t){if(this.getItems().length>0){const e=this.getItems()[0].getItems()[0];e.getContent().some(function(e){if(e.isA("sap.m.Button")){e.setIcon(t)}});this.setProperty("valueHelpIconSrc",t)}};s.onInternalDataReceived=function r(n){const i=this.getId();const a=e.getTargetView(this);const s=this.getItems()[1].getItems()[0];const l=this.data("infoPath");const c=s.getBindingContext("internal");const u=o.getLibraryResourceBundle("sap.fe.macros");const p=s.data("uom");t.updateChartScaleFactorTitle(s,a,i,l);if(n.getParameter("error")){const e=u.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE");const r=u.getText("M_VISUAL_FILTERS_ERROR_DATA_TEXT");t.applyErrorMessageAndTitle(e,r,l,a)}else if(n.getParameter("data")){const e=n.getSource().getCurrentContexts();if(e&&e.length===0){t.setNoDataMessage(l,u,a)}else{c.setProperty(l,{})}t.setMultiUOMMessage(e,s,l,u,a)}if(p&&(p["ISOCurrency"]&&p["ISOCurrency"].$Path||p["Unit"]&&p["Unit"].$Path)){const e=n.getSource().getContexts();const r=e&&e[0].getObject();t.applyUOMToTitle(s,r,a,l)}};return a}(a),h=O(d.prototype,"__implements__sap_ui_core_IFormContent",[c],{configurable:true,enumerable:true,writable:true,initializer:function(){return true}}),m=O(d.prototype,"showValueHelp",[u],{configurable:true,enumerable:true,writable:true,initializer:null}),_=O(d.prototype,"valueHelpIconSrc",[p],{configurable:true,enumerable:true,writable:true,initializer:null}),I=O(d.prototype,"valueHelpRequest",[f],{configurable:true,enumerable:true,writable:true,initializer:null}),d))||g);return L},false);
//# sourceMappingURL=VisualFilter.js.map