/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/controllerextensions/BaseControllerExtension","sap/fe/core/controllerextensions/BusyLocker","sap/fe/core/controllerextensions/Feedback","sap/fe/core/controllerextensions/HookSupport","sap/fe/core/controllerextensions/collaboration/ActivitySync","sap/fe/core/controllerextensions/collaboration/CollaborationCommon","sap/fe/core/controllerextensions/editFlow/TransactionHelper","sap/fe/core/controllerextensions/editFlow/draft","sap/fe/core/controllerextensions/editFlow/sticky","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/ClassSupport","sap/fe/core/helpers/EditState","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/ResourceModelHelper","sap/fe/core/helpers/SemanticKeyHelper","sap/fe/core/library","sap/m/Button","sap/m/Dialog","sap/m/MessageToast","sap/m/Text","sap/ui/core/Core","sap/ui/core/library","sap/ui/core/message/Message","sap/ui/core/mvc/OverrideExecution","sap/ui/model/Filter","sap/ui/model/Sorter","sap/ui/model/odata/v4/ODataListBinding","../ActionRuntime","../controls/Recommendations/ConfirmRecommendationDialog.block","./routing/NavigationReason"],function(e,t,i,n,o,r,s,a,c,l,d,g,u,f,h,p,y,m,v,w,C,M,D,P,b,S,E,A,x,k,R,I){"use strict";var _,O,F,T,B,V,H,N,j,L,G,$,U,q,K,W,z,J,Q,X,Y,Z,ee,te,ie,ne,oe,re,se,ae,ce,le,de,ge,ue,fe,he,pe,ye,me,ve,we,Ce,Me;var De=p.getResourceModel;var Pe=u.publicExtension;var be=u.finalExtension;var Se=u.extensible;var Ee=u.defineUI5Class;var Ae=g.getInvolvedDataModelObjects;var xe=g.convertTypes;var ke=a.shareObject;var Re=a.Activity;var Ie=r.hookable;var _e=o.triggerConfiguredSurvey;var Oe=o.TriggerType;var Fe=o.StandardActions;function Te(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;Be(e,t)}function Be(e,t){Be=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,i){t.__proto__=i;return t};return Be(e,t)}function Ve(e,t,i,n,o){var r={};Object.keys(n).forEach(function(e){r[e]=n[e]});r.enumerable=!!r.enumerable;r.configurable=!!r.configurable;if("value"in r||r.initializer){r.writable=true}r=i.slice().reverse().reduce(function(i,n){return n(e,t,i)||i},r);if(o&&r.initializer!==void 0){r.value=r.initializer?r.initializer.call(o):void 0;r.initializer=undefined}if(r.initializer===void 0){Object.defineProperty(e,t,r);r=null}return r}const He=m.CreationMode,Ne=m.ProgrammingModel,je=m.Constants,Le=m.DraftStatus,Ge=m.EditMode,$e=m.StartupMode,Ue=P.MessageType;let qe=(_=Ee("sap.fe.core.controllerextensions.EditFlow"),O=Pe(),F=be(),T=Pe(),B=be(),V=Pe(),H=be(),N=Pe(),j=Se(S.After),L=Pe(),G=Se(S.After),$=Pe(),U=Se("AfterAsync"),q=Pe(),K=Se(S.After),W=Pe(),z=Se(S.After),J=Pe(),Q=Ie("after"),X=Se(S.After),Y=Pe(),Z=Se(S.After),ee=Pe(),te=Se(S.After),ie=Pe(),ne=Se(S.After),oe=Pe(),re=Se(S.After),se=Pe(),ae=be(),ce=Pe(),le=be(),de=Pe(),ge=be(),ue=Pe(),fe=be(),he=Pe(),pe=be(),ye=Pe(),me=Se(S.After),ve=Pe(),we=be(),_(Ce=(Me=function(i){Te(o,i);function o(){var n;for(var o=arguments.length,r=new Array(o),s=0;s<o;s++){r[s]=arguments[s]}n=i.call(this,...r)||this;n.syncTasks=Promise.resolve();n.handleSideEffects=async(i,o)=>{try{const e=await o;await e.created();if(!t.hasTransientContext(i)){n.getAppComponent().getSideEffectsService().requestSideEffectsForNavigationProperty(i.getPath(),n.getView().getBindingContext())}}catch(t){e.error("Error while creating the document",t)}};n.createCustomValidationMessages=(e,t)=>{var i;const o=t.getCreationRow().data("customValidationFunction");const r=(i=t.getBindingContext("internal"))===null||i===void 0?void 0:i.getProperty("creationRowCustomValidity");const s=D.getMessageManager();const a=[];let c;let l;const d=s.getMessageModel().getData().filter(e=>e.getCode()===o);s.removeMessages(d);e.forEach(e=>{if(e.messageTarget){var t;c=D.byId(r[e.messageTarget].fieldId);l=`${(t=c.getBindingContext())===null||t===void 0?void 0:t.getPath()}/${c.getBindingPath("value")}`;if(!s.getMessageModel().getData().filter(e=>e.getTargets().some(e=>e===l)).length){s.addMessages(new b({message:e.messageText,processor:n.getView().getModel(),type:Ue.Error,code:o,technical:false,persistent:false,target:l}))}const i=s.getMessageModel().getData().filter(e=>e.getTargets().some(e=>e===l));i[0].addControlId(r[e.messageTarget].fieldId)}else{a.push({code:o,text:e.messageText,persistent:true,type:Ue.Error})}});if(a.length){n.getMessageHandler().showMessageDialog({customMessages:a})}};n.resolveCreationMode=(e,t,i)=>{if(e!==He.NewPage){return e}else{const e=t.getModel().getMetaModel();const c=n.getProgrammingModel(t);if(!t.isRelative()){var o,r,s,a;const i=Ae(e.getMetaContext(t.getPath()));const n=i.targetEntitySet,l=(o=c===Ne.Draft?n===null||n===void 0?void 0:(s=n.annotations.Common)===null||s===void 0?void 0:s.DraftRoot:n===null||n===void 0?void 0:(a=n.annotations.Session)===null||a===void 0?void 0:a.StickySessionSupported)===null||o===void 0?void 0:(r=o.NewAction)===null||r===void 0?void 0:r.toString();if(l&&i.targetEntityType.actions[l].parameters.length>1){return He.Deferred}}const l=n.getTransactionHelper().getCreationParameters(t,i,n.getAppComponent());if(l.length){return He.Deferred}return He.Async}};return n}var r=o.prototype;r.getInterface=function e(){return i.prototype.getInterface.call(this)};r.getAppComponent=function e(){return this.base.getAppComponent()};r.editDocument=async function i(n){const o=this.getTransactionHelper();const r=this._getRootViewController();const s=n.getModel();const a=this.getView().getViewData();const c=this.getProgrammingModel(n);let l=n;const d=this.base.getView();const g="editGroup";try{if((a===null||a===void 0?void 0:a.viewLevel)>1){if(c===Ne.Draft||c===Ne.Sticky){l=await t.createRootContext(c,d,this.getAppComponent())}}await this.base.editFlow.onBeforeEdit({context:l});const e=this._isFclEnabled()?r.getRightmostContext():n;const i=o.editDocument(l,this.getView(),this.getAppComponent(),this.getMessageHandler(),g);const u={rootSiblingPathPromise:i};this._setStickySessionInternalProperties(c,s);let f;const p=e!==l||(a===null||a===void 0?void 0:a.viewLevel)>1;if(p){f=this._computeSiblingInformation(l,e,c,true,u,g)}n.getModel().submitBatch(g);let y=await f;const m=await i;let v=m;if(p){if(y===undefined){y=await this._computeSiblingInformation(l,e,c,true,u,"$auto")}v=this._getNavigationTargetForEdit(n,m,y)}else{this._updatePathsInHistory([])}if(m){this.setEditMode(Ge.Editable,false);this.setDocumentModified(false);this.getMessageHandler().showMessageDialog();if(m!==l){await this.base.editFlow.onAfterEdit({context:v});await this._handleNewContext(v,{editable:true,recreateContext:false,forceFocus:true});if(c===Ne.Sticky){let e;if(this._isFclEnabled()){e=m===null||m===void 0?void 0:m.getModel().getKeepAliveContext(m.getPath())}else{e=m}this.handleStickyOn(e)}else if(h.isCollaborationDraftSupported(s.getMetaModel())){await ke(m)}return v}}}catch(t){e.error("Error while editing the document",t)}};r.deleteMultipleDocuments=async function i(o,r){if(r){r.beforeDeleteCallBack=this.base.editFlow.onBeforeDelete;r.requestSideEffects=r.requestSideEffects!==false}else{r={beforeDeleteCallBack:this.base.editFlow.onBeforeDelete,requestSideEffects:true}}const s=this.getGlobalUIModel();const a=this.getView().byId(r.controlId)||D.byId(r.controlId);if(!a){throw new Error("parameter controlId missing or incorrect")}else{r.parentControl=a}const c=a.getBinding("items")||a.getRowBinding();r.bFindActiveContexts=true;n.lock(s);try{var l,d;if(this.getProgrammingModel(((l=r)===null||l===void 0?void 0:(d=l.selectedContexts)===null||d===void 0?void 0:d[0])??o[0])===Ne.Sticky){this.setDocumentModified(true)}await this.deleteDocumentTransaction(o,r);let e;if(a.isA("sap.ui.mdc.Table")){a.clearSelection()}const i=this.getView().getBindingContext();if(c.isRoot()){e=new Promise(e=>{c.attachEventOnce("dataReceived",function(){e()})});c.refresh()}else if(i){if(r.requestSideEffects&&!t.hasTransientContext(c)){this.getAppComponent().getSideEffectsService().requestSideEffectsForNavigationProperty(c.getPath(),i)}}if(!this.getAppComponent()._isFclEnabled()){f.setEditStateDirty()}await this.base.editFlow.onAfterDelete({contexts:o});this._sendActivity(Re.Delete,o);return e}catch(t){e.error("Error while deleting the document(s)",t)}finally{n.unlock(s)}};r.updateDocument=function t(i,n){const o=this.getView().getBindingContext();const r=this.getProgrammingModel(i)===Ne.Draft;this.getMessageHandler().removeTransitionMessages();return this.syncTask(async()=>{if(o){this.setDocumentModified(true);if(!this._isFclEnabled()){f.setEditStateDirty()}if(r){this.setDraftStatus(Le.Saving)}}try{await n;const e=this.getView().getBindingContext();if(!r||!e||e!==o){return}const t=e.getModel().getMetaModel();const i=t.getMetaContext(e.getPath()).getObject("@sapui.name");const s=y.getSemanticKeys(t,i);if(s!==null&&s!==void 0&&s.length){const t=this._getSemanticMapping();const i=t===null||t===void 0?void 0:t.semanticPath,n=y.getSemanticPath(e,true);if(i&&i!==n){await this._handleNewContext(e,{editable:true,recreateContext:false})}}this.setDraftStatus(Le.Saved)}catch(t){e.error("Error while updating the document",t);if(r&&o){this.setDraftStatus(Le.Clear)}}finally{await this.getMessageHandler().showMessages()}})};r.getParentContextFromSelection=function e(t){if(t&&t.length>1){throw new Error(`Cannot create a new document in a TreeTable with ${t.length} parents`)}return(t===null||t===void 0?void 0:t.length)===1?t[0]:undefined};r.createDocument=async function e(t,i){var n,o;let r;const s=i;let a;if(s.creationMode!==He.External){if(typeof t==="string"){const e=this.getView().getModel();if(!e){return}r=e.bindList(t);s.creationMode=He.Sync;delete s.createAtEnd}else if(t.isA("sap.ui.model.odata.v4.ODataListBinding")){r=t}else{throw new Error("Binding object or path expected")}if(this.getTransactionHelper().isListBindingHierarchical(r)){a=this.getParentContextFromSelection(s.selectedContexts)}}const c=this.resolveCreationMode(s.creationMode,r,s.data);this.getAppComponent().getRouterProxy().removeIAppStateKey();if((n=this.getAppComponent().getManifest()["sap.fe"])!==null&&n!==void 0&&(o=n.app)!==null&&o!==void 0&&o.singleDraftForCreate&&r===r.getRootBinding()){r.filter(new E({filters:[new E({path:"IsActiveEntity",operator:"EQ",value1:false}),new E({path:"HasActiveEntity",operator:"EQ",value1:false})],and:true}));r.sort(new A("DraftAdministrativeData/LastChangeDateTime",true));return r.requestContexts(0,1).then(async e=>{if(e.length>0){return this._handleNewContext(e[0],{editable:true,recreateContext:false})}return this._handleCreationMode(c,t,s,r,a)})}return this._handleCreationMode(c,t,s,r,a)};r._handleCreationMode=async function e(t,i,n,o,r){switch(t){case He.External:return this.createExternalDocument(i,n.outbound);case He.Deferred:return this.createDeferredDocument(o,r,n.data);case He.CreationRow:return n.creationRow?this.createCreateRowDocument({creationRow:n.creationRow,skipSideEffects:n.skipSideEffects,createAtEnd:n.createAtEnd}):undefined;case He.Inline:return this.createInlineDocument({tableId:n.tableId,createAtEnd:n.createAtEnd,skipSideEffects:n.skipSideEffects,parentContext:r,data:n.data},o);case He.Sync:case He.Async:return this.createSyncAsyncDocument({creationMode:t,data:n.data,bFromDeferred:n.bFromDeferred,skipSideEffects:n.skipSideEffects,createAction:n.createAction,parentContext:r},o);default:throw new Error(`Unhandled creationMode ${t}`)}};r.postDocumentCreation=async function e(t,i){const n=this.getProgrammingModel(i);const o=i.getModel();const r=await t;const a=r[0];this._setStickySessionInternalProperties(n,o);await this.base.editFlow.onAfterCreate({context:a});this.setEditMode(Ge.Editable);if(!i.isRelative()&&n===Ne.Sticky){var c,l;const e=o.getMetaModel().getMetaContext(i.getPath());const t=Ae(e).startingEntitySet;const n=t===null||t===void 0?void 0:(c=t.annotations.Session)===null||c===void 0?void 0:(l=c.StickySessionSupported)===null||l===void 0?void 0:l.NewAction;this.getInternalModel().setProperty("/lastInvokedAction",n)}if(a){this.setDocumentModifiedOnCreate(i);if(!this._isFclEnabled()){f.setEditStateDirty()}this._sendActivity(Re.Create,a);if(h.isCollaborationDraftSupported(o.getMetaModel())&&this.isDraftRoot(a)&&!s.isConnected(this.getView())){await ke(a)}}};r.createCreateRowDocument=async function t(i){var o,r,s;const a=this.getAppComponent();const c=i.creationRow;const l=i.creationRow.getParent();let d=Promise.resolve();if(!l){return}const g=(o=l.getModel())===null||o===void 0?void 0:o.getMetaModel();const u=l.getRowBinding();if(this.getTransactionHelper().isListBindingHierarchical(u)){throw new Error(`Unhandled creationMode "CreationRow" with a TreeTable`)}const f=c.getBindingContext();const h=this.getCreationRowValidationFunction(l);if(c.data("disableAddRowButtonForEmptyData")==="true"){var p;(p=l.getBindingContext("internal"))===null||p===void 0?void 0:p.setProperty("creationRowFieldValidity",{})}const y=await this.syncTask(h);if(y.length>0){this.createCustomValidationMessages(y,l);e.error("Custom Validation failed");return}const m=Ae(g.getMetaContext(f.getPath())).targetEntityType;const v=f.getObject();await this._checkForValidationErrors();u.attachEventOnce("change",async()=>{await w;l.scrollToIndex(i.createAtEnd?l.getRowBinding().getLength():0)});this.handleCreateEvents(u);const w=this.getTransactionHelper().createDocument(u,{data:Object.assign({},...Object.keys(v).filter(e=>m.navigationProperties.findIndex(t=>t.name===e)===-1).map(e=>({[e]:v[e]}))),keepTransientContextOnFailed:false,busyMode:"Local",busyId:l===null||l===void 0?void 0:(r=l.getParent())===null||r===void 0?void 0:(s=r.getTableDefinition())===null||s===void 0?void 0:s.annotation.id,parentControl:this.getView(),beforeCreateCallBack:this.base.editFlow.onBeforeCreate,skipParameterDialog:a.getStartupMode()===$e.AutoCreate,createAtEnd:i.createAtEnd,creationMode:He.CreationRow},a,this.getMessageHandler(),false);if(!i.skipSideEffects){this.handleSideEffects(u,w)}try{var C;const t=f.getBinding();const i=t.create();c.setBindingContext(i);(C=i.created())===null||C===void 0?void 0:C.catch(()=>{e.trace("transient fast creation context deleted")});d=f.delete("$direct")}catch(t){if(n.isLocked(this.getView().getModel("ui"))){n.unlock(this.getView().getModel("ui"))}e.error("CreationRow navigation error: ",t)}return this.postDocumentCreation(Promise.all([w,d]),u)};r.createInlineDocument=async function e(t,i){var n,o,r,s;let a;if(t.tableId){a=this.getView().byId(t.tableId)}if((n=a)!==null&&n!==void 0&&n.isA("sap.ui.mdc.Table")){a.getRowBinding().attachEventOnce("change",async()=>{var e;await c;(e=a)===null||e===void 0?void 0:e.focusRow(t.createAtEnd?a.getRowBinding().getLength():0,true)})}this.handleCreateEvents(i);const c=this.getTransactionHelper().createDocument(i,{keepTransientContextOnFailed:false,busyMode:"Local",busyId:(o=a)===null||o===void 0?void 0:(r=o.getParent())===null||r===void 0?void 0:(s=r.getTableDefinition())===null||s===void 0?void 0:s.annotation.id,parentControl:this.getView(),beforeCreateCallBack:this.base.editFlow.onBeforeCreate,skipParameterDialog:this.getAppComponent().getStartupMode()===$e.AutoCreate,createAtEnd:t.createAtEnd,creationMode:He.Inline,parentContext:t.parentContext,data:t.data},this.getAppComponent(),this.getMessageHandler(),false);if(!t.skipSideEffects){this.handleSideEffects(i,c)}return this.postDocumentCreation(Promise.all([c,this.syncTask(c)]),i)};r.createDeferredDocument=async function e(t,i,o){const r=this.getGlobalUIModel();n.lock(r);await this.getInternalRouting().navigateForwardToContext(t,{createOnNavigateParameters:{mode:"Deferred",parentContext:i,listBinding:t,data:o},editable:true,forceFocus:true});n.unlock(r)};r.createSyncAsyncDocument=async function e(t,i){let o;const r=this.getGlobalUIModel();const s=this.getInternalRouting();n.lock(r);const a=this.getTransactionHelper().createDocument(i,{...t,...{parentControl:this.getView(),beforeCreateCallBack:this.base.editFlow.onBeforeCreate,skipParameterDialog:this.getAppComponent().getStartupMode()===$e.AutoCreate}},this.getAppComponent(),this.getMessageHandler(),false);if(t.bFromDeferred!==true&&!t.skipSideEffects){this.handleSideEffects(i,a)}if(t.creationMode===He.Async){o=s.navigateForwardToContext(i,{createOnNavigateParameters:{mode:"Async",createContextPromise:a},editable:true,forceFocus:true})}else{o=a.then(e=>{if(!e){const e=D.getLibraryResourceBundle("sap.fe.core");return s.navigateToMessagePage(e.getText("C_COMMON_SAPFE_DATA_RECEIVED_ERROR"),{title:e.getText("C_COMMON_SAPFE_ERROR"),description:e.getText("C_EDITFLOW_SAPFE_CREATION_FAILED_DESCRIPTION")})}else{const n={editable:true,forceFocus:true,reason:I.EditFlowAction,transient:this.getProgrammingModel(i)==Ne.Sticky||t.createAction?true:undefined};return t.bFromDeferred?s.navigateToContext(e,n):s.navigateForwardToContext(e,n)}})}try{await this.postDocumentCreation(Promise.all([a,o]),i)}catch(e){if([je.CancelActionDialog,je.ActionExecutionFailed,je.CreationFailed].includes(e)){this.getInternalRouting().navigateBackFromTransientState()}throw e}finally{n.unlock(r)}};r.createExternalDocument=async function e(t,i){if(i){if(typeof t!=="string"&&this.getTransactionHelper().isListBindingHierarchical(t)){throw new Error(`Unhandled creationMode "External" with a TreeTable`)}await this.syncTask();const e=this.getView().getController();const n=h.getAbsoluteMetaPathForListBinding(this.base.getView(),t);e._intentBasedNavigation.onChevronPressNavigateOutBound(e,i,undefined,n)}};r.validateDocument=function e(t,i){return this.getTransactionHelper().validateDocument(t,i,this.getView())};r.getCreationRowValidationFunction=function e(t){const i=t===null||t===void 0?void 0:t.getCreationRow();if(i&&t){return async()=>{const e=i.getBindingContext().getObject();delete e["@$ui5.context.isTransient"];return this.validateDocument(t.getBindingContext(),{data:e,customValidationFunction:t.getCreationRow().data("customValidationFunction")})}}return async()=>Promise.resolve()};r.createMultipleDocuments=async function i(o,r,a,c,l){let d=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;let g=arguments.length>6?arguments[6]:undefined;const u=this.getTransactionHelper();const f=this.getGlobalUIModel();const h=o;g=g!==false;if(!d){n.lock(f)}try{await this.syncTask();if(l){await l({contextPath:h.getPath()})}const e=h.getModel().getMetaModel();let i;if(h.getContext()){i=e.getMetaPath(`${h.getContext().getPath()}/${h.getPath()}`)}else{i=e.getMetaPath(h.getPath())}this.handleCreateEvents(h);const n=r.map(t=>{const n={data:{}};n.keepTransientContextOnFailed=false;n.creationMode=He.CreationRow;n.createAtEnd=a;n.inactive=d;for(const o in t){const r=e.getObject(`${i}/${o}`);if(r&&r.$kind!=="NavigationProperty"&&!o.includes("/")&&t[o]){n.data[o]=t[o]}}return u.createDocument(h,n,this.getAppComponent(),this.getMessageHandler(),c)});const o=await Promise.all(n);if(!d){this.setDocumentModifiedOnCreate(h)}const f=o.filter(e=>!e.isInactive());await Promise.all(f.map(e=>e.created()));const p=this.getView().getBindingContext();if(g&&!t.hasTransientContext(h)){this.getAppComponent().getSideEffectsService().requestSideEffectsForNavigationProperty(h.getPath(),p)}if(s.isConnected(this.getView())&&f.length>0){this._sendActivity(Re.Create,f)}return o}catch(t){e.error("Error while creating multiple documents.");throw t}finally{if(!d){n.unlock(f)}}};r.onBeforeSave=function e(t){return Promise.resolve()};r.onBeforeCreate=function e(t){return Promise.resolve()};r.onBeforeEdit=function e(t){return Promise.resolve()};r.onBeforeDiscard=function e(t){return Promise.resolve()};r.onBeforeDelete=function e(t){return Promise.resolve()};r.onAfterSave=async function e(t){return Promise.resolve()};r.onAfterCreate=async function e(t){return Promise.resolve()};r.onAfterEdit=async function e(t){return Promise.resolve()};r.onAfterDiscard=async function e(t){return Promise.resolve()};r.onAfterDelete=async function e(t){return Promise.resolve()};r.saveDocument=async function t(i,n){n=n||{};const o=n.bExecuteSideEffectsOnError||undefined;const r=this.getTransactionHelper();const a=n.bindings;try{await this.syncTask();this.getMessageHandler().removeTransitionMessages();if(n.mergePatchDraft!==true){await this._submitOpenChanges(i)}await this._checkForValidationErrors();if(this.base.recommendations.checkIfRecommendationsExist()){const e=await this.showConfirmRecommendationsDialog(true);if(e===false){return await Promise.reject("Cancel")}}await this.base.editFlow.onBeforeSave({context:i});const e=this.getProgrammingModel(i);const t=this._getRootViewController();let c;if((e===Ne.Sticky||i.getProperty("HasActiveEntity"))&&t.isFclEnabled()){c=await this._computeSiblingInformation(i,t.getRightmostContext(),e,true)}if(i.getModel().hasPendingChanges("$auto")&&n.mergePatchDraft){i.getModel().submitBatch("$auto")}const l=await r.saveDocument(i,this.getAppComponent(),this._getResourceModel(),o,a,this.getMessageHandler(),this.getCreationMode());this._removeStickySessionInternalProperties(e);await this.base.editFlow.onAfterSave({context:l});this._sendActivity(Re.Activate,l);s.disconnect(this.getView());this._triggerConfiguredSurvey(Fe.save,Oe.standardAction);this.setDocumentModified(false);this.setEditMode(Ge.Display,false);this.getMessageHandler().showMessageDialog();if(l!==i){let e=l;c=c??this._createSiblingInfo(i,l);this._updatePathsInHistory(c.pathMapping);if(t.isFclEnabled()){if(c.targetContext.getPath()!==l.getPath()){e=c.targetContext}}await this._handleNewContext(e,{editable:false,recreateContext:false,forceFocus:true})}}catch(t){if(!(t&&t.canceled)){e.error("Error while saving the document",t)}throw t}};r.toggleDraftActive=async function e(t){const i=t.getObject();let n;const o=t&&this.getProgrammingModel(t)===Ne.Draft;if(!o||!(!i.IsActiveEntity&&i.HasActiveEntity||i.IsActiveEntity&&i.HasDraftEntity)){return}if(!i.IsActiveEntity&&i.HasActiveEntity){n=false}else{n=true}try{const e=this._getRootViewController();const i=e.isFclEnabled()?e.getRightmostContext():t;let o=await this._computeSiblingInformation(t,i,Ne.Draft,false);if(!o&&t!==i){o=await this._computeSiblingInformation(t,t,Ne.Draft,false)}if(o){this.setEditMode(n?Ge.Editable:Ge.Display,false);if(e.isFclEnabled()){const e=this._getSemanticMapping();if((e===null||e===void 0?void 0:e.technicalPath)===t.getPath()){const t=o.pathMapping[o.pathMapping.length-1].newPath;o.pathMapping.push({oldPath:e.semanticPath,newPath:t})}}this._updatePathsInHistory(o.pathMapping);await this._handleNewContext(o.targetContext,{editable:n,recreateContext:true,forceFocus:true})}else{throw new Error("Error in EditFlow.toggleDraftActive - Cannot find sibling")}}catch(e){throw new Error(`Error in EditFlow.toggleDraftActive:${e}`)}};r.cancelDocument=async function t(i,n){const o=this.getTransactionHelper();const r=n;let a;let c=false;r.cancelButton=n.control||r.cancelButton;r.beforeCancelCallBack=this.base.editFlow.onBeforeDiscard;try{await this.syncTask();const e=this.getProgrammingModel(i);if((e===Ne.Sticky||i.getProperty("HasActiveEntity"))&&this._isFclEnabled()){const t=this._getRootViewController();a=await this._computeSiblingInformation(i,t.getRightmostContext(),e,true)}const t=await o.cancelDocument(i,r,this.getAppComponent(),this._getResourceModel(),this.getMessageHandler(),this.getCreationMode(),this.isDocumentModified());this._getRootViewController().getInstancedViews().forEach(e=>{const t=e.getBindingContext();if(t&&t.isKeepAlive()){t.setKeepAlive(false)}});this._removeStickySessionInternalProperties(e);this.setEditMode(Ge.Display,false);this.setDocumentModified(false);this.setDraftStatus(Le.Clear);await this.base.editFlow.onAfterDiscard({context:typeof t==="boolean"||t===null?undefined:t});f.setEditStateDirty();if(!t){this._sendActivity(Re.Discard,undefined);s.disconnect(this.getView());if(!r.skipBackNavigation){await this.getInternalRouting().navigateBackFromContext(i);c=true}}else{const n=t;this._sendActivity(Re.Discard,n);s.disconnect(this.getView());let o=n;a=a??this._createSiblingInfo(i,n);this._updatePathsInHistory(a.pathMapping);if(this._isFclEnabled()){if(a.targetContext.getPath()!==n.getPath()){o=a.targetContext}}if(e===Ne.Draft){await this._fetchSemanticKeyValues(n);if(!r.skipBindingToView){await this._handleNewContext(o,{editable:false,recreateContext:true,forceFocus:true})}else{return n}}else{await this._handleNewContext(o,{editable:false,recreateContext:false,forceFocus:true})}}if(e===Ne.Draft){this.showDocumentDiscardMessage(c)}}catch(t){e.error("Error while discarding the document",t)}};r.showDocumentDiscardMessage=function e(t){const i=this._getResourceModel();const n=i.getText("C_TRANSACTION_HELPER_DISCARD_DRAFT_TOAST");if(t==true){const e=this.getAppComponent();e.getRoutingService().attachAfterRouteMatched(this.showMessageWhenNoContext,this)}else{C.show(n)}};r.showMessageWhenNoContext=function e(){const t=this._getResourceModel();const i=t.getText("C_TRANSACTION_HELPER_DISCARD_DRAFT_TOAST");const n=this.getAppComponent();C.show(i);n.getRoutingService().detachAfterRouteMatched(this.showMessageWhenNoContext,this)};r.isDraftRoot=function e(t){const i=t.getModel().getMetaModel();const n=i.getMetaContext(t.getPath());return h.isDraftRoot(Ae(n).targetEntitySet)};r.deleteDocument=async function t(i,n){const o=this.getAppComponent();let r=n;if(!r){r={bFindActiveContexts:false}}else{r.bFindActiveContexts=false}r.beforeDeleteCallBack=this.base.editFlow.onBeforeDelete;try{if(this._isFclEnabled()&&this.isDraftRoot(i)&&i.getIndex()===undefined&&i.getProperty("IsActiveEntity")===true&&i.getProperty("HasDraftEntity")===true){r.beforeDeleteCallBack=async t=>{await this.base.editFlow.onBeforeDelete(t);try{const e=i.getModel();const t=e.bindContext(`${i.getPath()}/SiblingEntity`).getBoundContext();const n=await t.requestCanonicalPath();const o=e.getKeepAliveContext(n);o.replaceWith(i)}catch(t){e.error("Error while replacing the draft instance in the LR ODLB",t)}}}if(this.getProgrammingModel(i)===Ne.Sticky){this.setDocumentModified(true)}await this.deleteDocumentTransaction(i,r);if(!this._isFclEnabled()){f.setEditStateDirty()}this._sendActivity(Re.Delete,i);if(o){o.getShellServices().setBackNavigation()}await this.base.editFlow.onAfterDelete({contexts:[i]});if((o===null||o===void 0?void 0:o.getStartupMode())===$e.Deeplink&&!this._isFclEnabled()){o.getRouterProxy().exitFromApp()}else{this.getInternalRouting().navigateBackFromContext(i)}}catch(t){e.error("Error while deleting the document",t)}};r.applyDocument=async function e(t){const i=this.getGlobalUIModel();try{await this.syncTask();if(t.getModel().hasPendingChanges("$auto")){n.lock(i);await this._submitOpenChanges(t)}if(this.base.recommendations.checkIfRecommendationsExist()){const e=await this.showConfirmRecommendationsDialog(false);if(e===false){return}}await this._checkForValidationErrors();await this.getMessageHandler().showMessageDialog();await this.getInternalRouting().navigateBackFromContext(t)}finally{if(n.isLocked(i)){n.unlock(i)}}};r.invokeAction=async function t(i,n,o){var r;let a;const c=this.getTransactionHelper();let l;let d;let g;const u=this.base.getView();let h=n||{};if(h.isA&&h.isA("sap.ui.model.odata.v4.Context")||Array.isArray(h)||o!==undefined){const e=h;h=o||{};if(e){h.contexts=e}else{h.model=this.getView().getModel()}}h.isNavigable=h.requiresNavigation||h.isNavigable;const p=xe((r=this.getView().getModel())===null||r===void 0?void 0:r.getMetaModel());if(i.includes(""+p.entityContainer.name)){h.isBound=false}else{h.isBound=true}if(!h.parentControl){h.parentControl=this.getView()}if(!h.entitySetName&&h.contexts&&h.model){h.entitySetName=h.model.getMetaModel().getMetaContext(h.contexts.getPath()).getObject("@sapui.name")}if(h.controlId){a=this.getView().byId(h.controlId);if(a){h.internalModelContext=a.getBindingContext("internal")}}else{h.internalModelContext=u.getBindingContext("internal")}if(i&&i.includes("(")){l=i.split("(");i=l[0];d=l[l.length-1].replaceAll(")","")}if(h.bStaticAction){if(a.isTableBound()){var y;h.contexts=((y=this.getView().getModel())===null||y===void 0?void 0:y.bindList(a.getRowBinding().getHeaderContext().getPath())).getHeaderContext()}else{const e=a.data("rowsBindingInfo").path,t=new x(this.getView().getModel(),e);h.contexts=t.getHeaderContext()}if(d&&a.getBindingContext()){h.contexts=this._getActionOverloadContextFromMetadataPath(a.getBindingContext(),a.getRowBinding(),d)}if(h.enableAutoScroll){g=this.createActionPromise(i,a.sId)}}h.bGetBoundContext=this._getBoundContext(u,h);h.bObjectPage=u.getViewData().converterType==="ObjectPage";try{await this.syncTask();const t=await c.callAction(i,h,this.getView(),this.getAppComponent(),this.getMessageHandler());let n;if(h.contexts&&h.isBound===true){n=await this._refreshListIfRequired(this.getActionResponseDataAndKeys(i,t),h.contexts[0])}if(s.isConnected(this.getView())){let e=[];if(t){e=Array.isArray(t)?Object.keys(t[0].value.getObject()):Object.keys(t.getObject())}this._sendActivity(Re.Action,h.contexts,i,n,e)}this._triggerConfiguredSurvey(i,Oe.action);if(g){g.fResolver(t)}if(h.contexts){if(!this._isFclEnabled()){f.setEditStateDirty()}this.getInternalModel().setProperty("/lastInvokedAction",i)}if(h.isNavigable){let i=t;if(Array.isArray(i)&&i.length===1){i=i[0].value}if(i&&!Array.isArray(i)){const t=u.getModel().getMetaModel();const n=t.getMetaPath(i.getPath());const o=(e,t)=>e.filter(e=>{if(t){return t.indexOf(e)>-1}return true});const r=Array.isArray(h.contexts)?o(h.contexts,h.applicableContexts)[0]:h.contexts;const s=r&&t.getMetaPath(r.getPath());if(n!=undefined&&n===s){if(r.getPath()!==i.getPath()){this.getInternalRouting().navigateForwardToContext(i,{checkNoHashChange:true})}else{e.info("Navigation to the same context is not allowed")}}}}this.base.editFlow.onAfterActionExecution(i);return t}catch(e){if(g){g.fRejector()}if(e===je.CancelActionDialog){throw new Error("Dialog cancelled")}else if(!(e&&(e.canceled||e.rejectedItems&&e.rejectedItems[0].canceled))){throw new Error(`Error in EditFlow.invokeAction:${e}`)}}};r.onAfterActionExecution=async function e(t){};r.securedExecution=function e(t,i){var o,r;const s=(i===null||i===void 0?void 0:(o=i.busy)===null||o===void 0?void 0:o.set)??true,a=(i===null||i===void 0?void 0:(r=i.busy)===null||r===void 0?void 0:r.check)??true,c=(i===null||i===void 0?void 0:i.updatesDocument)??false,l=this.getGlobalUIModel(),d=this.getView().getBindingContext(),g=d&&this.getProgrammingModel(d)===Ne.Draft;if(a&&n.isLocked(l)){return Promise.reject("Application already busy therefore execution rejected")}if(s){n.lock(l)}if(c&&g){this.setDraftStatus(Le.Saving)}this.getMessageHandler().removeTransitionMessages();return this.syncTask(t).then(()=>{if(c){this.setDocumentModified(true);if(!this._isFclEnabled()){f.setEditStateDirty()}if(g){this.setDraftStatus(Le.Saved)}}}).catch(e=>{if(c&&g){this.setDraftStatus(Le.Clear)}return Promise.reject(e)}).finally(()=>{if(s){n.unlock(l)}this.getMessageHandler().showMessageDialog()})};r.handlePatchSent=function e(t){var i,n;const o=s.isConnected(this.getView());if(o){t.getSource().getModel().setIgnoreETag(true)}if(!((i=this.getView())!==null&&i!==void 0&&(n=i.getBindingContext("internal"))!==null&&n!==void 0&&n.getProperty("skipPatchHandlers"))){const e=t.getSource();const i=new Promise((i,n)=>{t.getSource().attachEventOnce("patchCompleted",r=>{if(o){t.getSource().getModel().setIgnoreETag(false)}if(t.getSource().isA("sap.ui.model.odata.v4.ODataListBinding")){var s;k.setActionEnablementAfterPatch(this.getView(),e,(s=this.getView())===null||s===void 0?void 0:s.getBindingContext("internal"))}const a=r.getParameter("success");if(a){i()}else{n()}})});this.updateDocument(e,i)}};r.syncTask=function e(t){if(t){if(typeof t==="function"){this.syncTasks=this.syncTasks.then(t).catch(function(){return Promise.resolve()})}else{this.syncTasks=this.syncTasks.then(()=>t).catch(function(){return Promise.resolve()})}}return this.syncTasks};r.computeEditMode=async function t(i){const n=this.getProgrammingModel(i);if(n===Ne.Draft){try{this.setDraftStatus(Le.Clear);const e=this.getGlobalUIModel();e.setProperty("/isEditablePending",true,undefined,true);const t=await i.requestObject("IsActiveEntity");if(t===false){this.setEditMode(Ge.Editable);const e=await i.requestObject("HasActiveEntity");this.setEditMode(undefined,!e)}else{this.setEditMode(Ge.Display,false)}e.setProperty("/isEditablePending",false,undefined,true)}catch(t){e.error("Error while determining the editMode for draft",t);throw t}}else if(n===Ne.Sticky){const e=this.getInternalModel().getProperty("/lastInvokedAction");if(e&&this.isNewActionForSticky(e,i)){this.setEditMode(Ge.Editable,true);if(!this.getAppComponent()._isFclEnabled()){f.setEditStateDirty()}this.handleStickyOn(i);this._setStickySessionInternalProperties(this.getProgrammingModel(i),i.getModel());this.getInternalModel().setProperty("/lastInvokedAction",undefined)}}};r.deleteDocumentTransaction=async function e(t,i){var n;const o=this._getResourceModel();const r=this.getTransactionHelper();i.internalModelContext=i.controlId?(n=sap.ui.getCore().byId(i.controlId))===null||n===void 0?void 0:n.getBindingContext("internal"):null;await this.syncTask();await r.deleteDocument(t,i,this.getAppComponent(),o,this.getMessageHandler())};r._getResourceModel=function e(){return De(this.getView())};r.getTransactionHelper=function e(){return c};r.getMessageHandler=function e(){if(this.base.messageHandler){return this.base.messageHandler}else{throw new Error("Edit Flow works only with a given message handler")}};r.getInternalModel=function e(){return this.getView().getModel("internal")};r.getGlobalUIModel=function e(){return this.getView().getModel("ui")};r.setCreationMode=function e(t){const i=this.getView().getBindingContext("ui");this.getGlobalUIModel().setProperty("createMode",t,i,true)};r.getCreationMode=function e(){const t=this.getView().getBindingContext("ui");return!!this.getGlobalUIModel().getProperty("createMode",t)};r.isDocumentModified=function e(){return!!this.getGlobalUIModel().getProperty("/isDocumentModified")};r.setDocumentModified=function e(t){this.getGlobalUIModel().setProperty("/isDocumentModified",t)};r.setDocumentModifiedOnCreate=function e(t){if(t.isRelative()){this.setDocumentModified(true)}};r.handleCreateEvents=function e(t){this.setDraftStatus(Le.Clear);const i=this.getProgrammingModel(t);t.attachEvent("createSent",()=>{if(i===Ne.Draft){this.setDraftStatus(Le.Saving)}});t.attachEvent("createCompleted",e=>{const t=e.getParameter("success");if(i===Ne.Draft){this.setDraftStatus(t?Le.Saved:Le.Clear)}this.getMessageHandler().showMessageDialog()})};r.setDraftStatus=function e(t){this.getView().getModel("ui").setProperty("/draftStatus",t,undefined,true)};r.getProgrammingModel=function e(t){return this.getTransactionHelper().getProgrammingModel(t)};r.setEditMode=function e(t,i){const n=this.getGlobalUIModel();if(t){n.setProperty("/isEditable",t==="Editable",undefined,true)}if(i!==undefined){this.setCreationMode(i)}};r.isNewActionForSticky=function t(i,n){try{var o;const e=n.getModel().getMetaModel();const t=e.getMetaContext(n.getPath());const r=Ae(t).startingEntitySet;const s=(o=r.annotations.Session)===null||o===void 0?void 0:o.StickySessionSupported;if((s===null||s===void 0?void 0:s.NewAction)===i){return true}if(s!==null&&s!==void 0&&s.AdditionalNewActions&&s!==null&&s!==void 0&&s.AdditionalNewActions.includes(i)){return true}return false}catch(t){e.info(t);return false}};r.handleStickyOn=function t(i){const n=this.getAppComponent();try{if(n===undefined){throw new Error("undefined AppComponent for function handleStickyOn")}if(!n.getRouterProxy().hasNavigationGuard()){const e=n.getRouterProxy().getHash();const t=this.getInternalModel();setTimeout(function(){n.getRouterProxy().setNavigationGuard(i.getPath().substring(1))},0);n.getShellServices().setBackNavigation(this.onBackNavigationInSession.bind(this,i));this.dirtyStateProviderFunction=this.getDirtyStateProvider(n,t,e);n.getShellServices().registerDirtyStateProvider(this.dirtyStateProviderFunction);const o=this.base.getView().getModel("sap.fe.i18n");this.sessionTimeoutFunction=this.getSessionTimeoutFunction(i,o);this.getView().getModel().attachSessionTimeout(this.sessionTimeoutFunction);this.stickyDiscardAfterNavigationFunction=this.getRouteMatchedFunction(i,n);n.getRoutingService().attachRouteMatched(this.stickyDiscardAfterNavigationFunction)}}catch(t){e.info(t);return false}return true};r.handleStickyOff=function t(){const i=this.getAppComponent();try{if(i===undefined){throw new Error("undefined AppComponent for function handleStickyOff")}if(i.getRouterProxy){i.getRouterProxy().discardNavigationGuard()}if(this.dirtyStateProviderFunction){i.getShellServices().deregisterDirtyStateProvider(this.dirtyStateProviderFunction);this.dirtyStateProviderFunction=undefined}const e=this.getView().getModel();if(e&&this.sessionTimeoutFunction){e.detachSessionTimeout(this.sessionTimeoutFunction)}if(this.stickyDiscardAfterNavigationFunction){i.getRoutingService().detachRouteMatched(this.stickyDiscardAfterNavigationFunction)}this.stickyDiscardAfterNavigationFunction=undefined;this.setEditMode(Ge.Display,false);if(i.getShellServices){i.getShellServices().setBackNavigation()}}catch(t){e.info(t);return false}return true};r._setStickySessionInternalProperties=function e(t,i){if(t===Ne.Sticky){const e=this.getInternalModel();e.setProperty("/sessionOn",true);e.setProperty("/stickySessionToken",i.getHttpHeaders(true)["SAP-ContextId"])}};r.getDirtyStateProvider=function t(i,n,o){return t=>{try{if(t===undefined){throw new Error("Invalid input parameters for DirtyStateProvider function")}const e=t.innerAppRoute;const r=i.getRouterProxy();let s="";let a;const c=n.getProperty("/sessionOn");if(!c){return undefined}if(!r.isNavigationFinalized()){a=false;s=e}else if(o===e){a=true}else if(r.checkHashWithGuard(e)||r.isGuardCrossAllowedByUser()){s=e;a=false}else{a=true}if(a){setTimeout(function(){i.getShellServices().setDirtyFlag(false)},0)}else{o=s}return a}catch(t){e.info(t);return undefined}}};r.getSessionTimeoutFunction=function t(i,n){return()=>{try{if(i===undefined){throw new Error("Context missing for SessionTimeout function")}this.getMessageHandler().removeTransitionMessages();const e=new w({title:"{sap.fe.i18n>C_EDITFLOW_OBJECT_PAGE_SESSION_EXPIRED_DIALOG_TITLE}",state:"Warning",content:new M({text:"{sap.fe.i18n>C_EDITFLOW_OBJECT_PAGE_SESSION_EXPIRED_DIALOG_MESSAGE}"}),beginButton:new v({text:"{sap.fe.i18n>C_COMMON_DIALOG_OK}",type:"Emphasized",press:()=>{this.handleStickyOff();this.getInternalRouting().navigateBackFromContext(i)}}),afterClose:function(){e.destroy()}});e.addStyleClass("sapUiContentPadding");e.setModel(n,"sap.fe.i18n");this.getView().addDependent(e);e.open()}catch(t){e.info(t);return undefined}return true}};r.getRouteMatchedFunction=function e(t,i){return()=>{const e=i.getRouterProxy().getHash();if(!e||!i.getRouterProxy().checkHashWithGuard(e)){this.discardStickySession(t);t.getModel().clearSessionContext()}}};r.discardStickySession=async function e(t){const i=await d.discardDocument(t);if(i!==null&&i!==void 0&&i.hasPendingChanges()){i.getBinding().resetChanges()}if(!this.getCreationMode()){i===null||i===void 0?void 0:i.refresh()}this.handleStickyOff()};r.getInternalRouting=function e(){if(this.base._routing){return this.base._routing}else{throw new Error("Edit Flow works only with a given routing listener")}};r._getRootViewController=function e(){return this.getAppComponent().getRootViewController()};r._getSemanticMapping=function e(){return this.getAppComponent().getRoutingService().getLastSemanticMapping()};r.createActionPromise=function e(t,i){let n,o;this.actionPromise=new Promise((e,t)=>{n=e;o=t}).then(e=>Object.assign({controlId:i},this.getActionResponseDataAndKeys(t,e)));return{fResolver:n,fRejector:o}};r.getActionResponseDataAndKeys=function e(t,i){if(Array.isArray(i)){if(i.length===1){i=i[0].value}else{return null}}if(!i){return null}const n=this.base.getView();const o=n.getModel().getMetaModel().getData();const r=o&&o[t]&&o[t][0]&&o[t][0].$ReturnType?o[t][0].$ReturnType.$Type:null;const s=r&&o[r]?o[r].$Key:null;return{oData:i.getObject(),keys:s}};r.getCurrentActionPromise=function e(){return this.actionPromise};r.deleteCurrentActionPromise=function e(){this.actionPromise=undefined};r.showConfirmRecommendationsDialog=async function e(t){var i;if(!this.confirmRecommendationsDialog){this.confirmRecommendationsDialog=new R({view:this.getView()})}return(i=this.confirmRecommendationsDialog)===null||i===void 0?void 0:i.open(t)};r._scrollAndFocusOnInactiveRow=function e(t){const i=t.getRowBinding();const n=i.getCount()||0;if(t.data("tableType")!=="ResponsiveTable"){if(n>0){t.scrollToIndex(n-1)}t.focusRow(n,true)}else{const e=i.getContexts();if(!(e!==null&&e!==void 0&&e.length)){t.focusRow(n,true);return}let o=n,r=0;for(const t of e){if(t.isInactive()&&r<o){o=r}r++}if(o>0){t.scrollToIndex(o)}t.focusRow(o,true)}};r.createEmptyRowsAndFocus=async function e(t){var i,n,o;const r=t.getParent();if(r!==null&&r!==void 0&&(i=r.tableDefinition)!==null&&i!==void 0&&(n=i.control)!==null&&n!==void 0&&n.inlineCreationRowsHiddenInEditMode&&!((o=t.getBindingContext("ui"))!==null&&o!==void 0&&o.getProperty("createMode"))){await r.setUpEmptyRows(t,true)}this._scrollAndFocusOnInactiveRow(t)};r._sendActivity=function e(t,i,n,o,r){const a=Array.isArray(i)?i.map(e=>e.getPath()):i===null||i===void 0?void 0:i.getPath();s.send(this.getView(),{action:t,content:a,triggeredActionName:n,refreshListBinding:o,actionRequestedProperties:r})};r._triggerConfiguredSurvey=function e(t,i){_e(this.getView(),t,i)};r._submitOpenChanges=async function e(t){const i=t.getModel(),o=this.getGlobalUIModel();try{await i.submitBatch("$auto");await i.oRequestor.waitForRunningChangeRequests("$auto");if(i.hasPendingChanges("$auto")){throw new Error("submit of open changes failed")}}finally{if(n.isLocked(o)){n.unlock(o)}}};r._removeStickySessionInternalProperties=function e(t){if(t===Ne.Sticky){const e=this.getInternalModel();e.setProperty("/sessionOn",false);e.setProperty("/stickySessionToken",undefined);this.handleStickyOff()}};r.onBackNavigationInSession=function e(t){const i=this.base.getView();const n=this.getAppComponent().getRouterProxy();if(n.checkIfBackIsOutOfGuard()){d.processDataLossConfirmation(async()=>{await this.discardStickySession(t);this._removeStickySessionInternalProperties(Ne.Sticky);history.back()},i,Ne.Sticky);return}history.back()};r._handleNewContext=async function e(t,i){if(!this._isFclEnabled()){f.setEditStateDirty()}await this.getInternalRouting().navigateToContext(t,{checkNoHashChange:true,editable:i.editable,persistOPScroll:true,recreateContext:i.recreateContext,reason:I.EditFlowAction,showPlaceholder:false,forceFocus:i.forceFocus??false,keepCurrentLayout:true})};r._getBoundContext=function e(t,i){const n=t.getViewData().viewLevel;const o=n>1||n===1&&i.controlId;return!i.isNavigable||!!o};r._checkForValidationErrors=async function t(){return this.syncTask().then(()=>{const t=this.getView().getId();const i=D.getMessageManager().getMessageModel().getData();let n;let o;if(!i.length){e.info("No validation errors found");return}for(let e=0;e<i.length;e++){o=i[e];if(o.validation){n=D.byId(o.getControlId());while(n){if(n.getId()===t){throw"validation errors exist"}n=n.getParent()}}}})};r._refreshListIfRequired=function t(i,n){if(!n||!i||!i.oData||!i.keys){return Promise.resolve(undefined)}const o=n.getBinding();if(o&&o.isA("sap.ui.model.odata.v4.ODataListBinding")){const t=i.oData;const r=i.keys;const s=n.getObject();let a=true;if(Object.keys(t).length){a=r.every(function(e){return s[e]===t[e]});if(!a){return new Promise(t=>{if(o.isRoot()){o.attachEventOnce("dataReceived",function(){t(!a)});o.refresh()}else{const i=this.getAppComponent();i.getSideEffectsService().requestSideEffects([{$NavigationPropertyPath:o.getPath()}],o.getContext()).then(function(){t(!a)},function(){e.error("Error while refreshing the table");t(!a)}).catch(function(t){e.error("Error while refreshing the table",t)})}})}}}return Promise.resolve(undefined)};r._fetchSemanticKeyValues=function e(t){const i=t.getModel().getMetaModel(),n=i.getMetaContext(t.getPath()).getObject("@sapui.name"),o=y.getSemanticKeys(i,n);if(o&&o.length){const e=o.map(function(e){return t.requestObject(e.$PropertyPath)});return Promise.all(e)}else{return Promise.resolve()}};r._getActionOverloadContextFromMetadataPath=function e(t,i,n){const o=t.getModel();const r=o.getMetaModel();let s=i.getPath().split("/");let a=t;s.pop();if(s.length===0){s=[""]}if(s[0]!==""){s.unshift("")}const c=s.map(e=>{if(e!==""){a=o.bindContext(e,a).getBoundContext()}else{a=t}return a}).reverse();const l=c.find(e=>r.getMetaContext(e.getPath()).getObject("$Type")===n);return l||i.getHeaderContext()};r._createSiblingInfo=function e(t,i){return{targetContext:i,pathMapping:[{oldPath:t.getPath(),newPath:i.getPath()}]}};r._updatePathsInHistory=function e(t){const i=this.getAppComponent();i.getRouterProxy().setPathMapping(t);const n=this._getSemanticMapping();if(t.length&&(n===null||n===void 0?void 0:n.technicalPath)===t[t.length-1].oldPath){n.technicalPath=t[t.length-1].newPath}};r._getNavigationTargetForEdit=function e(t,i,n){let o;n=n??this._createSiblingInfo(t,i);this._updatePathsInHistory(n.pathMapping);if(n.targetContext.getPath()!=i.getPath()){o=n.targetContext}return o};r._computeSiblingInformation=async function t(i,n,o,r,s,a){n=n??i;if(!n.getPath().startsWith(i.getPath())){e.error("Cannot compute rightmost sibling context");throw new Error("Cannot compute rightmost sibling context")}if(r&&n.getPath()===i.getPath()){return Promise.resolve(undefined)}const c=i.getModel();if(o===Ne.Draft){return l.computeSiblingInformation(i,n,s,a)}else{return{targetContext:c.bindContext(n.getPath()).getBoundContext(),pathMapping:[]}}};r._isFclEnabled=function e(){return this.getAppComponent()._isFclEnabled()};return o}(i),Ve(Me.prototype,"editDocument",[O,F],Object.getOwnPropertyDescriptor(Me.prototype,"editDocument"),Me.prototype),Ve(Me.prototype,"updateDocument",[T,B],Object.getOwnPropertyDescriptor(Me.prototype,"updateDocument"),Me.prototype),Ve(Me.prototype,"createDocument",[V,H],Object.getOwnPropertyDescriptor(Me.prototype,"createDocument"),Me.prototype),Ve(Me.prototype,"onBeforeSave",[N,j],Object.getOwnPropertyDescriptor(Me.prototype,"onBeforeSave"),Me.prototype),Ve(Me.prototype,"onBeforeCreate",[L,G],Object.getOwnPropertyDescriptor(Me.prototype,"onBeforeCreate"),Me.prototype),Ve(Me.prototype,"onBeforeEdit",[$,U],Object.getOwnPropertyDescriptor(Me.prototype,"onBeforeEdit"),Me.prototype),Ve(Me.prototype,"onBeforeDiscard",[q,K],Object.getOwnPropertyDescriptor(Me.prototype,"onBeforeDiscard"),Me.prototype),Ve(Me.prototype,"onBeforeDelete",[W,z],Object.getOwnPropertyDescriptor(Me.prototype,"onBeforeDelete"),Me.prototype),Ve(Me.prototype,"onAfterSave",[J,Q,X],Object.getOwnPropertyDescriptor(Me.prototype,"onAfterSave"),Me.prototype),Ve(Me.prototype,"onAfterCreate",[Y,Z],Object.getOwnPropertyDescriptor(Me.prototype,"onAfterCreate"),Me.prototype),Ve(Me.prototype,"onAfterEdit",[ee,te],Object.getOwnPropertyDescriptor(Me.prototype,"onAfterEdit"),Me.prototype),Ve(Me.prototype,"onAfterDiscard",[ie,ne],Object.getOwnPropertyDescriptor(Me.prototype,"onAfterDiscard"),Me.prototype),Ve(Me.prototype,"onAfterDelete",[oe,re],Object.getOwnPropertyDescriptor(Me.prototype,"onAfterDelete"),Me.prototype),Ve(Me.prototype,"saveDocument",[se,ae],Object.getOwnPropertyDescriptor(Me.prototype,"saveDocument"),Me.prototype),Ve(Me.prototype,"cancelDocument",[ce,le],Object.getOwnPropertyDescriptor(Me.prototype,"cancelDocument"),Me.prototype),Ve(Me.prototype,"deleteDocument",[de,ge],Object.getOwnPropertyDescriptor(Me.prototype,"deleteDocument"),Me.prototype),Ve(Me.prototype,"applyDocument",[ue,fe],Object.getOwnPropertyDescriptor(Me.prototype,"applyDocument"),Me.prototype),Ve(Me.prototype,"invokeAction",[he,pe],Object.getOwnPropertyDescriptor(Me.prototype,"invokeAction"),Me.prototype),Ve(Me.prototype,"onAfterActionExecution",[ye,me],Object.getOwnPropertyDescriptor(Me.prototype,"onAfterActionExecution"),Me.prototype),Ve(Me.prototype,"securedExecution",[ve,we],Object.getOwnPropertyDescriptor(Me.prototype,"securedExecution"),Me.prototype),Me))||Ce);return qe},false);
//# sourceMappingURL=EditFlow.js.map