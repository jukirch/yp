/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/array/uniqueSort","sap/base/util/merge","sap/fe/core/converters/ConverterContext","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/BindingToolkit","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/SemanticDateOperators","sap/fe/core/helpers/StableIdHelper","sap/fe/core/library","sap/ui/Device","sap/ui/core/Component","sap/ui/core/Fragment","sap/ui/core/XMLTemplateProcessor","sap/ui/core/util/XMLPreprocessor","sap/ui/mdc/condition/FilterOperatorUtil","sap/ui/mdc/odata/v4/TypeMap","sap/ui/model/Filter","./controls/AnyElement","./helpers/MetaModelFunction"],function(e,t,n,o,i,r,s,a,c,l,u,p,f,g,d,m,b,O,P,h){"use strict";var v={};var y=c.generate;var j=r.pathInModel;var S=r.compileExpression;const A=l.ProgrammingModel;function C(e){if(!e){return undefined}return e.replace(/"/g," ").replace(/\\/g,"\\\\").split(/\s+/).reduce(function(e,t){if(t!==""){e=`${e?`${e} `:""}"${t}"`}return e},undefined)}async function E(e){var t;const n=e.getModel();const o=n.getMetaModel();const r=o.getMetaPath(e.getPath());const s=i.getInvolvedDataModelObjects(o.getContext(r));await e.requestProperty((t=s.targetEntityType.keys[0])===null||t===void 0?void 0:t.name)}function T(e){let t=false;if(e){e.getCurrentContexts().forEach(function(e){if(e&&e.isTransient()){t=true}})}return t}async function x(e,t,n,o){return e.getLinks({semanticObject:n,params:o})}function $(e){const t=[];const n=Object.keys(e);let o;for(const i of n){o={LocalProperty:{$PropertyPath:i},SemanticObjectProperty:e[i]};t.push(o)}return t}function M(e,t,n,o,i){for(const r of e){const e=r;const s=e.intent;const a=s.split("-")[1].split("?")[0];if(i&&i.includes(a)||!i&&t&&!t.includes(a)){o.push({text:e.text,targetSemObject:s.split("#")[1].split("-")[0],targetAction:a.split("~")[0],targetParams:n})}}}function F(e,t,n,o){if(o&&o.length>0){const i=e.allowedActions||undefined;const r=e.unavailableActions?e.unavailableActions:[];const s=e.mapping?$(e.mapping):[];const a={navigationContexts:t,semanticObjectMapping:s};M(o,r,a,n,i)}}function R(e,t,n,o){if(o.length>0){const i=[e.action];const r=[];const s=[];const a={navigationContexts:t,semanticObjectMapping:s};M(o,r,a,n,i)}}async function N(t,n,o,i,r,s,a){const c=a.getShellServices();const l={};let u="",p="";let f;let g=[];let d=[];let m;async function b(){const e=c.parseShellHash(document.location.hash);u=e.semanticObject;p=e.action;return x(c,o,u,l)}try{if(n){if(i&&i.length>0){for(const e of i){const t=e.$PropertyPath;if(!l[t]){l[t]={value:n[t]}}}}else{const e=r.getObject(`${s}/$Type/$Key`);for(const t in e){const o=e[t];if(!l[o]){l[o]={value:n[o]}}}}}const e=I(o).getViewData();const O=[];let P;if(e.additionalSemanticObjects){m=Object.keys(e.additionalSemanticObjects);for(const n of m){P=await Promise.resolve(x(c,o,n,l));F(e.additionalSemanticObjects[n],t,O,P)}}const h=[];const v=a.getComponentData();if(v.feEnvironment&&v.feEnvironment.getIntent()){const e=v.feEnvironment.getIntent();P=await Promise.resolve(x(c,o,e.semanticObject,l));R(e,t,h,P)}const y=o.getBindingContext("internal");const j=await b();if(j){if(j.length>0){let n=false;const o={};const i=[];const a=`${s}@`;const c=`${s}/@`;const l=r.getObject(a);f=Re.getSemanticObjectAnnotations(l,u);if(!f.bHasEntitySetSO){const e=r.getObject(c);f=Re.getSemanticObjectAnnotations(e,u)}d=f.aUnavailableActions;d.push(p);o.navigationContexts=t;o.semanticObjectMapping=f.aMappings;M(j,d,o,i);O.forEach(function(e){var t;let{targetSemObject:o}=e;if(((t=i[0])===null||t===void 0?void 0:t.targetSemObject)===o){n=true}});if(e.additionalSemanticObjects&&i[0]&&e.additionalSemanticObjects[i[0].targetSemObject]&&!!e.additionalSemanticObjects[i[0].targetSemObject].allowedActions){n=true}const m=O.concat(h);g=n?m:m.concat(i);y.setProperty("relatedApps/visibility",g.length>0);y.setProperty("relatedApps/items",g)}else{y.setProperty("relatedApps/visibility",false)}}else{y.setProperty("relatedApps/visibility",false)}}catch(t){e.error("Cannot read links",t)}return g}function w(e,t){const n={bHasEntitySetSO:false,aAllowedActions:[],aUnavailableActions:[],aMappings:[]};let o,i;let r;for(const s in e){if(s.includes("com.sap.vocabularies.Common.v1.SemanticObject")&&e[s]===t){n.bHasEntitySetSO=true;o=`@${"com.sap.vocabularies.Common.v1.SemanticObjectMapping"}`;i=`@${"com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions"}`;if(s.includes("#")){r=s.split("#")[1];o=`${o}#${r}`;i=`${i}#${r}`}if(e[o]){n.aMappings=n.aMappings.concat(e[o])}if(e[i]){n.aUnavailableActions=n.aUnavailableActions.concat(e[i])}break}}return n}function D(t,n){const o=t.getModel().getMetaModel();const i=t.getBindingContext();const r=i&&i.getPath()||"";const s=o.getMetaPath(r);const a=`${s}/`+`@com.sap.vocabularies.Common.v1.SemanticKey`;const c=o.getObject(a);const l=i===null||i===void 0?void 0:i.getObject();if(!l&&i){i.requestObject().then(async function(e){return Re.updateRelateAppsModel(i,e,t,c,o,s,n)}).catch(function(t){e.error("Cannot update the related app details",t)})}else{return Re.updateRelateAppsModel(i,l,t,c,o,s,n)}}function L(e){if(e&&e.isA(["sap.m.Button","sap.m.OverflowToolbarButton"])&&e.getVisible()&&e.getEnabled()){e.firePress()}}function k(e){if(e.isA("sap.fe.core.AppComponent")){return e}const t=p.getOwnerComponentFor(e);if(!t){throw new Error("There should be a sap.fe.core.AppComponent as owner of the control")}else{return k(t)}}function B(e){const t=e.getRootViewController();return t.isFclEnabled()?t.getRightmostView():Re.getTargetView(e.getRootContainer().getCurrentPage())}function I(e){if(e&&e.isA("sap.ui.core.ComponentContainer")){const t=e.getComponentInstance();e=t&&t.getRootControl()}while(e&&!e.isA("sap.ui.core.mvc.View")){e=e.getParent()}return e}function V(e,t){for(const n in t){if(t[n]!==e[n]){return false}}return true}function q(e,t,n){const o=e.getObject(`${t}/`)||{},i={};for(const e in o){if(o.hasOwnProperty(e)&&!/^\$/i.test(e)&&o[e].$kind&&V(o[e],n||{$kind:"Property"})){i[e]=o[e]}}return i}function U(e,t){const n=e&&e.getActions();if(n){n.forEach(function(e){if(e.isA("sap.ui.mdc.actiontoolbar.ActionToolbarAction")){e=e.getAction()}if(e.isA("sap.m.MenuButton")){const n=e.getMenu();const o=n.getItems();o.forEach(e=>{if(e.data("IBNData")){t.push(e)}})}else if(e.data("IBNData")){t.push(e)}})}return t}function G(t,n){const o={};const i=Re.getAppComponent(n);const r=s.isStickySessionSupported(n.getModel().getMetaModel());const a=function(n){if(n){const e=Object.keys(n);e.forEach(function(e){if(e.indexOf("_")!==0&&!e.includes("odata.context")){o[e]={value:n[e]}}})}if(t.length){t.forEach(function(t){const n=t.data("IBNData").semanticObject;const s=t.data("IBNData").action;i.getShellServices().getLinks({semanticObject:n,action:s,params:o}).then(function(e){t.setVisible(t.getVisible()&&e&&e.length===1);if(r){t.getBindingContext("internal").setProperty(t.getId().split("--")[1],{shellNavigationNotAvailable:!(e&&e.length===1)})}}).catch(function(t){e.error("Cannot retrieve the links from the shell service",t)})})}};if(n&&n.getBindingContext()){var c;(c=n.getBindingContext())===null||c===void 0?void 0:c.requestObject().then(function(e){return a(e)}).catch(function(t){e.error("Cannot retrieve the links from the shell service",t)})}else{a()}}function H(e,t,n,o){const i=!n?e.getObject(e.getPath()).toString():n;let r=e.getPath().split("/@")[0];const s=e.getObject(r).$Type;const a=Y(e.getModel(),s);if(a){r=`/${a}`}if(o){return e.getObject(`${r}/${i}@Org.OData.Core.V1.OperationAvailable`)}if(t){return`${r}/${i}`}else{return{sContextPath:r,sProperty:e.getObject(`${r}/${i}@Org.OData.Core.V1.OperationAvailable/$Path`),sBindingParameter:e.getObject(`${r}/${i}/@$ui5.overload/0/$Parameter/0/$Name`)}}}function Y(e,t){const n=e.getObject("/");for(const e in n){if(typeof n[e]==="object"&&n[e].$Type===t){return e}}}function W(e,t){const n=e["@com.sap.vocabularies.Common.v1.Text"],o=n&&(e&&e["@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement"]||t&&t["@com.sap.vocabularies.UI.v1.TextArrangement"]);if(o){if(o.$EnumMember==="com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly"){return"Description"}else if(o.$EnumMember==="com.sap.vocabularies.UI.v1.TextArrangementType/TextLast"){return"ValueDescription"}else if(o.$EnumMember==="com.sap.vocabularies.UI.v1.TextArrangementType/TextSeparate"){return"Value"}return"DescriptionValue"}return n?"DescriptionValue":"Value"}function _(e){const t=e.getModel().getMetaModel();return t.getObject(`${t.getMetaPath(e.getPath())}/$Type`)}async function Q(t,n,o){let i=n;const r=t.indexOf("(");if(r>-1){const n=t.slice(r+1,-1);let o=_(i);while(o!==n){i=i.getBinding().getContext();if(i){o=_(i)}else{e.warning("Cannot determine target type to request property value for bound action invocation");return Promise.resolve(undefined)}}}return i.requestObject(o)}async function K(e,t,n,o){const i=n&&n.indexOf("/")===0?Se(n,e.getModel()):Q(t,e,n);return i.then(function(n){return{vPropertyValue:n,oSelectedContext:e,sAction:t,sDynamicActionEnabledPath:o}})}async function J(t,n){return Promise.all(n).then(function(e){if(e.length){const n=[],o=[];e.forEach(function(e){if(e){if(e.vPropertyValue){t.getModel().setProperty(e.sDynamicActionEnabledPath,true);n.push(e.oSelectedContext)}else{o.push(e.oSelectedContext)}}});X(t,e[0].sAction,n,o)}}).catch(function(t){e.trace("Cannot retrieve property value from path",t)})}function X(e,t,n,o){const i=`${e.getPath()}/dynamicActions/${t}`,r=e.getModel();r.setProperty(`${i}/aApplicable`,n);r.setProperty(`${i}/aNotApplicable`,o)}function z(e){const t=b.getDataTypeClassName(e);const n=b.getBaseType(t,{},{});return m.getOperatorsForType(n)}function Z(e,t){return e.filter(function(e){return t.includes(e)})}function ee(e){const t=Re.AllowedExpressionsPrio;e.sort(function(e,n){return t.indexOf(e)-t.indexOf(n)});return e[0]}function te(e,t,n,o,i,r){const s=Re.getFilterRestrictionsByPath(t,n);const c=["EQ"];const l=["EQ","GE","LE","LT","GT","BT","NOTLE","NOTLT","NOTGE","NOTGT"];const u=["EQ","BT"];const p=["TODAY","TOMORROW","YESTERDAY","DATE","FIRSTDAYWEEK","LASTDAYWEEK","FIRSTDAYMONTH","LASTDAYMONTH","FIRSTDAYQUARTER","LASTDAYQUARTER","FIRSTDAYYEAR","LASTDAYYEAR"];const f=["EQ","GE","LE","LT","GT","BT","NE","NOTBT","NOTLE","NOTLT","NOTGE","NOTGT"];const g=["Contains","NotContains","StartsWith","NotStartsWith","EndsWith","NotEndsWith"];const d=a.getSupportedOperations();const m=i==="true"||i===true;let b=[];const O=r&&typeof r==="string"?JSON.parse(r).customData:r;if(n.getObject(`${t}/@com.sap.vocabularies.Common.v1.ResultContext`)===true){return c}if(O&&O.operatorConfiguration&&O.operatorConfiguration.length>0){b=a.getFilterOperations(O.operatorConfiguration,o)}else{b=a.getSemanticDateOperations(o)}let P=z(o);if(m){P=d.concat(P)}let h=[];if(s&&s.FilterAllowedExpressions&&s.FilterAllowedExpressions[e]){const t=Re.getSpecificAllowedExpression(s.FilterAllowedExpressions[e]);switch(t){case"SingleValue":const e=o==="Edm.Date"&&m?p:c;h=Z(P,e);break;case"MultiValue":h=Z(P,c);break;case"SingleRange":let t;if(m){if(o==="Edm.Date"){t=b}else if(o==="Edm.DateTimeOffset"){t=b}else{t=l}}else if(o==="Edm.DateTimeOffset"){t=u}else{t=l}const n=Z(P,t);h=n;break;case"MultiRange":h=Z(P,f);break;case"SearchExpression":h=Z(P,g);break;case"MultiRangeOrSearchExpression":h=Z(P,g.concat(f));break;default:break}}return h}v.getOperatorsForProperty=te;function ne(){const e=["EQ","NE"];return e.toString()}function oe(e){const t=z(e);const n=["EQ","GE","LE","LT","GT","BT","NE","NOTBT","NOTLE","NOTLT","NOTGE","NOTGT"];return Z(t,n)}function ie(e,t){const n=t.substring(0,t.lastIndexOf("/"));const o=e.getObject(`${n}/@com.sap.vocabularies.Common.v1.ResultContext`);const i={};if(o&&n!==t){i.contextPath=n;i.parameterProperties=Re.getContextPathProperties(e,n)}return i}function re(e,t,n){const o=Re.getAppComponent(n);const i=o.getNavigationService();return i.mixAttributesAndSelectionVariant(t,e.toJSONString())}function se(e){const t=s.isStickySessionSupported(e.getModel().getMetaModel());const n=e.getModel("ui").getProperty("/isEditable");return t&&n}async function ae(e,t,n,o,i,r){const s=e.getComponentData(),a=s&&s.startupParameters||{},c=e.getShellServices();const l=await c.getStartupAppState(e);const u=(l===null||l===void 0?void 0:l.getData())||{},p=u.selectionVariant&&u.selectionVariant.SelectOptions||[];t.forEach(function(e){var t;const s=o?`/${e.$Name}`:(t=e.getPath)===null||t===void 0?void 0:t.call(e).slice(e.getPath().lastIndexOf("/")+1);const c=o?s.slice(1):s;if(r&&i){if(r[c]){n.setProperty(s,r[c])}}else if(a[c]){n.setProperty(s,a[c][0])}else if(p.length>0){for(const e of p){if(e.PropertyName===c){const t=e.Ranges.length?e.Ranges[e.Ranges.length-1]:undefined;if(t&&t.Sign==="I"&&t.Option==="EQ"){n.setProperty(s,t.Low)}}}}})}function ce(e,t){const n=t,o=n!==undefined?Object.keys(n).filter(function(e){return n[e].useForCreate}):[];let i;for(const t of o){const n=t;const o=e&&e[n];if(o&&o.length===1){i=i||Object.create(null);i[n]=o[0]}}return i}function le(e){const t=[];if(e.parameters){const n=Object.keys(e.parameters)||[];if(n.length>0){n.forEach(function(n){const o=e.parameters[n];if(o.value&&o.value.value&&o.value.format==="binding"){const e={LocalProperty:{$PropertyPath:o.value.value},SemanticObjectProperty:n};if(t.length>0){for(const n of t){var i;if(((i=n.LocalProperty)===null||i===void 0?void 0:i.$PropertyPath)!==e.LocalProperty.$PropertyPath){t.push(e)}}}else{t.push(e)}}})}}return t}function ue(t,n){const o={};let i;const r=t.controlConfiguration;for(const t in r){if(t.includes("@com.sap.vocabularies.UI.v1.DataPoint")||t.includes("@com.sap.vocabularies.UI.v1.Chart")){var s,a;const c=(s=r[t].navigation)===null||s===void 0?void 0:(a=s.targetOutbound)===null||a===void 0?void 0:a.outbound;if(c!==undefined){const r=n[c];if(r.semanticObject&&r.action){if(t.includes("Chart")){i=y(["fe","MicroChartLink",t])}else{i=y(["fe","HeaderDPLink",t])}const e=Re.getSemanticObjectMapping(r);o[i]={semanticObject:r.semanticObject,action:r.action,semanticObjectMapping:e}}else{e.error(`Cross navigation outbound is configured without semantic object and action for ${c}`)}}}}return o}function pe(e,t){const n=typeof t==="string"?JSON.parse(t):t;for(const t of n){const n=t["LocalProperty"]&&t["LocalProperty"]["$PropertyPath"]||t["@com.sap.vocabularies.Common.v1.LocalProperty"]&&t["@com.sap.vocabularies.Common.v1.LocalProperty"]["$Path"];const o=t["SemanticObjectProperty"]||t["@com.sap.vocabularies.Common.v1.SemanticObjectProperty"];const i=e.getSelectOption(n);if(i){e.removeSelectOption(n);e.massAddSelectOption(o,i)}}return e}async function fe(e,t,n){return new Promise(function(o){let i,r;if(n===""){i=e.getObject(`${t}@${"com.sap.vocabularies.Common.v1.SemanticObject"}`);r=e.getObject(`${t}@${"com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions"}`)}else{i=e.getObject(`${t}@${"com.sap.vocabularies.Common.v1.SemanticObject"}#${n}`);r=e.getObject(`${t}@${"com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions"}#${n}`)}const s=[{semanticObject:i}];const a={semanticObject:i};o({semanticObjectPath:t,semanticObjectForGetLinks:s,semanticObject:a,unavailableActions:r})})}async function ge(t,o,i,r){return Promise.all(t).then(function(e){let t,s,a,c=[];let l={};const u=function(e,t){for(const n in t){if(n===e){return true}else{return false}}};for(let n=0;n<e.length;n++){t=e[n];if(t&&t.length>0&&t[0]!==undefined){const e={};let i;let p;for(let l=0;l<t.length;l++){c.push([]);let f=false;let g=false;for(const e of t[l][0]){s=e;a=s&&s.intent.split("?")[0].split("-")[1];if(!(s&&s.intent&&s.intent.indexOf(r)===0)){f=true;if(!u(a,o[n].unavailableActions)){c[l].push(s);g=true}}}i={semanticObject:o[n].semanticObject,path:o[n].path,HasTargets:g,HasTargetsNotFiltered:f};if(e[o[n].semanticObject]===undefined){e[o[n].semanticObject]={}}p=o[n].path.replace(/\//g,"_");if(e[o[n].semanticObject][p]===undefined){e[o[n].semanticObject][p]={}}e[o[n].semanticObject][p]=Object.assign(e[o[n].semanticObject][p],i)}const f=Object.keys(e)[0];if(Object.keys(l).includes(f)){l[f]=Object.assign(l[f],e[f])}else{l=Object.assign(l,e)}c=[]}}if(Object.keys(l).length>0){i.setProperty("semanticsTargets",n(l,i.getProperty("semanticsTargets")));return l}}).catch(function(t){e.error("fnUpdateSemanticTargetsModel: Cannot read links",t)})}async function de(e,t,n,o,i){return Re.getSemanticObjectsFromPath(n,o,i)}function me(e,t,n,o,i){let r,s;let a,c;for(const l of o){s=l;r=Object.keys(n.getObject(s+"@"));for(const o of r){if(o.indexOf(`@${"com.sap.vocabularies.Common.v1.SemanticObject"}`)===0&&!o.includes(`@${"com.sap.vocabularies.Common.v1.SemanticObjectMapping"}`)&&!o.includes(`@${"com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions"}`)){c=/#(.*)/.exec(o);a=c?c[1]:"";i.push(Re.getSemanticObjectPromise(e,t,n,s,a))}}}}function be(t,n){const o=function(e,t,n){if(!e){return n}if(e instanceof Array){e.forEach(e=>{n=n.concat(o(e,t,[]))});return n}if(e[t]){n.push(e[t])}if(typeof e=="object"&&e!==null){const i=Object.keys(e);if(i.length>0){for(const r of i){n=n.concat(o(e[r],t,[]))}}}return n};const i=function(e,t){return o(e,t,[])};const r=function(e){return e.filter(function(t,n){return e.indexOf(t)===n})};const s=t.getView();const a=s.getBindingContext("internal");if(a){const o=[];const c=t.getOwnerComponent();const l=p.getOwnerComponentFor(c);const u=l.getMetaModel();let f=c.getModel(n).getData();if(JSON.stringify(f)==="{}"){f=c.getModel(n)._getObject("/",undefined)}let g=i(f,"semanticObjectPath");g=r(g);const d=l.getShellServices();let m=d.getHash();const b=[];let O;if(m&&m.includes("?")){m=m.split("?")[0]}me(l,s,u,g,o);if(o.length===0){return Promise.resolve()}else{Promise.all(o).then(async function(e){const t=[];let n;const o=e.filter(function(e){if(e.semanticObject!==undefined&&e.semanticObject.semanticObject&&typeof e.semanticObject.semanticObject==="object"){n=S(j(e.semanticObject.semanticObject.$Path));e.semanticObject.semanticObject=n;e.semanticObjectForGetLinks[0].semanticObject=n;return true}else if(e){return e.semanticObject!==undefined}else{return false}});for(const e of o){O=e;if(O&&O.semanticObject&&!(O.semanticObject.semanticObject.indexOf("{")===0)){b.push({semanticObject:O.semanticObject.semanticObject,unavailableActions:O.unavailableActions,path:e.semanticObjectPath});t.push(d.getLinksWithCache([O.semanticObjectForGetLinks]))}}return Re.updateSemanticTargets(t,b,a,m)}).catch(function(t){e.error("fnGetSemanticTargetsFromTable: Cannot get Semantic Objects",t)})}}else{return Promise.resolve()}}function Oe(e){const t={};if(e&&e.FilterExpressionRestrictions!==undefined){e.FilterExpressionRestrictions.forEach(function(e){if(e.Property&&e.AllowedExpressions!==undefined){if(t[e.Property.$PropertyPath]!==undefined){t[e.Property.$PropertyPath].push(e.AllowedExpressions)}else{t[e.Property.$PropertyPath]=[e.AllowedExpressions]}}})}return t}function Pe(e,t){let n=[];if(e&&e[t]){n=e[t].map(function(e){return e.$PropertyPath})}return n}function he(e,t,n){const o=t+"/";return e.reduce((e,t)=>{if(t.startsWith(o)){const n=t.replace(o,"");if(!e.includes(n)){e.push(n)}}return e},n)}function ve(e,o){const i={RequiredProperties:[],NonFilterableProperties:[],FilterAllowedExpressions:{}};let r;const a="$NavigationPropertyBinding";const c="@Org.OData.Capabilities.V1.FilterRestrictions";const l=e.replaceAll("%2F","/").split("/").filter(s.filterOutNavPropBinding);const u=`/${l.join("/")}/`;const p=s.getEntitySetPath(e,o);const f=p.split("/").filter(s.filterOutNavPropBinding);const g=o.getObject(`${u}$ContainsTarget`);const d=!!g&&l[l.length-1];if(!g){r=o.getObject(`${p}${c}`);i.RequiredProperties=Pe(r,"RequiredProperties")||[];const e=o.getObject(`${u}@com.sap.vocabularies.Common.v1.ResultContext`);if(!e){i.NonFilterableProperties=Pe(r,"NonFilterableProperties")||[]}i.FilterAllowedExpressions=Oe(r)||{}}if(l.length>1){const e=g?d:f[f.length-1];const r=g?p:`/${f.slice(0,-1).join(`/${a}/`)}`;const s={RequiredProperties:[],NonFilterableProperties:[],FilterAllowedExpressions:{}};if(!e.includes("%2F")){const t=o.getObject(`${r}${c}`);i.RequiredProperties=he(Pe(t,"RequiredProperties")||[],e,i.RequiredProperties||[]);i.NonFilterableProperties=he(Pe(t,"NonFilterableProperties")||[],e,i.NonFilterableProperties||[]);const n=Oe(t)||{};s.FilterAllowedExpressions=Object.keys(n).reduce((t,o)=>{if(o.startsWith(e+"/")){const i=o.replace(e+"/","");t[i]=n[o]}return t},{})}i.FilterAllowedExpressions=n({},i.FilterAllowedExpressions||{},s.FilterAllowedExpressions||{});const u=h.getNavigationRestrictions(o,r,e.replaceAll("%2F","/"));const m=u&&u["FilterRestrictions"];const b=Pe(m,"RequiredProperties")||[];i.RequiredProperties=t(i.RequiredProperties.concat(b));const O=Pe(m,"NonFilterableProperties")||[];i.NonFilterableProperties=t(i.NonFilterableProperties.concat(O));i.FilterAllowedExpressions=n({},i.FilterAllowedExpressions||{},Oe(m)||{});const P=o.getObject(`/${l.join("/")}${c}`);const v=Pe(P,"RequiredProperties")||[];i.RequiredProperties=t(i.RequiredProperties.concat(v));const y=Pe(P,"NonFilterableProperties")||[];i.NonFilterableProperties=t(i.NonFilterableProperties.concat(y));i.FilterAllowedExpressions=n({},i.FilterAllowedExpressions,Oe(P)||{})}return i}async function ye(e,t,n,o){n=n||{};if(o){return o.templateControlFragment(e,t,n.view).then(function(e){return o.targets==="xmlTree"&&e.length>0?e[0]:e})}else{const o=await d.process(g.loadTemplate(e,"fragment"),{name:e},t);const i=o.firstElementChild;if(!!n.isXML&&i){return i}return f.load({id:n.id,definition:o,controller:n.controller})}}function je(e,t){const n=e.split("/").filter(Boolean),o=n.pop(),i=n.join("/"),r=i&&t.getObject(`/${i}`);if((r===null||r===void 0?void 0:r.$kind)==="Singleton"){const e=n[n.length-1];return`/${e}/${o}`}return undefined}async function Se(e,t){if(!e||!t){return Promise.resolve(null)}const n=t.getMetaModel();const o=je(e,n);if(o){const e=t.bindProperty(o);return e.requestValue()}return Promise.resolve(null)}function Ae(e,t){let n;if(e.includes("@$ui5.overload")){n=e.split("@$ui5.overload")[0]}else{const t=e.split("/0")[0].split(".");n=`/${t[t.length-1]}/`}return n+t}function Ce(e,t){const n=new P({anyText:e});t.addDependent(n);const o=n.getAnyText();t.removeDependent(n);n.destroy();return o}function Ee(){return!u.system.desktop||u.resize.width<=320}function Te(e,t,n){const o=e.data("entityType"),i=Re.getAppComponent(e).getMetaModel(),r={},s=[],a=[];let c="";let l=i.getObject(`${o}${t}`);if(n){l=l.SelectionVariant}if(l){c=l.Text;(l.SelectOptions||[]).filter(function(e){return e&&e.PropertyName&&e.PropertyName.$PropertyPath}).forEach(function(e){const t=e.PropertyName.$PropertyPath;if(!a.includes(t)){a.push(t)}for(const i in e.Ranges){var n,o;const s=e.Ranges[i];r[t]=(r[t]||[]).concat(new O(t,(n=s.Option)===null||n===void 0?void 0:(o=n.$EnumMember)===null||o===void 0?void 0:o.split("/").pop(),s.Low,s.High))}});for(const e in r){s.push(new O({filters:r[e],and:false}))}}return{properties:a,filters:s,text:c}}function xe(e,t,i,r){const s=t.createBindingContext(e);return o===null||o===void 0?void 0:o.createConverterContextForMacro(i,s||t,r,n,undefined)}function $e(e,t){return e.replace("_fe_"+t+"_","")}function Me(e){e.forEach(e=>{if(e.sPath&&e.sPath.includes("fe_groupable")){e.sPath=Re.getInternalChartNameFromPropertyNameAndKind(e.sPath,"groupable")}});return e}async function Fe(e,t,n){const o=t.getBindingContext();if(o){const a=e===A.Draft?s.getDraftRootPath(o):s.getStickyRootPath(o);let c;if(a){var i,r;const e=(i=n.getRootViewController().getInstancedViews().find(e=>{var t;return((t=e.getBindingContext())===null||t===void 0?void 0:t.getPath())===a}))===null||i===void 0?void 0:i.getBindingContext();if(e){return e}const s=t.getModel("internal");c=s.getProperty("/simpleRootContext");if(((r=c)===null||r===void 0?void 0:r.getPath())===a){return c}const l=o.getModel();c=l.bindContext(a).getBoundContext();await Re.waitForContextRequested(c);s.setProperty("/simpleRootContext",c);return c}}}const Re={fireButtonPress:L,getTargetView:I,getCurrentPageView:B,hasTransientContext:T,updateRelatedAppsDetails:D,getAppComponent:k,getContextPathProperties:q,getParameterInfo:ie,updateDataFieldForIBNButtonsVisibility:G,getEntitySetName:Y,getActionPath:H,computeDisplayMode:W,isStickyEditMode:se,getOperatorsForProperty:te,getOperatorsForDateProperty:oe,getOperatorsForGuidProperty:ne,addPageContextToSelectionVariant:re,setUserDefaults:ae,getIBNActions:U,getHeaderFacetItemConfigForExternalNavigation:ue,getSemanticObjectMapping:le,setSemanticObjectMappings:pe,getSemanticObjectPromise:de,getSemanticTargetsFromPageModel:be,getSemanticObjectsFromPath:fe,updateSemanticTargets:ge,waitForContextRequested:E,getFilterRestrictionsByPath:ve,getSpecificAllowedExpression:ee,getAdditionalParamsForCreate:ce,requestSingletonProperty:Se,templateControlFragment:ye,FilterRestrictions:{REQUIRED_PROPERTIES:"RequiredProperties",NON_FILTERABLE_PROPERTIES:"NonFilterableProperties",ALLOWED_EXPRESSIONS:"FilterAllowedExpressions"},AllowedExpressionsPrio:["SingleValue","MultiValue","SingleRange","MultiRange","SearchExpression","MultiRangeOrSearchExpression"],normalizeSearchTerm:C,setContextsBasedOnOperationAvailable:J,setDynamicActionContexts:X,requestProperty:K,getParameterPath:Ae,getRelatedAppsMenuItems:M,getTranslatedTextFromExpBindingString:Ce,updateRelateAppsModel:N,getSemanticObjectAnnotations:w,getFiltersInfoForSV:Te,getInternalChartNameFromPropertyNameAndKind:$e,getChartPropertiesWithoutPrefixes:Me,createRootContext:Fe,isSmallDevice:Ee,getConverterContextForPath:xe};return Re},false);
//# sourceMappingURL=CommonUtils.js.map