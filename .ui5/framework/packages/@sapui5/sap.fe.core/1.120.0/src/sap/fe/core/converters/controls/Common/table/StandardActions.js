/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/formatters/TableFormatter","sap/fe/core/helpers/BindingToolkit","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper","../../../../helpers/BindingHelper","../../../ManifestSettings","../../../helpers/InsightsHelpers"],function(e,t,n,i,a,o,s,r){"use strict";var l={};var d=r.getInsightsVisibility;var c=r.getInsightsEnablement;var u=s.TemplateType;var p=s.CreationMode;var f=s.ActionType;var v=o.singletonPathVisitor;var g=o.UI;var b=a.isPathUpdatable;var y=a.isPathInsertable;var h=a.isPathDeletable;var C=a.getTargetObjectPath;var T=i.isSingleton;var M=i.isNavigationProperty;var S=i.isEntitySet;var E=t.pathInModel;var m=t.or;var A=t.notEqual;var P=t.not;var x=t.lessOrEqual;var D=t.length;var I=t.isPathInModelExpression;var R=t.isConstant;var O=t.ifElse;var w=t.greaterThan;var U=t.greaterOrEqual;var k=t.getExpressionFromAnnotation;var V=t.formatResult;var j=t.equal;var H=t.constant;var L=t.compileExpression;var z=t.and;const F={Cut:"StandardAction::Cut",Create:"StandardAction::Create",Delete:"StandardAction::Delete",CreationRow:"StandardAction::CreationRow",Paste:"StandardAction::Paste",MassEdit:"StandardAction::MassEdit",Insights:"StandardAction::Insights"};l.StandardActionKeys=F;function N(e,t,n,i){return{collectionPath:C(e.getDataModelObjectPath()),hiddenAnnotation:{create:B(e,"CreateHidden"),delete:B(e,"DeleteHidden"),update:B(e,"UpdateHidden")},creationMode:t,isDraftOrStickySupported:W(e),isViewWithMultipleVisualizations:i?e.getManifestWrapper().hasMultipleVisualizations(i):false,newAction:q(e),tableManifestConfiguration:n,restrictions:_(e)}}l.generateStandardActionsContext=N;function W(e){var t,i,a;const o=e.getDataModelObjectPath();const s=n.isObjectPathDraftSupported(o);const r=(t=o.startingEntitySet)!==null&&t!==void 0&&(i=t.annotations)!==null&&i!==void 0&&(a=i.Session)!==null&&a!==void 0&&a.StickySessionSupported?true:false;return s||r}l.isDraftOrStickySupported=W;function q(e){var t,n,i,a;const o=e.getEntitySet();const s=S(o)?((t=o.annotations.Common)===null||t===void 0?void 0:(n=t.DraftRoot)===null||n===void 0?void 0:n.NewAction)??((i=o.annotations.Session)===null||i===void 0?void 0:(a=i.StickySessionSupported)===null||a===void 0?void 0:a.NewAction):undefined;const r=s===null||s===void 0?void 0:s.toString();if(r){var l,d,c;const t=e===null||e===void 0?void 0:(l=e.getEntityType().actions[r])===null||l===void 0?void 0:(d=l.annotations)===null||d===void 0?void 0:(c=d.Core)===null||c===void 0?void 0:c.OperationAvailable;return{name:r,available:k(t,[],true)}}return undefined}l.getNewAction=q;function B(e,t){var n,i;let a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;const o=e.getEntitySet();const s=!T(o)&&(o===null||o===void 0?void 0:(n=o.annotations.UI)===null||n===void 0?void 0:n[t])||((i=e.getEntityType().annotations.UI)===null||i===void 0?void 0:i[t]);if(!s){return H(false)}const r=e.getDataModelObjectPath();const l=r.navigationProperties.length>0&&a?[r.navigationProperties[r.navigationProperties.length-1].name]:[];return k(s,l,undefined,t=>v(t,e.getConvertedTypes(),l))}l.isActionAnnotatedHidden=B;function _(e){const t=e.getDataModelObjectPath();const n=[{key:"isInsertable",function:y},{key:"isUpdatable",function:b},{key:"isDeletable",function:h}];const i={};n.forEach(function(n){const a=n["function"];i[n.key]={expression:a.apply(null,[t,{pathVisitor:(t,n)=>v(t,e.getConvertedTypes(),n)}]),navigationExpression:a.apply(null,[t,{ignoreTargetCollection:true,authorizeUnresolvable:true,pathVisitor:(t,n)=>v(t,e.getConvertedTypes(),n)}])}});return i}l.getRestrictions=_;function $(e,t){return t||e.creationMode===p.External}l.getInsertUpdateActionsTemplating=$;function G(e,t){const n=ie(e,t);return{isTemplated:L(te(t,n)),visible:L(n),enabled:L(le(e,t,n)),key:F.Create,type:f.Standard}}l.getStandardActionCreate=G;function K(e,t){const n=X(e,t);return{isTemplated:L(ne(n)),visible:L(n),enabled:L(pe(n,t)),key:F.Cut,type:f.Standard}}l.getStandardActionCut=K;function J(e,t){const n=ae(e,t);return{isTemplated:L(ne(n)),visible:L(n),enabled:L(de(e,t,n)),key:F.Delete,type:f.Standard}}l.getStandardActionDelete=J;function Q(e,t){const n=ie(e,t,true);return{isTemplated:L(te(t,n,true)),visible:L(n),enabled:L(re(e,t,n)),key:F.CreationRow,type:f.Standard}}l.getCreationRow=Q;function X(e,t){var n,i,a;const o=(n=t.restrictions)===null||n===void 0?void 0:(i=n.isUpdatable)===null||i===void 0?void 0:i.expression;const s=e.getTemplateType()!==u.ListReport?g.IsEditable:false;return O(j((a=t.tableManifestConfiguration)===null||a===void 0?void 0:a.type,"TreeTable"),z(P(z(R(o),j(o,false))),s),false)}l.getCutVisibility=X;function Y(e,t,n){const i=ie(e,t,false,true);const a=le(e,t,i);const o=oe(e,t,i,n);return{visible:L(o),enabled:L(ce(o,a,t)),key:F.Paste,type:f.Standard}}l.getStandardActionPaste=Y;function Z(e,t){const n=se(e,t);return{isTemplated:L(ne(n)),visible:L(n),enabled:L(ue(e,t,n)),key:F.MassEdit,type:f.Standard}}l.getStandardActionMassEdit=Z;function ee(e,t,n){const i=d("Table",e,n,t);const a=z(i,c());return{isTemplated:L(ne(i)),visible:L(i),enabled:L(a),key:F.Insights,type:f.Standard}}l.getStandardActionInsights=ee;function te(e,t){let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;return z(m(z(n,e.creationMode===p.CreationRow),z(!n,e.creationMode!==p.CreationRow)),m(P(R(t)),t))}l.getCreateTemplating=te;function ne(e){return m(P(R(e)),e)}l.getDefaultTemplating=ne;function ie(e,t){var n,i;let a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;let o=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;const s=t.restrictions.isInsertable.expression;const r=a?B(e,"CreateHidden",false):t.hiddenAnnotation.create;const l=t.newAction;return O(t.creationMode===p.External,z(P(r),m(e.getTemplateType()===u.ListReport,g.IsEditable)),O(m(z(R(l===null||l===void 0?void 0:l.available),j(l===null||l===void 0?void 0:l.available,false)),z(R(s),j(s,false),!l),z(R(r),j(r,true)),z(t.creationMode===p.InlineCreationRows,((n=t.tableManifestConfiguration)===null||n===void 0?void 0:n.type)==="ResponsiveTable",O(z((t===null||t===void 0?void 0:(i=t.tableManifestConfiguration)===null||i===void 0?void 0:i.inlineCreationRowsHiddenInEditMode)===false,P(o)),true,g.IsCreateMode))),false,O(e.getTemplateType()===u.ListReport,m(P(I(r)),P(r)),z(P(r),g.IsEditable))))}l.getCreateVisibility=ie;function ae(e,t){const n=t.hiddenAnnotation.delete;const i=t.restrictions.isDeletable.expression;return O(e.getTemplateType()===u.AnalyticalListPage,false,O(z(R(i),j(i,false)),false,O(z(R(n),j(n,H(true))),false,O(e.getTemplateType()!==u.ListReport,z(P(n),g.IsEditable),P(z(I(n),n))))))}l.getDeleteVisibility=ae;function oe(e,t,n,i){return z(A(t.tableManifestConfiguration.enablePaste,false),t.tableManifestConfiguration.type==="TreeTable"?g.IsEditable:n,i,![u.ListReport,u.AnalyticalListPage].includes(e.getTemplateType()),t.tableManifestConfiguration.type==="TreeTable"?t.restrictions.isUpdatable.expression:t.restrictions.isInsertable.expression)}l.getPasteVisibility=oe;function se(e,t){var n;const i=t.hiddenAnnotation.update,a=t.restrictions.isUpdatable.expression,o=((n=t.tableManifestConfiguration)===null||n===void 0?void 0:n.enableMassEdit)||false;const s=e.getTemplateType()===u.ObjectPage?g.IsEditable:e.getTemplateType()===u.ListReport;return z(P(z(R(a),j(a,false))),o,s,P(i))}l.getMassEditVisibility=se;function re(t,n,i){const a=y(t.getDataModelObjectPath(),{ignoreTargetCollection:true,authorizeUnresolvable:true,pathVisitor:(e,n)=>{if(e.indexOf("/")===0){e=v(e,t.getConvertedTypes(),n);return e}const i=t.getDataModelObjectPath().navigationProperties;if(i){const t=i[i.length-1];const n=M(t)&&t.partner;if(n){e=`${n}/${e}`}}return e}});const o=a._type==="Unresolvable"?y(t.getDataModelObjectPath(),{pathVisitor:e=>v(e,t.getConvertedTypes(),[])}):a;return z(i,o,m(!n.tableManifestConfiguration.disableAddRowButtonForEmptyData,V([E("creationRowFieldValidity","internal")],e.validateCreationRowFields)))}l.getCreationRowEnablement=re;function le(e,t,n){const i=[];if(t.creationMode===p.InlineCreationRows){i.push(z(P(t.hiddenAnnotation.create),g.IsEditable))}else{i.push(n)}const a=t.restrictions.isInsertable.expression;const o=e.resolveAbsolutePath(t.collectionPath).target;i.push(m(S(o),z(a,m(e.getTemplateType()!==u.ObjectPage,g.IsEditable))));if(t.tableManifestConfiguration.type==="TreeTable"){i.push(x(E("numberOfSelectedContexts","internal"),1));if(t.tableManifestConfiguration.createEnablement){i.push(A(E("createEnablement/Create","internal"),false))}}return z(...i)}l.getCreateEnablement=le;function de(e,t,n){const i=E("deletableContexts","internal");const a=E("unSavedContexts","internal");const o=E("draftsWithDeletableActive","internal");const s=E("draftsWithNonDeletableActive","internal");return z(n,m(t.restrictions.isDeletable.navigationExpression._type==="Unresolvable",t.restrictions.isDeletable.expression),m(z(A(i,undefined),w(D(i),0)),z(A(o,undefined),w(D(o),0)),z(A(s,undefined),w(D(s),0)),z(A(a,undefined),w(D(a),0))))}l.getDeleteEnablement=de;function ce(e,t,n){if(n.tableManifestConfiguration.type==="TreeTable"){return z(e,z(P(j(E("pastableContexts","internal"),undefined)),j(D(E("pastableContexts","internal")),1),j(E("pasteAuthorized","internal"),true)))}return z(e,t)}l.getPasteEnablement=ce;function ue(e,t,i){const a=t.restrictions.isUpdatable.expression;const o=!R(a)&&t.restrictions.isUpdatable.navigationExpression._type==="Unresolvable";const s=U(E("numberOfSelectedContexts","internal"),1);const r=U(D(E("updatableContexts","internal")),1);const l=n.isObjectPathDraftSupported(e.getDataModelObjectPath());const d=fe(e);const c=O(m(z(d,l),o),z(s,r),z(s));return z(i,O(o,c,z(c,a)))}l.getMassEditEnablement=ue;function pe(e,t){const n=j(E("numberOfSelectedContexts","internal"),1);const i=z(P(j(E("cutableContexts","internal"),undefined)),j(D(E("cutableContexts","internal")),1));const a=z(n,i);return O(z(R(t.restrictions.isUpdatable.expression),j(t.restrictions.isUpdatable.expression,false)),false,z(e,a))}l.getCutEnablement=pe;function fe(e,t){const n=e.getTemplateType();if(n===u.ListReport||n===u.AnalyticalListPage||t&&e.getManifestWrapper().hasMultipleVisualizations(t)){return true}return false}l.isInDisplayMode=fe;return l},false);
//# sourceMappingURL=StandardActions.js.map