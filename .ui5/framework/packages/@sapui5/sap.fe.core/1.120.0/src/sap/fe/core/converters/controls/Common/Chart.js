/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/converters/annotations/DataField","sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/helpers/ConfigurableObject","sap/fe/core/converters/helpers/Key","sap/fe/core/helpers/BindingToolkit","sap/fe/core/templating/DataModelPathHelper","sap/ui/core/Core","../../ManifestSettings","../../helpers/Aggregation","../../helpers/ID","../../helpers/InsightsHelpers"],function(t,e,n,a,o,i,r,s,l,g,c,p){"use strict";var u={};var d=p.getInsightsVisibility;var v=p.getInsightsEnablement;var f=c.getFilterBarID;var m=c.getChartID;var y=g.AggregationHelper;var h=l.VisualizationType;var b=l.VariantManagementType;var P=l.TemplateType;var A=l.ActionType;var T=r.getTargetObjectPath;var S=i.not;var C=i.getExpressionFromAnnotation;var I=i.equal;var M=i.compileExpression;var O=i.and;var D=o.KeyHelper;var E=a.insertCustomElements;var F=a.OverrideType;var V=n.getActionsFromManifest;var N=e.isDataFieldForActionAbstract;function w(t,e,n){const a=[];if(t!==null&&t!==void 0&&t.Actions){t.Actions.forEach(t=>{if(N(t)&&!t.Inline&&!t.Determining){const e=D.generateKeyFromDataField(t);switch(t.$Type){case"com.sap.vocabularies.UI.v1.DataFieldForAction":if(t.ActionTarget&&!t.ActionTarget.isBound){a.push({type:A.DataFieldForAction,annotationPath:n.getEntitySetBasedAnnotationPath(t.fullyQualifiedName),key:e,visible:x(t,n)})}break;case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":a.push({type:A.DataFieldForIntentBasedNavigation,annotationPath:n.getEntitySetBasedAnnotationPath(t.fullyQualifiedName),key:e,visible:x(t,n),isNavigable:true});break}}})}return a}function B(t,e,n){const a=w(t,e,n);const o=V(n.getManifestControlConfiguration(e).actions,n,a);const i={enabled:F.overwrite,enableOnSelect:F.overwrite,visible:F.overwrite,command:F.overwrite};const r=E(a,o.actions,i);return{actions:r,commandActions:o.commandActions}}u.getChartActions=B;function $(t,e){var n;const a=e.getManifestWrapper();const o=e.getManifestControlConfiguration(t);const i=a.getVariantManagement();const r=[];const s=o===null||o===void 0?void 0:(n=o.chartSettings)===null||n===void 0?void 0:n.personalization;const l=i===b.Control?true:false;if(s!==undefined&&!s||s=="false"){return undefined}switch(true){case typeof s==="object":if(s.type){r.push("Type")}if(s.item){r.push("Item")}if(s.sort){r.push("Sort")}if(s.filter){r.push("Filter")}return r.join(",");case l:case!!s:return"Sort,Type,Item,Filter";default:return"Sort,Type,Item"}}u.getP13nMode=$;function z(t){var e;return t!==null&&t!==void 0&&(e=t.annotationPath)!==null&&e!==void 0&&e.includes(`@${"com.sap.vocabularies.UI.v1.SelectionPresentationVariant"}`)?t===null||t===void 0?void 0:t.annotationPath:undefined}function L(t){let e;if(t!==null&&t!==void 0&&t.Property){var n;e={Property:{$PropertyPath:t===null||t===void 0?void 0:(n=t.Property)===null||n===void 0?void 0:n.value}}}else{e={Property:{$PropertyPath:t===null||t===void 0?void 0:t.name}}}return e}function G(e,n,a,o,i){var r;const l=new y(a.getEntityType(),a,true);if(!o&&!l.isAnalyticsSupported()){throw new Error("ApplySupported is not added to the annotations")}const g=l.getTransAggregations();const c=l.getCustomAggregateDefinitions();const p=a.getManifestWrapper();const u=p.getVariantManagement();const b=$(n,a);if(b===undefined&&u==="Control"){t.warning("Variant Management cannot be enabled when personalization is disabled")}const A={};const S=z(i);if(c){const t=l.getEntityType();for(const e of c){var C,I,M,D,E;const n=e===null||e===void 0?void 0:(C=e.annotations)===null||C===void 0?void 0:(I=C.Aggregation)===null||I===void 0?void 0:I.ContextDefiningProperties;const a=e===null||e===void 0?void 0:e.qualifier;const o=a&&t.entityProperties.find(t=>t.name===a);const i=o&&(o===null||o===void 0?void 0:(M=o.annotations)===null||M===void 0?void 0:(D=M.Common)===null||D===void 0?void 0:(E=D.Label)===null||E===void 0?void 0:E.toString());A[a]={name:a,label:i||`Custom Aggregate (${a})`,sortable:true,sortOrder:"both",contextDefiningProperty:n?n.map(t=>t.value):[]}}}const F={};const V=s.getLibraryResourceBundle("sap.fe.core");if(g){for(let t=0;t<g.length;t++){var N,w,G,x,k,R;F[g[t].Name]={name:g[t].Name,propertyPath:g[t].AggregatableProperty.valueOf().value,aggregationMethod:g[t].AggregationMethod,label:(N=g[t])!==null&&N!==void 0&&(w=N.annotations)!==null&&w!==void 0&&(G=w.Common)!==null&&G!==void 0&&G.Label?(x=g[t])===null||x===void 0?void 0:(k=x.annotations)===null||k===void 0?void 0:(R=k.Common)===null||R===void 0?void 0:R.Label.toString():`${V.getText("AGGREGATABLE_PROPERTY")} (${g[t].Name})`,sortable:true,sortOrder:"both",custom:false}}}const H=l.getAggregatableProperties();const Q=l.getGroupableProperties();const U={};U.$Type="Org.OData.Aggregation.V1.ApplySupportedType";U.AggregatableProperties=[];U.GroupableProperties=[];if(H){U.AggregatableProperties=H.map(t=>L(t))}if(Q){U.GroupableProperties=Q.map(t=>({["$PropertyPath"]:t.value}))}const W=B(e,n,a);let[K]=n.split("@");if(K.lastIndexOf("/")===K.length-1){K=K.substring(0,K.length-1)}const q=((r=e.Title)===null||r===void 0?void 0:r.toString())||"";const J=a.getDataModelObjectPath();const Y=K.length===0;const _=J.targetEntitySet?J.targetEntitySet.name:J.startingEntitySet.name;const X=Y?f(a.getContextPath()):undefined;const Z={legendGroup:{layout:{position:"bottom"}}};let tt;if(a.getTemplateType()===P.ObjectPage){tt=true}else if(a.getTemplateType()===P.ListReport||a.getTemplateType()===P.AnalyticalListPage){tt=false}const et=a.getManifestWrapper().hasMultipleVisualizations()||a.getTemplateType()===P.AnalyticalListPage;const nt=et?".handlers.onSegmentedButtonPressed":"";const at=et?"{= ${pageInternal>alpContentView} !== 'Table'}":"true";const ot=l.getAllowedTransformations();U.enableSearch=ot?ot.includes("search"):true;let it="";if(e.fullyQualifiedName.split("#").length>1){it=e.fullyQualifiedName.split("#")[1]}const rt=d("Analytical",a,n);const st=O(v(),rt);return{type:h.Chart,id:it?m(Y?_:K,it,h.Chart):m(Y?_:K,h.Chart),collection:T(a.getDataModelObjectPath()),entityName:_,personalization:$(n,a),navigationPath:K,annotationPath:a.getAbsoluteAnnotationPath(n),filterId:X,vizProperties:JSON.stringify(Z),actions:W.actions,commandActions:W.commandActions,title:q,autoBindOnInit:tt,onSegmentedButtonPressed:nt,visible:at,customAgg:A,transAgg:F,applySupported:U,selectionPresentationVariantPath:S,variantManagement:j(b,u),isInsightsEnabled:st,isInsightsVisible:rt}}u.createChartVisualization=G;function j(t,e){return e==="Control"&&!t?b.None:e}function x(t,e){var n,a;return M(S(I(C((n=t.annotations)===null||n===void 0?void 0:(a=n.UI)===null||a===void 0?void 0:a.Hidden,[],undefined,e.getRelativeModelPathFunction()),true)))}function k(t){const e=t.getManifestWrapper().hasMultipleVisualizations()||t.getTemplateType()===P.AnalyticalListPage;const n=t.getDataModelObjectPath();const a=n.targetEntitySet?n.targetEntitySet.name:n.startingEntitySet.name;const o={type:h.Chart,id:m(a,h.Chart),entityName:a,title:"",collection:"",personalization:undefined,navigationPath:"",annotationPath:"",vizProperties:JSON.stringify({legendGroup:{layout:{position:"bottom"}}}),actions:[],commandActions:{},autoBindOnInit:false,onSegmentedButtonPressed:"",visible:e?"{= ${pageInternal>alpContentView} !== 'Table'}":"true",customAgg:{},transAgg:{},applySupported:{$Type:"Org.OData.Aggregation.V1.ApplySupportedType",AggregatableProperties:[],GroupableProperties:[],enableSearch:false},multiViews:false,variantManagement:b.None};return o}u.createBlankChartVisualization=k;return u},false);
//# sourceMappingURL=Chart.js.map