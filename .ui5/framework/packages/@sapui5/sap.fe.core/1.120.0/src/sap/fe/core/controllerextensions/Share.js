/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/ObjectPath","sap/base/util/extend","sap/fe/core/helpers/ClassSupport","sap/m/library","sap/ui/core/Component","sap/ui/core/Core","sap/ui/core/Fragment","sap/ui/core/XMLTemplateProcessor","sap/ui/core/mvc/ControllerExtension","sap/ui/core/mvc/OverrideExecution","sap/ui/core/routing/HashChanger","sap/ui/core/util/XMLPreprocessor","sap/ui/model/json/JSONModel"],function(e,t,o,i,r,a,n,l,s,c,p,u,d,h){"use strict";var g,f,m,y,S,v,b,w,_,T,O,D,E,M,P,A,C,I,j;var x=i.publicExtension;var H=i.methodOverride;var U=i.finalExtension;var L=i.extensible;var R=i.defineUI5Class;function F(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;J(e,t)}function J(e,t){J=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,o){t.__proto__=o;return t};return J(e,t)}function B(e,t,o,i,r){var a={};Object.keys(i).forEach(function(e){a[e]=i[e]});a.enumerable=!!a.enumerable;a.configurable=!!a.configurable;if("value"in a||a.initializer){a.writable=true}a=o.slice().reverse().reduce(function(o,i){return i(e,t,o)||o},a);if(r&&a.initializer!==void 0){a.value=a.initializer?a.initializer.call(r):void 0;a.initializer=undefined}if(a.initializer===void 0){Object.defineProperty(e,t,a);a=null}return a}let V;let z=(g=R("sap.fe.core.controllerextensions.Share"),f=H(),m=H(),y=x(),S=U(),v=x(),b=L(p.After),w=x(),_=L(p.After),T=x(),O=U(),D=x(),E=U(),M=x(),P=U(),A=x(),C=U(),g(I=(j=function(i){F(c,i);function c(){return i.apply(this,arguments)||this}var p=c.prototype;p.onInit=function e(){const t=new h({saveAsTileClicked:false,collaborationInfo:{url:"",appTitle:"",subTitle:"",minifyUrlForChat:true,appId:""}});this.base.getView().setModel(t,"shareInfo")};p.onExit=function e(){var t,o;const i=(t=this.base)===null||t===void 0?void 0:(o=t.getView())===null||o===void 0?void 0:o.getModel("shareInfo");if(i){i.destroy()}};p.openShareSheet=function e(t){this._openShareSheetImpl(t)};p.getCardDefinition=function e(){return};p.adaptShareMetadata=function e(t){return t};p._openShareSheetImpl=async function t(i){let a;const c=u.getInstance().getHash(),p=u.getInstance().hrefForAppSpecificHash?u.getInstance().hrefForAppSpecificHash(""):"",g={url:window.location.origin+window.location.pathname+window.location.search+(c?p+c:window.location.hash),title:document.title,email:{url:"",title:""},jam:{url:"",title:""},tile:{url:"",title:"",subtitle:"",icon:"",queryUrl:""}};V=i;const f=function(e,t){const i=e.getModel("shareData");const r=o(i.getData(),t);i.setData(r)};try{var m,y,S,v,b,w,_;const t=await((m=this.base.getView().getController())===null||m===void 0?void 0:(y=m.share)===null||y===void 0?void 0:y.adaptShareMetadata(g));const c={shareEmailPressed:function(){const e=a.getModel("shareData");const t=e.getData();const o=n.getLibraryResourceBundle("sap.fe.core");const i=t.email.title?t.email.title:o.getText("T_SHARE_UTIL_HELPER_SAPFE_EMAIL_SUBJECT",[t.title]);r.URLHelper.triggerEmail(undefined,i,t.email.url?t.email.url:t.url)},shareMSTeamsPressed:function(){const e=a.getModel("shareData");const t=e.getData();const o=t.email.title?t.email.title:t.title;const i=t.email.url?t.email.url:t.url;const r=window.open("","ms-teams-share-popup","width=700,height=600");r.opener=null;r.location=`https://teams.microsoft.com/share?msgText=${encodeURIComponent(o)}&href=${encodeURIComponent(i)}`},onSaveTilePress:function(){setTimeout(function(){var e;(e=n.byId("bookmarkDialog"))===null||e===void 0?void 0:e.attachAfterClose(function(){V.focus()})},0)},shareJamPressed:()=>{var e,o;this._doOpenJamShareDialog(t!==null&&t!==void 0&&(e=t.jam)!==null&&e!==void 0&&e.title?t.jam.title:t.title,t!==null&&t!==void 0&&(o=t.jam)!==null&&o!==void 0&&o.url?t.jam.url:t.url)}};c.onCancelPressed=function(){a.close()};c.setShareSheet=function(e){i.shareSheet=e};const p=new h({});const u={bindingContexts:{this:p.createBindingContext("/")},models:{this:p}};const T={title:t!==null&&t!==void 0&&(S=t.tile)!==null&&S!==void 0&&S.title?t.tile.title:t.title,subtitle:t===null||t===void 0?void 0:(v=t.tile)===null||v===void 0?void 0:v.subtitle,icon:t===null||t===void 0?void 0:(b=t.tile)===null||b===void 0?void 0:b.icon,url:t!==null&&t!==void 0&&(w=t.tile)!==null&&w!==void 0&&w.url?t.tile.url:t.url.substring(t.url.indexOf("#")),queryUrl:t===null||t===void 0?void 0:(_=t.tile)===null||_===void 0?void 0:_.queryUrl};if(i.shareSheet){a=i.shareSheet;const e=a.getModel("share");this._setStaticShareData(e);const r=o(e.getData(),T);e.setData(r);f(a,t);a.openBy(i)}else{const r="sap.fe.macros.share.ShareSheet";const n=s.loadTemplate(r,"fragment");try{const e=await d.process(n,{name:r},u);a=await l.load({definition:e,controller:c});a.setModel(new h(T||{}),"share");const s=a.getModel("share");this._setStaticShareData(s);const p=o(s.getData(),T);s.setData(p);a.setModel(new h(t||{}),"shareData");f(a,t);i.addDependent(a);a.openBy(i);c.setShareSheet(a)}catch(t){e.error("Error while opening the share fragment",t)}}}catch(t){e.error("Error while fetching the share model data",t)}};p._setStaticShareData=function e(o){const i=n.getLibraryResourceBundle("sap.fe.core");o.setProperty("/jamButtonText",i.getText("T_COMMON_SAPFE_SHARE_JAM"));o.setProperty("/emailButtonText",i.getText("T_SEMANTIC_CONTROL_SEND_EMAIL"));o.setProperty("/msTeamsShareButtonText",i.getText("T_COMMON_SAPFE_SHARE_MSTEAMS"));if(t.get("sap-ushell-config.renderers.fiori2.componentData.config.sapHorizonEnabled")===true){o.setProperty("/msTeamsVisible",true)}else{o.setProperty("/msTeamsVisible",false)}const r=t.get("sap.ushell.Container.getUser");o.setProperty("/jamVisible",!!r&&r().isJamActive());o.setProperty("/saveAsTileVisible",!!(sap&&sap.ushell&&sap.ushell.Container))};p._doOpenJamShareDialog=function e(t,o){const i=a.create({name:"sap.collaboration.components.fiori.sharing.dialog",settings:{object:{id:o,share:t}}});i.open()};p._triggerEmail=async function e(){const t=await this._adaptShareMetadata();const o=n.getLibraryResourceBundle("sap.fe.core");const i=t.email.title?t.email.title:o.getText("T_SHARE_UTIL_HELPER_SAPFE_EMAIL_SUBJECT",[t.title]);r.URLHelper.triggerEmail(undefined,i,t.email.url?t.email.url:t.url)};p._triggerShareToJam=async function e(){const t=await this._adaptShareMetadata();this._doOpenJamShareDialog(t.jam.title?t.jam.title:t.title,t.jam.url?t.jam.url:window.location.origin+window.location.pathname+t.url)};p._saveAsTile=async function e(t){var o,i;const r=(o=this.base)===null||o===void 0?void 0:(i=o.getView())===null||i===void 0?void 0:i.getModel("shareInfo");if(r){r.setProperty("/saveAsTileClicked",true)}const a=await this._adaptShareMetadata(),n=t.getDependents()[0],l=u.getInstance().getHash(),s=u.getInstance().hrefForAppSpecificHash?u.getInstance().hrefForAppSpecificHash(""):"";a.url=l?s+l:window.location.hash;n.setTitle(a.tile.title?a.tile.title:a.title);n.setSubtitle(a.tile.subtitle);n.setTileIcon(a.tile.icon);n.setCustomUrl(a.tile.url?a.tile.url:a.url);n.setServiceUrl(a.tile.queryUrl);n.setDataSource({type:"OData",settings:{odataVersion:"4.0"}});if(r){r.setProperty("/saveAsTileClicked",false)}n.firePress()};p._adaptShareMetadata=function e(){const t=u.getInstance().getHash(),o=u.getInstance().hrefForAppSpecificHash?u.getInstance().hrefForAppSpecificHash(""):"",i={url:window.location.origin+window.location.pathname+window.location.search+(t?o+t:window.location.hash),title:document.title,email:{url:"",title:""},jam:{url:"",title:""},tile:{url:"",title:"",subtitle:"",icon:"",queryUrl:""}};return this.base.getView().getController().share.adaptShareMetadata(i)};return c}(c),B(j.prototype,"onInit",[f],Object.getOwnPropertyDescriptor(j.prototype,"onInit"),j.prototype),B(j.prototype,"onExit",[m],Object.getOwnPropertyDescriptor(j.prototype,"onExit"),j.prototype),B(j.prototype,"openShareSheet",[y,S],Object.getOwnPropertyDescriptor(j.prototype,"openShareSheet"),j.prototype),B(j.prototype,"getCardDefinition",[v,b],Object.getOwnPropertyDescriptor(j.prototype,"getCardDefinition"),j.prototype),B(j.prototype,"adaptShareMetadata",[w,_],Object.getOwnPropertyDescriptor(j.prototype,"adaptShareMetadata"),j.prototype),B(j.prototype,"_triggerEmail",[T,O],Object.getOwnPropertyDescriptor(j.prototype,"_triggerEmail"),j.prototype),B(j.prototype,"_triggerShareToJam",[D,E],Object.getOwnPropertyDescriptor(j.prototype,"_triggerShareToJam"),j.prototype),B(j.prototype,"_saveAsTile",[M,P],Object.getOwnPropertyDescriptor(j.prototype,"_saveAsTile"),j.prototype),B(j.prototype,"_adaptShareMetadata",[A,C],Object.getOwnPropertyDescriptor(j.prototype,"_adaptShareMetadata"),j.prototype),j))||I);return z},false);
//# sourceMappingURL=Share.js.map