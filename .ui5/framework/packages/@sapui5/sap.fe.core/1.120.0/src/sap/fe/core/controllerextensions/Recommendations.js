/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/helpers/ClassSupport","sap/fe/core/helpers/RecommendationHelper","sap/fe/core/helpers/StandardRecommendationHelper","sap/ui/core/mvc/ControllerExtension","sap/ui/core/mvc/OverrideExecution","../CommonUtils","./editFlow/TransactionHelper"],function(e,t,n,o,i,r,c,s){"use strict";var a,d,p,l,m,u,f,h,y,g,v,b,R,O,P,A;var w={};var x=o.standardRecommendationHelper;var C=n.recommendationHelper;var j=t.publicExtension;var E=t.methodOverride;var D=t.extensible;var I=t.defineUI5Class;function V(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;F(e,t)}function F(e,t){F=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,n){t.__proto__=n;return t};return F(e,t)}function B(e,t,n,o,i){var r={};Object.keys(o).forEach(function(e){r[e]=o[e]});r.enumerable=!!r.enumerable;r.configurable=!!r.configurable;if("value"in r||r.initializer){r.writable=true}r=n.slice().reverse().reduce(function(n,o){return o(e,t,n)||n},r);if(i&&r.initializer!==void 0){r.value=r.initializer?r.initializer.call(i):void 0;r.initializer=undefined}if(r.initializer===void 0){Object.defineProperty(e,t,r);r=null}return r}let M=(a=I("sap.fe.core.controllerextensions.Recommendations"),d=E(),p=E("_routing"),l=j(),m=j(),u=D(r.Instead),f=j(),h=D(r.Instead),y=j(),g=j(),v=j(),b=D("AfterAsync"),R=j(),O=D(r.Instead),a(P=(A=function(t){V(n,t);function n(){return t.apply(this,arguments)||this}w=n;var o=n.prototype;o.onInit=function e(){};o.onAfterBinding=async function e(t){const n=this.base.getView().getModel("internal");const o=n.getProperty("/isRecommendationEnabled");if(o===undefined&&t){const e=await this._getRootContext(t);if(e){this.recommendationEnabledPromise=this.base.recommendations.isEnabled(e)}}else if(o!==undefined){this.recommendationEnabledPromise=Promise.resolve(o)}};o._getRootContext=async function e(t){const n=s.getProgrammingModel(t);return c.createRootContext(n,this.base.getView(),this.base.getAppComponent())};o.clearRecommendations=function e(){const t=this.getView().getBindingContext();if(t){C.clearRecommendations(this.getView(),t)}};o.isEnabled=async function e(t){return Promise.resolve(false)};o.fetchRecommendations=async function e(t,n){return Promise.resolve([])};o.fetchAndApplyRecommendations=async function t(n){if(n&&n.length>0){const t=this.base.getView().getModel("internal");const o=await this.recommendationEnabledPromise;t.setProperty("/isRecommendationEnabled",o);if(o){try{const e=await this._getRootContext(n[0]);const t=await this.base.recommendations.fetchRecommendations(n,e);if(t!==null&&t!==void 0&&t.length){this.storeRecommendationContexts(n)}return this.applyRecommendation(t,n)}catch(t){e.error("There was an error fetching the recommendations",t)}}}return false};o.fetchAndApplyRecommendationsOnFieldChange=async function e(t,n){const o=this.base.getAppComponent();const i=o.getSideEffectsService().checkIfFieldIsRecommendationRelevant(t);if(i){return this.fetchAndApplyRecommendations(n)}else{return false}};o.onBeforeAcceptRecommendations=async function e(t){return Promise.resolve()};o.acceptRecommendations=async function e(t){return Promise.resolve(true)};o.applyRecommendation=function e(t,n){x.storeRecommendations(t,this.getView().getModel("internal"),n);return true};o.storeRecommendationContexts=function e(t){var n;let o=this.recommendationContexts||[];const i=[];t.forEach(e=>{i.push(e.getPath())});o=(n=o)===null||n===void 0?void 0:n.filter(e=>{if(e&&e!==null&&e!==void 0&&e.getModel()&&!i.includes(e.getPath())){return true}return false});this.recommendationContexts=[...o,...t]};o.fetchFilteredRecommendationContexts=function e(t){const n=[];const o=[];for(const e of t){const t=e.substring(0,e.lastIndexOf(")")+1);this.recommendationContexts.forEach(e=>{if(e.getPath()==t&&!n.includes(t)){n.push(t);o.push(e)}})}return o};o.fetchFilteredRecommendationData=function e(t){var n,o;const i={};const r=(n=this.getView())===null||n===void 0?void 0:(o=n.getModel("internal"))===null||o===void 0?void 0:o.getProperty("/recommendationsData");Object.keys(r).forEach(e=>{if(t.includes(e)){i[e]=Object.assign(r[e],{})}});return i};o.fetchTargets=function e(){var t,n;const o=(t=this.getView())===null||t===void 0?void 0:(n=t.getModel("internal"))===null||n===void 0?void 0:n.getProperty("/recommendationsData");if(o.version===null){return[]}return Object.keys(o).filter(e=>{var t,n;return e!=="version"&&e.includes((t=this.getView())===null||t===void 0?void 0:(n=t.getBindingContext())===null||n===void 0?void 0:n.getPath())})||[]};o.adjustAcceptAllParams=function e(t,n,o){o.recommendationData=[];for(const e in t){const i=e.substring(0,e.lastIndexOf(")")+1);const r=e.substring(e.lastIndexOf(")")+2);const c=n.filter(function(e){if(e.getPath()===i){return true}});if(x.isRecommendationFieldNull(c[0],e,r)){o.recommendationData.push({context:c[0],propertyPath:r,value:t[e].value,text:t[e].text})}}};o.fetchAcceptAllParams=async function e(){var t;const n=this.fetchTargets();const o=this.fetchFilteredRecommendationData(n);const i=this.fetchFilteredRecommendationContexts(n);const r={};this.adjustAcceptAllParams(o,i,r);await((t=this.getView())===null||t===void 0?void 0:t.getController()).recommendations.onBeforeAcceptRecommendations(r);return r};o.checkIfRecommendationsExist=function e(){var t,n;const o=((t=this.getView())===null||t===void 0?void 0:(n=t.getModel("internal"))===null||n===void 0?void 0:n.getProperty("/recommendationsData"))||{};return Object.keys(o).length!==0};return n}(i),B(A.prototype,"onInit",[d],Object.getOwnPropertyDescriptor(A.prototype,"onInit"),A.prototype),B(A.prototype,"onAfterBinding",[p],Object.getOwnPropertyDescriptor(A.prototype,"onAfterBinding"),A.prototype),B(A.prototype,"clearRecommendations",[l],Object.getOwnPropertyDescriptor(A.prototype,"clearRecommendations"),A.prototype),B(A.prototype,"isEnabled",[m,u],Object.getOwnPropertyDescriptor(A.prototype,"isEnabled"),A.prototype),B(A.prototype,"fetchRecommendations",[f,h],Object.getOwnPropertyDescriptor(A.prototype,"fetchRecommendations"),A.prototype),B(A.prototype,"fetchAndApplyRecommendations",[y],Object.getOwnPropertyDescriptor(A.prototype,"fetchAndApplyRecommendations"),A.prototype),B(A.prototype,"fetchAndApplyRecommendationsOnFieldChange",[g],Object.getOwnPropertyDescriptor(A.prototype,"fetchAndApplyRecommendationsOnFieldChange"),A.prototype),B(A.prototype,"onBeforeAcceptRecommendations",[v,b],Object.getOwnPropertyDescriptor(A.prototype,"onBeforeAcceptRecommendations"),A.prototype),B(A.prototype,"acceptRecommendations",[R,O],Object.getOwnPropertyDescriptor(A.prototype,"acceptRecommendations"),A.prototype),A))||P);w=M;return w},false);
//# sourceMappingURL=Recommendations.js.map