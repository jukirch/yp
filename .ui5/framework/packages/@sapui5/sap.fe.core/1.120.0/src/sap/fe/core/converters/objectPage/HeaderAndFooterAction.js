/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/helpers/ConfigurableObject","sap/fe/core/converters/helpers/Key","sap/fe/core/helpers/BindingToolkit","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper","sap/fe/core/templating/UIFormatters","sap/ui/core/Core","../../helpers/BindingHelper","../ManifestSettings"],function(t,e,i,n,o,a,l,r,d,s,v){"use strict";var u={};var c=v.ActionType;var f=s.singletonPathVisitor;var p=s.UI;var y=s.Draft;var g=r.isVisible;var b=l.isPathDeletable;var E=a.isEntitySet;var h=n.pathInModel;var A=n.not;var m=n.ifElse;var D=n.getExpressionFromAnnotation;var C=n.fn;var I=n.equal;var S=n.constant;var T=n.compileExpression;var O=n.and;var F=i.KeyHelper;var P=e.Placement;var B=t.getSemanticObjectMapping;var N=t.getEnabledForAnnotationAction;var U=t.getCopyAction;var M=t.dataFieldIsCopyAction;var k=t.ButtonType;function H(t,e){var i,n,o;return((i=t.annotations)===null||i===void 0?void 0:(n=i.UI)===null||n===void 0?void 0:(o=n.Identification)===null||o===void 0?void 0:o.filter(t=>{var i,n,o,a,l,r,d,s,v,u;return((i=t.annotations)===null||i===void 0?void 0:(n=i.UI)===null||n===void 0?void 0:(o=n.Hidden)===null||o===void 0?void 0:o.valueOf())!==true&&t.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"&&Boolean((a=t.Determining)===null||a===void 0?void 0:a.valueOf())===e&&(((l=t.ActionTarget)===null||l===void 0?void 0:(r=l.isBound)===null||r===void 0?void 0:r.valueOf())!==true||(t===null||t===void 0?void 0:(d=t.ActionTarget)===null||d===void 0?void 0:(s=d.annotations)===null||s===void 0?void 0:(v=s.Core)===null||v===void 0?void 0:(u=v.OperationAvailable)===null||u===void 0?void 0:u.valueOf())!==false)?true:false}))||[]}u.getIdentificationDataFieldForActions=H;function R(t,e){var i,n,o;return((i=t.annotations)===null||i===void 0?void 0:(n=i.UI)===null||n===void 0?void 0:(o=n.Identification)===null||o===void 0?void 0:o.filter(t=>{var i,n,o,a;return((i=t.annotations)===null||i===void 0?void 0:(n=i.UI)===null||n===void 0?void 0:(o=n.Hidden)===null||o===void 0?void 0:o.valueOf())!==true&&t.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"&&Boolean((a=t.Determining)===null||a===void 0?void 0:a.valueOf())===e?true:false}))||[]}const V=["UI.CriticalityType/VeryPositive","UI.CriticalityType/Positive","UI.CriticalityType/Negative","UI.CriticalityType/VeryNegative"];u.IMPORTANT_CRITICALITIES=V;function x(t,e){const i=t.getDataModelObjectPath(),n=i.navigationProperties.map(t=>t.name),o=D(e,n,false,e=>f(e,t.getConvertedTypes(),[])),a=t.getManifestWrapper(),l=a.getViewLevel(),r=l>1?p.IsEditable:A(p.IsEditable);return m(e===undefined||e.valueOf()===false,r,O(r,I(o,false)))}u.getDeleteButtonVisibility=x;function j(t,e,i){const n=i.getEntitySet(),a=o.isDraftRoot(n);let l=m(e!==undefined,e,m(t!==undefined,I(D(t),true),S(true)));l=a?O(l,A(h("DraftAdministrativeData/InProcessByUser"))):l;return l}u.getDeleteButtonEnabled=j;function w(t,e,i,n,a){const l=i===null||i===void 0?void 0:i.getEntitySet(),r=t.getEntitySet(),d=t.getManifestWrapper().isFclEnabled();let s;const v=L(i,e);if(a&&a>1){s=o.isDraftNode(r)}else{s=o.isDraftRoot(l)}const u=L(i,n);const c=A(p.IsEditable);const f=m(a>1,m(n===undefined||n.valueOf()===false,O(c,I(h("rootEditVisible","internal"),true),m(d,I(h("/showEditButton","fclhelper"),true),true)),O(c,I(u,false),I(h("rootEditVisible","internal"),true),m(d,I(h("/showEditButton","fclhelper"),true),true))),m(e===undefined||e.valueOf()===false,c,O(c,I(v,false))));return m(s,O(f,y.HasNoDraftForCurrentUser),f)}u.getEditButtonVisibility=w;function L(t,e){const i=t.getDataModelObjectPath(),n=i.navigationProperties.map(t=>t.name),o=D(e,n,false,e=>f(e,t.getConvertedTypes(),n));return o}u.getHiddenExpression=L;function K(t,e,i){const n=t.getEntitySet(),a=o.isDraftRoot(n),l=o.isSticky(n);let r;if(a&&E(n)){var d,s;r=(d=n.annotations.Common)===null||d===void 0?void 0:(s=d.DraftRoot)===null||s===void 0?void 0:s.EditAction}else if(l&&E(n)){var v,u;r=(v=n.annotations.Session)===null||v===void 0?void 0:(u=v.StickySessionSupported)===null||u===void 0?void 0:u.EditAction}if(r){var c,f;const n=t.getAbsoluteAnnotationPath(r);const o=t.resolveAbsolutePath(n).target;if((o===null||o===void 0?void 0:(c=o.annotations)===null||c===void 0?void 0:(f=c.Core)===null||f===void 0?void 0:f.OperationAvailable)===null){}else if(i>1){if(e!==undefined){return T(O(I(D(e),true),I(h("rootEditEnabled","internal"),true)))}else{return T(I(h("rootEditEnabled","internal"),true))}}else{return N(t,o??undefined)}}return"true"}u.getEditButtonEnabled=K;function W(t){var e,i,n,a,l;const r=t.getContextPath();const s=o.getRootEntitySetPath(r);const v=t.getConverterContextFor("/"+s);const u=t.getEntitySet(),p=t.getEntityType(),y=v.getEntitySet(),g=v.getEntityType(),m=o.getStickySession(y),S=o.getDraftRoot(y),P=o.getDraftNode(y),N=u&&((e=u.annotations)===null||e===void 0?void 0:(i=e.Capabilities)===null||i===void 0?void 0:i.DeleteRestrictions),L=o.isUpdateHidden(y,g),W=y&&E(y)&&(L===null||L===void 0?void 0:L.valueOf()),$=t.getDataModelObjectPath(),_=b($,{pathVisitor:(e,i)=>f(e,t.getConvertedTypes(),i)}),Q=_?T(_):_,G=H(t.getEntityType(),false);const Y=t.getManifestWrapper().getViewLevel()===1?U(G.filter(t=>M(t))):undefined;const z=G.filter(t=>!M(t));const J=[];if(E(u)&&S!==null&&S!==void 0&&S.EditAction&&W!==true){J.push({type:c.DraftActions,key:"DraftActions"})}const X=t.getManifestWrapper().getViewLevel();const Z=X>1?u===null||u===void 0?void 0:(n=u.annotations.Capabilities)===null||n===void 0?void 0:(a=n.UpdateRestrictions)===null||a===void 0?void 0:a.Updatable:undefined;if(S||P){J.push({type:c.CollaborationAvatars,key:"CollaborationAvatars"})}z.filter(t=>{const e=T(D(t===null||t===void 0?void 0:t.Criticality));return V.includes(e)}).forEach(e=>{J.push(q(e,t))});if((S!==null&&S!==void 0&&S.EditAction||m!==null&&m!==void 0&&m.EditAction)&&W!==true){J.push({type:c.Primary,key:"EditAction",visible:T(w(t,L,v,o.isUpdateHidden(u,p),X)),enabled:K(v,Z,X)})}if(Q&&Q!=="false"||(N===null||N===void 0?void 0:(l=N.Deletable)===null||l===void 0?void 0:l.valueOf())!==false&&Q!=="false"){const e=o.getDeleteHidden(u,p);J.push({type:c.Secondary,key:"DeleteAction",visible:T(x(t,e)),enabled:T(j(N===null||N===void 0?void 0:N.Deletable,_,t)),parentEntityDeleteEnabled:Q})}if(Y){var tt;J.push({...q(Y,t),type:c.Copy,text:((tt=Y.Label)===null||tt===void 0?void 0:tt.toString())??d.getLibraryResourceBundle("sap.fe.core").getText("C_COMMON_COPY")})}const et=R(t.getEntityType(),false);et.filter(t=>{const e=T(D(t===null||t===void 0?void 0:t.Criticality));return!V.includes(e)}).forEach(e=>{var i,n,o,a,l;if(((i=e.RequiresContext)===null||i===void 0?void 0:i.valueOf())===true){throw new Error(`RequiresContext property should not be true for header IBN action : ${e.Label}`)}if(((n=e.Inline)===null||n===void 0?void 0:n.valueOf())===true){throw new Error(`Inline property should not be true for header IBN action : ${e.Label}`)}const r={semanticObjectMapping:B(e.Mapping)};J.push({type:c.DataFieldForIntentBasedNavigation,text:(o=e.Label)===null||o===void 0?void 0:o.toString(),annotationPath:t.getEntitySetBasedAnnotationPath(e.fullyQualifiedName),buttonType:k.Ghost,visible:T(O(A(I(D((a=e.annotations)===null||a===void 0?void 0:(l=a.UI)===null||l===void 0?void 0:l.Hidden),true)),A(I(h("shellNavigationNotAvailable","internal"),true)))),enabled:e.NavigationAvailable!==undefined?T(I(D(e.NavigationAvailable),true)):true,key:F.generateKeyFromDataField(e),isNavigable:true,press:T(C("._intentBasedNavigation.navigate",[D(e.SemanticObject),D(e.Action),r])),customData:T({semanticObject:D(e.SemanticObject),action:D(e.Action)})})});z.filter(t=>{const e=T(D(t===null||t===void 0?void 0:t.Criticality));return!V.includes(e)}).forEach(e=>{J.push(q(e,t))});return J}u.getHeaderDefaultActions=W;function $(t){var e,i,n;const o=t.getEntityType();const a=((e=o.annotations)===null||e===void 0?void 0:(i=e.UI)===null||i===void 0?void 0:(n=i.Identification)===null||n===void 0?void 0:n.filter(t=>{var e,i,n;return(t===null||t===void 0?void 0:(e=t.annotations)===null||e===void 0?void 0:(i=e.UI)===null||i===void 0?void 0:(n=i.Hidden)===null||n===void 0?void 0:n.valueOf())===true}))||[];return a.map(t=>({type:c.Default,key:F.generateKeyFromDataField(t)}))}u.getHiddenHeaderActions=$;function _(t,e){var i,n,a,l;const r=e.getEntitySet();const d=e.getEntityType();const s=o.getStickySession(r),v=E(r)&&(((i=r.annotations.Common)===null||i===void 0?void 0:(n=i.DraftRoot)===null||n===void 0?void 0:n.term)??((a=r.annotations.Session)===null||a===void 0?void 0:(l=a.StickySessionSupported)===null||l===void 0?void 0:l.term)),u=Boolean(v==="com.sap.vocabularies.Common.v1.DraftRoot"||s&&(s===null||s===void 0?void 0:s.SaveAction)),f=t>1,p=Boolean(v==="com.sap.vocabularies.Common.v1.DraftRoot"||s&&(s===null||s===void 0?void 0:s.DiscardAction));const y=H(e.getEntityType(),true);const g=y.filter(t=>{const e=T(D(t===null||t===void 0?void 0:t.Criticality));return e&&V.includes(e)}).map(t=>q(t,e));if((r===null||r===void 0?void 0:r.entityTypeName)===(d===null||d===void 0?void 0:d.fullyQualifiedName)&&u){g.push({type:c.Primary,key:"SaveAction"})}if(f){g.push({type:c.DefaultApply,key:"ApplyAction"})}y.filter(t=>{const e=T(D(t===null||t===void 0?void 0:t.Criticality));return e&&!V.includes(e)}).forEach(t=>{g.push(q(t,e))});if(p){g.push({type:c.Secondary,key:"CancelAction",position:{placement:P.End}})}return g}u.getFooterDefaultActions=_;function q(t,e){const i=g(t);return{type:c.DataFieldForAction,annotationPath:e.getEntitySetBasedAnnotationPath(t.fullyQualifiedName),key:F.generateKeyFromDataField(t),visible:T(i),enabled:N(e,t.ActionTarget),isNavigable:true}}return u},false);
//# sourceMappingURL=HeaderAndFooterAction.js.map