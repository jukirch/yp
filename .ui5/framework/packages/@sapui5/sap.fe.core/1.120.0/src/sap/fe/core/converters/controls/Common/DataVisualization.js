/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/converters/MetaModelConverter","sap/fe/core/converters/helpers/IssueManager","sap/fe/core/helpers/StableIdHelper","sap/fe/core/helpers/TypeGuards","sap/fe/macros/CommonHelper","sap/ui/core/Core","../../ManifestSettings","./Chart","./Table"],function(t,e,a,n,i,o,r,s,l){"use strict";var u={};var c=s.createChartVisualization;var v=s.createBlankChartVisualization;var d=r.VisualizationType;var f=r.TemplateType;var p=n.isAnnotationOfType;var m=a.generate;var I=e.IssueType;var h=e.IssueSeverity;var g=e.IssueCategory;const P=function(t,e,a,n){const i=[];const o=E(a);const r=e.split("@")[0];if((n===true||o)&&!y(t,o)){if(!D(t,"com.sap.vocabularies.UI.v1.LineItem")){const t=L("com.sap.vocabularies.UI.v1.LineItem",r,a);if(t){i.push(t)}}if(!D(t,"com.sap.vocabularies.UI.v1.Chart")){const t=L("com.sap.vocabularies.UI.v1.Chart",r,a);if(t){i.push(t)}}}const s=t.Visualizations;const l=function(t){const e=s===null||s===void 0?void 0:s.find(e=>e.$target!==undefined&&t.includes(e.$target.term));if(e){i.push({visualization:e.$target,annotationPath:`${r}${e.value}`,converterContext:a})}};if(o){l(["com.sap.vocabularies.UI.v1.LineItem"]);l(["com.sap.vocabularies.UI.v1.Chart"])}else{l(["com.sap.vocabularies.UI.v1.LineItem","com.sap.vocabularies.UI.v1.Chart"])}return i};u.getVisualizationsFromPresentationVariant=P;function V(t,e,a){if(e){const t=a.getEntityTypeAnnotation(e);const n=t.annotation;if(n){if(n.term==="com.sap.vocabularies.UI.v1.SelectionPresentationVariant"){return n}}else{throw new Error("Annotation Path for the SPV mentioned in the manifest is not found, Please add the SPV in the annotation")}}else{var n,i;return(n=t.annotations)===null||n===void 0?void 0:(i=n.UI)===null||i===void 0?void 0:i.SelectionPresentationVariant}}u.getSelectionPresentationVariant=V;function b(t,e){const a=t&&t.PresentationVariant;if(a){return y(a,e)}else{throw new Error("Presentation Variant is not present in the SPV annotation")}}u.isSelectionPresentationCompliant=b;function y(t){let e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;let a=false,n=false;if(e){if(t!==null&&t!==void 0&&t.Visualizations){const e=t.Visualizations;e.forEach(t=>{var e,i;if(((e=t.$target)===null||e===void 0?void 0:e.term)==="com.sap.vocabularies.UI.v1.LineItem"){a=true}if(((i=t.$target)===null||i===void 0?void 0:i.term)==="com.sap.vocabularies.UI.v1.Chart"){n=true}})}return n&&a}else{return(t===null||t===void 0?void 0:t.Visualizations)&&!!t.Visualizations.find(t=>{var e,a;return((e=t.$target)===null||e===void 0?void 0:e.term)==="com.sap.vocabularies.UI.v1.LineItem"||((a=t.$target)===null||a===void 0?void 0:a.term)==="com.sap.vocabularies.UI.v1.Chart"})}}u.isPresentationCompliant=y;function C(t){var e;return(e=t.annotations.UI)===null||e===void 0?void 0:e.LineItem}u.getDefaultLineItem=C;function U(t){var e;return(e=t.annotations.UI)===null||e===void 0?void 0:e.Chart}u.getDefaultChart=U;function M(t){var e,a;return(e=t.annotations)===null||e===void 0?void 0:(a=e.UI)===null||a===void 0?void 0:a.PresentationVariant}u.getDefaultPresentationVariant=M;function z(t){var e,a;return(e=t.annotations)===null||e===void 0?void 0:(a=e.UI)===null||a===void 0?void 0:a.SelectionVariant}u.getDefaultSelectionVariant=z;function S(t,e){const a=e.getManifestWrapper().getDefaultTemplateAnnotationPath();const n=V(t,a,e);let i;if(n){i=n.SelectionVariant;if(i){return i}}else{i=z(t);return i}}u.getSelectionVariant=S;function T(t,e,a,n,i,o,r){const s=t!==""?a.getEntityTypeAnnotation(t):{annotation:undefined,converterContext:a};const u=o?a.getEntityTypeAnnotation(o):null;const d=s.annotation;a=s.converterContext;let f=[];let p;let m="";let V,b;const y=d===null||d===void 0?void 0:d.term;if(y){switch(y){case"com.sap.vocabularies.UI.v1.LineItem":case"com.sap.vocabularies.UI.v1.Chart":p=u===null||u===void 0?void 0:u.annotation;f.push({visualization:d,annotationPath:t,converterContext:a});break;case"com.sap.vocabularies.UI.v1.PresentationVariant":p=d;f=f.concat(P(d,t,a,r));break;case"com.sap.vocabularies.UI.v1.SelectionPresentationVariant":p=d.PresentationVariant;m=p.fullyQualifiedName;f=f.concat(P(p,t,a,r));break;default:break}f.forEach(t=>{const{visualization:a,annotationPath:o,converterContext:r}=t;switch(a.term){case"com.sap.vocabularies.UI.v1.Chart":V=c(a,o,r,i,n);break;case"com.sap.vocabularies.UI.v1.LineItem":default:b=l.createTableVisualization(a,o,r,p,e,n);break}})}const C=[];let U=y==="com.sap.vocabularies.UI.v1.SelectionPresentationVariant"?m:d===null||d===void 0?void 0:d.fullyQualifiedName;if(U===undefined){U="/"}const M=E(a);if(!y||M&&b===undefined){b=l.createDefaultTableVisualization(a,r!==true);a.getDiagnostics().addIssue(g.Annotation,h.Medium,I.MISSING_LINEITEM)}if(M&&V===undefined){V=v(a);a.getDiagnostics().addIssue(g.Annotation,h.Medium,I.MISSING_CHART)}if(V){C.push(V)}if(b){C.push(b)}return{visualizations:C,annotationPath:a.getEntitySetBasedAnnotationPath(U)}}u.getDataVisualizationConfiguration=T;function A(e,a){i.validatePresentationMetaPath(e.getPath(),a);const n=t.convertMetaModelContext(e),o=e.getModel();if(n){if(p(n,"com.sap.vocabularies.UI.v1.SelectionPresentationVariantType")||p(n,"com.sap.vocabularies.UI.v1.PresentationVariantType")){let t;if(p(n,"com.sap.vocabularies.UI.v1.SelectionPresentationVariantType")&&n.PresentationVariant){t=n.PresentationVariant.Visualizations}else if(p(n,"com.sap.vocabularies.UI.v1.PresentationVariantType")){t=n.Visualizations}if(Array.isArray(t)){for(const n of t){if(n.type=="AnnotationPath"&&n.value.includes(a)&&!!o.getMetaContext(e.getPath().split("@")[0]+n.value).getObject()){a=n.value;break}}}}else{return e}}return o.getMetaContext(e.getPath().split("@")[0]+a)}u.getUiControl=A;const D=function(t,e){var a;return((a=t.Visualizations)===null||a===void 0?void 0:a.some(t=>t.value.includes(e)))??false};u.annotationExistsInPresentationVariant=D;const L=function(t,e,a){const n=a.getEntityType();const i=t==="com.sap.vocabularies.UI.v1.LineItem"?C(n):U(n);if(i){return{visualization:i,annotationPath:`${e}${a.getRelativeAnnotationPath(i.fullyQualifiedName,n)}`,converterContext:a}}return undefined};u.prepareDefaultVisualization=L;const E=function(t){return t.getManifestWrapper().hasMultipleVisualizations()||t.getTemplateType()===f.AnalyticalListPage};u.isAlpAnnotation=E;const N=function(t){if(o.getLoadedLibraries().hasOwnProperty("sap.sac.df")){return{visualizations:[{type:d.MultiDimensionalGrid,id:m(["fe","MultiDimensionalGrid",t.dataProviderName]),variantManagementId:m(["fe","MultiDimensionalGrid",t.dataProviderName,"vm"]),modelName:t.modelName,dataProviderName:t.dataProviderName,dimensionMapping:t.dimensionMapping}]}}else{throw new Error("You need to add 'sap.sac.df' to sap.ui5.dependencies.libs in order to use the DragonFly multidimensional grid!")}};u.getMultiDimensionalGridVisualization=N;return u},false);
//# sourceMappingURL=DataVisualization.js.map