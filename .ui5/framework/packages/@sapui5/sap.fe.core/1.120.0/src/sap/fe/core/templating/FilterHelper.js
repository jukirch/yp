/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/converters/MetaModelConverter","sap/fe/core/templating/PropertyHelper","sap/fe/core/type/EDM","sap/ui/mdc/condition/Condition","sap/ui/mdc/enums/ConditionValidated"],function(e,t,n,o,i,a){"use strict";var r={};var s=o.isTypeFilterable;var d=n.hasValueHelp;var l=t.getInvolvedDataModelObjects;const c={Contains:"NotContains",StartsWith:"NotStartsWith",EndsWith:"NotEndsWith",Empty:"NotEmpty",NotEmpty:"Empty",LE:"NOTLE",GE:"NOTGE",LT:"NOTLT",GT:"NOTGT",BT:"NOTBT",NE:"EQ",EQ:"NE"};function u(e){let t;if(e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})T(\d{1,2}):(\d{1,2}):(\d{1,2})\+(\d{1,4})/)){t=e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})T(\d{1,2}):(\d{1,2}):(\d{1,2})\+(\d{1,4})/)[0]}else if(e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})T(\d{1,2}):(\d{1,2}):(\d{1,2})/)){t=`${e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})T(\d{1,2}):(\d{1,2}):(\d{1,2})/)[0]}+0000`}else if(e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/)){t=`${e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/)[0]}T00:00:00+0000`}else if(e.indexOf("Z")===e.length-1){t=`${e.split("Z")[0]}+0100`}else{t=undefined}return t}r._getDateTimeOffsetCompliantValue=u;function f(e){return e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/)?e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/)[0]:e.match(/^(\d{8})/)&&e.match(/^(\d{8})/)[0]}r._getDateCompliantValue=f;function p(e,t,n){var o;if(!s(t)||!n){return undefined}if(e===undefined||e===null){return e}let i=e;switch(t){case"Edm.Boolean":if(typeof e==="boolean"){i=e}else{i=e==="true"||(e==="false"?false:undefined)}break;case"Edm.Double":case"Edm.Single":if(e===""&&n==="EQ"){break}const t=Number(e);i=isNaN(t)?undefined:parseFloat(e.toString());break;case"Edm.Byte":case"Edm.Int16":case"Edm.Int32":case"Edm.SByte":if(i===""&&n==="EQ"){break}const a=Number(e);i=isNaN(a)?undefined:parseInt(e.toString(),10);break;case"Edm.Date":i=f(e);break;case"Edm.DateTimeOffset":i=u(e);break;case"Edm.TimeOfDay":i=e.toString().match(/(\d{1,2}):(\d{1,2}):(\d{1,2})/)?(o=e.toString().match(/(\d{1,2}):(\d{1,2}):(\d{1,2})/))===null||o===void 0?void 0:o[0]:undefined;break;default:}return i===null?undefined:i}r.getTypeCompliantValue=p;function m(t,n,o,i){let a=n,r,s;if(n===undefined||n===null){return undefined}switch(t){case"CP":s="Contains";if(a){const t=a.indexOf("*");const n=a.lastIndexOf("*");if(t>-1){if(t===0&&n!==a.length-1){s="EndsWith";a=a.substring(1,a.length)}else if(t!==0&&n===a.length-1){s="StartsWith";a=a.substring(0,a.length-1)}else{a=a.substring(1,a.length-1)}}else{e.warning("Contains Option cannot be used without '*'.");return undefined}}break;case"EQ":s=n===""?"Empty":t;break;case"NE":s=n===""?"NotEmpty":t;break;case"BT":if(o===undefined||o===null){return}r=o;s=t;break;case"LE":case"GE":case"GT":case"LT":s=t;break;default:e.warning(`Selection Option is not supported : '${t}'`);return undefined}if(i==="E"){s=c[s]}const d={values:[],isEmpty:null,operator:s};if(s!=="Empty"){d.values.push(a);if(r){d.values.push(r)}}return d}r.resolveConditionValues=m;function g(e){return e.indexOf("/")>0?e.split("/")[1]:e}r.getRangeProperty=g;function E(e,t,n,o){const i=[];const a=d(t);e===null||e===void 0?void 0:e.forEach(e=>{const r=o?o(e,t,n):b(e,t.type,a);if(r){i.push(r)}});return i}function h(e,t,n){const o=t.getMetaContext(`${n}/${e}`),i=l(o);return i.targetObject}function v(e,t,n,o){const i=e.PropertyName,a={},r=i.value||i.$PropertyPath,s=e.Ranges;const d=h(r,t,n);if(d){const e=E(s,d,r,o);if(e.length){a[r]=(a[r]||[]).concat(e)}}return a}function y(e,t,n,o){let i={};if(!n){return i}const r=n.SelectOptions,s=n.Parameters;r===null||r===void 0?void 0:r.forEach(n=>{const a=n.PropertyName,r=a.value||a.$PropertyPath;if(Object.keys(i).includes(r)){i[r]=i[r].concat(v(n,t,e,o)[r])}else{i={...i,...v(n,t,e,o)}}});s===null||s===void 0?void 0:s.forEach(e=>{const t=e.PropertyName.value||e.PropertyName.$PropertyPath;const n=o?{operator:"EQ",value1:e.PropertyValue,value2:null,path:t,isParameter:true}:{operator:"EQ",values:[e.PropertyValue],isEmpty:null,validated:a.Validated,isParameter:true};i[t]=[n]});return i}r.getFiltersConditionsFromSelectionVariant=y;function b(t,n,o){let r;try{const e=g(t.Sign);const s=g(t.Option);const d=p(t.Low,n,s);const l=t.High?p(t.High,n,s):undefined;const c=m(s,d,l,e);if(c){const e=o&&c.operator==="EQ"?a.Validated:a.NotValidated;r=i.createCondition(c.operator,c.values,null,null,e)}}catch(t){const n=t instanceof Error?t.message:String(t);e.error(`FE : Core : FilterHelper : getConditions : ${n}`)}return r}r.getConditions=b;const T=function(e,t){const n={};const o=e.getInterface(1).getPath(),r=e.getInterface(1).getModel();if(t){for(const e in t){const t=r.getObject(`${o}/${e}@com.sap.vocabularies.Common.v1.FilterDefaultValue`);if(t!==undefined){const o=e;n[o]=[i.createCondition("EQ",[t],null,null,a.Validated)]}}}return n};const N=function(e,t,n){const o={};const a=e.getInterface(1);const r=a.getModel();const s=a.getPath();for(const e in n){if(n[e][0]){const t=e.split("::");let a="";const d=t.length;const l=t.slice(0,t.length-1).join("/");const c=t[d-1];if(l){const e=r.getObject(s+"/"+l);if(e.$kind==="NavigationProperty"&&e.$isCollection){a+=`${l}*/`}else if(e.$kind==="NavigationProperty"){a+=`${l}/`}}a+=c;const u="values"in n[e][0]?n[e][0].values:[];o[a]=[i.createCondition(n[e][0].operator,u,null,null,null)]}}return o};function C(){const e={};e["$editState"]=[i.createCondition("DRAFT_EDIT_STATE",["ALL"],null,null,a.Validated)];return e}r.getEditStatusFilter=C;function O(e,t){var n,o;let i;const a=e.getInterface(1).getPath(),r=e.getInterface(1).getModel(),s=r.getObject(`${a}@`),d=r.getObject(`${a}/`);if(s&&(s["@com.sap.vocabularies.Common.v1.DraftRoot"]||s["@com.sap.vocabularies.Common.v1.DraftNode"])){i=C()}const l=(n=t)===null||n===void 0?void 0:n.selectionVariant;const c=((o=t)===null||o===void 0?void 0:o.defaultSemanticDates)||{};const u=T(e,d);const f=N(e,d,c);if(l){t=y(a,r,l)}else if(u){t=u}if(f){t={...t,...f}}if(i){t={...t,...i}}return Object.keys(t).length>0?JSON.stringify(t).replace(/([{}])/g,"\\$1"):undefined}r.getFilterConditions=O;function P(e){return(e===null||e===void 0?void 0:e.$Type)==="com.sap.vocabularies.UI.v1.SelectionVariantType"}r.isSelectionVariant=P;O.requiresIContext=true;return r},false);
//# sourceMappingURL=FilterHelper.js.map