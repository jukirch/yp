/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/deepClone","sap/base/util/deepEqual","sap/base/util/deepExtend","sap/fe/core/ActionRuntime","sap/fe/core/CommonUtils","sap/fe/core/converters/MetaModelConverter","sap/fe/core/formatters/ValueFormatter","sap/fe/core/helpers/DeleteHelper","sap/fe/core/helpers/ExcelFormatHelper","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/ResourceModelHelper","sap/fe/core/helpers/SizeHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/type/EDM","sap/fe/macros/CommonHelper","sap/fe/macros/DelegateUtil","sap/fe/macros/filterBar/FilterBarDelegate","sap/fe/macros/table/TableSizeHelper","sap/fe/macros/table/Utils","sap/ui/core/Core","sap/ui/core/Fragment","sap/ui/mdc/odata/v4/TableDelegate","sap/ui/mdc/odata/v4/TypeMap","sap/ui/model/Filter","sap/ui/model/json/JSONModel","../TableHelper","../TableRuntime"],function(e,t,n,o,i,a,r,l,s,d,c,u,p,g,f,m,h,v,y,b,C,P,D,F,T,_,I,x){"use strict";var M=f.isTypeFilterable;var S=g.isMultipleNavigationProperty;var A=u.getResourceModel;var E=u.getLocalizedText;var B=r.getInvolvedDataModelObjects;const w="/semanticKeyHasDraftIndicator";const O="searchFired";const V="columnAdded";return Object.assign({},D,{apiVersion:2,_computeVisualSettingsForFieldGroup:function(e,t,n){if(t.name.indexOf("DataFieldForAnnotation::FieldGroup::")===0){const i=e.getColumns().find(function(e){return e.getDataProperty()===t.name});const a=i?i.data("showDataFieldsLabel")==="true":false;const r=e.getModel().getMetaModel();const l=B(r.getContext(t.metadataPath));const s=l.convertedTypes;const d=l.targetObject;const c=d.Target.$target;const u=[];c.Data.forEach(function(e){let t;switch(e.$Type){case"com.sap.vocabularies.UI.v1.DataFieldForAnnotation":t=y.getWidthForDataFieldForAnnotation(e,false,n,s,a);break;case"com.sap.vocabularies.UI.v1.DataField":t=y.getWidthForDataField(e,a,n,s,false);break;case"com.sap.vocabularies.UI.v1.DataFieldForAction":t={labelWidth:0,propertyWidth:p.getButtonWidth(e.Label)};break;default:}if(t){u.push(t.labelWidth+t.propertyWidth)}});const g=u.reduce(function(e,t){return Math.max(e,t)},0);t.visualSettings=o(t.visualSettings,{widthCalculation:{verticalArrangement:true,minWidth:Math.ceil(g)}})}},_computeVisualSettingsForPropertyWithValueHelp:function(e,t){const n=e.getParent();if(!t.propertyInfos){const i=e.getModel().getMetaModel();if(t.metadataPath&&i){const e=i.getObject(`${t.metadataPath}@`);if(e&&e["@com.sap.vocabularies.Common.v1.ValueList"]){t.visualSettings=o(t.visualSettings||{},{widthCalculation:{gap:n.getProperty("readOnly")?0:4}})}}}},_computeVisualSettingsForPropertyWithUnit:function(e,t,n,i,a){const r=e?e.getParent():null;const l=i||a;if(l){t.visualSettings=o(t.visualSettings,{widthCalculation:{gap:Math.ceil(p.getButtonWidth(l))}})}if(n){t.visualSettings=o(t.visualSettings,{widthCalculation:{gap:r&&r.getReadOnly()?0:6}})}},_computeLabel:function(e,t){if(e.label){var n;const o=t[e.label];if((o===null||o===void 0?void 0:o.length)>1&&(n=e.path)!==null&&n!==void 0&&n.includes("/")&&e.additionalLabels){e.label=e.label+" ("+e.additionalLabels.join(" / ")+")"}delete e.additionalLabels}},_updatePropertyInfo:function(e,t){const n={};const i=e.getP13nMode();t.forEach(e=>{if(!e.propertyInfos&&e.label){if(i!==null&&i!==void 0&&i.includes("Sort")&&e.sortable||i!==null&&i!==void 0&&i.includes("Filter")&&e.filterable||i!==null&&i!==void 0&&i.includes("Group")&&e.groupable){n[e.label]=n[e.label]!==undefined?n[e.label].concat([e]):[e]}}});t.forEach(i=>{this._computeVisualSettingsForFieldGroup(e,i,t);this._computeVisualSettingsForPropertyWithValueHelp(e,i);i.typeConfig=o(i.typeConfig,{});this._computeLabel(i,n)});t.push({name:"$editState",path:"$editState",groupLabel:"",group:"",typeConfig:F.getTypeConfig("sap.ui.model.odata.type.String",{},{}),visible:false,groupable:false,sortable:false,filterable:false});return t},getColumnsFor:function(e){return e.getParent().getTableDefinition().columns},_getAggregatedPropertyMap:function(e){return e.getParent().getTableDefinition().aggregates},fetchExportCapabilities:function(t){const n={XLSX:{}};let o;return h.fetchModel(t).then(function(e){o=e;return o.getMetaModel().getObject("/$EntityContainer@Org.OData.Capabilities.V1.SupportedFormats")}).then(function(e){const t=(e||[]).map(e=>e.toLowerCase());if(t.includes("application/pdf")){return o.getMetaModel().getObject("/$EntityContainer@com.sap.vocabularies.PDF.v1.Features")}return undefined}).then(function(e){if(e){n["PDF"]=Object.assign({},e)}return}).catch(function(t){e.error(`An error occurs while computing export capabilities: ${t}`)}).then(function(){return n})},_isFilterableNavigationProperty:function(e,t,n){const o=B(t.getContext(h.getCustomData(n,"metaPath"))),i=B(t.getContext(e.annotationPath)).navigationProperties,a=i.findIndex(e=>{var t;return((t=e.targetType)===null||t===void 0?void 0:t.name)===o.targetEntityType.name}),r=i.slice(a>0?a:0);return!e.relativePath.includes("/")||e.isPartOfLineItem===true&&!r.some(S)},_fetchPropertyInfo:function(e,t,n,o){var i,a,r;const l=t.annotationPath,s=e.getObject(l),d=e.createBindingContext(l),c=(i=t.typeConfig)!==null&&i!==void 0&&i.className&&M(t.typeConfig.className)?F.getTypeConfig(t.typeConfig.className,t.typeConfig.formatOptions,t.typeConfig.constraints):{},u=m.isPropertyFilterable(d,s),p=t.typeConfig&&t.typeConfig.className&&((a=t.typeConfig.className)===null||a===void 0?void 0:a.indexOf("Edm."))!==0,g=h.getCustomData(n,"enableAnalytics")==="true",f=g?this._getAggregatedPropertyMap(n):{},v=E(t.label??"",o??n);const y=E(t.tooltip??"",o??n);const b={name:t.name,metadataPath:l,groupLabel:t.groupLabel,group:t.group,label:v,tooltip:y,typeConfig:c,visible:t.availability!=="Hidden"&&!p,exportSettings:this._setPropertyInfoExportSettings(t.exportSettings,t),unit:t.unit};if(t.visualSettings&&Object.keys(t.visualSettings).length>0){b.visualSettings=t.visualSettings}if(t.exportDataPointTargetValue){b.exportDataPointTargetValue=t.exportDataPointTargetValue}if((r=t.propertyInfos)!==null&&r!==void 0&&r.length){b.propertyInfos=t.propertyInfos}else{var C,P;b.path=t.relativePath;b.sortable=t.sortable;if(g){this._updateAnalyticalPropertyInfoAttributes(b,t)}b.filterable=!!u&&((C=t.textArrangement)===null||C===void 0?void 0:C.mode)!=="Description"&&this._isFilterableNavigationProperty(t,e,n)&&(!g||!f[b.name]&&!((P=t.extension)!==null&&P!==void 0&&P.technicallyGroupable));b.key=t.isKey;b.groupable=t.isGroupable;if(t.textArrangement){const e=this.getColumnsFor(n).find(function(e){var n;return e.name===((n=t.textArrangement)===null||n===void 0?void 0:n.textProperty)});if(e){b.mode=t.textArrangement.mode;b.valueProperty=t.relativePath;b.descriptionProperty=e.relativePath}}b.text=t.textArrangement&&t.textArrangement.textProperty;b.caseSensitive=t.caseSensitive;if(t.additionalLabels){b.additionalLabels=t.additionalLabels.map(e=>E(e,o||n))}}this._computeVisualSettingsForPropertyWithUnit(n,b,t.unit,t.unitText,t.timezoneText);return b},_setPropertyInfoExportSettings:function(e,t){var n;const o=this._getExportFormat((n=t.typeConfig)===null||n===void 0?void 0:n.className);if(o&&e){e.format=o}return e},_updateAnalyticalPropertyInfoAttributes(e,t){if(t.aggregatable){e.aggregatable=t.aggregatable}if(t.extension){e.extension=t.extension}},_fetchComputedPropertyInfo:function(e,t,n){let o="";o=E(e.label,n||t);const i={name:e.name,label:o.toString(),type:"Edm.String",visible:e.availability!=="Hidden",filterable:false,sortable:false,groupable:false,exportSettings:null};return i},_fetchCustomPropertyInfo:function(e,t,n){let o="";if(e.header){if(e.header.startsWith("{metaModel>")){const n=e.header.substring(11,e.header.length-1);o=t.getModel().getMetaModel().getObject(n)}else{o=E(e.header,n||t)}}const i={name:e.name,groupLabel:undefined,group:undefined,label:o.toString(),type:"Edm.String",visible:e.availability!=="Hidden",exportSettings:e.exportSettings,visualSettings:e.visualSettings};if(e.propertyInfos&&e.propertyInfos.length){i.propertyInfos=e.propertyInfos}else{i.path=e.name;i.sortable=false;i.filterable=false}return i},_bColumnHasPropertyWithDraftIndicator:function(e){return!!(e.formatOptions&&e.formatOptions.hasDraftIndicator||e.formatOptions&&e.formatOptions.fieldGroupDraftIndicatorPropertyPath)},_updateDraftIndicatorModel:function(e,t){const n=e.getColumns();const o=e.getBindingContext("internal");const i=o&&o.getPath();if(n&&o){for(const e in n){if(this._bColumnHasPropertyWithDraftIndicator(t)&&t.name===n[e].getDataProperty()){if(o.getProperty(i+w)===undefined){o.setProperty(i+w,t.name);break}}}}},_fetchPropertiesForEntity:function(t,n,o,i){const r=c.getEntitySetPath(n);let l=[];const s=a.getFilterRestrictionsByPath(r,o);const d=s.NonFilterableProperties;return Promise.resolve(this.getColumnsFor(t)).then(e=>{if(e){let n;e.forEach(e=>{this._updateDraftIndicatorModel(t,e);switch(e.type){case"Annotation":n=this._fetchPropertyInfo(o,e,t,i);if(n&&!d.includes(n.name)){n.maxConditions=h.isMultiValue(n)?-1:1}break;case"Computed":n=this._fetchComputedPropertyInfo(e,t,i);break;case"Slot":case"Default":n=this._fetchCustomPropertyInfo(e,t,i);break;default:throw new Error(`unhandled switch case ${e.type}`)}l.push(n)})}return}).then(()=>{l=this._updatePropertyInfo(t,l);return}).catch(function(t){e.error(`An error occurs while updating fetched properties: ${t}`)}).then(function(){return l})},_getCachedOrFetchPropertiesForEntity:function(e,t,n,o){const i=h.getCachedProperties(e);if(i){return Promise.resolve(i)}return this._fetchPropertiesForEntity(e,t,n,o).then(function(t){h.setCachedProperties(e,t);return t})},_setTableNoDataText:function(e,t){let n="";const o=b.getAllFilterInfo(e),i=t.path.startsWith("/")?t.path.substr(1):t.path;const a=function(){if(e.data("hiddenFilters")||e.getQuickFilter()){return"M_TABLE_AND_CHART_NO_DATA_TEXT_MULTI_VIEW"}else{return"T_TABLE_AND_CHART_NO_DATA_TEXT_WITH_FILTER"}};const r=e.getFilter();if(r&&!/BasicSearch$/.test(r)){if(o.search||o.filters&&o.filters.length){n=a()}else{n="T_TABLE_AND_CHART_NO_DATA_TEXT"}}else if(o.search||o.filters&&o.filters.length){n=a()}else{n="M_TABLE_AND_CHART_NO_FILTERS_NO_DATA_TEXT"}e.setNoData(A(e).getText(n,undefined,i))},handleTableDataReceived:function(e,t){const n=e&&e.getRowBinding(),o=t&&t.getProperty("dataReceivedAttached");if(t&&!o){n.attachDataReceived(function(){t.setProperty("selectedContexts",[]);const n=e.getSelectedContexts();t.setProperty("selectedContexts",n);t.setProperty("numberOfSelectedContexts",n.length);const o=JSON.parse(m.parseCustomData(h.getCustomData(e,"operationAvailableMap")));i.setActionEnablement(t,o,n,"table");s.updateDeleteInfoForSelectedContexts(t,n);const a=e?e.getParent():null;if(a){a.setUpEmptyRows(e)}});t.setProperty("dataReceivedAttached",true)}},rebind:function(t,n){const o=t.getParent();const i=o===null||o===void 0?void 0:o.getProperty("bindingSuspended");o===null||o===void 0?void 0:o.setProperty("outDatedBinding",i);if(!i){x.clearSelection(t);D.rebind.apply(this,[t,n]);b.onTableBound(t);this._setTableNoDataText(t,n);return b.whenBound(t).then(this.handleTableDataReceived(t,t.getBindingContext("internal"))).catch(function(t){e.error("Error while waiting for the table to be bound",t)})}return Promise.resolve()},fetchProperties:function(e){return h.fetchModel(e).then(t=>this._getCachedOrFetchPropertiesForEntity(e,h.getCustomData(e,"entityType"),t.getMetaModel())).then(t=>{var n;(n=e.getBindingContext("internal"))===null||n===void 0?void 0:n.setProperty("tablePropertiesAvailable",true);return t})},preInit:function(e){return D.preInit.apply(this,[e]).then(()=>{var t;const n=e.getCreationRow();if(n){n.setBindingContext(null)}const o=C.byId(e.getFilter());o===null||o===void 0?void 0:(t=o.getParent())===null||t===void 0?void 0:t.attachEvent("search",()=>{const t=e.getBindingContext("internal");t===null||t===void 0?void 0:t.setProperty(O,true)});return null})},updateBindingInfo:function(e,t){var n;const o=e.getBindingContext("internal");o.setProperty("isInsightsEnabled",true);D.updateBindingInfo.apply(this,[e,t]);this._internalUpdateBindingInfo(e,t);this._setTableNoDataText(e,t);const i=e.getBindingContext();if(((n=e.getCreationRow())===null||n===void 0?void 0:n.getBindingContext())===null&&t.path&&i){var a;I.enableFastCreationRow(e.getCreationRow(),t.path,i,e.getModel(),(a=e.getModel("ui"))===null||a===void 0?void 0:a.getProperty("/isEditable"))}},_manageSemanticTargets:function(e){const t=e.getRowBinding();if(t){t.attachEventOnce("dataRequested",function(){setTimeout(function(){const t=a.getTargetView(e);if(t){b.getSemanticTargetsFromTable(t.getController(),e)}},0)})}},updateBinding:function(t,o,i){const r=t.getParent();const l=r===null||r===void 0?void 0:r.getProperty("bindingSuspended");if(!l){let l=false;const d=a.getTargetView(t);const c=t.getBindingContext("internal");const u="pendingManualBindingUpdate";const p=c===null||c===void 0?void 0:c.getProperty(u);if(i){var s;const e=d===null||d===void 0?void 0:d.getViewData();const t=i.getFilters("Application");const a=n(o.filters,t[0])&&o.path===i.getPath()&&i.getQueryOptionsFromParameters().$search===(o===null||o===void 0?void 0:(s=o.parameters)===null||s===void 0?void 0:s.$search);const r=!!e.views;l=a&&((c===null||c===void 0?void 0:c.getProperty(O))||(c===null||c===void 0?void 0:c.getProperty(V))||r)&&!p&&e.converterType==="ListReport"}D.updateBinding.apply(this,[t,o,i]);t.fireEvent("bindingUpdated");if(l&&t.getFilter()&&i){i.requestRefresh(i.getGroupId()).finally(()=>{c===null||c===void 0?void 0:c.setProperty(u,false)}).catch(function(t){e.error("Error while refreshing the table",t)});c===null||c===void 0?void 0:c.setProperty(u,true)}c===null||c===void 0?void 0:c.setProperty(O,false);c===null||c===void 0?void 0:c.setProperty(V,false);this._manageSemanticTargets(t);if(r.getTableDefinition().control.type==="TreeTable"){c===null||c===void 0?void 0:c.setProperty("pastableContexts",[])}}r===null||r===void 0?void 0:r.setProperty("outDatedBinding",l)},_computeRowBindingInfoFromTemplate:function(e){const n=t(h.getCustomData(e,"rowsBindingInfo"));if(n.parameters.$$getKeepAliveContext){const t=h.getCustomData(e,"targetCollectionPath");const o=e.getModel("internal");const i=o.getObject("/keptAliveLists")||{};if(!i[t]){i[t]=e.getId();o.setProperty("/keptAliveLists",i)}else if(i[t]!==e.getId()){delete n.parameters.$$getKeepAliveContext}}return n},_internalUpdateBindingInfo:function(e,t){const n=e.getBindingContext("internal");Object.assign(t,this._computeRowBindingInfoFromTemplate(e));if(e.getRowBinding()){t.suspended=false}if(n){n.setProperty("dataReceivedAttached",false)}let o;const i=b.getAllFilterInfo(e);if(i.filters.length>0){o=new T({filters:i.filters,and:true})}if(i.bindingPath){t.path=i.bindingPath}const a=e.getDataStateIndicator();if(a&&a.isFiltering()){if(t.filters.length>0){o=new T({filters:t.filters.concat(i.filters),and:true});this.updateBindingInfoWithSearchQuery(t,i,o)}}else{this.updateBindingInfoWithSearchQuery(t,i,o)}},updateBindingInfoWithSearchQuery:function(e,t,n){e.filters=n;if(t.search){e.parameters.$search=a.normalizeSearchTerm(t.search)}else{e.parameters.$search=undefined}},_templateCustomColumnFragment:async function(e,t,n,o,i){const a=i.getModel&&i.getModel();const r=new _(e),l=new _({id:o}),s={bindingContexts:{this:l.createBindingContext("/"),column:r.createBindingContext("/"),collection:i},models:{metaModel:a,this:l,column:r,collection:a}};return h.templateControlFragment("sap.fe.macros.table.CustomColumn",s,{view:t},n).then(function(e){r.destroy();return e})},_templateSlotColumnFragment:async function(t,n,o,i){const a=new _(t),r=new _({id:i}),l={bindingContexts:{this:r.createBindingContext("/"),column:a.createBindingContext("/")},models:{this:r,column:a}};const s=await h.templateControlFragment("sap.fe.macros.table.SlotColumn",l,{isXML:true});if(!s){return Promise.resolve(null)}const d=s.getElementsByTagName("slot")[0],c=s.getElementsByTagName("mdcTable:template")[0];c.removeChild(d);if(t.template){const e=(new DOMParser).parseFromString(t.template,"text/xml");c.appendChild(e.firstElementChild)}else{e.error(`Please provide content inside this Building Block Column: ${t.header}`);return Promise.resolve(null)}if((o===null||o===void 0?void 0:o.targets)!=="jsControlTree"){return s}return P.load({type:"XML",definition:s,controller:n.getController()})},_templateComputedColumnFragment:async function(e,t,n,o,i){const a=i.getModel&&i.getModel();const r=new _(e),l=new _({id:o}),s={bindingContexts:{this:l.createBindingContext("/"),column:r.createBindingContext("/"),collection:i},models:{metaModel:a,this:l,column:r,collection:a}};return h.templateControlFragment("sap.fe.macros.table.ComputedColumn",s,{view:t},n).then(function(e){r.destroy();return e})},_getExportFormat:function(e){switch(e){case"Edm.Date":return d.getExcelDatefromJSDate();case"Edm.DateTimeOffset":return d.getExcelDateTimefromJSDateTime();case"Edm.TimeOfDay":return d.getExcelTimefromJSTime();default:return undefined}},_getVHRelevantFields:function(e,t,n){let o=[],i=e.getObject(t);if(i.$kind&&i.$kind==="Property"){i=e.getObject(`${t}@com.sap.vocabularies.UI.v1.DataFieldDefault`);t=`${t}@com.sap.vocabularies.UI.v1.DataFieldDefault`}switch(i.$Type){case"com.sap.vocabularies.UI.v1.DataFieldForAnnotation":if(e.getObject(`${t}/Target/$AnnotationPath`).includes("com.sap.vocabularies.UI.v1.FieldGroup")){e.getObject(`${t}/Target/$AnnotationPath/Data`).forEach((n,i)=>{o=o.concat(this._getVHRelevantFields(e,`${t}/Target/$AnnotationPath/Data/${i}`))})}break;case"com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath":case"com.sap.vocabularies.UI.v1.DataFieldWithUrl":case"com.sap.vocabularies.UI.v1.DataField":case"com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation":case"com.sap.vocabularies.UI.v1.DataFieldWithAction":o.push(e.getObject(`${t}/Value/$Path`));break;case"com.sap.vocabularies.UI.v1.DataFieldForAction":case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":break;default:if(t.indexOf(n)===0){o.push(t.substring(n.length+1));break}o.push(m.getNavigationPath(t,true));break}return o},_setDraftIndicatorOnVisibleColumn:function(e,t,n){const o=e.getBindingContext("internal");if(!o){return}const i=o.getPath();const a=t.filter(e=>this._bColumnHasPropertyWithDraftIndicator(e));const r=e.getColumns();let l,s,d,c;for(const e in r){s=r[e].getDataProperty();for(const e in a){c=a[e].name;if(s===c){d=true;break}if(n&&n.name===c){l=n.name}}if(d){o.setProperty(i+w,s);break}}if(!d&&l){o.setProperty(i+w,l)}},removeItem:function(e,t,n){let o=true;if(!t){return Promise.resolve(o)}const i=n.modifier;const a=i.getProperty(t,"dataProperty");if(a&&a.indexOf&&a.indexOf("InlineXML")!==-1){i.insertAggregation(e,"dependents",t);o=false}if(e.isA&&i.targets==="jsControlTree"){this._setDraftIndicatorStatus(i,e,this.getColumnsFor(e))}return Promise.resolve(o)},_getMetaModel:function(e){return e.appComponent&&e.appComponent.getModel().getMetaModel()},_setDraftIndicatorStatus:function(e,t,n,o){if(e.targets==="jsControlTree"){this._setDraftIndicatorOnVisibleColumn(t,n,o)}},_getGroupId:function(e){return e||undefined},_getDependent:function(e,t,n){if(t===n){return e}return undefined},_fnTemplateValueHelp:function(e,t,n){if(t&&!n){return e("sap.fe.macros.table.ValueHelp")}return Promise.resolve()},_getDisplayMode:function(e){let t;if(e!==undefined){e=typeof e==="boolean"?e:e==="true";t=e?"Display":"Editable";return{displaymode:e,columnEditMode:t}}return{displaymode:undefined,columnEditMode:undefined}},_insertAggregation:function(e,t,n){if(e){return t.insertAggregation(n,"dependents",e,0)}return undefined},addItem:async function(t,n,o){const i=this._getMetaModel(o),r=o.modifier,l=r.getId(t),s=t.isA?this.getColumnsFor(t):null;if(!s){return Promise.resolve(null)}const d=s.find(function(e){return e.name===n});if(!d){e.error(`${n} not found while adding column`);return Promise.resolve(null)}const c=t.getBindingContext("internal");c===null||c===void 0?void 0:c.setProperty(V,true);this._setDraftIndicatorStatus(r,t,s,d);const u=await h.getCustomData(t,"metaPath",r);const p=i.createBindingContext(u);const g=o.view||a.getTargetView(t)||(o.appComponent?a.getCurrentPageView(o.appComponent):undefined);if(d.type==="Default"){return this._templateCustomColumnFragment(d,g,r,l,p)}if(d.type==="Slot"){return this._templateSlotColumnFragment(d,g,r,l)}if(d.type==="Computed"){return this._templateComputedColumnFragment(d,g,r,l,p)}if(!i){return Promise.resolve(null)}const f=await h.getCustomData(t,"entityType",r);const m=await h.getCustomData(t,"requestGroupId",r);const v=this._getGroupId(m);const y=await this._getCachedOrFetchPropertiesForEntity(t,f,i,o.appComponent);const b=y.find(function(e){return e.name===n});const C=i.createBindingContext(b.metadataPath);const P=this._getVHRelevantFields(i,b.metadataPath,u);const D={sBindingPath:u,sValueHelpType:"TableValueHelp",oControl:t,oMetaModel:i,oModifier:r,oPropertyInfo:b};const F=async n=>{const o=new _({id:l,requestGroupId:v}),a={bindingContexts:{this:o.createBindingContext("/"),dataField:C,contextPath:p},models:{this:o,dataField:i,metaModel:i,contextPath:i}};try{const e=await h.templateControlFragment(n,a,{},r);return await this._insertAggregation(e,r,t)}catch(t){e.error(`ValueHelp not loaded : ${t.message}`);return null}finally{o.destroy()}};const T=(e,a)=>{const s="sap.fe.macros.table.Column";let c;let g;let f;let m;return Promise.all([h.getCustomData(t,"displayModePropertyBinding",r),h.getCustomData(t,"tableType",r),h.getCustomData(t,"onChange",r),h.getCustomData(t,"creationMode",r)]).then(e=>{c=e[0];g=e[1];f=e[2];m=e[3];const v=this._getDisplayMode(c);c=v.displaymode;const y=v.columnEditMode;const b=new _({enableAutoColumnWidth:t.getParent().enableAutoColumnWidth,isOptimizedForSmallDevice:t.getParent().isOptimizedForSmallDevice,readOnly:c,columnEditMode:y,tableType:g,onChange:f,id:l,navigationPropertyPath:n,columnInfo:d,collection:{sPath:u,oModel:i},creationMode:{name:m},widthIncludingColumnHeader:t.getParent().widthIncludingColumnHeader}),P={bindingContexts:{entitySet:p,collection:p,dataField:C,this:b.createBindingContext("/"),column:b.createBindingContext("/columnInfo")},models:{this:b,entitySet:i,collection:i,dataField:i,metaModel:i,column:b},appComponent:o.appComponent};return h.templateControlFragment(s,P,{view:a},r).finally(function(){b.destroy()})})};await Promise.all(P.map(async e=>{const t=Object.assign({},D,{sPropertyName:e});const n=await Promise.all([h.isValueHelpRequired(t),h.doesValueHelpExist(t)]);const o=n[0],i=n[1];return this._fnTemplateValueHelp(F,o,i)}));return T(b,g)},getFilterDelegate:function(){return Object.assign({apiVersion:2},v,{addItem:function(e,t){if(t.indexOf("Property::")===0){t=t.replace("Property::","")}return v.addItem(e,t)}})},getTypeMap:function(){return F},formatGroupHeader(e,t,n){var o,i;const a=h.getCachedProperties(e),r=a&&a.filter(e=>e.name===n)[0],s=(r===null||r===void 0?void 0:(o=r.typeConfig)===null||o===void 0?void 0:o.baseType)==="DateTime"||(r===null||r===void 0?void 0:(i=r.typeConfig)===null||i===void 0?void 0:i.baseType)==="Date";let d;if(r&&r.mode){switch(r.mode){case"Description":d=t.getProperty(r.descriptionProperty,s);break;case"DescriptionValue":d=l.formatWithBrackets(t.getProperty(r.descriptionProperty,s),t.getProperty(r.valueProperty,s));break;case"ValueDescription":d=l.formatWithBrackets(t.getProperty(r.valueProperty,s),t.getProperty(r.descriptionProperty,s));break;default:break}}else{d=t.getProperty(r===null||r===void 0?void 0:r.path,s)}return A(e).getText("M_TABLE_GROUP_HEADER_TITLE",[r===null||r===void 0?void 0:r.label,d])}})},false);
//# sourceMappingURL=TableDelegate.js.map