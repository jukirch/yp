/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/controllerextensions/BusyLocker","sap/fe/core/controllerextensions/HookSupport","sap/fe/core/controllerextensions/collaboration/ActivitySync","sap/fe/core/controllerextensions/collaboration/CollaborationCommon","sap/fe/core/controllerextensions/editFlow/NotApplicableContextDialog","sap/fe/core/controllerextensions/routing/NavigationReason","sap/fe/core/converters/ManifestSettings","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/ClassSupport","sap/fe/core/helpers/DeleteHelper","sap/fe/core/helpers/FPMHelper","sap/fe/core/helpers/PasteHelper","sap/fe/core/helpers/ResourceModelHelper","sap/fe/core/helpers/SemanticDateOperators","sap/fe/macros/filter/FilterUtils","sap/fe/macros/insights/InsightsService","sap/fe/macros/insights/TableInsightsHelper","sap/fe/macros/table/Utils","sap/m/MessageBox","sap/m/MessageToast","sap/ui/core/Core","sap/ui/core/library","sap/ui/core/message/Message","sap/ui/model/Filter","../MacroAPI","../insights/CommonInsightsHelper","./TableHelper"],function(e,t,n,o,r,i,a,l,s,c,u,p,g,d,f,b,y,h,m,v,C,w,P,T,M,D,E,x,I){"use strict";var R,A,S,O,F,B,z,_,V,N,k,j,L,H,$,U,Q,q,W,G,Y,K,X,J,Z,ee,te,ne,oe,re,ie,ae,le,se,ce,ue,pe,ge,de,fe,be,ye,he,me,ve,Ce,we,Pe,Te,Me,De,Ee,xe,Ie,Re,Ae,Se,Oe,Fe,Be,ze,_e,Ve,Ne,ke,je,Le,He,$e,Ue,Qe,qe,We,Ge,Ye,Ke,Xe,Je,Ze,et,tt,nt,ot,rt,it,at,lt,st,ct,ut,pt,gt,dt,ft,bt,yt,ht;var mt=x.showGenericErrorMessage;var vt=x.hasInsightActionEnabled;var Ct=T.MessageType;var wt=f.getResourceModel;var Pt=f.getLocalizedText;var Tt=u.xmlEventHandler;var Mt=u.property;var Dt=u.event;var Et=u.defineUI5Class;var xt=u.aggregation;var It=c.convertTypes;var Rt=s.CreationMode;var At=i.Activity;var St=o.controllerExtensionHandler;function Ot(e,t,n,o){if(!n)return;Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(o):void 0})}function Ft(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function Bt(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;zt(e,t)}function zt(e,t){zt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,n){t.__proto__=n;return t};return zt(e,t)}function _t(e,t,n,o,r){var i={};Object.keys(o).forEach(function(e){i[e]=o[e]});i.enumerable=!!i.enumerable;i.configurable=!!i.configurable;if("value"in i||i.initializer){i.writable=true}i=n.slice().reverse().reduce(function(n,o){return o(e,t,n)||n},i);if(r&&i.initializer!==void 0){i.value=i.initializer?i.initializer.call(r):void 0;i.initializer=undefined}if(i.initializer===void 0){Object.defineProperty(e,t,i);i=null}return i}function Vt(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}let Nt=(R=Et("sap.fe.macros.table.TableAPI",{returnTypes:["sap.fe.macros.MacroAPI"]}),A=Mt({type:"string",expectedTypes:["EntitySet","EntityType","Singleton","NavigationProperty"],expectedAnnotations:["com.sap.vocabularies.UI.v1.LineItem","com.sap.vocabularies.UI.v1.PresentationVariant","com.sap.vocabularies.UI.v1.SelectionPresentationVariant"]}),S=Mt({type:"string",expectedTypes:["EntitySet","EntityType","Singleton","NavigationProperty"]}),O=Mt({type:"object"}),F=Mt({type:"string"}),B=Mt({type:"boolean"}),z=Mt({type:"string"}),_=Mt({type:"boolean",defaultValue:false}),V=Mt({type:"string",defaultValue:"ResponsiveTable",allowedValues:["GridTable","ResponsiveTable"]}),N=Mt({type:"boolean",defaultValue:true}),k=Mt({type:"boolean",defaultValue:false}),j=Mt({type:"boolean",defaultValue:false}),L=Mt({type:"string"}),H=Mt({type:"string",allowedValues:["None","Single","Multi","Auto","ForceMulti","ForceSingle"]}),$=Mt({type:"string"}),U=Mt({type:"boolean",defaultValue:true}),Q=Mt({type:"boolean",defaultValue:false}),q=Mt({type:"boolean",defaultValue:true}),W=Mt({type:"number"}),G=Mt({type:"boolean",defaultValue:false}),Y=Mt({type:"string",defaultValue:"Fixed",allowedValues:["Auto","Fixed"]}),K=Mt({type:"number",defaultValue:5}),X=xt({type:"sap.fe.macros.table.Action",multiple:true}),J=xt({type:"sap.fe.macros.table.Column",multiple:true}),Z=Mt({type:"boolean",defaultValue:false}),ee=Mt({type:"boolean",defaultValue:false}),te=Mt({type:"boolean",defaultValue:false}),ne=Mt({type:"boolean",defaultValue:false}),oe=Mt({type:"boolean",defaultValue:false}),re=Dt(),ie=Dt(),ae=Dt(),le=Dt(),se=Mt({type:"boolean | string",defaultValue:true}),ce=Mt({type:"string",allowedValues:["Control"]}),ue=Mt({type:"boolean",defaultValue:true}),pe=Mt({type:"sap.fe.macros.table.TableCreationOptions",defaultValue:{name:"Inline",createAtEnd:false,inlineCreationRowsHiddenInEditMode:false}}),ge=Dt(),de=Tt(),fe=Tt(),be=Tt(),ye=Tt(),he=Tt(),me=Tt(),ve=St("collaborationManager","collectAvailableCards"),Ce=Tt(),we=Tt(),Pe=Tt(),Te=Tt(),Me=Tt(),De=Tt(),Ee=Tt(),xe=Tt(),Ie=Tt(),Re=Tt(),Ae=Tt(),Se=Tt(),Oe=Tt(),R(Fe=(Be=function(o){Bt(i,o);function i(e){var t;for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++){r[i-1]=arguments[i]}t=o.call(this,e,...r)||this;t.fetchedContextPaths=[];Ot(t,"metaPath",ze,Ft(t));Ot(t,"contextPath",_e,Ft(t));Ot(t,"tableDefinition",Ve,Ft(t));Ot(t,"entityTypeFullyQualifiedName",Ne,Ft(t));Ot(t,"readOnly",ke,Ft(t));Ot(t,"id",je,Ft(t));Ot(t,"busy",Le,Ft(t));Ot(t,"type",He,Ft(t));Ot(t,"enableExport",$e,Ft(t));Ot(t,"enablePaste",Ue,Ft(t));Ot(t,"enableFullScreen",Qe,Ft(t));Ot(t,"filterBar",qe,Ft(t));Ot(t,"selectionMode",We,Ft(t));Ot(t,"header",Ge,Ft(t));Ot(t,"enableAutoColumnWidth",Ye,Ft(t));Ot(t,"isOptimizedForSmallDevice",Ke,Ft(t));Ot(t,"headerVisible",Xe,Ft(t));Ot(t,"frozenColumnCount",Je,Ft(t));Ot(t,"widthIncludingColumnHeader",Ze,Ft(t));Ot(t,"rowCountMode",et,Ft(t));Ot(t,"rowCount",tt,Ft(t));Ot(t,"actions",nt,Ft(t));Ot(t,"columns",ot,Ft(t));Ot(t,"dataInitialized",rt,Ft(t));Ot(t,"bindingSuspended",it,Ft(t));Ot(t,"outDatedBinding",at,Ft(t));Ot(t,"pendingRequest",lt,Ft(t));Ot(t,"emptyRowsEnabled",st,Ft(t));Ot(t,"rowPress",ct,Ft(t));Ot(t,"stateChange",ut,Ft(t));Ot(t,"contextChange",pt,Ft(t));Ot(t,"internalDataRequested",gt,Ft(t));Ot(t,"personalization",dt,Ft(t));Ot(t,"variantManagement",ft,Ft(t));Ot(t,"isSearchable",bt,Ft(t));Ot(t,"creationMode",yt,Ft(t));Ot(t,"selectionChange",ht,Ft(t));t.updateFilterBar();if(t.content){t.content.attachEvent("selectionChange",{},t.onTableSelectionChange,Ft(t))}return t}i.getAPI=function e(t){const n=t.getSource();let r;if(n.isA("sap.ui.model.odata.v4.ODataListBinding")){var i,a;r=(i=this.instanceMap)===null||i===void 0?void 0:(a=i.get(this))===null||a===void 0?void 0:a.find(e=>{var t;return((t=e.content)===null||t===void 0?void 0:t.getRowBinding())===n})}return r||o.getAPI.call(this,t,"sap.fe.macros.table.TableAPI")};var s=i.prototype;s.getSortConditionsQuery=function e(){var t;const n=this.content;const o=(t=n.getSortConditions())===null||t===void 0?void 0:t.sorters;return o?o.map(function(e){var t;const o=(t=n.getPropertyHelper().getProperty(e.name))===null||t===void 0?void 0:t.path;if(o){return`${o}${e.descending?" desc":""}`}return""}).join(","):""};s.getSelectedContexts=function e(){return this.content.getSelectedContexts()};s.addMessage=function e(t){const n=this._getMessageManager();const o=this.content;const r=new M({target:o.getRowBinding().getResolvedPath(),type:t.type,message:t.message,processor:o.getModel(),description:t.description,persistent:t.persistent});n.addMessages(r);return r.getId()};s.checkIfRecommendationRelevant=function e(n){const o=this.getProperty("readOnly");const r=this.getModel("ui").getProperty("/isEditable");const i=t.getTargetView(this);const a=i.getViewData();if(!o&&r&&a.converterType!=="ListReport"){return true}return false};s.removeMessage=function e(t){const n=this._getMessageManager();const o=n.getMessageModel().getData();const r=o.find(e=>e.id===t);if(r){n.removeMessages(r)}};s.refresh=function e(){this.content.getRowBinding().refresh()};s.setQuickFilterCountsAsLoading=function e(){const t=this.content,n=t.getBindingContext("internal"),o=t.getQuickFilter(),r={};for(const e in o.getItems()){r[e]="..."}n.setProperty("quickFilters",{counts:r})};s.refreshSelectedQuickFilterCount=function e(){var t,n;const o=this.content;const r=o.getRowBinding().getCount();const i=o.getQuickFilter();if(i&&(t=this.getTableDefinition().control.filters)!==null&&t!==void 0&&(n=t.quickFilters)!==null&&n!==void 0&&n.showCounts&&r!==undefined){const e=i.getItems().findIndex(e=>e.getKey()===i.getSelectedKey());if(e>-1){var a;(a=o.getBindingContext("internal"))===null||a===void 0?void 0:a.setProperty(`quickFilters/counts/${e}`,v.getCountFormatted(r))}}};s.refreshUnSelectedQuickFilterCounts=async function n(){var o,r,i;const a=this.content,l=a.getQuickFilter(),s=l.getItems(),c=a.getBindingContext("internal"),u=(o=t.getTargetView(this))===null||o===void 0?void 0:o.getController(),p=(r=(i=u).getChartControl)===null||r===void 0?void 0:r.call(i),g=p&&p.getParent(),d=async e=>{const n=e.getKey();const o=t.getFiltersInfoForSV(a,n);const r=await v.getListBindingForCount(a,a.getBindingContext(),{batchGroupId:"$auto",additionalFilters:[...b,...o.filters]});const i=s.findIndex(e=>e.getKey()===n);if(i>-1){c.setProperty(`quickFilters/counts/${i}`,v.getCountFormatted(r))}};const f=g&&g.hasSelections()&&g.getFilter();const b=v.getHiddenFilters(a);if(f){b.push(f)}const y=s.filter(e=>e.getKey()!==l.getSelectedKey()).map(async e=>d(e));try{await Promise.all(y)}catch(t){e.error("Error while retrieving the binding promises",t)}};s._getMessageManager=function e(){return sap.ui.getCore().getMessageManager()};s._getRowBinding=function e(){const t=this.getContent();return t.getRowBinding()};s.getCounts=function e(){const t=this.getContent();return v.getListBindingForCount(t,t.getBindingContext(),{batchGroupId:!this.getProperty("bindingSuspended")?t.data("batchGroupId"):"$auto",additionalFilters:v.getHiddenFilters(t)}).then(e=>v.getCountFormatted(e)).catch(()=>"0")};s.onContextChange=function e(t){this.fireEvent("contextChange",t.getParameters());this.setFastCreationRowEnablement();this.refreshSelectedQuickFilterCount()};s.onFieldLiveChange=function e(t){const n=t.getSource(),o=n.getBindingContext(),r=o.getBinding();if(o.isInactive()){const e=this===null||this===void 0?void 0:this.content;this===null||this===void 0?void 0:this.createEmptyRows(r,e,true)}};s.onQuickFilterSelectionChange=function e(){var n,o,r;const i=this.content;const a=i.getFilter();const l=a&&P.byId(a);if(!(l!==null&&l!==void 0&&(n=l.getSuspendSelection)!==null&&n!==void 0&&n.call(l))){i.rebind()}(o=t.getTargetView(this))===null||o===void 0?void 0:(r=o.getController())===null||r===void 0?void 0:r.getExtensionAPI().updateAppState()};s.onTableRowPress=function e(t,n,o,r){if(o&&o.isInactive()&&o.isTransient()){return false}if(this.getTableDefinition().enableAnalytics&&o&&o.isA("sap.ui.model.odata.v4.Context")&&typeof o.getProperty("@$ui5.node.isExpanded")==="boolean"){return false}else{const e=Object.assign({},r,{reason:l.RowPress});n._routing.navigateForwardToContext(o,e)}};s.onInternalPatchCompleted=function e(){const t=this.getBindingContext("internal");const n=this.getSelectedContexts();p.updateDeleteInfoForSelectedContexts(t,n)};s.onInternalDataReceived=function e(t){const n=this.checkIfRecommendationRelevant(t);if(n){const e=t.getSource().getAllCurrentContexts();const n=e.filter(e=>!this.fetchedContextPaths.includes(e.getPath()));this.getController().recommendations.fetchAndApplyRecommendations(n)}if(t.getParameter("error")){this.getController().messageHandler.showMessageDialog()}};s.collectAvailableCards=function e(t){const n=this.content.getActions();if(vt(n)){t.push((async()=>{const e=await this.getCardManifestTable();return{card:e,title:this.getTableDefinition().headerInfoTypeName??"",callback:this.onAddCardToCollaborationManagerCallback.bind(this)}})())}};s.onInternalDataRequested=function e(t){var n,o;const r=this.content;this.setProperty("dataInitialized",true);const i=this.checkIfRecommendationRelevant(t);if(i){const e=t.getSource().getAllCurrentContexts();this.fetchedContextPaths=e.map(e=>e===null||e===void 0?void 0:e.getPath())}this.fireEvent("internalDataRequested",t.getParameters());if(r.getQuickFilter()&&(n=this.getTableDefinition().control.filters)!==null&&n!==void 0&&(o=n.quickFilters)!==null&&o!==void 0&&o.showCounts){this.setQuickFilterCountsAsLoading();this.refreshUnSelectedQuickFilterCounts()}};s.onPaste=async function t(n,o){const r=n.getParameter("data"),i=n.getSource(),a=i.isA("sap.ui.mdc.Table")?i:i.getParent(),l=a.getBindingContext("internal");if(!this.tableDefinition.control.enablePaste||!this.getModel("ui").getProperty("/isEditable")){return}if(l!==null&&l!==void 0&&l.getProperty("pastableContexts")){const t=l.getProperty("pastableContexts")[0];const n=a.getSelectedContexts()[0];const o=a.getRowBinding().getCurrentContexts().find(e=>e.getPath()===t);if(!o){e.error("The Cut operation is unsuccessful because the relevant context is no longer available")}else{try{await o.move({parent:n})}catch(t){e.error("The move context fails ",t)}l.setProperty("pastableContexts",[]);return}}if(a.getEnablePaste()===true){d.pasteData(r,a,o)}else{const e=sap.ui.getCore().getLibraryResourceBundle("sap.fe.core");C.error(e.getText("T_OP_CONTROLLER_SAPFE_PASTE_DISABLED_MESSAGE"),{title:e.getText("C_COMMON_SAPFE_ERROR")})}};s.onCut=function t(n){const o=n.getSource().getParent();const r=o.getBindingContext("internal");if(o.getSelectedContexts().length>1){e.error("Multi cutting is not supported");return}r.setProperty("pastableContexts",o.getSelectedContexts().map(e=>e.getPath()));w.show(f.getResourceModel(o).getText("M_CUT_READY"));o.clearSelection();r.setProperty("cutableContexts",[])};s.onBeforeExport=function e(t){var n;const o=!!((n=t.getParameter("userExportSettings"))!==null&&n!==void 0&&n.splitCells);const r=t.getSource(),a=t.getParameter("exportSettings"),l=this.getTableDefinition();i.updateExportSettings(a,l,r,o)};i.dataStateIndicatorFilter=function e(t,n){var o;const r=(o=n.getBindingContext())===null||o===void 0?void 0:o.getPath();const i=(r?`${r}/`:"")+n.getRowBinding().getPath();return i===t.getTargets()[0]?true:false};s.onDataStateChange=function e(t){const n=t.getSource();const o=t.getParameter("filteredMessages");if(o){const e=o.map(e=>{const t=e.getTechnicalDetails()||{};return t.emptyRowMessage===true&&t.missingColumn}).filter(e=>!!e);if(e.length){const o=sap.ui.getCore().getLibraryResourceBundle("sap.fe.macros").getText(e.length===1?"M_MESSAGESTRIP_EMPTYROW_MANDATORY_HIDDEN":"M_MESSAGESTRIP_EMPTYROW_MANDATORY_HIDDEN_PLURAL",[e.join(", ")]);n.showMessage(o,"Error");t.preventDefault()}const r=n.getModel("internal");r.setProperty("filteredMessages",o,n.getBindingContext("internal"))}};i.updateExportSettings=function e(t,n,o,r){const i=n.columns;if(!n.enableAnalytics&&(n.control.type==="ResponsiveTable"||n.control.type==="GridTable")){t.dataSource.sizeLimit=1e3}if(t.fileType==="PDF"){t.workbook.columns=t.workbook.columns.filter(e=>{var t;const o=(t=P.byId(e.columnId))===null||t===void 0?void 0:t.getPropertyKey();if(o){var r;return((r=n.columns.find(e=>e.name===o))===null||r===void 0?void 0:r.isMultiValue)!==true}return true})}const a=t.workbook.columns;for(let e=a.length-1;e>=0;e--){const t=a[e];const n=P.getLibraryResourceBundle("sap.fe.macros");t.label=Pt(t.label,o);if(t.type==="Boolean"){t.falseValue=n.getText("no");t.trueValue=n.getText("yes")}const l=i===null||i===void 0?void 0:i.find(e=>{if(r){return this.columnWithTargetValueToBeAdded(e,t)}else{return false}});if(l){const o={label:n.getText("TargetValue"),property:Array.isArray(t.property)?t.property:[t.property],template:l.exportDataPointTargetValue};a.splice(e+1,0,o)}}return t};i.columnWithTargetValueToBeAdded=function e(t,n){var o;let r=false;if(t.exportDataPointTargetValue&&((o=t.propertyInfos)===null||o===void 0?void 0:o.length)===1){if(t.relativePath===n.property||n.property[0]===t.propertyInfos[0]||n.property.includes(t.relativePath)||n.property.includes(t.name)){delete n.template;r=true}}return r};s.resumeBinding=function e(t){this.setProperty("bindingSuspended",false);if(t&&!this.getDataInitialized()||this.getProperty("outDatedBinding")){var n;this.setProperty("outDatedBinding",false);(n=this.getContent())===null||n===void 0?void 0:n.rebind()}};s.refreshNotApplicableFields=function e(t){const n=this.getContent();return y.getNotApplicableFilters(t,n)};s.suspendBinding=function e(){this.setProperty("bindingSuspended",true)};s.invalidateContent=function e(){this.setProperty("dataInitialized",false);this.setProperty("outDatedBinding",false)};s.setFastCreationRowEnablement=function e(){const t=this.content;const n=t.getCreationRow();if(n&&!n.getBindingContext()){const e=t.getRowBinding();const o=e.getContext();if(o){I.enableFastCreationRow(n,e.getPath(),o,o.getModel(),t.getModel("ui").getProperty("/isEditable"))}}};s.onAddCardToInsightsPressed=async function t(){try{const e=m.getInsightsRelevantColumns(this);const t=await m.createTableCardParams(this,e);if(t){const e=t.parameters.isNavigationEnabled?undefined:{type:"Warning",text:this.createNavigationErrorMessage(this.content)};h.showInsightsCardPreview(t,e);return}}catch(t){mt(this.content);e.error(t)}};s.getCardManifestTable=async function e(){const t=m.getInsightsRelevantColumns(this);const n=await m.createTableCardParams(this,t);return h.getCardManifest(n)};s.onAddCardToCollaborationManagerCallback=async function t(n){try{if(n){await h.showCollaborationManagerCardPreview(n,this.getController().collaborationManager.getService());return}}catch(t){mt(this.content);e.error(t)}};s.createNavigationErrorMessage=function e(t){const n=f.getResourceModel(t);return n.getText("M_ROW_LEVEL_NAVIGATION_DISABLED_MSG_REASON_EXTERNAL_NAVIGATION_CONFIGURED")};s.onMassEditButtonPressed=function t(n,o){const r=this.content;if(o&&o.massEdit){o.massEdit.openMassEditDialog(r)}else{e.warning("The Controller is not enhanced with Mass Edit functionality")}};s.onTableSelectionChange=function e(t){this.fireEvent("selectionChange",t.getParameters())};s.onActionPress=async function t(n,o,r,i){i.model=n.getSource().getModel();let l=true;if(i.notApplicableContexts&&i.notApplicableContexts.length>0){const e=It(i.model.getMetaModel());const t=e.resolvePath(this.entityTypeFullyQualifiedName).target;const n=new a({entityType:t,notApplicableContexts:i.notApplicableContexts,title:i.label,resourceModel:wt(this)});i.contexts=i.applicableContexts;l=await n.open(this)}if(l){try{return await o.editFlow.invokeAction(r,i)}catch(t){e.info(t)}}};s.getTableDefinition=function e(){return this.tableDefinition};s.updateFilterBar=function e(){const t=this.getContent();const n=this.getFilterBar();if(t&&n&&t.getFilter()!==n){this._setFilterBar(n)}};s._setFilterBar=function e(n){var o;const r=this.getContent();const i=this===null||this===void 0?void 0:this.getId();const a=this.data("tableAPILocalId");const l=a&&n&&i&&i.replace(new RegExp(a+"$"),n);const s=((o=t.getTargetView(this))===null||o===void 0?void 0:o.byId(n))||P.byId(n)||P.byId(l);if(s){if(s.isA("sap.fe.macros.filterBar.FilterBarAPI")){r.setFilter(`${s.getId()}-content`)}else if(s.isA("sap.ui.mdc.FilterBar")){r.setFilter(s.getId())}}};s.checkIfColumnExists=function e(t,n){return t.some(function(e){if((e===null||e===void 0?void 0:e.columnName)===n&&e!==null&&e!==void 0&&e.sColumnNameVisible||(e===null||e===void 0?void 0:e.sTextArrangement)!==undefined&&(e===null||e===void 0?void 0:e.sTextArrangement)===n){return n}})};s.getIdentifierColumn=function e(){const t=this.getContent();const n=this.getTableDefinition().headerInfoTitle;const o=t&&t.getModel().getMetaModel(),r=t.data("metaPath");const i=o.getObject(`${r}/$Type/$Key`);const a=[];if(i&&i.length>0){i.forEach(function(e){if(e!=="IsActiveEntity"){a.push(e)}})}const l=this.getTableDefinition().semanticKeys;const s=[];const c=[];const u=t.getColumns();u.forEach(function(e){const t=e===null||e===void 0?void 0:e.getDataProperty();s.push(t)});s.forEach(function(e){var t,n;const i=o.getObject(`${r}/$Type/${e}@`);const a=i&&((t=i["@com.sap.vocabularies.Common.v1.Text"])===null||t===void 0?void 0:t.$Path);const l=i&&((n=i["@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement"])===null||n===void 0?void 0:n.$EnumMember);c.push({columnName:e,sTextArrangement:a,sColumnNameVisible:!(l==="com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly")})});let p;if(n!==undefined&&this.checkIfColumnExists(c,n)){p=n}else if(l!==undefined&&l.length===1&&this.checkIfColumnExists(c,l[0])){p=l[0]}else if(a!==undefined&&a.length===1&&this.checkIfColumnExists(c,a[0])){p=a[0]}return p};s.setEmptyRowsEnabled=function e(t){this.setProperty("emptyRowsEnabled",t);this.setUpEmptyRows(this.content)};s.handleCreateActivate=async function n(o){const i=o.getParameter("context");this.createEmptyRows(o.getSource(),this.content,true);if(!this.validateEmptyRow(i)){o.preventDefault();return}try{const n=i.getPath();try{await(i.created()??Promise.resolve())}catch(t){e.warning(`Failed to activate context ${i.getPath()}`);return}const o=i.getPath();const a=t.getTargetView(this);r.send(a,{action:At.Create,content:o});r.updateLocksForContextPath(a,n,i.getPath())}catch(t){e.error("Failed to activate new row -",t)}};s.setUpEmptyRows=async function e(t){var n;let o=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(((n=this.tableDefinition.control)===null||n===void 0?void 0:n.creationMode)!==Rt.InlineCreationRows){return}const r=t.getModel("ui");if(!r){return}if(r.getProperty("/isEditablePending")){const e=r.bindProperty("/isEditablePending");await new Promise(t=>{const n=()=>{e.detachChange(n);e.destroy();t()};e.attachChange(n)})}const i=t.getRowBinding();const a=i===null||i===void 0?void 0:i.getHeaderContext();if(i&&i.isResolved()&&i.isLengthFinal()&&a){var l,s;const e=a.getPath();if(!this.emptyRowsEnabled){this.removeEmptyRowsMessages();return this._deleteEmptyRows(i,e)}if(!r.getProperty("/isEditable")){return}if((l=this.tableDefinition.control)!==null&&l!==void 0&&l.inlineCreationRowsHiddenInEditMode&&!((s=t.getBindingContext("ui"))!==null&&s!==void 0&&s.getProperty("createMode"))&&!o){return}const n=i.getAllCurrentContexts().find(function(t){return t.isInactive()&&t.getPath().startsWith(e)});if(!n){this.removeEmptyRowsMessages();await this.createEmptyRows(i,t)}}};s._deleteEmptyRows=function e(t,n){for(const e of t.getAllCurrentContexts()){if(e.isInactive()&&e.getPath().startsWith(n)){e.delete()}}};s.getInactiveContextNumber=function e(t){return t.getAllCurrentContexts().filter(e=>e.isInactive()).length};s.validateEmptyRow=function e(t){const n=this.getTableDefinition().annotation.requiredProperties;if(n!==null&&n!==void 0&&n.length){this.removeEmptyRowsMessages(t);const e=n.filter(e=>!t.getObject(e));if(e.length){const n=sap.ui.getCore().getLibraryResourceBundle("sap.fe.macros");const r=[];let i;for(const a of e){let e;const l=this.getTableDefinition().columns.find(e=>e.relativePath===a||e.propertyInfos&&e.propertyInfos.includes(a));if(!l){e=n.getText("M_TABLE_EMPTYROW_MANDATORY",[a])}else{var o;i=this.content.getColumns().find(e=>e.getPropertyKey()===l.name);e=n.getText(i?"M_TABLE_EMPTYROW_MANDATORY":"M_TABLE_EMPTYROW_MANDATORY_HIDDEN",[((o=i)===null||o===void 0?void 0:o.getHeader())||l.label])}r.push(new M({message:e,processor:this.getModel(),type:Ct.Error,technical:false,persistent:true,technicalDetails:{tableId:this.content.getId(),emptyRowMessage:true,missingColumn:i?undefined:a},target:`${t===null||t===void 0?void 0:t.getPath()}/${a}`}))}P.getMessageManager().addMessages(r);return false}}return true};s.removeEmptyRowsMessages=function e(t){const n=P.getMessageManager();n.removeMessages(n.getMessageModel().getData().filter(e=>{const n=e.getTechnicalDetails()||{};return(t?e.getTargets().some(e=>e.startsWith(t.getPath())):true)&&n.emptyRowMessage&&n.tableId===this.content.getId()}))};s.createEmptyRows=async function n(o,r){var i;let a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;const l=((i=this.tableDefinition.control)===null||i===void 0?void 0:i.inlineCreationRowCount)||1;if(this.creatingEmptyRows||this.getInactiveContextNumber(o)>l){return}const s=Array.from({length:l},()=>({})),c=r.data("tableType")!=="ResponsiveTable",u=true,p=t.getTargetView(r),g=p.getController(),d=g.editFlow,f=t.getAppComponent(r);this.creatingEmptyRows=true;try{const e=a?[{}]:s;const t=await d.createMultipleDocuments(o,e,a?true:c,false,g.editFlow.onBeforeCreate,u);t===null||t===void 0?void 0:t.forEach(async function(e){try{await e.created();f.getSideEffectsService().requestSideEffectsForNavigationProperty(o.getPath(),p.getBindingContext())}catch(e){if(!e.canceled){throw e}}})}catch(t){e.error(t)}finally{this.creatingEmptyRows=false}};s.getDownloadUrlWithFilters=async function e(){const t=this.content;const n=P.byId(t===null||t===void 0?void 0:t.getFilter());if(!n){throw new Error("filter bar is not available")}const o=t.getRowBinding();const r=t.getModel();const i=await n.getParent().getSelectionVariant();const a=b.getSemanticOpsFilterProperties(i._getSelectOptions());const l=v.getAllFilterInfo(t,a.map(e=>e.filterName));const s=n.getPropertyInfoSet();const[c,u]=b.getSemanticDateFiltersWithFlpPlaceholders(a,s);let p=[];if(l.filters.length>0){p=p.concat(l.filters)}if(u.length>0){p.push(...u)}const g=new D({filters:p,and:true});const d=r.bindList(o.getPath(),undefined,undefined,g);let f=await d.requestDownloadUrl();for(const[e,t]of Object.entries(c)){f=f.replace(e,t)}return f};s.onDragEnterDocument=function t(n){const o=n.getParameter("bindingContext");const r=n.getParameter("dragSource");const i=this.getTableDefinition().control.isMoveToPositionAllowed;const a=o.getParent();let l=!a,s=false;let c="OnOrBetween";try{if(i){const e=g.getCustomFunction(i.moduleName,i.methodName,n.getSource().getParent());s=e(r,o)===false;l=l||e(r,a)===false}}catch(t){e.warning("Cannot execute function related to isMoveToPositionAllowed",t)}if(r.isAncestorOf(o)||o===this.content.getBindingContext()||o.getBinding()!==r.getBinding()||l&&s){n.preventDefault();return}if(l){c="On"}else if(s){c="Between"}n.getSource().setDropPosition(c)};s.onDragStartDocument=function e(t){const n=t.getParameter("bindingContext");const o=this.getTableDefinition().control.isNodeMovable;const r=this.getTableDefinition().annotation.updatablePropertyPath;let i=false;try{if(o){i=g.getCustomFunction(o.moduleName,o.methodName,t.getSource())(n)===false}}catch(e){i=false}if(r&&!n.getProperty(r)||i){t.preventDefault()}};s.onDropDocument=async function t(o){n.lock(this.content);const r=o.getParameter("bindingContext");const i=o.getParameter("dropPosition")==="On"?r:r.getParent();return o.getParameter("dragSource").move({parent:i}).catch(t=>{e.error(t)}).finally(()=>{n.unlock(this.content)})};return i}(E),ze=_t(Be.prototype,"metaPath",[A],{configurable:true,enumerable:true,writable:true,initializer:null}),_e=_t(Be.prototype,"contextPath",[S],{configurable:true,enumerable:true,writable:true,initializer:null}),Ve=_t(Be.prototype,"tableDefinition",[O],{configurable:true,enumerable:true,writable:true,initializer:null}),Ne=_t(Be.prototype,"entityTypeFullyQualifiedName",[F],{configurable:true,enumerable:true,writable:true,initializer:null}),ke=_t(Be.prototype,"readOnly",[B],{configurable:true,enumerable:true,writable:true,initializer:null}),je=_t(Be.prototype,"id",[z],{configurable:true,enumerable:true,writable:true,initializer:null}),Le=_t(Be.prototype,"busy",[_],{configurable:true,enumerable:true,writable:true,initializer:null}),He=_t(Be.prototype,"type",[V],{configurable:true,enumerable:true,writable:true,initializer:null}),$e=_t(Be.prototype,"enableExport",[N],{configurable:true,enumerable:true,writable:true,initializer:null}),Ue=_t(Be.prototype,"enablePaste",[k],{configurable:true,enumerable:true,writable:true,initializer:null}),Qe=_t(Be.prototype,"enableFullScreen",[j],{configurable:true,enumerable:true,writable:true,initializer:null}),qe=_t(Be.prototype,"filterBar",[L],{configurable:true,enumerable:true,writable:true,initializer:null}),We=_t(Be.prototype,"selectionMode",[H],{configurable:true,enumerable:true,writable:true,initializer:null}),Ge=_t(Be.prototype,"header",[$],{configurable:true,enumerable:true,writable:true,initializer:null}),Ye=_t(Be.prototype,"enableAutoColumnWidth",[U],{configurable:true,enumerable:true,writable:true,initializer:null}),Ke=_t(Be.prototype,"isOptimizedForSmallDevice",[Q],{configurable:true,enumerable:true,writable:true,initializer:null}),Xe=_t(Be.prototype,"headerVisible",[q],{configurable:true,enumerable:true,writable:true,initializer:null}),Je=_t(Be.prototype,"frozenColumnCount",[W],{configurable:true,enumerable:true,writable:true,initializer:null}),Ze=_t(Be.prototype,"widthIncludingColumnHeader",[G],{configurable:true,enumerable:true,writable:true,initializer:null}),et=_t(Be.prototype,"rowCountMode",[Y],{configurable:true,enumerable:true,writable:true,initializer:null}),tt=_t(Be.prototype,"rowCount",[K],{configurable:true,enumerable:true,writable:true,initializer:null}),nt=_t(Be.prototype,"actions",[X],{configurable:true,enumerable:true,writable:true,initializer:null}),ot=_t(Be.prototype,"columns",[J],{configurable:true,enumerable:true,writable:true,initializer:null}),rt=_t(Be.prototype,"dataInitialized",[Z],{configurable:true,enumerable:true,writable:true,initializer:null}),it=_t(Be.prototype,"bindingSuspended",[ee],{configurable:true,enumerable:true,writable:true,initializer:null}),at=_t(Be.prototype,"outDatedBinding",[te],{configurable:true,enumerable:true,writable:true,initializer:null}),lt=_t(Be.prototype,"pendingRequest",[ne],{configurable:true,enumerable:true,writable:true,initializer:null}),st=_t(Be.prototype,"emptyRowsEnabled",[oe],{configurable:true,enumerable:true,writable:true,initializer:null}),ct=_t(Be.prototype,"rowPress",[re],{configurable:true,enumerable:true,writable:true,initializer:null}),ut=_t(Be.prototype,"stateChange",[ie],{configurable:true,enumerable:true,writable:true,initializer:null}),pt=_t(Be.prototype,"contextChange",[ae],{configurable:true,enumerable:true,writable:true,initializer:null}),gt=_t(Be.prototype,"internalDataRequested",[le],{configurable:true,enumerable:true,writable:true,initializer:null}),dt=_t(Be.prototype,"personalization",[se],{configurable:true,enumerable:true,writable:true,initializer:null}),ft=_t(Be.prototype,"variantManagement",[ce],{configurable:true,enumerable:true,writable:true,initializer:null}),bt=_t(Be.prototype,"isSearchable",[ue],{configurable:true,enumerable:true,writable:true,initializer:null}),yt=_t(Be.prototype,"creationMode",[pe],{configurable:true,enumerable:true,writable:true,initializer:null}),ht=_t(Be.prototype,"selectionChange",[ge],{configurable:true,enumerable:true,writable:true,initializer:null}),_t(Be.prototype,"onContextChange",[de],Object.getOwnPropertyDescriptor(Be.prototype,"onContextChange"),Be.prototype),_t(Be.prototype,"onFieldLiveChange",[fe],Object.getOwnPropertyDescriptor(Be.prototype,"onFieldLiveChange"),Be.prototype),_t(Be.prototype,"onQuickFilterSelectionChange",[be],Object.getOwnPropertyDescriptor(Be.prototype,"onQuickFilterSelectionChange"),Be.prototype),_t(Be.prototype,"onTableRowPress",[ye],Object.getOwnPropertyDescriptor(Be.prototype,"onTableRowPress"),Be.prototype),_t(Be.prototype,"onInternalPatchCompleted",[he],Object.getOwnPropertyDescriptor(Be.prototype,"onInternalPatchCompleted"),Be.prototype),_t(Be.prototype,"onInternalDataReceived",[me],Object.getOwnPropertyDescriptor(Be.prototype,"onInternalDataReceived"),Be.prototype),_t(Be.prototype,"collectAvailableCards",[ve],Object.getOwnPropertyDescriptor(Be.prototype,"collectAvailableCards"),Be.prototype),_t(Be.prototype,"onInternalDataRequested",[Ce],Object.getOwnPropertyDescriptor(Be.prototype,"onInternalDataRequested"),Be.prototype),_t(Be.prototype,"onPaste",[we],Object.getOwnPropertyDescriptor(Be.prototype,"onPaste"),Be.prototype),_t(Be.prototype,"onCut",[Pe],Object.getOwnPropertyDescriptor(Be.prototype,"onCut"),Be.prototype),_t(Be.prototype,"onBeforeExport",[Te],Object.getOwnPropertyDescriptor(Be.prototype,"onBeforeExport"),Be.prototype),_t(Be.prototype,"onDataStateChange",[Me],Object.getOwnPropertyDescriptor(Be.prototype,"onDataStateChange"),Be.prototype),_t(Be.prototype,"onAddCardToInsightsPressed",[De],Object.getOwnPropertyDescriptor(Be.prototype,"onAddCardToInsightsPressed"),Be.prototype),_t(Be.prototype,"onMassEditButtonPressed",[Ee],Object.getOwnPropertyDescriptor(Be.prototype,"onMassEditButtonPressed"),Be.prototype),_t(Be.prototype,"onTableSelectionChange",[xe],Object.getOwnPropertyDescriptor(Be.prototype,"onTableSelectionChange"),Be.prototype),_t(Be.prototype,"onActionPress",[Ie],Object.getOwnPropertyDescriptor(Be.prototype,"onActionPress"),Be.prototype),_t(Be.prototype,"handleCreateActivate",[Re],Object.getOwnPropertyDescriptor(Be.prototype,"handleCreateActivate"),Be.prototype),_t(Be.prototype,"onDragEnterDocument",[Ae],Object.getOwnPropertyDescriptor(Be.prototype,"onDragEnterDocument"),Be.prototype),_t(Be.prototype,"onDragStartDocument",[Se],Object.getOwnPropertyDescriptor(Be.prototype,"onDragStartDocument"),Be.prototype),_t(Be.prototype,"onDropDocument",[Oe],Object.getOwnPropertyDescriptor(Be.prototype,"onDropDocument"),Be.prototype),Be))||Fe);return Nt},false);
//# sourceMappingURL=TableAPI.js.map