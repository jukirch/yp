/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/strings/formatMessage","sap/fe/core/CommonUtils","sap/fe/core/buildingBlocks/BuildingBlockSupport","sap/fe/core/buildingBlocks/RuntimeBuildingBlock","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/BindingHelper","sap/fe/core/helpers/BindingToolkit","sap/m/Button","sap/m/ObjectMarker","sap/m/Popover","sap/m/Text","sap/m/VBox","sap/m/library","sap/ui/core/Core","sap/fe/core/jsx-runtime/jsx","sap/fe/core/jsx-runtime/jsxs"],function(e,t,r,i,n,a,s,o,l,c,d,u,p,f,D,v){"use strict";var y,b,g,A,h,T,_,I,m,O,B,P,E,C,x,M,R;var U={};var L=p.ObjectMarkerVisibility;var N=p.ObjectMarkerType;var w=s.pathInModel;var F=s.or;var V=s.not;var j=s.isEmpty;var k=s.ifElse;var z=s.constant;var S=s.and;var H=a.UI;var G=a.Entity;var K=n.convertMetaModelContext;var J=r.defineBuildingBlock;var W=r.blockAttribute;function X(e,t,r,i){if(!r)return;Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(i):void 0})}function Y(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function q(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;$(e,t)}function $(e,t){$=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return $(e,t)}function Q(e,t,r,i,n){var a={};Object.keys(i).forEach(function(e){a[e]=i[e]});a.enumerable=!!a.enumerable;a.configurable=!!a.configurable;if("value"in a||a.initializer){a.writable=true}a=r.slice().reverse().reduce(function(r,i){return i(e,t,r)||r},a);if(n&&a.initializer!==void 0){a.value=a.initializer?a.initializer.call(n):void 0;a.initializer=undefined}if(a.initializer===void 0){Object.defineProperty(e,t,a);a=null}return a}function Z(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}let ee=(y=J({name:"DraftIndicator",namespace:"sap.fe.macros"}),b=W({type:"string"}),g=W({type:"string"}),A=W({type:"string",validate:e=>{if(e&&![L.IconOnly,L.IconAndText].includes(e)){throw new Error(`Allowed value ${e} does not match`)}}}),h=W({type:"sap.ui.model.Context",required:true,expectedTypes:["EntitySet","NavigationProperty"]}),T=W({type:"boolean",bindable:true}),_=W({type:"string"}),I=W({type:"boolean"}),y(m=(O=function(r){q(i,r);function i(){var e;for(var t=arguments.length,i=new Array(t),n=0;n<t;n++){i[n]=arguments[n]}e=r.call(this,...i)||this;X(e,"id",B,Y(e));X(e,"ariaLabelledBy",P,Y(e));X(e,"draftIndicatorType",E,Y(e));X(e,"entitySet",C,Y(e));X(e,"isDraftIndicatorVisible",x,Y(e));X(e,"class",M,Y(e));X(e,"usedInTable",R,Y(e));return e}U=i;i.formatDraftOwnerTextInPopover=function e(t,r,i,n,a){const s=f.getLibraryResourceBundle("sap.fe.macros");if(t){const e=n||r||a||i;if(!e){return s.getText("M_FIELD_RUNTIME_DRAFT_POPOVER_UNSAVED_CHANGES_BY_UNKNOWN")}else{return r?s.getText("M_FIELD_RUNTIME_DRAFT_POPOVER_LOCKED_BY_KNOWN",[e]):s.getText("M_FIELD_RUNTIME_DRAFT_POPOVER_UNSAVED_CHANGES_BY_KNOWN",[e])}}else{return s.getText("M_FIELD_RUNTIME_DRAFT_POPOVER_NO_DATA_TEXT")}};var n=i.prototype;n.getDraftAdministrativeDataProperties=function e(){const t=this.entitySet.getModel().createBindingContext("DraftAdministrativeData",this.entitySet);const r=K(t);return r.targetType.entityProperties.map(e=>e.name)};n.getPopoverTitleBindingExpression=function e(){return k(V(G.IsActive),w("M_COMMON_DRAFT_OBJECT","sap.fe.i18n"),k(G.HasDraft,k(V(j(w("DraftAdministrativeData/InProcessByUser"))),w("M_COMMON_DRAFT_LOCKED_OBJECT","sap.fe.i18n"),w("M_DRAFT_POPOVER_ADMIN_UNSAVED_OBJECT","sap.fe.i18n")),this.draftIndicatorType===L.IconAndText?" ":w("C_DRAFT_POPOVER_ADMIN_DATA_DRAFTINFO_FLAGGED_OBJECT","sap.fe.i18n")))};n.getDraftOwnerTextBindingExpression=function e(){const t=this.getDraftAdministrativeDataProperties();const r=[{path:"HasDraftEntity",targetType:"any"},{path:"DraftAdministrativeData/InProcessByUser"},{path:"DraftAdministrativeData/LastChangedByUser"}];if(t.includes("InProcessByUserDescription")){r.push({path:"DraftAdministrativeData/InProcessByUserDescription"})}if(t.includes("LastChangedByUserDescription")){r.push({path:"DraftAdministrativeData/LastChangedByUserDescription"})}return{parts:r,formatter:i.formatDraftOwnerTextInPopover}};n.createPopover=function r(i){const n=S(V(G.IsActive),j(w("DraftAdministrativeData/LastChangeDateTime")));const a=this.draftIndicatorType===L.IconAndText?w("M_DRAFT_POPOVER_ADMIN_GENERIC_LOCKED_OBJECT_POPOVER_TEXT","sap.fe.i18n"):w("C_DRAFT_POPOVER_ADMIN_DATA_DRAFTINFO_POPOVER_NO_DATA_TEXT","sap.fe.i18n");const s=S(V(G.IsActive),V(j(w("DraftAdministrativeData/LastChangeDateTime"))));const l={parts:[{path:"M_DRAFT_POPOVER_ADMIN_LAST_CHANGE_TEXT",model:"sap.fe.i18n"},{path:"DraftAdministrativeData/LastChangeDateTime"}],formatter:e};const p=S(G.IsActive,V(j(w("DraftAdministrativeData/LastChangeDateTime"))));const f={...l};const y=D(c,{title:this.getPopoverTitleBindingExpression(),showHeader:true,contentWidth:"15.625rem",verticalScrolling:false,class:"sapUiContentPadding",placement:"Auto",endButton:D(o,{icon:"sap-icon://decline",press:()=>{var e;return(e=this.draftPopover)===null||e===void 0?void 0:e.close()}}),children:v(u,{class:"sapUiContentPadding",children:[D(u,{visible:n,children:D(d,{text:a})}),D(u,{visible:s,children:D(d,{text:l})}),v(u,{visible:p,children:[D(d,{text:this.getDraftOwnerTextBindingExpression()}),D(d,{class:"sapUiSmallMarginTop",text:f})]})]})});t.getTargetView(i).addDependent(y);return y};n.onObjectMarkerPressed=function e(t){const r=t.getSource();const i=r.getBindingContext();this.draftPopover??=this.createPopover(r);this.draftPopover.setBindingContext(i);this.draftPopover.openBy(r,false)};n.getIconAndTextAdditionalInfoBindingExpression=function e(){const t=this.getDraftAdministrativeDataProperties();const r=[];if(t.includes("InProcessByUserDescription")){r.push(w("DraftAdministrativeData/InProcessByUserDescription"))}r.push(w("DraftAdministrativeData/InProcessByUser"));if(t.includes("LastChangedByUserDescription")){r.push(w("DraftAdministrativeData/LastChangedByUserDescription"))}r.push(w("DraftAdministrativeData/LastChangedByUser"));return k(G.HasDraft,F(...r),"")};n.getIconAndTextContent=function e(){const t=k(V(G.IsActive),N.Draft,k(G.HasDraft,k(w("DraftAdministrativeData/InProcessByUser"),N.LockedBy,k(w("DraftAdministrativeData/LastChangedByUser"),N.UnsavedBy,N.Unsaved)),N.Flagged));const r=k(V(G.HasDraft),L.TextOnly,L.IconAndText);return D(l,{type:t,press:this.onObjectMarkerPressed.bind(this),visibility:r,visible:this.isDraftIndicatorVisible,additionalInfo:this.getIconAndTextAdditionalInfoBindingExpression(),ariaLabelledBy:this.ariaLabelledBy?[this.ariaLabelledBy]:[],class:this.class})};n.getIconOnlyContent=function e(){const t=k(V(G.IsActive),N.Draft,k(G.HasDraft,k(w("DraftAdministrativeData/InProcessByUser"),N.Locked,N.Unsaved),N.Flagged));let r;if(this.usedInTable===true){r=F(V(G.IsActive),S(G.IsActive,G.HasDraft))}else{r=S(V(j(G.HasDraft)),V(H.IsEditable),G.HasDraft,V(w("DraftAdministrativeData/DraftIsCreatedByMe")))}return D(l,{type:t,press:this.onObjectMarkerPressed.bind(this),visibility:L.IconOnly,visible:r,ariaLabelledBy:this.ariaLabelledBy?[this.ariaLabelledBy]:[],class:this.class})};n.getContent=function e(){if(this.draftIndicatorType===L.IconAndText){return this.getIconAndTextContent()}else{return this.getIconOnlyContent()}};return i}(i),B=Q(O.prototype,"id",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),P=Q(O.prototype,"ariaLabelledBy",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),E=Q(O.prototype,"draftIndicatorType",[A],{configurable:true,enumerable:true,writable:true,initializer:function(){return L.IconAndText}}),C=Q(O.prototype,"entitySet",[h],{configurable:true,enumerable:true,writable:true,initializer:null}),x=Q(O.prototype,"isDraftIndicatorVisible",[T],{configurable:true,enumerable:true,writable:true,initializer:function(){return z(false)}}),M=Q(O.prototype,"class",[_],{configurable:true,enumerable:true,writable:true,initializer:function(){return""}}),R=Q(O.prototype,"usedInTable",[I],{configurable:true,enumerable:true,writable:true,initializer:null}),O))||m);U=ee;return U},false);
//# sourceMappingURL=DraftIndicator.block.js.map