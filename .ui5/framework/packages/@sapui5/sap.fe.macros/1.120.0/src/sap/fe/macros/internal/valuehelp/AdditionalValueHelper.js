/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/helpers/StandardRecommendationHelper","sap/ui/core/Core","sap/ui/model/Filter","sap/ui/model/FilterType","sap/ui/model/Sorter"],function(e,t,r,n,o,a){"use strict";var i={};var s=t.standardRecommendationHelper;var c;(function(e){e["recommendation"]="recommendation";e["recentValue"]="recentValue"})(c||(c={}));i.AdditionalValueGroupKey=c;const l={requestForAdditionalValueContextData:async function(e,t,r){const n=[...e].reverse();if(r.parameters){t.changeParameters(r.parameters)}const o=r.parameters.$search;const a=this.getAdditionalValueFilters(n,[...this.getValueHelpBindingFilters(r)]);r.parameters.$search=o;const i=[this.getSorter()];const s=t.getModel().bindList(r.path,undefined,i,a,r.parameters);const c=await s.requestContexts();return c.map(e=>e.getObject())},getValueHelpBindingFilters:function(e){if(e.filters){if(Array.isArray(e.filters)){return e.filters}else{return[e.filters]}}return[]},resumeValueListBindingAndResetChanges:async function(e){if(e.isSuspended()){e.resume()}try{await e.resetChanges()}catch(e){}},sortAndFilterOthers:function(e,t,r){const n=this.createFiltersForOthersGroup(r,[...this.getValueHelpBindingFilters(t)]);e.filter([n],o.Application);e.sort(this.getSorter())},getAdditionalValueFilters:function(e,t){e.forEach(e=>{if(e.values.length>0){const r=e.values;const o=e.propertyPath;r.forEach(e=>{t.push(new n({path:o,value1:e,operator:"EQ"}))})}});return t},getSorter:function(){return new a("",false,this.getSorterFunction)},getSorterFunction:function(e){const t=r.getLibraryResourceBundle("sap.fe.macros");const n=e.getProperty("@$fe.additionalValueGroupKey");if(n===c.recommendation){return t.getText("M_ADDITIONALVALUEHELPER_RECOMMENDATIONS")}else if(n===c.recentValue){return t.getText("M_ADDITIONALVALUEHELPER_RECENTVALUE")}else{return t.getText("M_ADDITIONALVALUEHELPER_OTHERS")}},createAdditionalValueTransientContexts:function(e,t,r){if(e.length>0){t.forEach(t=>{const n=t.values;const o=t.propertyPath;const a=t.groupKey;this.sortAdditionalValueContextDataAndCreateContexts(e,n,o,r,a)})}},sortAdditionalValueContextDataAndCreateContexts:function(t,r,n,o,a){[...r].reverse().forEach(r=>{t.forEach(async t=>{if(r===t[n]){t["@$fe.additionalValueGroupKey"]=a;const r=o.create(t);try{await r.created()}catch(t){if(!t.canceled){e.error(t.name)}}}})})},removeDuplicateAdditionalValues:function(e,t){const r=[];t.forEach(e=>{const t=[...e.values];const n=e.propertyPath;const o=e.groupKey;r.push({values:t,propertyPath:n,groupKey:o})});e.forEach(e=>{let t=false;r.forEach(r=>{const n=r.values;const o=r.propertyPath;if(n.includes(e[o])){if(t){n.splice(n.indexOf(e[o]),1)}else{t=true}}})});return r},createFiltersForOthersGroup:function(e,t){const r=[];e.forEach(e=>{const t=e.values;const o=e.propertyPath;t.forEach(e=>{r.push(new n({path:o,value1:e,operator:"NE"}))})});const o=new n({filters:r,and:true});if(t.length>0){t.push(o);return new n({filters:t,and:true})}else{return o}},getRelevantRecommendations:function(e,t,r,n){const o=[];let a;if(Object.keys(e).length>0){r=this.getRecommendationPropertyPath(r);if(e.version===2&&n){r=n}a=this.getAdditionalValueFromPropertyPath(r,t,e);if(a&&Object.keys(a).length>0){a.additionalValues.forEach(e=>{o.push(e.value)});return o}else{return null}}},_checkForKeysInRecommendations:function(e,t){for(const r in e){if(e[r]!==t[r]){return false}}return true},getAdditionalValueFromKeys:function(e,t){const r=t===null||t===void 0?void 0:t.getObject();let n={};if(t&&r){if(Array.isArray(e)){e.forEach(e=>{const t=e.keyProperties;const o=this._checkForKeysInRecommendations(t,r);if(o){n=e}})}}return n},_getRecommendation:function(e,t,r){let n=Object.assign(r,{});if(Object.keys(r).includes(e)){return r[e]}else{while(Object.keys(n).length>0&&!Object.keys(n).includes(e)){const o=e.split("/");if(o.length>1){const a=o[0];o.splice(0,1);e=o.join("/");r=this.getAdditionalValueFromPropertyPath(a,t,r);r=this.getAdditionalValueFromKeys(r,t);if(Object.keys(r).length>0){n=Object.assign(r,{});r=this.getAdditionalValueFromPropertyPath(e,t,r)}else{return{}}}else{return{}}}return r}},getAdditionalValueFromPropertyPath:function(e,t,r){if(r.version===2){return s.getStandardRecommendations(t,e,r)}if(r){return this._getRecommendation(e,t,r)}},getRecommendationPropertyPath:function(e){const t=e.split("/");t.splice(0,2);return t.join("/")}};i.additionalValueHelper=l;return i},false);
//# sourceMappingURL=AdditionalValueHelper.js.map