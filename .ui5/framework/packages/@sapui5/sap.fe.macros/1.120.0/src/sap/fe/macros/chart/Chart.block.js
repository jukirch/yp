/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/uid","sap/fe/core/buildingBlocks/BuildingBlockBase","sap/fe/core/buildingBlocks/BuildingBlockSupport","sap/fe/core/buildingBlocks/BuildingBlockTemplateProcessor","sap/fe/core/converters/MetaModelConverter","sap/fe/core/converters/annotations/DataField","sap/fe/core/converters/controls/Common/DataVisualization","sap/fe/core/converters/helpers/Aggregation","sap/fe/core/helpers/BindingToolkit","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/StableIdHelper","sap/fe/core/templating/DataModelPathHelper","sap/fe/macros/CommonHelper","sap/ui/Device","sap/ui/core/library","sap/ui/model/json/JSONModel","../internal/helpers/ActionHelper","../internal/helpers/DefaultActionHandler","./ChartHelper"],function(e,t,n,a,i,o,r,s,l,c,u,d,g,p,h,m,b,f,v,P){"use strict";var A,y,C,x,M,$,D,I,T,O,B,_,S,z,w,V,E,j,k,F,N,H,L,U,R,W,q,G,X,J,K,Y,Q,Z,ee,te,ne,ae,ie,oe,re,se,le,ce,ue,de,ge,pe,he,me,be,fe,ve,Pe,Ae,ye,Ce,xe,Me,$e,De,Ie;var Te={};var Oe=m.TitleLevel;var Be=g.getContextRelativeTargetObjectPath;var _e=d.generate;var Se=c.resolveBindingString;var ze=l.AggregationHelper;var we=s.getVisualizationsFromPresentationVariant;var Ve=s.getDataVisualizationConfiguration;var Ee=r.isDataModelObjectPathForActionWithDialog;var je=o.getInvolvedDataModelObjects;var ke=i.xml;var Fe=i.escapeXMLAttributeValue;var Ne=a.defineBuildingBlock;var He=a.blockEvent;var Le=a.blockAttribute;var Ue=a.blockAggregation;function Re(e,t,n,a){if(!n)return;Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(a):void 0})}function We(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function qe(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;Ge(e,t)}function Ge(e,t){Ge=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,n){t.__proto__=n;return t};return Ge(e,t)}function Xe(e,t,n,a,i){var o={};Object.keys(a).forEach(function(e){o[e]=a[e]});o.enumerable=!!o.enumerable;o.configurable=!!o.configurable;if("value"in o||o.initializer){o.writable=true}o=n.slice().reverse().reduce(function(n,a){return a(e,t,n)||n},o);if(i&&o.initializer!==void 0){o.value=o.initializer?o.initializer.call(i):void 0;o.initializer=undefined}if(o.initializer===void 0){Object.defineProperty(e,t,o);o=null}return o}function Je(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}const Ke={"com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis1":"axis1","com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis2":"axis2","com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis3":"axis3","com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis4":"axis4"};var Ye;(function(e){e["Sort"]="Sort";e["Type"]="Type";e["Item"]="Item";e["Filter"]="Filter"})(Ye||(Ye={}));const Qe=function(e){var t;let n=null;const a=e;let i=[];const o=(t=a.getAttribute("key"))===null||t===void 0?void 0:t.replace("InlineXML_","");if(a.children.length&&a.localName==="ActionGroup"&&a.namespaceURI&&["sap.fe.macros","sap.fe.macros.chart"].includes(a.namespaceURI)){const e=Array.prototype.slice.apply(a.children);let t=0;n=e.reduce((e,n)=>{var a;const i=((a=n.getAttribute("key"))===null||a===void 0?void 0:a.replace("InlineXML_",""))||o+"_Menu_"+t;const r={key:i,text:n.getAttribute("text"),__noWrap:true,press:n.getAttribute("press"),requiresSelection:n.getAttribute("requiresSelection")==="true",enabled:n.getAttribute("enabled")===null?true:n.getAttribute("enabled")};e[r.key]=r;t++;return e},{});i=Object.values(n).slice(-a.children.length).map(function(e){return e.key})}return{key:o,text:a.getAttribute("text"),position:{placement:a.getAttribute("placement"),anchor:a.getAttribute("anchor")},__noWrap:true,press:a.getAttribute("press"),requiresSelection:a.getAttribute("requiresSelection")==="true",enabled:a.getAttribute("enabled")===null?true:a.getAttribute("enabled"),menu:i.length?i:null,menuContentActions:n}};let Ze=(A=Ne({name:"Chart",namespace:"sap.fe.macros.internal",publicNamespace:"sap.fe.macros",returnTypes:["sap.fe.macros.chart.ChartAPI"]}),y=Le({type:"string",isPublic:true}),C=Le({type:"object"}),x=Le({type:"sap.ui.model.Context",isPublic:true}),M=Le({type:"sap.ui.model.Context",isPublic:true}),$=Le({type:"string"}),D=Le({type:"string"}),I=Le({type:"string",isPublic:true}),T=Le({type:"boolean",isPublic:true}),O=Le({type:"sap.ui.core.TitleLevel",isPublic:true}),B=Le({type:"string",isPublic:true}),_=Le({type:"string|boolean",isPublic:true}),S=Le({type:"string",isPublic:true}),z=Le({type:"string"}),w=Le({type:"string"}),V=Le({type:"string"}),E=Le({type:"sap.ui.model.Context"}),j=Le({type:"boolean"}),k=Le({type:"boolean"}),F=Le({type:"string"}),N=Le({type:"string"}),H=Le({type:"string"}),L=Le({type:"string"}),U=Le({type:"boolean"}),R=Le({type:"string",isPublic:true}),W=He(),q=He(),G=Ue({type:"sap.fe.macros.internal.chart.Action | sap.fe.macros.internal.chart.ActionGroup",isPublic:true,processAggregations:Qe}),X=He(),J=He(),A(K=(Y=(Ie=function(n){qe(a,n);function a(i,o,r){var s;s=n.call(this,i,o,r)||this;Re(s,"id",Q,We(s));Re(s,"chartDefinition",Z,We(s));Re(s,"metaPath",ee,We(s));Re(s,"contextPath",te,We(s));Re(s,"height",ne,We(s));Re(s,"width",ae,We(s));Re(s,"header",ie,We(s));Re(s,"headerVisible",oe,We(s));Re(s,"headerLevel",re,We(s));Re(s,"selectionMode",se,We(s));Re(s,"personalization",le,We(s));Re(s,"filterBar",ce,We(s));Re(s,"noDataText",ue,We(s));Re(s,"chartDelegate",de,We(s));Re(s,"vizProperties",ge,We(s));Re(s,"chartActions",pe,We(s));Re(s,"draftSupported",he,We(s));Re(s,"autoBindOnInit",me,We(s));Re(s,"visible",be,We(s));Re(s,"navigationPath",fe,We(s));Re(s,"filter",ve,We(s));Re(s,"measures",Pe,We(s));Re(s,"_applyIdToContent",Ae,We(s));Re(s,"variantManagement",ye,We(s));Re(s,"variantSelected",Ce,We(s));Re(s,"variantSaved",xe,We(s));Re(s,"actions",Me,We(s));Re(s,"selectionChange",$e,We(s));Re(s,"stateChange",De,We(s));s._commandActions=[];s.createChartDefinition=(e,t,n)=>{var i,o;let r=Be(t);if(((i=s.metaPath)===null||i===void 0?void 0:(o=i.getObject())===null||o===void 0?void 0:o.$Type)==="com.sap.vocabularies.UI.v1.PresentationVariantType"){const e=s.metaPath.getObject().Visualizations;r=a.checkChartVisualizationPath(e,r)}if(!r||!n.includes(r)){r=`@${"com.sap.vocabularies.UI.v1.Chart"}`}const l=Ve(r,s.useCondensedLayout,e,undefined,undefined,undefined,true);return l.visualizations[0]};s.createBindingContext=function(e,n){const a=`/${t()}`;n.models.converterContext.setProperty(a,e);return n.models.converterContext.createBindingContext(a)};s.getChartMeasures=(t,n)=>{const a=t.chartDefinition.annotationPath.split("/");const i=a.filter(function(e,t){return a.indexOf(e)==t}).toString().replaceAll(",","/");const o=je(s.metaPath.getModel().createBindingContext(i),s.contextPath).targetObject;const r=n.getAggregatedProperties("AggregatedProperty");let l=[];const c=t.metaPath.getPath();const u=n.getAggregatedProperties("AggregatedProperties");const d=o.Measures?o.Measures:[];const g=o.DynamicMeasures?o.DynamicMeasures:[];const p=u[0]?u[0].filter(function(e){return d.some(function(t){return e.Name===t.value})}):undefined;const h=c.replace(/@com.sap.vocabularies.UI.v1.(Chart|PresentationVariant|SelectionPresentationVariant).*/,"");const m=t.chartDefinition.transAgg;const f=t.chartDefinition.customAgg;if(r.length>0&&!g&&p.length>0){e.warning("The transformational aggregate measures are configured as Chart.Measures but should be configured as Chart.DynamicMeasures instead. Please check the SAP Help documentation and correct the configuration accordingly.")}const v=d.some(e=>{const t=s.getCustomAggMeasure(f,e);return!!t});if(r.length>0&&!(g!==null&&g!==void 0&&g.length)&&!v){throw new Error("Please configure DynamicMeasures for the chart")}if(r.length>0){for(const e of g){l=s.getDynamicMeasures(l,e,h,o)}}for(const e of d){const t=e.value;const n=s.getCustomAggMeasure(f,e);const a={};if(n){l=s.setCustomAggMeasure(l,a,n,t)}else if(r.length===0&&m[t]){l=s.setTransAggMeasure(l,a,m,t)}s.setChartMeasureAttributes(s._chart.MeasureAttributes,h,a)}const P=new b(l);P.$$valueAsPromise=true;return P.createBindingContext("/")};s.setCustomAggMeasure=(t,n,a,i)=>{if(i.includes("/")){e.error(`$expand is not yet supported. Measure: ${i} from an association cannot be used`)}n.key=a.value;n.role="axis1";n.label=a.label;n.propertyPath=a.value;t.push(n);return t};s.setTransAggMeasure=(e,t,n,a)=>{const i=n[a];t.key=i.name;t.role="axis1";t.propertyPath=a;t.aggregationMethod=i.aggregationMethod;t.label=i.label||t.label;e.push(t);return e};s.getDynamicMeasures=(t,n,a,i)=>{var o;const r=n.value||"";const l=je(s.metaPath.getModel().createBindingContext(a+r),s.contextPath).targetObject;if(r.includes("/")){e.error(`$expand is not yet supported. Measure: ${r} from an association cannot be used`)}else if(!l){throw new Error(`Please provide the right AnnotationPath to the Dynamic Measure ${n.value}`)}else if(((o=n.value)===null||o===void 0?void 0:o.startsWith(`@${"com.sap.vocabularies.Analytics.v1.AggregatedProperty"}`))===null){throw new Error(`Please provide the right AnnotationPath to the Dynamic Measure ${n.value}`)}else{var c;const e={key:l.Name,role:"axis1"};e.propertyPath=l.AggregatableProperty.value;e.aggregationMethod=l.AggregationMethod;e.label=Se(((c=l.annotations.Common)===null||c===void 0?void 0:c.Label)||je(s.metaPath.getModel().createBindingContext(a+e.propertyPath+`@${"com.sap.vocabularies.Common.v1.Label"}`),s.contextPath).targetObject);s.setChartMeasureAttributes(i.MeasureAttributes,a,e);t.push(e)}return t};s.getCustomAggMeasure=(e,t)=>{if(t.value&&e[t.value]){var n;t.label=(n=e[t.value])===null||n===void 0?void 0:n.label;return t}return null};s.setChartMeasureAttributes=(e,t,n)=>{if(e!==null&&e!==void 0&&e.length){for(const a of e){s._setChartMeasureAttribute(a,t,n)}}};s._setChartMeasureAttribute=(e,t,n)=>{var a,i,o;const r=e.DynamicMeasure?e===null||e===void 0?void 0:(a=e.DynamicMeasure)===null||a===void 0?void 0:a.value:e===null||e===void 0?void 0:(i=e.Measure)===null||i===void 0?void 0:i.value;const l=e.DataPoint?e===null||e===void 0?void 0:(o=e.DataPoint)===null||o===void 0?void 0:o.value:null;const c=e.Role;const u=l&&je(s.metaPath.getModel().createBindingContext(t+l),s.contextPath).targetObject;if(n.key===r){s.setMeasureRole(n,c);s.setMeasureDataPoint(n,u)}};s.setMeasureDataPoint=(e,t)=>{if(t&&t.Value.$Path==e.key){e.dataPoint=P.formatJSONToString(s.createDataPointProperty(t))||""}};s.setMeasureRole=(e,t)=>{if(t){const n=t.$EnumMember;e.role=Ke[n]}};s.getDependents=e=>{if(s._commandActions.length>0){return s._commandActions.map(t=>s.getActionCommand(t,e))}return""};s.checkPersonalizationInChartProperties=e=>{if(e.personalization){if(e.personalization==="false"){s.personalization=undefined}else if(e.personalization==="true"){s.personalization=Object.values(Ye).join(",")}else if(s.verifyValidPersonlization(e.personalization)===true){s.personalization=e.personalization}else{s.personalization=undefined}}};s.verifyValidPersonlization=e=>{let t=true;const n=e.split(",");const a=Object.values(Ye);n.forEach(e=>{if(!a.includes(e)){t=false}});return t};s.getVariantManagement=(e,t)=>{let n=e.variantManagement?e.variantManagement:t.variantManagement;n=s.personalization===undefined?"None":n;return n};s.createVariantManagement=()=>{const t=s.personalization;if(t){const e=s.variantManagement;if(e==="Control"){return ke`
					<mdc:variant>
					<variant:VariantManagement
						id="${_e([s.id,"VM"])}"
						for="${s.id}"
						showSetAsDefault="${true}"
						select="${s.variantSelected}"
						headerLevel="${s.headerLevel}"
						save="${s.variantSaved}"
					/>
					</mdc:variant>
			`}else if(e==="None"||e==="Page"){return""}}else if(!t){e.warning("Variant Management cannot be enabled when personalization is disabled")}return""};s.getPersistenceProvider=()=>{if(s.variantManagement==="None"){return ke`<p13n:PersistenceProvider id="${_e([s.id,"PersistenceProvider"])}" for="${s.id}"/>`}return""};s.pushActionCommand=(e,t,n,a)=>{if(t){const i={actionContext:e,onExecuteAction:P.getPressEventForDataFieldForActionButton(s.id,t,n||""),onExecuteIBN:p.getPressHandlerForDataFieldForIBN(t,`\${internal>selectedContexts}`,false),onExecuteManifest:p.buildActionWrapper(a,We(s))};s._commandActions.push(i)}};s.getActionCommand=(e,t)=>{const n=e.actionContext.getObject();const a=n.annotationPath&&s.contextPath.getModel().createBindingContext(n.annotationPath);const i=a&&a.getObject();const o=s.contextPath.getModel().createBindingContext(n.annotationPath+"/Action");const r=p.getActionContext(o);const l=p.getPathToBoundActionOverload(o);const c=s.contextPath.getModel().createBindingContext(l).getObject();const u=Fe(P.getOperationAvailableMap(t.getObject(),{context:t}));const d=n.enabled?n.enabled:P.isDataFieldForActionButtonEnabled(c&&c.$IsBound,i.Action,s.contextPath,u||"",n.enableOnSelect||"");let g;if(n.enabled){g=n.enabled}else if(i.RequiresContext){g="{= %{internal>numberOfSelectedContexts} >= 1}"}const h=ke`<internalMacro:ActionCommand
		action="${n}"
		onExecuteAction="${e.onExecuteAction}"
		onExecuteIBN="${e.onExecuteIBN}"
		onExecuteManifest="${e.onExecuteManifest}"
		isIBNEnabled="${g}"
		isActionEnabled="${d}"
		visible="${s.getVisible(a)}"
	/>`;if(n.type=="ForAction"&&(!c||c.IsBound!==true||r[`@${"Org.OData.Core.V1.OperationAvailable"}`]!==false)){return h}else if(n.type=="ForAction"){return""}else{return h}};s.getItems=e=>{if(s._chart){const t=[];const n=[];if(s._chart.Dimensions){P.formatDimensions(e).getObject().forEach(e=>{e.id=_e([s.id,"dimension",e.key]);t.push(s.getItem({id:e.id,key:e.key,label:e.label,role:e.role},"_fe_groupable_","groupable"))})}if(s.measures){P.formatMeasures(s.measures).forEach(e=>{e.id=_e([s.id,"measure",e.key]);n.push(s.getItem({id:e.id,key:e.key,label:e.label,role:e.role},"_fe_aggregatable_","aggregatable"))})}if(t.length&&n.length){return t.concat(n)}}return""};s.getItem=(e,t,n)=>ke`<chart:Item
			id="${e.id}"
			name="${t+e.key}"
			type="${n}"
			label="${Se(e.label,"string")}"
			role="${e.role}"
		/>`;s.getToolbarActions=(e,t,n)=>{var a;const i=s.getActions(e);if((a=s.chartDefinition)!==null&&a!==void 0&&a.onSegmentedButtonPressed){i.push(s.getSegmentedButton())}if(t){i.push(s.getStandardActions(t,n))}if(i.length>0){return ke`<mdc:actions>${i}</mdc:actions>`}return""};s.getStandardActions=(e,t)=>ke`<mdcat:ActionToolbarAction  xmlns="sap.m" xmlns:mdcat="sap.ui.mdc.actiontoolbar" visible="${t}">
				<Button
					id="${_e([s.id,"StandardAction::Insights"])}"
					text="{sap.fe.i18n>M_COMMON_INSIGHTS_CARD}"
					core:require="{API: 'sap/fe/macros/chart/ChartAPI'}"
					press="API.onAddCardToInsightsPressed($event)"
					enabled="${e}"
				>
					<layoutData>
						<OverflowToolbarLayoutData priority="AlwaysOverflow"/>
					</layoutData>
				</Button>
			</mdcat:ActionToolbarAction>`;s.getActions=e=>{var t;let n=(t=s.chartActions)===null||t===void 0?void 0:t.getObject();n=s.removeMenuItems(n);return n.map(t=>{if(t.annotationPath){return s.getAction(t,e,false)}else if(t.hasOwnProperty("noWrap")){return s.getCustomActions(t,e)}})};s.removeMenuItems=e=>{for(const t of e){if(t.menu){t.menu.forEach(t=>{const n=e.map(e=>e.key).indexOf(t.key);if(n!==-1){e.splice(n,1)}})}}return e};s.getCustomActions=(e,t)=>{let n=e.enabled;if((e.requiresSelection??false)&&e.enabled==="true"){n="{= %{internal>numberOfSelectedContexts} >= 1}"}if(e.type==="Default"){return s.getActionToolbarAction(e,{id:_e([s.id,e.id]),unittestid:"DataFieldForActionButtonAction",label:e.text?e.text:"",ariaHasPopup:undefined,press:e.press?e.press:"",enabled:n,visible:e.visible?e.visible:false},false)}else if(e.type==="Menu"){return s.getActionToolbarMenuAction({id:_e([s.id,e.id]),text:e.text,visible:e.visible,enabled:n,useDefaultActionOnly:v.getUseDefaultActionOnly(e),buttonMode:v.getButtonMode(e),defaultAction:undefined,actions:e},t)}};s.getMenuItemFromMenu=(e,t)=>{let n;if(e.annotationPath){return s.getAction(e,t,true)}if(e.command){n="cmd:"+e.command}else if(e.noWrap??false){n=e.press}else{n=p.buildActionWrapper(e,We(s))}return ke`<MenuItem
		core:require="{FPM: 'sap/fe/core/helpers/FPMHelper'}"
		text="${e.text}"
		press="${n}"
		visible="${e.visible}"
		enabled="${e.enabled}"
	/>`};s.getActionToolbarMenuAction=(e,t)=>{var n,a;const i=(n=e.actions)===null||n===void 0?void 0:(a=n.menu)===null||a===void 0?void 0:a.map(e=>s.getMenuItemFromMenu(e,t));return ke`<mdcat:ActionToolbarAction>
			<MenuButton
			text="${e.text}"
			type="Transparent"
			menuPosition="BeginBottom"
			id="${e.id}"
			visible="${e.visible}"
			enabled="${e.enabled}"
			useDefaultActionOnly="${e.useDefaultActionOnly}"
			buttonMode="${e.buttonMode}"
			defaultAction="${e.defaultAction}"
			>
				<menu>
					<Menu>
						${i}
					</Menu>
				</menu>
			</MenuButton>
		</mdcat:ActionToolbarAction>`};s.getAction=(e,t,n)=>{const a=s.contextPath.getModel().createBindingContext(e.annotationPath||"");if(e.type==="ForNavigation"){return s.getNavigationActions(e,a,n)}else if(e.type==="ForAction"){return s.getAnnotationActions(t,e,a,n)}return""};s.getNavigationActions=(e,t,n)=>{let a="true";const i=t.getObject();if(e.enabled!==undefined){a=e.enabled}else if(i.RequiresContext){a="{= %{internal>numberOfSelectedContexts} >= 1}"}return s.getActionToolbarAction(e,{id:undefined,unittestid:"DataFieldForIntentBasedNavigationButtonAction",label:i.Label,ariaHasPopup:undefined,press:p.getPressHandlerForDataFieldForIBN(i,`\${internal>selectedContexts}`,false),enabled:a,visible:s.getVisible(t)},n)};s.getAnnotationActions=(e,t,n,a)=>{const i=s.contextPath.getModel().createBindingContext(t.annotationPath+"/Action");const o=s.contextPath.getModel().createBindingContext(p.getActionContext(i));const r=o.getObject();const l=p.getPathToBoundActionOverload(i);const c=s.contextPath.getModel().createBindingContext(l).getObject();const u=n.getObject();if(!c||c.$IsBound!==true||r[`@${"Org.OData.Core.V1.OperationAvailable"}`]!==false){const i=s.getAnnotationActionsEnabled(t,c,u,e);const o=je(s.contextPath.getModel().createBindingContext(t.annotationPath));const r=Ee(o);const l=Fe(P.getOperationAvailableMap(e.getObject(),{context:e}))||"";return s.getActionToolbarAction(t,{id:_e([s.id,je(n)]),unittestid:"DataFieldForActionButtonAction",label:u.Label,ariaHasPopup:r,press:P.getPressEventForDataFieldForActionButton(s.id,u,l),enabled:i,visible:s.getVisible(n)},a)}return""};s.getActionToolbarAction=(e,t,n)=>{if(n){return ke`
			<MenuItem
				text="${t.label}"
				press="${e.command?"cmd:"+e.command:t.press}"
				enabled="${t.enabled}"
				visible="${t.visible}"
			/>`}else{return s.buildAction(e,t)}};s.buildAction=(e,t)=>{let n="";if(e.hasOwnProperty("noWrap")){if(e.command){n="cmd:"+e.command}else if(e.noWrap===true){n=t.press}else if(!e.annotationPath){n=p.buildActionWrapper(e,We(s))}return ke`<mdcat:ActionToolbarAction>
			<Button
				core:require="{FPM: 'sap/fe/core/helpers/FPMHelper'}"
				unittest:id="${t.unittestid}"
				id="${t.id}"
				text="${t.label}"
				ariaHasPopup="${t.ariaHasPopup}"
				press="${n}"
				enabled="${t.enabled}"
				visible="${t.visible}"
			/>
		   </mdcat:ActionToolbarAction>`}else{return ke`<mdcat:ActionToolbarAction>
			<Button
				unittest:id="${t.unittestid}"
				id="${t.id}"
				text="${t.label}"
				ariaHasPopup="${t.ariaHasPopup}"
				press="${e.command?"cmd:"+e.command:t.press}"
				enabled="${t.enabled}"
				visible="${t.visible}"
			/>
		</mdcat:ActionToolbarAction>`}};s.getAnnotationActionsEnabled=(e,t,n,a)=>e.enabled!==undefined?e.enabled:P.isDataFieldForActionButtonEnabled(t&&t.$IsBound,n.Action,s.contextPath,P.getOperationAvailableMap(a.getObject(),{context:a}),e.enableOnSelect||"");s.getSegmentedButton=()=>ke`<mdcat:ActionToolbarAction layoutInformation="{
			aggregationName: 'end',
			alignment: 'End'
		}">
			<SegmentedButton
				id="${_e([s.id,"SegmentedButton","TemplateContentView"])}"
				select="${s.chartDefinition.onSegmentedButtonPressed}"
				visible="{= \${pageInternal>alpContentView} !== 'Table' }"
				selectedKey="{pageInternal>alpContentView}"
			>
				<items>
					${s.getSegmentedButtonItems()}
				</items>
			</SegmentedButton>
		</mdcat:ActionToolbarAction>`;s.getSegmentedButtonItems=()=>{const e=[];if(p.isDesktop()){e.push(s.getSegmentedButtonItem("{sap.fe.i18n>M_COMMON_HYBRID_SEGMENTED_BUTTON_ITEM_TOOLTIP}","Hybrid","sap-icon://chart-table-view"))}e.push(s.getSegmentedButtonItem("{sap.fe.i18n>M_COMMON_CHART_SEGMENTED_BUTTON_ITEM_TOOLTIP}","Chart","sap-icon://bar-chart"));e.push(s.getSegmentedButtonItem("{sap.fe.i18n>M_COMMON_TABLE_SEGMENTED_BUTTON_ITEM_TOOLTIP}","Table","sap-icon://table-view"));return e};s.getSegmentedButtonItem=(e,t,n)=>ke`<SegmentedButtonItem
			tooltip="${e}"
			key="${t}"
			icon="${n}"
		/>`;s.getVisible=e=>{const t=e.getObject();if(t[`@${"com.sap.vocabularies.UI.v1.Hidden"}`]&&t[`@${"com.sap.vocabularies.UI.v1.Hidden"}`].$Path){const n=s.contextPath.getModel().createBindingContext(e.getPath()+`/@${"com.sap.vocabularies.UI.v1.Hidden"}/$Path`,t[`@${"com.sap.vocabularies.UI.v1.Hidden"}`].$Path);return P.getHiddenPathExpressionForTableActionsAndIBN(t[`@${"com.sap.vocabularies.UI.v1.Hidden"}`].$Path,{context:n})}else if(t[`@${"com.sap.vocabularies.UI.v1.Hidden"}`]){return!t[`@${"com.sap.vocabularies.UI.v1.Hidden"}`]}else{return true}};s.getContextPath=()=>s.contextPath.getPath().lastIndexOf("/")===s.contextPath.getPath().length-1?s.contextPath.getPath().replaceAll("/",""):s.contextPath.getPath().split("/")[s.contextPath.getPath().split("/").length-1];const l=je(s.metaPath,s.contextPath);const c=s.getConverterContext(l,undefined,r);const d=a.getVisualizationPath(We(s),l,c);const g=a.getExtraParams(We(s),d);const h=s.getConverterContext(l,undefined,r,g);const m=new ze(h.getEntityType(),h,true);s._chartContext=P.getUiChart(s.metaPath);s._chart=s._chartContext.getObject();if(s._applyIdToContent??false){s._apiId=s.id+"::Chart";s._contentId=s.id}else{s._apiId=s.id;s._contentId=s.getContentId(s.id)}if(s._chart){var A,y,C,x,M,$,D,I,T;s.chartDefinition=s.chartDefinition===undefined||s.chartDefinition===null?s.createChartDefinition(h,l,s._chartContext.getPath()):s.chartDefinition;s.navigationPath=s.chartDefinition.navigationPath;s.autoBindOnInit=s.chartDefinition.autoBindOnInit;s.vizProperties=s.chartDefinition.vizProperties;s.chartActions=s.createBindingContext(s.chartDefinition.actions,r);s.selectionMode=s.selectionMode.toUpperCase();if(s.filterBar){s.filter=s.getContentId(s.filterBar)}else if(!s.filter){s.filter=s.chartDefinition.filterId}s.checkPersonalizationInChartProperties(We(s));s.variantManagement=s.getVariantManagement(We(s),s.chartDefinition);s.visible=s.chartDefinition.visible;let e=s.contextPath.getPath();e=e[e.length-1]==="/"?e.slice(0,-1):e;s.draftSupported=u.isDraftSupported(r.models.metaModel,e);s._chartType=P.formatChartType(s._chart.ChartType);const t=P.getOperationAvailableMap(s._chart,{context:s._chartContext});if(Object.keys((A=s.chartDefinition)===null||A===void 0?void 0:A.commandActions).length>0){var O;Object.keys((O=s.chartDefinition)===null||O===void 0?void 0:O.commandActions).forEach(e=>{var n;const a=(n=s.chartDefinition)===null||n===void 0?void 0:n.commandActions[e];const i=s.createBindingContext(a,r);const o=a.annotationPath&&s.contextPath.getModel().createBindingContext(a.annotationPath);const l=o&&o.getObject();const c=Fe(t);s.pushActionCommand(i,l,c,a)})}s.measures=s.getChartMeasures(We(s),m);const n=p.createPresentationPathContext(s.metaPath);s._sortCondtions=P.getSortConditions(s.metaPath,s.metaPath.getObject(),n.getPath(),s.chartDefinition.applySupported);const a=s.contextPath.getModel().createBindingContext(s._chartContext.getPath()+"/Actions",s._chart.Actions);const i=s.contextPath.getModel().createBindingContext(s.contextPath.getPath(),s.contextPath);const o=p.getContextPath(s.contextPath,{context:i});const c=p.getTargetCollectionPath(s.contextPath);const d=s.contextPath.getModel().createBindingContext(c,s.contextPath);const g=(y=l.convertedTypes.resolvePath(a.getPath()))===null||y===void 0?void 0:y.target;s._customData={targetCollectionPath:o,entitySet:typeof d.getObject()==="string"?d.getObject():d.getObject("@sapui.name"),entityType:o+"/",operationAvailableMap:p.stringifyCustomData(JSON.parse(t)),multiSelectDisabledActions:f.getMultiSelectDisabledActions(g)+"",segmentedButtonId:_e([s.id,"SegmentedButton","TemplateContentView"]),customAgg:p.stringifyCustomData((C=s.chartDefinition)===null||C===void 0?void 0:C.customAgg),transAgg:p.stringifyCustomData((x=s.chartDefinition)===null||x===void 0?void 0:x.transAgg),applySupported:p.stringifyCustomData((M=s.chartDefinition)===null||M===void 0?void 0:M.applySupported),vizProperties:s.vizProperties,draftSupported:s.draftSupported,multiViews:($=s.chartDefinition)===null||$===void 0?void 0:$.multiViews,selectionPresentationVariantPath:p.stringifyCustomData({data:(D=s.chartDefinition)===null||D===void 0?void 0:D.selectionPresentationVariantPath})};s._actions=s.chartActions?s.getToolbarActions(s._chartContext,(I=s.chartDefinition)===null||I===void 0?void 0:I.isInsightsEnabled,(T=s.chartDefinition)===null||T===void 0?void 0:T.isInsightsVisible):""}else{s.autoBindOnInit=false;s.visible="true";s.navigationPath="";s._actions="";s._customData={targetCollectionPath:"",entitySet:"",entityType:"",operationAvailableMap:"",multiSelectDisabledActions:"",segmentedButtonId:"",customAgg:"",transAgg:"",applySupported:"",vizProperties:""}}return s}Te=a;var i=a.prototype;i.getContentId=function e(t){return`${t}-content`};a.getExtraParams=function e(t,n){const a={};if(t.actions){var i;(i=Object.values(t.actions))===null||i===void 0?void 0:i.forEach(e=>{t.actions={...t.actions,...e.menuContentActions};delete e.menuContentActions})}if(n){a[n]={actions:t.actions}}return a};i.createDataPointProperty=function e(t){const n={};if(t.TargetValue){n.targetValue=t.TargetValue.$Path}if(t.ForeCastValue){n.foreCastValue=t.ForeCastValue.$Path}let a=null;if(t.Criticality){if(t.Criticality.$Path){a={Calculated:t.Criticality.$Path}}else{a={Static:t.Criticality.$EnumMember.replace("com.sap.vocabularies.UI.v1.CriticalityType/","")}}}else if(t.CriticalityCalculation){const e={};const n=this.buildThresholds(e,t.CriticalityCalculation);if(n){a={ConstantThresholds:e}}else{a={DynamicThresholds:e}}}if(a){n.criticality=a}return n};i.buildThresholds=function e(t,n){const a=["AcceptanceRangeLowValue","AcceptanceRangeHighValue","ToleranceRangeLowValue","ToleranceRangeHighValue","DeviationRangeLowValue","DeviationRangeHighValue"];let i=true,o,r,s;t.ImprovementDirection=n.ImprovementDirection.$EnumMember.replace("com.sap.vocabularies.UI.v1.ImprovementDirectionType/","");const l={oneSupplied:false,usedMeasures:[]};const c={oneSupplied:false};for(r=0;r<a.length;r++){o=a[r];l[o]=n[o]?n[o].$Path:undefined;l.oneSupplied=l.oneSupplied||l[o];if(!l.oneSupplied){c[o]=n[o];c.oneSupplied=c.oneSupplied||c[o]}else if(l[o]){l.usedMeasures.push(l[o])}}if(l.oneSupplied){i=false;for(r=0;r<a.length;r++){if(l[a[r]]){t[a[r]]=l[a[r]]}}t.usedMeasures=l.usedMeasures}else{let e;t.AggregationLevels=[];if(c.oneSupplied){e={VisibleDimensions:null};for(r=0;r<a.length;r++){if(c[a[r]]){e[a[r]]=c[a[r]]}}t.AggregationLevels.push(e)}if(n.ConstantThresholds&&n.ConstantThresholds.length>0){for(r=0;r<n.ConstantThresholds.length;r++){const i=n.ConstantThresholds[r];const o=i.AggregationLevel?[]:null;if(i.AggregationLevel&&i.AggregationLevel.length>0){for(s=0;s<i.AggregationLevel.length;s++){o.push(i.AggregationLevel[s].$PropertyPath)}}e={VisibleDimensions:o};for(s=0;s<a.length;s++){const t=i[a[s]];if(t){e[a[s]]=t}}t.AggregationLevels.push(e)}}}return i};i.getTemplate=function e(){let t="";if(this._customData.targetCollectionPath===""){this.noDataText=this.getTranslatedText("M_CHART_NO_ANNOTATION_SET_TEXT")}if(this.chartDelegate){t=this.chartDelegate}else{const e=this.getContextPath();t="{name:'sap/fe/macros/chart/ChartDelegate', payload: {collectionName: '"+e+"', contextPath: '"+e+"', parameters:{$$groupId:'$auto.Workers'}, selectionMode: '"+this.selectionMode+"'}}"}const n="{internal>controls/"+this.id+"}";if(!this.header){var a,i;this.header=(a=this._chart)===null||a===void 0?void 0:(i=a.Title)===null||i===void 0?void 0:i.toString()}return ke`
			<macro:ChartAPI xmlns="sap.m" xmlns:macro="sap.fe.macros.chart" xmlns:variant="sap.ui.fl.variants" xmlns:p13n="sap.ui.mdc.p13n" xmlns:unittest="http://schemas.sap.com/sapui5/preprocessorextension/sap.fe.unittesting/1" xmlns:macrodata="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1" xmlns:internalMacro="sap.fe.macros.internal" xmlns:chart="sap.ui.mdc.chart" xmlns:mdc="sap.ui.mdc" xmlns:mdcat="sap.ui.mdc.actiontoolbar" xmlns:core="sap.ui.core" id="${this._apiId}" selectionChange="${this.selectionChange}" stateChange="${this.stateChange}">
				<macro:layoutData>
					<FlexItemData growFactor="1" shrinkFactor="1" />
				</macro:layoutData>
				<mdc:Chart
					binding="${n}"
					unittest:id="ChartMacroFragment"
					id="${this._contentId}"
					chartType="${this._chartType}"
					sortConditions="${this._sortCondtions}"
					header="${this.header}"
					headerVisible="${this.headerVisible}"
					height="${this.height}"
					width="${this.width}"
					headerLevel="${this.headerLevel}"
					p13nMode="${this.personalization}"
					filter="${this.filter}"
					noDataText="${this.noDataText}"
					autoBindOnInit="${this.autoBindOnInit}"
					delegate="${t}"
					macrodata:targetCollectionPath="${this._customData.targetCollectionPath}"
					macrodata:entitySet="${this._customData.entitySet}"
					macrodata:entityType="${this._customData.entityType}"
					macrodata:operationAvailableMap="${this._customData.operationAvailableMap}"
					macrodata:multiSelectDisabledActions="${this._customData.multiSelectDisabledActions}"
					macrodata:segmentedButtonId="${this._customData.segmentedButtonId}"
					macrodata:customAgg="${this._customData.customAgg}"
					macrodata:transAgg="${this._customData.transAgg}"
					macrodata:applySupported="${this._customData.applySupported}"
					macrodata:vizProperties="${this._customData.vizProperties}"
					macrodata:draftSupported="${this._customData.draftSupported}"
					macrodata:multiViews="${this._customData.multiViews}"
					macrodata:selectionPresentationVariantPath="${this._customData.selectionPresentationVariantPath}"
					visible="${this.visible}"
				>
				<mdc:dependents>
					${this.getDependents(this._chartContext)}
					${this.getPersistenceProvider()}
				</mdc:dependents>
				<mdc:items>
					${this.getItems(this._chartContext)}
				</mdc:items>
				${this._actions}
				${this.createVariantManagement()}
			</mdc:Chart>
		</macro:ChartAPI>`};return a}(n),Ie.checkChartVisualizationPath=(e,t)=>{e.forEach(function(e){if(e.$AnnotationPath.includes(`@${"com.sap.vocabularies.UI.v1.Chart"}`)){t=e.$AnnotationPath}});return t},Ie.getVisualizationPath=(t,n,a)=>{var i;const o=Be(n);if(!o){e.error(`Missing metapath parameter for Chart`);return`@${"com.sap.vocabularies.UI.v1.Chart"}`}if(n.targetObject.term==="com.sap.vocabularies.UI.v1.Chart"){return o}const r=a.getEntityTypeAnnotation(o);let s=[];switch((i=n.targetObject)===null||i===void 0?void 0:i.term){case"com.sap.vocabularies.UI.v1.SelectionPresentationVariant":if(n.targetObject.PresentationVariant){s=we(n.targetObject.PresentationVariant,o,r.converterContext,true)}break;case"com.sap.vocabularies.UI.v1.PresentationVariant":s=we(n.targetObject,o,r.converterContext,true);break}const l=s.find(e=>e.visualization.term==="com.sap.vocabularies.UI.v1.Chart");if(l){return l.annotationPath}else{e.error(`Bad metapath parameter for chart: ${n.targetObject.term}`);return`@${"com.sap.vocabularies.UI.v1.Chart"}`}},Ie),Q=Xe(Y.prototype,"id",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),Z=Xe(Y.prototype,"chartDefinition",[C],{configurable:true,enumerable:true,writable:true,initializer:null}),ee=Xe(Y.prototype,"metaPath",[x],{configurable:true,enumerable:true,writable:true,initializer:null}),te=Xe(Y.prototype,"contextPath",[M],{configurable:true,enumerable:true,writable:true,initializer:null}),ne=Xe(Y.prototype,"height",[$],{configurable:true,enumerable:true,writable:true,initializer:function(){return h.system.phone?"75vh":"100%"}}),ae=Xe(Y.prototype,"width",[D],{configurable:true,enumerable:true,writable:true,initializer:function(){return"100%"}}),ie=Xe(Y.prototype,"header",[I],{configurable:true,enumerable:true,writable:true,initializer:null}),oe=Xe(Y.prototype,"headerVisible",[T],{configurable:true,enumerable:true,writable:true,initializer:null}),re=Xe(Y.prototype,"headerLevel",[O],{configurable:true,enumerable:true,writable:true,initializer:function(){return Oe.Auto}}),se=Xe(Y.prototype,"selectionMode",[B],{configurable:true,enumerable:true,writable:true,initializer:function(){return"MULTIPLE"}}),le=Xe(Y.prototype,"personalization",[_],{configurable:true,enumerable:true,writable:true,initializer:null}),ce=Xe(Y.prototype,"filterBar",[S],{configurable:true,enumerable:true,writable:true,initializer:null}),ue=Xe(Y.prototype,"noDataText",[z],{configurable:true,enumerable:true,writable:true,initializer:null}),de=Xe(Y.prototype,"chartDelegate",[w],{configurable:true,enumerable:true,writable:true,initializer:null}),ge=Xe(Y.prototype,"vizProperties",[V],{configurable:true,enumerable:true,writable:true,initializer:null}),pe=Xe(Y.prototype,"chartActions",[E],{configurable:true,enumerable:true,writable:true,initializer:null}),he=Xe(Y.prototype,"draftSupported",[j],{configurable:true,enumerable:true,writable:true,initializer:null}),me=Xe(Y.prototype,"autoBindOnInit",[k],{configurable:true,enumerable:true,writable:true,initializer:null}),be=Xe(Y.prototype,"visible",[F],{configurable:true,enumerable:true,writable:true,initializer:null}),fe=Xe(Y.prototype,"navigationPath",[N],{configurable:true,enumerable:true,writable:true,initializer:null}),ve=Xe(Y.prototype,"filter",[H],{configurable:true,enumerable:true,writable:true,initializer:null}),Pe=Xe(Y.prototype,"measures",[L],{configurable:true,enumerable:true,writable:true,initializer:null}),Ae=Xe(Y.prototype,"_applyIdToContent",[U],{configurable:true,enumerable:true,writable:true,initializer:function(){return false}}),ye=Xe(Y.prototype,"variantManagement",[R],{configurable:true,enumerable:true,writable:true,initializer:null}),Ce=Xe(Y.prototype,"variantSelected",[W],{configurable:true,enumerable:true,writable:true,initializer:null}),xe=Xe(Y.prototype,"variantSaved",[q],{configurable:true,enumerable:true,writable:true,initializer:null}),Me=Xe(Y.prototype,"actions",[G],{configurable:true,enumerable:true,writable:true,initializer:null}),$e=Xe(Y.prototype,"selectionChange",[X],{configurable:true,enumerable:true,writable:true,initializer:null}),De=Xe(Y.prototype,"stateChange",[J],{configurable:true,enumerable:true,writable:true,initializer:null}),Y))||K);Te=Ze;return Te},false);
//# sourceMappingURL=Chart.block.js.map