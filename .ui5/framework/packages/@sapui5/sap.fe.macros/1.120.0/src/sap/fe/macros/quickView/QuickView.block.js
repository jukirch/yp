/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/BindingToolkit","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/SemanticObjectHelper","sap/fe/macros/field/FieldTemplating","sap/fe/core/buildingBlocks/BuildingBlockBase","sap/fe/core/buildingBlocks/BuildingBlockSupport","sap/fe/core/buildingBlocks/BuildingBlockTemplateProcessor","sap/fe/core/templating/DataModelPathHelper"],function(e,t,i,a,n,o,r,c,s){"use strict";var l,u,d,p,f,m,v,b,g;var y={};var O=s.getRelativePaths;var h=c.xml;var P=r.defineBuildingBlock;var j=r.blockAttribute;var k=n.isUsedInNavigationWithQuickViewFacets;var S=n.getPropertyWithSemanticObject;var w=n.getDataModelObjectPathForValue;var F=a.getSemanticObjects;var T=a.getSemanticObjectUnavailableActions;var x=a.getSemanticObjectMappings;var D=a.getDynamicPathFromSemanticObject;var E=i.isProperty;var M=t.pathInModel;var Q=t.getExpressionFromAnnotation;var V=t.compileExpression;function B(e,t,i,a){if(!i)return;Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(a):void 0})}function L(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function $(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;U(e,t)}function U(e,t){U=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,i){t.__proto__=i;return t};return U(e,t)}function z(e,t,i,a,n){var o={};Object.keys(a).forEach(function(e){o[e]=a[e]});o.enumerable=!!o.enumerable;o.configurable=!!o.configurable;if("value"in o||o.initializer){o.writable=true}o=i.slice().reverse().reduce(function(i,a){return a(e,t,i)||i},o);if(n&&o.initializer!==void 0){o.value=o.initializer?o.initializer.call(n):void 0;o.initializer=undefined}if(o.initializer===void 0){Object.defineProperty(e,t,o);o=null}return o}function C(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}let A=(l=P({name:"QuickView",namespace:"sap.fe.macros",designtime:"sap/fe/macros/quickView/QuickView.designtime"}),u=j({type:"sap.ui.model.Context",required:true,expectedTypes:["Property"],expectedAnnotationTypes:["com.sap.vocabularies.UI.v1.DataField","com.sap.vocabularies.UI.v1.DataFieldWithUrl","com.sap.vocabularies.UI.v1.DataFieldForAnnotation","com.sap.vocabularies.UI.v1.DataPointType"]}),d=j({type:"sap.ui.model.Context",required:true,expectedTypes:["EntitySet","NavigationProperty","EntityType","Singleton"]}),p=j({type:"string"}),l(f=(m=function(t){$(i,t);i.getRelativePathToQuickViewEntity=function e(t){let i;const a=this.getNavPropToQuickViewEntity(t);if(a){i=t.navigationProperties.reduce((e,i)=>{var n;if(i.name!==a.name&&!((n=t.contextLocation)!==null&&n!==void 0&&n.navigationProperties.find(e=>e.name===i.name))){return`${e}${i.name}/`}return e},"");i=`${i}${a.name}`}return i};i.getSemanticObjectsForPayloadAndQualifierMap=function e(t){const i={};const a=[];if(t!==undefined){for(const e of F(t)){const t=V(Q(e));if(t&&!a.includes(t)){i[e.qualifier||""]=t;a.push(t)}}}return{semanticObjectsList:a,qualifierMap:i}};i.getSemanticObjectMappingsForPayload=function e(t,i){const a=[];if(t!==undefined){for(const e of x(t)){const t=i[e.qualifier||""];if(t){a.push({semanticObject:t,items:e.map(e=>({key:e.LocalProperty.value,value:e.SemanticObjectProperty.valueOf()}))})}}}return a};i.getSemanticObjectUnavailableActionsForPayload=function e(t,i){const a=[];if(t!==undefined){for(const e of T(t)){const t=i[e.qualifier||""];if(t){a.push({semanticObject:t,actions:e.map(e=>e)})}}}return a};i.addCustomSemanticObjectToSemanticObjectListForPayload=function e(t,i){if(i){if(!i.startsWith("[")){if(!t.includes(i)){t.push(i)}}else{for(const e of JSON.parse(i)){if(!t.includes(e)){t.push(e)}}}}};i.getNavPropToQuickViewEntity=function e(t){var i;const a=t.targetObject;const n=t.targetEntityType.navigationProperties;let o=n.find(e=>e.referentialConstraint.some(t=>{var i;return t.sourceProperty===a.name&&((i=e.targetType.annotations.UI)===null||i===void 0?void 0:i.QuickViewFacets)}));if(!o&&((i=t.contextLocation)===null||i===void 0?void 0:i.targetEntitySet)!==t.targetEntitySet){var r,c;const e=((r=t.targetEntityType.annotations.Common)===null||r===void 0?void 0:r.SemanticKey)||[];const i=e.some(e=>e.$target===a);const n=t.navigationProperties[t.navigationProperties.length-1];if((i||a.isKey)&&(c=t.targetEntityType.annotations.UI)!==null&&c!==void 0&&c.QuickViewFacets){o=n}}return o};function i(a,n,o){var r,c,s,l,u;var d;d=t.call(this,a,n,o)||this;B(d,"dataField",v,L(d));B(d,"contextPath",b,L(d));B(d,"semanticObject",g,L(d));let p=e.getInvolvedDataModelObjects(d.dataField,d.contextPath);const f=w(p);if(f){d.valueDataModelPath=f}p=f||p;const m=E(p.targetObject)?p.targetObject:undefined;const y=m&&k(p,m)?"true":"false";const O=i.getRelativePathToQuickViewEntity(p);const h=((r=p.contextLocation)===null||r===void 0?void 0:(c=r.targetEntitySet)===null||c===void 0?void 0:c.name)??((s=p.contextLocation)===null||s===void 0?void 0:s.targetObject).fullyQualifiedName;const P=O?`/${h}/${O}`:undefined;const j=O?V(M(O)):undefined;const F=S(p);let T;const{semanticObjectsList:x,qualifierMap:D}=i.getSemanticObjectsForPayloadAndQualifierMap(F);const Q=i.getSemanticObjectMappingsForPayload(F,D);const $=i.getSemanticObjectUnavailableActionsForPayload(F,D);if(F){T=D.main||D[""];if(!T){T=Object.keys(D)[0]}}i.addCustomSemanticObjectToSemanticObjectListForPayload(x,d.semanticObject);const U=(m===null||m===void 0?void 0:(l=m.annotations.Common)===null||l===void 0?void 0:(u=l.Label)===null||u===void 0?void 0:u.valueOf())||"";d.payload={semanticObjects:x,entityType:P,semanticObjectUnavailableActions:$,semanticObjectMappings:Q,mainSemanticObject:T,propertyPathLabel:U,dataField:P===undefined?d.dataField.getPath():undefined,contact:undefined,navigationPath:j,hasQuickViewFacets:y};return d}y=i;var a=i.prototype;a.getTemplate=function e(){const t={name:"sap/fe/macros/quickView/QuickViewDelegate",payload:this.payload};return h`<mdc:Link xmlns:mdc="sap.ui.mdc" delegate="${JSON.stringify(t)}">
			${this.writeCustomData(this.payload.semanticObjects,this.valueDataModelPath)}
			</mdc:Link>`};a.writeCustomData=function e(t,i){let a="";const n=i&&O(i);for(const e of t){const t=D(e);if(t){const e=V(M(t,undefined,n));const i=e&&D(e);if(i){a=`${a}\n\t\t\t\t<core:CustomData xmlns:core="sap.ui.core" key="${i}" value="${e}" />`}}}if(a.length){return`<mdc:customData>\n\t\t\t\t${a}\n\t\t\t</mdc:customData>`}return""};return i}(o),v=z(m.prototype,"dataField",[u],{configurable:true,enumerable:true,writable:true,initializer:null}),b=z(m.prototype,"contextPath",[d],{configurable:true,enumerable:true,writable:true,initializer:null}),g=z(m.prototype,"semanticObject",[p],{configurable:true,enumerable:true,writable:true,initializer:null}),m))||f);y=A;return y},false);
//# sourceMappingURL=QuickView.block.js.map