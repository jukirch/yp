/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/ActionRuntime","sap/fe/core/CommonUtils","sap/fe/core/controllerextensions/BusyLocker","sap/fe/core/helpers/DeleteHelper","sap/fe/core/helpers/FPMHelper","sap/fe/core/library","sap/fe/macros/field/FieldRuntime","sap/fe/macros/table/TableHelper","sap/fe/macros/table/Utils"],function(e,t,n,o,i,a,s,r,l,c){"use strict";const d=s.CreationMode;const u={displayTableSettings:function(e){const t=e.getSource().getParent(),o=sap.ui.getCore().byId(`${t.getId()}-settings`);n.fireButtonPress(o)},executeConditionalActionShortcut:function(e,t){const o=t.getParent();if(e!==d.CreationRow){const t=o.getActions().reduce(function(e,t){return e.concat(t.getAction())},[]).find(function(t){return t.getId().endsWith(e)});n.fireButtonPress(t)}else{const e=o.getAggregation("creationRow");if(e&&e.getApplyEnabled()&&e.getVisible()){e.fireApply()}}},setContexts:function(t,n,i,a,s,r,l){o.lock(t);return u.setContextsAsync(t,n,i,a,s,r,l).then(()=>{e.info("Selections updated");return}).catch(t=>{e.error(t)}).finally(()=>{o.unlock(t)})},setContextsAsync:async function(e,n,o,a,s,r,c){const d=r?r.split(","):[];const u=JSON.parse(a);const f=s&&s!=="undefined"&&JSON.parse(s);let g=e.getSelectedContexts();const p=[];const b=e.data("displayModePropertyBinding")==="true"&&o!=="undefined";const m=[];const C={};const y={};const h=e.getBindingContext("internal");if(!h){return}g=g.filter(function(e){return!e.isInactive()});const P=Object.assign(h.getObject()||{},{selectedContexts:g,numberOfSelectedContexts:g.length,dynamicActions:C,ibn:y,deleteEnabled:true,deletableContexts:p,unSavedContexts:[],lockedContexts:[],draftsWithNonDeletableActive:[],draftsWithDeletableActive:[],controlId:"",updatableContexts:m,pasteAuthorized:true,cutableContext:[],semanticKeyHasDraftIndicator:h.getProperty("semanticKeyHasDraftIndicator")?h.getProperty("semanticKeyHasDraftIndicator"):undefined});for(const e of g){const t=e.getObject();for(const e in t){if(e.indexOf("#")===0){let t=e;t=t.substring(1,t.length);P.dynamicActions[t]={enabled:true};h.setProperty("",P)}}const n=c.length===0||!!e.getProperty(c);const o=!b||t.IsActiveEntity;if(n&&o){m.push(e)}}i.updateDeleteInfoForSelectedContexts(h,g);if(!e.data("enableAnalytics")){l.setIBNEnablement(h,f,g)}if(g.length>1){this.disableAction(d,C)}if(P){P["updatableContexts"]=m;P["controlId"]=e.getId();h.setProperty("",P)}const x=e.getParent();if(g.length<=1&&x.tableDefinition.control.createEnablement){const t=g.length?g[0]:undefined;this._updateCreateEnablement(h,x.tableDefinition.control.createEnablement,e,t,x.tableDefinition.control.nodeType)}this.updateCutPasteEnablement(P,e);return t.setActionEnablement(h,u,g,"table")},updateCutPasteEnablement:function(e,t){var n,o;const i=t.getParent().getTableDefinition().control.isNodeMovable;e["cutableContexts"]=(n=i?(o=e["updatableContexts"])===null||o===void 0?void 0:o.filter(e=>a.getCustomFunction(i.moduleName,i.methodName,t)(e)):e["updatableContexts"])===null||n===void 0?void 0:n.map(e=>e.getPath());const s=t.getParent().getTableDefinition().control.isMoveToPositionAllowed;if(s&&e.numberOfSelectedContexts===1){if(!a.getCustomFunction(s.moduleName,s.methodName,t)(null,e.selectedContexts[0])){e.pasteAuthorized=false}}},_updateCreateEnablement:function(e,t,n,o,i){let s;if(i!==undefined){s=i.values.map(e=>e.value)}else{s=[undefined]}const r=a.getCustomFunction(t.moduleName,t.methodName,n);if(!r){return}const l=s.map(e=>{let t=false;try{t=!!(r(e,o)??true)}catch(e){t=true}return t});const c={};c["Create"]=l.some(e=>e);l.forEach((e,t)=>{c[`Create_${t}`]=e});e.setProperty("createEnablement",c)},clearSelection:function(e){e.clearSelection();const t=e.getBindingContext("internal");if(t){t.setProperty("deleteEnabled",false);t.setProperty("numberOfSelectedContexts",0);t.setProperty("selectedContexts",[]);t.setProperty("deletableContexts",[])}const n=e.getParent();if(n.tableDefinition.control.createEnablement){this._updateCreateEnablement(t,n.tableDefinition.control.createEnablement,e,undefined,n.tableDefinition.control.nodeType)}},disableAction:function(e,t){e.forEach(function(e){t[e]={bEnabled:false}})},onFieldChangeInCreationRow:function(e,t){const n=r.getFieldStateOnChange(e),o=n.field,i=o.getId();const a=o.getBindingContext("internal"),s=a.getProperty("creationRowFieldValidity"),l=Object.assign({},s);l[i]=n.state;a.setProperty("creationRowFieldValidity",l);if(t){var c;const e=a.getProperty("creationRowCustomValidity"),t=Object.assign({},e);t[o.getBinding("value").getPath()]={fieldId:o.getId()};a.setProperty("creationRowCustomValidity",t);const n=sap.ui.getCore().getMessageManager();const i=`${(c=o.getBindingContext())===null||c===void 0?void 0:c.getPath()}/${o.getBindingPath("value")}`;n.getMessageModel().getData().forEach(function(e){if(e.target===i){n.removeMessages(e)}})}},onTreeTableContextChanged:function(e,t){const n=e.getRowBinding();if(!n.getContext()){return}const o=n.getAggregation()??{};const i=c.getAllFilterInfo(e);o.expandTo=i.search?100:t;n.setAggregation(o)},onCreateMenuItemPress:function(t,o,i){const s=a.getMdcTable(t.getSource());const r=s===null||s===void 0?void 0:s.getParent();if(!r){return}const l=r.tableDefinition.control.nodeType;if(!l){return}const c=n.getTargetView(r);const d={};d[l.propertyName]=l.values[o].value;c.getController().editFlow.createDocument(s.getRowBinding(),{selectedContexts:i,creationMode:r.tableDefinition.control.creationMode,data:d,tableId:s===null||s===void 0?void 0:s.getId()}).catch(t=>{e.error(`Failed to create new document: ${t}`)})}};return u},false);
//# sourceMappingURL=TableRuntime.js.map