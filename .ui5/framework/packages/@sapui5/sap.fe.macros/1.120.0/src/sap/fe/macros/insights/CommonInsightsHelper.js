/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/CommonUtils","sap/fe/core/helpers/ResourceModelHelper","sap/m/MessageBox","sap/ui/core/Core","sap/ui/mdc/p13n/StateUtil","../filterBar/adapter/StateFilterToSelectionVariant"],function(t,e,n,o,r,a){"use strict";var s={};var i=e.getResourceModel;const c={"sap.ui.model.odata.type.String":"string","sap.ui.model.odata.type.Int":"integer","sap.ui.model.odata.type.Int32":"integer","sap.ui.model.odata.type.Int64":"integer","sap.ui.model.odata.type.Boolean":"boolean","sap.ui.model.odata.type.Decimal":"number","sap.ui.model.odata.type.Double":"number","sap.ui.model.odata.type.Date":"date","sap.ui.model.odata.type.DateTimeOffset":"datetime"};function l(t,e){if(e&&e.length===0){return false}const n=o.byId(t);if(n!==null&&n!==void 0&&n.isA("sap.fe.core.controls.FilterBar")){const t=n.getParent().isSemanticDateFilterApplied();return!t}return true}s.isInsightsCardCreationPossible=l;function p(t,e){if(t==="Table"){const t=`<strong>\n\t\t${e.getText("M_CARD_RETRY_MESSAGE")}\n\t\t</strong>`;const o=`<ul><li>\n\t\t\t${e.getText("M_CARD_FAILURE_REASON_DATE_RANGE_FILTERS")}\n\t\t\t</li><li>\n\t\t\t${e.getText("M_CARD_FAILURE_TABLE_REASON_UNSUPPORTED_COLUMNS")}\n\t\t\t</li></ul>`;const r=t+o;n.error(e.getText("M_CARD_CREATION_FAILURE"),{onClose:function(){throw new Error("Insights is not supported")},details:r})}else{const t=e.getText("M_CARD_CREATION_FAILURE_CHART_REASON_DATE_RANGE_FILTERS");n.error(t,{onClose:function(){throw new Error("Insights is not supported")}})}}function u(t){const e=t.getShellServices();const n=t.getNavigationService();const o=e.getHash();const r=e.parseShellHash(o);return{iAppStateKey:n.getIAppStateKey(),intent:{semanticObject:r.semanticObject,action:r.action}}}function g(t,e,n,o){const r={};const s=a.mergeSelectionVariants(e,o);const i=s.getSelectOptionsPropertyNames();if(i.length){for(const e of i){const o=f(e,n);if(e!=="$editState"&&!t.includes(e)&&!e.includes("$Parameter.")&&o){const t={id:s.getID(),Parameters:[],SelectOptions:[{PropertyName:e,Ranges:s.getSelectOption(e)}]};r[e]={value:JSON.stringify(t),type:o}}}}return r}function d(t,e,n){const o={};const r=e.getSelectOptionsPropertyNames();if(r.length){for(const s of t){const t=f(s,n);if(r.includes(s)&&t){var a;o[s]={value:(a=e.getSelectOption(s))===null||a===void 0?void 0:a[0].Low,type:t}}}}return o}function f(t,e){let n;e.forEach(e=>{if(e.name===t){n=c[e.dataType]}});return n}async function m(e,n,s,c){const f=l(s,c);if(!f){p(e,i(n));return}const m=t.getAppComponent(n.content);const S=o.byId(s);const A=n.content;const y=await r.retrieveExternalState(A);const E=a.getSelectionVariantFromConditions(y.filter,A.getPropertyHelper());let R,_,I=[];if(S!==null&&S!==void 0&&S.isA("sap.fe.core.controls.FilterBar")){const t=S.getParent();const e=t.getParameters();const n=await t.getSelectionVariant();const o=S.getPropertyInfoSet();I=t.getMandatoryFilterPropertyNames();R=g(e,n,o,E);_=d(e,n,o)}const T={navigation:u(m),type:e,requestParameters:{serviceUrl:n.content.getModel().getServiceUrl(),queryUrl:"",sortQuery:""},content:{cardTitle:""},parentAppManifest:m.getManifest(),parameters:{mandatoryFilters:I,filters:R,oDataParameters:_},entitySetPath:""};return T}s.createInsightsParams=m;function S(t){const o=e.getResourceModel(t);n.error(o.getText("M_CARD_FAILURE_GENERIC"))}s.showGenericErrorMessage=S;function A(t){let e=false;for(const n of t){const t=n.getAction();const o=t.getId().includes("StandardAction::Insights");e=o&&t.getVisible()&&t.getEnabled();if(e){break}}return e}s.hasInsightActionEnabled=A;return s},false);
//# sourceMappingURL=CommonInsightsHelper.js.map