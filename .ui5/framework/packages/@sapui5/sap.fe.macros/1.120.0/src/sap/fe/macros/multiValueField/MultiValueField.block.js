/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/buildingBlocks/BuildingBlockBase","sap/fe/core/buildingBlocks/BuildingBlockSupport","sap/fe/core/buildingBlocks/BuildingBlockTemplateProcessor","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/BindingHelper","sap/fe/core/helpers/BindingToolkit","sap/fe/core/helpers/StableIdHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper","sap/fe/core/templating/PropertyFormatters","sap/fe/core/templating/UIFormatters","sap/fe/macros/field/FieldHelper","sap/fe/macros/field/FieldTemplating","sap/fe/macros/internal/valuehelp/ValueHelpTemplating"],function(e,t,i,a,r,n,o,l,s,d,u,c,p,f){"use strict";var h,m,y,v,g,b,P,M,x,O,F,D,V,$,w,B,I,E,j;var z={};var T=p.getVisibleExpression;var H=p.getValueBinding;var S=u.getDisplayMode;var k=s.isPathInsertable;var C=s.isPathDeletable;var L=s.getRelativePaths;var G=s.getContextRelativeTargetObjectPath;var R=s.enhanceDataModelPath;var _=l.isPropertyPathExpression;var A=l.isProperty;var N=l.isMultipleNavigationProperty;var U=n.or;var q=n.not;var Q=n.isConstant;var J=n.ifElse;var K=n.getExpressionFromAnnotation;var W=n.constant;var X=n.compileExpression;var Y=n.and;var Z=r.UI;var ee=i.xml;var te=t.defineBuildingBlock;var ie=t.blockAttribute;function ae(e,t,i,a){if(!i)return;Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(a):void 0})}function re(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function ne(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;oe(e,t)}function oe(e,t){oe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,i){t.__proto__=i;return t};return oe(e,t)}function le(e,t,i,a,r){var n={};Object.keys(a).forEach(function(e){n[e]=a[e]});n.enumerable=!!n.enumerable;n.configurable=!!n.configurable;if("value"in n||n.initializer){n.writable=true}n=i.slice().reverse().reduce(function(i,a){return a(e,t,i)||i},n);if(r&&n.initializer!==void 0){n.value=n.initializer?n.initializer.call(r):void 0;n.initializer=undefined}if(n.initializer===void 0){Object.defineProperty(e,t,n);n=null}return n}function se(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}let de=(h=te({name:"MultiValueField",namespace:"sap.fe.macros.internal",publicNamespace:"sap.fe.macros"}),m=ie({isPublic:true,type:"string"}),y=ie({type:"string"}),v=ie({type:"string"}),g=ie({isPublic:true,type:"sap.ui.model.Context",required:true,expectedTypes:["Property"],expectedAnnotationTypes:["com.sap.vocabularies.UI.v1.DataField"]}),b=ie({type:"boolean",isPublic:true,required:false}),P=ie({isPublic:true,required:true,type:"sap.ui.model.Context",expectedTypes:["EntitySet","NavigationProperty","EntityType","Singleton"]}),M=ie({type:"string"}),x=ie({type:"object",validate:function(e){if(e.displayMode&&!["Value","Description","ValueDescription","DescriptionValue"].includes(e.displayMode)){throw new Error(`Allowed value ${e.displayMode} for displayMode does not match`)}if(typeof e.displayOnly==="string"&&!["true","false"].includes(e.displayOnly)){throw new Error(`Allowed value ${e.displayOnly} for displayOnly does not match`)}if(e.measureDisplayMode&&!["Hidden","ReadOnly"].includes(e.measureDisplayMode)){throw new Error(`Allowed value ${e.measureDisplayMode} for measureDisplayMode does not match`)}return e}}),h(O=(F=function(e){ne(i,e);i._getMultiInputSettings=function e(t,a){var r;const{collectionPath:n,itemDataModelObjectPath:o}=i._getPathStructure(t);const l=`{path:'${n}', templateShareable: false}`;const s=`{path:'${n}', templateShareable: false}`;const d=t.targetObject;const u=_(d)?d.$target:d;const c=u===null||u===void 0?void 0:(r=u.annotations.Common)===null||r===void 0?void 0:r.Text;const p=L(t);const f=c?X(K(c,p)):H(o,a,true);return{description:f,collectionBindingDisplay:l,collectionBindingEdit:s,key:H(o,a,true)}};i._getPathStructure=function e(t){var i,a;let r="";const n=(i=t.contextLocation)!==null&&i!==void 0&&i.targetEntitySet?t.contextLocation.targetEntitySet:t.startingEntitySet;const o=[];const l=((a=t.contextLocation)===null||a===void 0?void 0:a.navigationProperties)||[];for(const e of t.navigationProperties){if(t.contextLocation===undefined||!t.contextLocation.navigationProperties.some(t=>t.fullyQualifiedName===e.fullyQualifiedName)){o.push(e.name);l.push(e)}if(n.navigationPropertyBinding.hasOwnProperty(e.name)){if(N(e)){break}}}r=`${o.join("/")}`;const s=Object.assign({},t);if(s.contextLocation){s.contextLocation.navigationProperties=l}return{collectionPath:r,itemDataModelObjectPath:s}};var t=i.prototype;t.computeFieldGroupIds=function e(t){if(!t){return""}const i=t.getSideEffectsService();const a=i.computeFieldGroupIds(this.dataModelPath.targetEntityType.fullyQualifiedName,this.dataModelPath.targetObject.fullyQualifiedName);const r=a.join(",");return r===""?undefined:r};function i(t,r,n){var o;var l;l=e.call(this,t)||this;ae(l,"id",D,re(l));ae(l,"idPrefix",V,re(l));ae(l,"vhIdPrefix",$,re(l));ae(l,"metaPath",w,re(l));ae(l,"readOnly",B,re(l));ae(l,"contextPath",I,re(l));ae(l,"ariaLabelledBy",E,re(l));ae(l,"formatOptions",j,re(l));const s=a.convertMetaModelContext(l.metaPath);if(A(s)&&((o=s.annotations.UI)===null||o===void 0?void 0:o.DataFieldDefault)!==undefined){l.enhancedMetaPath=n.models.metaModel.createBindingContext(`@${"com.sap.vocabularies.UI.v1.DataFieldDefault"}`,l.metaPath)}else{l.enhancedMetaPath=l.metaPath}const d=a.getInvolvedDataModelObjects(l.enhancedMetaPath,l.contextPath);l.convertedDataField=d.targetObject;l.dataModelPath=R(d,l.convertedDataField.Value.path);l.property=l.dataModelPath.targetObject;const u=k(l.dataModelPath);const c=C(l.dataModelPath,{ignoreTargetCollection:true,authorizeUnresolvable:true});const p=C(l.dataModelPath);const f=J(c._type==="Unresolvable",U(q(Q(p)),p),p);l.visible=T(l.dataModelPath,l.formatOptions);l.editMode=l.formatOptions.displayOnly==="true"||l.readOnly===true?"Display":X(J(Y(u,f,Z.IsEditable),W("Editable"),W("Display")));l.displayMode=S(l.dataModelPath);const h=R(a.getInvolvedDataModelObjects(l.enhancedMetaPath,l.contextPath),l.convertedDataField.Value.path);l.item=i._getMultiInputSettings(h,l.formatOptions);l.collection=l.editMode==="Display"?l.item.collectionBindingDisplay:l.item.collectionBindingEdit;l.fieldGroupIds=l.computeFieldGroupIds(n.appComponent);return l}z=i;t.getPossibleValueHelpTemplate=function e(){const t=c.valueHelpProperty(this.metaPath);const i=this.metaPath.getModel().createBindingContext(t,this.metaPath);const a=c.hasValueHelpAnnotation(i.getObject("@"));if(a){return ee`
			<mdc:dependents>
				<macros:ValueHelp
					idPrefix="${o.generate([this.id,"FieldValueHelp"])}"
					property="${i}"
					contextPath="${this.contextPath}"
					useMultiValueField="true"
				/>
			</mdc:dependents>`}return""};t.getTemplate=function e(){if(this.id){this.vhIdPrefix=o.generate([this.id,this.vhIdPrefix])}else{this.id=this.idPrefix?o.generate([this.idPrefix,"MultiValueField"]):undefined}const t=c.valueHelpProperty(this.metaPath);const i=this.metaPath.getModel().createBindingContext(t,this.metaPath);const a=f.generateID(undefined,this.vhIdPrefix,d.getRelativePropertyPath(i,{context:this.contextPath}),G(this.dataModelPath)??"");const r=c.computeLabelText(this.convertedDataField.Value,{context:this.metaPath});const n=`MVFieldRuntime.handleChange($controller, $event)`;const l=`MVFieldRuntime.onValidateFieldGroup($controller, $event)`;return ee`
		<mdc:MultiValueField
				core:require="{MVFieldRuntime:'sap/fe/macros/multiValueField/MultiValueFieldRuntime'}"
				delegate="{name: 'sap/fe/macros/multiValueField/MultiValueFieldDelegate'}"
				id="${this.id}"
				items="${this.collection}"
				display="${this.displayMode}"
				width="100%"
				editMode="${this.editMode}"
				valueHelp="${a}"
				ariaLabelledBy = "${this.ariaLabelledBy}"
				showEmptyIndicator = "${this.formatOptions.showEmptyIndicator}"
				label = "${r}"
				change="${n}"
				fieldGroupIds="${this.fieldGroupIds}"
				validateFieldGroup="${l}"
		>
			<mdc:items>
				<mdcField:MultiValueFieldItem xmlns:mdcField="sap.ui.mdc.field" key="${this.item.key}" description="${this.item.description}" />
			</mdc:items>
			${this.getPossibleValueHelpTemplate()}
		</mdc:MultiValueField>`};return i}(e),D=le(F.prototype,"id",[m],{configurable:true,enumerable:true,writable:true,initializer:null}),V=le(F.prototype,"idPrefix",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),$=le(F.prototype,"vhIdPrefix",[v],{configurable:true,enumerable:true,writable:true,initializer:function(){return"FieldValueHelp"}}),w=le(F.prototype,"metaPath",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),B=le(F.prototype,"readOnly",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),I=le(F.prototype,"contextPath",[P],{configurable:true,enumerable:true,writable:true,initializer:null}),E=le(F.prototype,"ariaLabelledBy",[M],{configurable:true,enumerable:true,writable:true,initializer:null}),j=le(F.prototype,"formatOptions",[x],{configurable:true,enumerable:true,writable:true,initializer:function(){return{}}}),F))||O);z=de;return z},false);
//# sourceMappingURL=MultiValueField.block.js.map