/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/controllerextensions/messageHandler/messageHandling","sap/fe/core/helpers/ClassSupport","sap/fe/core/helpers/ResourceModelHelper","sap/fe/macros/messages/MessagePopover","sap/m/Button","sap/m/ColumnListItem","sap/m/Dialog","sap/m/FormattedText","sap/m/library","sap/ui/core/Core","sap/ui/core/library","sap/ui/core/mvc/View","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/Sorter","sap/ui/thirdparty/jquery"],function(e,t,n,i,o,s,r,a,g,l,c,u,f,d,p,h,jQuery){"use strict";var T,b,_,m,I,C,P;var v=u.MessageType;var y=l.ButtonType;var E=i.getResourceModel;var S=n.event;var M=n.defineUI5Class;var w=n.aggregation;function x(e,t,n,i){if(!n)return;Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function R(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function A(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;O(e,t)}function O(e,t){O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,n){t.__proto__=n;return t};return O(e,t)}function B(e,t,n,i,o){var s={};Object.keys(i).forEach(function(e){s[e]=i[e]});s.enumerable=!!s.enumerable;s.configurable=!!s.configurable;if("value"in s||s.initializer){s.writable=true}s=n.slice().reverse().reduce(function(n,i){return i(e,t,n)||n},s);if(o&&s.initializer!==void 0){s.value=s.initializer?s.initializer.call(o):void 0;s.initializer=undefined}if(s.initializer===void 0){Object.defineProperty(e,t,s);s=null}return s}function L(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}let G=(T=M("sap.fe.macros.messages.MessageButton"),b=w({type:"sap.fe.macros.messages.MessageFilter",multiple:true,singularName:"customFilter"}),_=S(),T(m=(I=function(n){A(i,n);function i(e,t){var i;i=n.call(this,e,t)||this;x(i,"customFilters",C,R(i));x(i,"messageChange",P,R(i));i.sGeneralGroupText="";i.sViewId="";i.sLastActionText="";return i}var l=i.prototype;l.init=function e(){s.prototype.init.apply(this);this.attachPress(this.handleMessagePopoverPress,this);this.oMessagePopover=new o;this.oItemBinding=this.oMessagePopover.getBinding("items");this.oItemBinding.attachChange(this._setMessageData,this);const t=this.getId();if(t){this.oMessagePopover.addCustomData(new sap.ui.core.CustomData({key:"messageButtonId",value:t}))}this.attachModelContextChange(this._applyFiltersAndSort.bind(this));this.oMessagePopover.attachActiveTitlePress(this._activeTitlePress.bind(this))};l.handleMessagePopoverPress=function e(t){this.oMessagePopover.toggle(t.getSource())};l._applyGroupingAsync=async function n(i){const o=[];const s=i.getBindingContext();const r=e=>{const n=[];const i=this.oItemBinding.getContexts().map(function(e){return e.getObject()});const o=e.getBindingContext();if(o){const s=e.getContent()[0];t.getVisibleSectionsFromObjectPageLayout(s).forEach(function(e){e.getSubSections().forEach(function(e){e.findElements(true).forEach(function(t){if(t.isA("sap.ui.mdc.Table")){for(let s=0;s<i.length;s++){const r=t.getRowBinding();if(r){const r=`${o.getPath()}/${t.getRowBinding().getPath()}`;if(i[s].target.indexOf(r)===0){n.push({table:t,subsection:e});break}}}}})})})}return n};const a=r.bind(this)(i);a.forEach(function(e){var t;const n=e.table,i=e.subsection;if(!n.getBindingContext()||((t=n.getBindingContext())===null||t===void 0?void 0:t.getPath())!==(s===null||s===void 0?void 0:s.getPath())){i.setBindingContext(s);if(!n.getRowBinding().isLengthFinal()){o.push(new Promise(function(e){n.getRowBinding().attachEventOnce("dataReceived",function(){e()})}))}}});const g=new Promise(e=>{setTimeout(async()=>{this._applyGrouping();e()},0)});try{await Promise.all(o);i.getModel().checkMessages();await g}catch(t){e.error("Error while grouping the messages in the messagePopOver")}};l._applyGrouping=function e(){this.oObjectPageLayout=this._getObjectPageLayout(this,this.oObjectPageLayout);if(!this.oObjectPageLayout){return}const n=this.oMessagePopover.getItems();const i=t.getVisibleSectionsFromObjectPageLayout(this.oObjectPageLayout);const o=this._checkControlIdInSections(n,false);if(o){this._fnEnableBindings(i)}};l._getTableRefErrorContext=function e(t){const n=t.getModel("internal");if(!t.getBindingContext("internal").getProperty("refError")){n.setProperty("refError",{},t.getBindingContext("internal"))}const i=t.getBindingContext("internal").getPath()+"/refError/"+t.getBindingContext().getPath().replace("/","$")+"$"+t.getRowBinding().getPath().replace("/","$");const o=n.getContext(i);if(!o.getProperty("")){n.setProperty("",{},o)}return o};l._updateInternalModel=function e(t,n,i,o,s,r){let a;if(r){a={rowIndex:"CreationRow",targetColProperty:i?i:""}}else{a={rowIndex:t?n:"",targetColProperty:i?i:""}}const g=o.getModel("internal"),l=this._getTableRefErrorContext(o);const c=sap.ui.getCore().getMessageManager().getMessageModel().getData().map(function(e){return e.id});let u;if(l.getProperty()){u=Object.keys(l.getProperty()).filter(function(e){return c.indexOf(e)===-1});u.forEach(function(e){delete l.getProperty()[e]})}g.setProperty(s.getId(),Object.assign({},l.getProperty(s.getId())?l.getProperty(s.getId()):{},a),l)};l._setGroupLabelForTransientMsg=function e(t,n){this.sLastActionText=this.sLastActionText?this.sLastActionText:c.getLibraryResourceBundle("sap.fe.core").getText("T_MESSAGE_BUTTON_SAPFE_MESSAGE_GROUP_LAST_ACTION");t.setGroupName(`${this.sLastActionText}: ${n}`)};l._computeMessageGroupAndSubTitle=function e(n,i,o,s,r,a){var g;const l=E(i);this.oItemBinding.detachChange(this._setMessageData,this);const u=(g=n.getBindingContext("message"))===null||g===void 0?void 0:g.getObject();const f=true;let d,p,h,T,b,_,m;const I=new RegExp("^/").test(u===null||u===void 0?void 0:u.getTargets()[0]);if(I){for(T=0;T<s.length;T++){d=s[T];_=d;if(d.isA("sap.m.Table")||d.isA("sap.ui.table.Table")){p=d.getParent();const e=p.getRowBinding();const i=(e,t)=>{this._setGroupLabelForTransientMsg(n,t)};if(e&&e.isLengthFinal()&&p.getBindingContext()){var C;const o=t.getTableColumnDataAndSetSubtile(u,p,d,e,a,f,i);h=o.oTargetTableInfo;if(o.subTitle){n.setSubtitle(o.subTitle)}n.setActiveTitle(!!h.oTableRowContext&&!((C=h.oTableRowContext)!==null&&C!==void 0&&C.isInactive()));if(h.oTableRowContext&&!h.oTableRowContext.isInactive()){this._formatMessageDescription(n,h.oTableRowContext,h.sTableTargetColName,p)}b=h.oTableRowContext&&h.oTableRowContext.getIndex();this._updateInternalModel(h.oTableRowContext,b,h.sTableTargetColProperty,p,u)}}else{n.setActiveTitle(true);const e=t.bIsOrphanElement(_,s);if(e){n.setSubtitle("");break}}}}else{_=s[0];p=this._getMdcTable(_);if(p){h={};h.tableHeader=p.getHeader();const e=this._getTableColumnIndex(_);h.sTableTargetColProperty=e>-1?p.getColumns()[e].getDataProperty():undefined;h.sTableTargetColName=h.sTableTargetColProperty&&e>-1?p.getColumns()[e].getHeader():undefined;m=this._getTableRow(_).isA("sap.ui.table.CreationRow");if(!m){b=this._getTableRowIndex(_);h.oTableRowBindingContexts=p.getRowBinding().getCurrentContexts();h.oTableRowContext=h.oTableRowBindingContexts[b]}const i=t.getMessageSubtitle(u,h.oTableRowBindingContexts,h.oTableRowContext,h.sTableTargetColName,p,m,e===0&&_.getValueState()==="Error"?_:undefined);if(i){n.setSubtitle(i)}n.setActiveTitle(true);this._updateInternalModel(h.oTableRowContext,b,h.sTableTargetColProperty,p,u,m)}}if(f){const e=t.createSectionGroupName(i,o,r,h,l);n.setGroupName(e);const s=this._getViewId(this.getId());const a=c.byId(s);const g=u.getTargets()[0]&&u.getTargets()[0].split("/").pop();const f=a===null||a===void 0?void 0:a.getModel("internal");if(f&&f.getProperty("/messageTargetProperty")&&g&&g===f.getProperty("/messageTargetProperty")){this.oMessagePopover.fireActiveTitlePress({item:n});f.setProperty("/messageTargetProperty",false)}}this.oItemBinding.attachChange(this._setMessageData,this);return _};l._checkControlIdInSections=function e(n,i){let o,s,r,a,g,l;this.sGeneralGroupText=this.sGeneralGroupText?this.sGeneralGroupText:c.getLibraryResourceBundle("sap.fe.core").getText("T_MESSAGE_BUTTON_SAPFE_MESSAGE_GROUP_GENERAL");const u=t.getVisibleSectionsFromObjectPageLayout(this.oObjectPageLayout);if(u){var f;const e=this._getViewId(this.getId());const T=c.byId(e);const b=T===null||T===void 0?void 0:(f=T.getBindingContext("internal"))===null||f===void 0?void 0:f.getProperty("sActionName");if(b){(T===null||T===void 0?void 0:T.getBindingContext("internal")).setProperty("sActionName",null)}for(a=n.length-1;a>=0;--a){r=n[a];let e=true;for(g=u.length-1;g>=0;--g){let n=false;o=u[g];s=o.getSubSections();for(l=s.length-1;l>=0;--l){var d,p;const i=s[l];const a=(d=r)===null||d===void 0?void 0:(p=d.getBindingContext("message"))===null||p===void 0?void 0:p.getObject();const g=t.getControlFromMessageRelatingToSubSection(i,a);if(g.length>0){const t=this._computeMessageGroupAndSubTitle(r,o,i,g,s.length>1,b);e=false;if(t&&!t.isA("sap.m.Table")&&!t.isA("sap.ui.table.Table")){n=true;break}}}if(n){break}}if(e){var h;const e=(h=r.getBindingContext("message"))===null||h===void 0?void 0:h.getObject();r.setActiveTitle(false);if(e.persistent&&b){this._setGroupLabelForTransientMsg(r,b)}else{r.setGroupName(this.sGeneralGroupText)}}if(!i&&r.getGroupName()===this.sGeneralGroupText&&this._findTargetForMessage(r)){return true}}}};l._findTargetForMessage=function e(t){const n=t.getBindingContext("message")&&t.getBindingContext("message").getObject();if(n&&n.target){const e=this.oObjectPageLayout&&this.oObjectPageLayout.getModel()&&this.oObjectPageLayout.getModel().getMetaModel(),t=e&&e.getMetaPath(n.target),i=e&&e.getObject(t);if(i&&i.$kind==="Property"){return true}}};l._fnEnableBindings=function e(t){for(let e=0;e<t.length;e++){const i=t[e];let o=false;const s=i.getSubSections();for(let e=0;e<s.length;e++){const t=s[e];let i=t.getBlocks();if(i){if(i.length===0){t.connectToModels();t.setBindingContext(undefined);i=t.getBlocks()}for(let e=0;e<t.getBlocks().length;e++){var n;if(i[e].getContent&&!((n=i[e].getContent())!==null&&n!==void 0&&n.isA("sap.fe.macros.table.TableAPI"))){o=true;break}}if(o){t.setBindingContext(undefined)}}if(t.getBindingContext()){this._findMessageGroupAfterRebinding();t.getBindingContext().getBinding().attachDataReceived(this._findMessageGroupAfterRebinding.bind(this))}}}};l._findMessageGroupAfterRebinding=function e(){const t=this.oMessagePopover.getItems();this._checkControlIdInSections(t,true)};l._getViewId=function e(t){let n,i=c.byId(t);while(i){if(i instanceof f){n=i.getId();break}i=i.getParent()}return n};l._setLongtextUrlDescription=function t(n,i){this.oMessagePopover.setAsyncDescriptionHandler(function(t){const o=n;const s=t.item.getLongtextUrl();if(s){jQuery.ajax({type:"GET",url:s,success:function(e){const n=i.getHtmlText()+e;t.item.setDescription(`${o}${n}`);t.promise.resolve()},error:function(){t.item.setDescription(n);const i=`A request has failed for long text data. URL: ${s}`;e.error(i);t.promise.reject(i)}})}})};l._formatMessageDescription=function e(n,i,o,s){var r;const a=E(s);const l=s.getParent().getIdentifierColumn();let c="";const u=(r=n.getBindingContext("message"))===null||r===void 0?void 0:r.getObject();const f=t.fetchColumnInfo(u,s);if(o){c=`${a.getText("T_MESSAGE_GROUP_DESCRIPTION_TABLE_COLUMN")}: ${o}`}else if(f){if(f.availability==="Hidden"){if(n.getType()==="Error"){c=l?`${a.getText("T_COLUMN_AVAILABLE_DIAGNOSIS_MSGDESC_ERROR")} ${i.getValue(l)}`+".":`${a.getText("T_COLUMN_AVAILABLE_DIAGNOSIS_MSGDESC_ERROR")}`+"."}else{c=l?`${a.getText("T_COLUMN_AVAILABLE_DIAGNOSIS_MSGDESC")} ${i.getValue(l)}`+".":`${a.getText("T_COLUMN_AVAILABLE_DIAGNOSIS_MSGDESC")}`+"."}}else{if(!this._navigationConfigured(s)){n.setActiveTitle(false)}c=`${a.getText("T_MESSAGE_GROUP_DESCRIPTION_TABLE_COLUMN")}: ${f.label} (${a.getText("T_COLUMN_INDICATOR_IN_TABLE_DEFINITION")})`}}const d=new g({htmlText:`<html><body><strong>${a.getText("T_FIELDS_AFFECTED_TITLE")}</strong></body></html><br>`});let p;if(l){p=`${d.getHtmlText()}<br>${a.getText("T_MESSAGE_GROUP_TITLE_TABLE_DENOMINATOR")}: ${s.getHeader()}<br>${a.getText("T_MESSAGE_GROUP_DESCRIPTION_TABLE_ROW")}: ${this.escape(i.getValue(l))}<br>${c}<br>`}else if(c==""||!c){p=""}else{p=`${d.getHtmlText()}<br>${a.getText("T_MESSAGE_GROUP_TITLE_TABLE_DENOMINATOR")}: ${s.getHeader()}<br>${c}<br>`}const h=new g({htmlText:`<html><body><strong>${a.getText("T_DIAGNOSIS_TITLE")}</strong></body></html><br>`});const T=n.getBindingContext("message").getObject().description;n.setDescription(null);let b="";let _="";if(n.getLongtextUrl()){_=`${p}<br>`;this._setLongtextUrlDescription(_,h)}else if(T){b=`${h.getHtmlText()}<br>${T}`;_=`${p}<br>${b}`;n.setDescription(_)}else{n.setDescription(p)}};l._setMessageData=function t(){clearTimeout(this._setMessageDataTimeout);this._setMessageDataTimeout=setTimeout(async()=>{const t="",n=this.oMessagePopover.getItems(),i={Error:0,Warning:0,Success:0,Information:0},o=c.getLibraryResourceBundle("sap.fe.core"),s=n.length;let r=y.Default,a="",g="",l="";if(s>0){for(let e=0;e<s;e++){if(!n[e].getType()||n[e].getType()===""){++i["Information"]}else{++i[n[e].getType()]}}if(i[v.Error]>0){r=y.Negative}else if(i[v.Warning]>0){r=y.Critical}else if(i[v.Success]>0){r=y.Success}else if(i[v.Information]>0){r=y.Neutral}const u=i[v.Error]+i[v.Warning]+i[v.Success]+i[v.Information];this.setText(u.toString());if(i.Error===1){a="C_COMMON_SAPFE_ERROR_MESSAGES_PAGE_TITLE_ERROR"}else if(i.Error>1){a="C_COMMON_SAPFE_ERROR_MESSAGES_PAGE_MULTIPLE_ERROR_TOOLTIP"}else if(!i.Error&&i.Warning){a="C_COMMON_SAPFE_ERROR_MESSAGES_PAGE_WARNING_TOOLTIP"}else if(!i.Error&&!i.Warning&&i.Information){a="C_MESSAGE_HANDLING_SAPFE_ERROR_MESSAGES_PAGE_TITLE_INFO"}else if(!i.Error&&!i.Warning&&!i.Information&&i.Success){a="C_MESSAGE_HANDLING_SAPFE_ERROR_MESSAGES_PAGE_TITLE_SUCCESS"}if(a){l=o.getText(a);g=i.Error?`${i.Error} ${l}`:l;this.setTooltip(g)}this.setIcon(t);this.setType(r);this.setVisible(true);const f=c.byId(this.sViewId);if(f){const t=f.getController().pageReady;try{await t.waitPageReady();await this._applyGroupingAsync(f)}catch(t){e.error("fail grouping messages")}this.fireMessageChange({iMessageLength:s})}if(s>1){this.oMessagePopover.navigateBack()}}else{this.setVisible(false);this.fireMessageChange({iMessageLength:s})}},100)};l._activeTitlePress=async function t(n){var i;const o=this.getBindingContext("pageInternal");o.setProperty("errorNavigationSectionFlag",true);const s=n.getParameter("item"),r=s===null||s===void 0?void 0:(i=s.getBindingContext("message"))===null||i===void 0?void 0:i.getObject(),a=new RegExp("^/").test(r.getTargets()[0]),g=c.byId(this.sViewId);if(!s){return}let l,u;const f=function(e,t){const n={preventScroll:true,targetInfo:e};t.focus(n)};if(s.getGroupName().includes("Table:")){let t;if(a){t=r.controlIds.map(function(e){const t=c.byId(e);const n=t&&t.getParent();return n&&n.isA("sap.ui.mdc.Table")&&n.getHeader()===s.getGroupName().split(", Table: ")[1]?n:null}).reduce(function(e,t){return t?t:e});if(t){u=s.getGroupName().split(", ")[0];try{var d;await this._navigateFromMessageToSectionTableInIconTabBarMode(t,this.oObjectPageLayout,u);const n=this._getTableRefErrorContext(t);const i=n.getProperty((d=s.getBindingContext("message"))===null||d===void 0?void 0:d.getObject().getId());const o=async(e,t)=>{const n=this._getMdcTableRows(e),i=this._getGridTable(e).getFirstVisibleRow();if(n.length>0&&n[0]){const o=n[t-i],s=this.getTargetCell(o,r);if(s){this.setFocusToControl(s);return undefined}else{const t=r.getTargets()[0].split("/").pop();if(t){g.getModel("internal").setProperty("/messageTargetProperty",t)}if(this._navigationConfigured(e)){return g.getController()._routing.navigateForwardToContext(o.getBindingContext())}else{return false}}}return undefined};if(t.data("tableType")==="GridTable"&&i.rowIndex!==""){const n=this._getGridTable(t).getFirstVisibleRow();try{await t.scrollToIndex(i.rowIndex);const e=this._getMdcTableRows(t);let s,a;if(e.length>0&&e[0]){s=e[0].getParent().getFirstVisibleRow();a=n-s!==0}let g;if(a){g=new Promise(function(e){c.attachEvent("UIUpdated",e)})}else{g=Promise.resolve()}await g;setTimeout(async function(){const e=await o(t,i.rowIndex);if(e===false){f(r,t)}},0)}catch(t){e.error("Error while focusing on error")}}else if(t.data("tableType")==="ResponsiveTable"&&i){const e=await this.focusOnMessageTargetControl(g,r,t,i.rowIndex);if(e===false){f(r,t)}}else{this.focusOnMessageTargetControl(g,r)}}catch(t){e.error("Fail to navigate to Error control")}}}else{l=c.byId(r.controlIds[0]);const e=c.byId(this.oObjectPageLayout.getSelectedSection());if((e===null||e===void 0?void 0:e.findElements(true).indexOf(l))===-1){u=s.getGroupName().split(", ")[0];this._navigateFromMessageToSectionInIconTabBarMode(this.oObjectPageLayout,u)}this.setFocusToControl(l)}}else{u=s.getGroupName().split(", ")[0];this._navigateFromMessageToSectionInIconTabBarMode(this.oObjectPageLayout,u);this.focusOnMessageTargetControl(g,r)}};l.getTargetCell=function e(t,n){return n.getControlIds().length>0?n.getControlIds().map(function(e){const n=t.findElements(true,function(t){return t.getId()===e});return n.length>0?c.byId(e):null}).reduce(function(e,t){return t?t:e}):null};l.focusOnMessageTargetControl=async function e(t,n,i,o){const s=t.findElements(true);const a=n.getControlIds().filter(function(e){return s.some(function(t){return t.getId()===e&&t.getDomRef()})}).map(function(e){return c.byId(e)});const g=a.filter(function(e){return!e.isA("sap.m.Table")&&!e.isA("sap.ui.table.Table")});if(g.length>0){this.setFocusToControl(g[0]);return undefined}else if(a.length>0){const e=i?i.findElements(true,e=>{var t;return e.isA(r.getMetadata().getName())&&((t=e.getParent())===null||t===void 0?void 0:t.getParent())===i}):[];if(e.length>0&&e[0]){const s=e[o];const r=this.getTargetCell(s,n);if(r){const e=r.isA("sap.fe.macros.field.FieldAPI")?r.getContent().getContentEdit()[0]:r.getItems()[0].getContent().getContentEdit()[0];this.setFocusToControl(e);return undefined}else{const e=n.getTargets()[0].split("/").pop();if(e){t.getModel("internal").setProperty("/messageTargetProperty",e)}if(this._navigationConfigured(i)){return t.getController()._routing.navigateForwardToContext(s.getBindingContext())}else{return false}}}return undefined}return undefined};l._getMessageRank=function e(t,n){if(n){let e,i,o,s,r,a,g,l;for(s=n.length-1;s>=0;--s){e=n[s];i=e.getSubSections();for(r=i.length-1;r>=0;--r){o=i[r];g=o.findElements(true);a=g.filter(this._fnFilterUponId.bind(this,t.getControlId()));l=s+1;if(a.length>0){if(e.getVisible()&&o.getVisible()){if(!t.hasOwnProperty("sectionName")){t.sectionName=e.getTitle()}if(!t.hasOwnProperty("subSectionName")){t.subSectionName=o.getTitle()}return l*10+(r+1)}else{return 1}}}}if(!t.sectionName&&!t.subSectionName&&t.persistent){return 1}return 999}return 999};l._applyFiltersAndSort=function e(){let t,n,i,o,s,r,g=null;const l=[];const u=()=>{const e=e=>{let t=Infinity,n=c.byId(e[0]);const i=c.byId(e[0]);while(n){const e=n instanceof a?(i===null||i===void 0?void 0:i.getParent()).findElements(true).indexOf(i):Infinity;if(n instanceof a){if(t>e){t=e;this.setFocusToControl(i)}return false}n=n.getParent()}return true};return new d({path:"controlIds",test:e,caseSensitive:true})};function f(){const e=function(e){if(!e.length){return false}let t=c.byId(e[0]);while(t){if(t.getId()===T){return true}if(t instanceof a){return false}t=t.getParent()}return false};return new d({path:"controlIds",test:e,caseSensitive:true})}if(!this.sViewId){this.sViewId=this._getViewId(this.getId())}const T=this.sViewId;const b=this.getAggregation("customFilters");if(b){b.forEach(function(e){l.push(new d({path:e.getProperty("path"),operator:e.getProperty("operator"),value1:e.getProperty("value1"),value2:e.getProperty("value2")}))})}const _=this.getBindingContext();if(!_){this.setVisible(false);return}else{o=_.getPath();t=new d({filters:[new d({path:"validation",operator:p.EQ,value1:true}),f()],and:true});n=new d({filters:[t,new d({path:"target",operator:p.StartsWith,value1:o})],and:false});r=new d({filters:[u()]})}const m=new d({filters:[n,r],and:true});if(l.length>0){i=new d({filters:[l,m],and:false})}else{i=m}this.oItemBinding.filter(i);this.oObjectPageLayout=this._getObjectPageLayout(this,this.oObjectPageLayout);if(this.oObjectPageLayout){s=new h("",null,null,(e,t)=>{if(!g){g=this.oObjectPageLayout&&this.oObjectPageLayout.getSections()}const n=this._getMessageRank(e,g);const i=this._getMessageRank(t,g);if(n<i){return-1}if(n>i){return 1}return 0});this.oItemBinding.sort(s)}};l._fnFilterUponId=function e(t,n){return t===n.getId()};l._getSectionBySectionTitle=function e(t,n){let i;if(n){const e=t.getSections();for(let t=0;t<e.length;t++){if(e[t].getVisible()&&e[t].getTitle()===n){i=e[t];break}}}return i};l._navigateFromMessageToSectionInIconTabBarMode=function e(t,n){const i=t.getUseIconTabBar();if(i){const e=this._getSectionBySectionTitle(t,n);const i=t.getSelectedSection();if(e&&i!==e.getId()){t.setSelectedSection(e.getId())}}};l._navigateFromMessageToSectionTableInIconTabBarMode=async function e(t,n,i){const o=t.getRowBinding();const s=t.getBindingContext();const r=n.getBindingContext();const a=!(s===r);this._navigateFromMessageToSectionInIconTabBarMode(n,i);return new Promise(function(e){if(a){o.attachEventOnce("change",function(){e()})}else{e()}})};l._getMdcTable=function e(t){let n=t.getParent();while(n&&!n.isA("sap.ui.mdc.Table")){n=n.getParent()}return n&&n.isA("sap.ui.mdc.Table")?n:undefined};l._getGridTable=function e(t){return t.findElements(true,function(e){return e.isA("sap.ui.table.Table")&&e.getParent()===t})[0]};l._getTableRow=function e(t){let n=t.getParent();while(n&&!n.isA("sap.ui.table.Row")&&!n.isA("sap.ui.table.CreationRow")&&!n.isA(r.getMetadata().getName())){n=n.getParent()}return n&&(n.isA("sap.ui.table.Row")||n.isA("sap.ui.table.CreationRow")||n.isA(r.getMetadata().getName()))?n:undefined};l._getTableRowIndex=function e(t){const n=this._getTableRow(t);let i;if(n.isA("sap.ui.table.Row")){i=n.getIndex()}else{i=n.getTable().getItems().findIndex(function(e){return e.getId()===n.getId()})}return i};l._getTableColumnIndex=function e(t){const n=function(e,t){return t.getCells().findIndex(function(t){return t.getId()===e.getId()})};const i=function(e,t){let i=e.getParent(),o=n(i,t);while(i&&o<0){i=i.getParent();o=n(i,t)}return o};const o=this._getTableRow(t);let s;s=i(t,o);if(o.isA("sap.ui.table.CreationRow")){const e=o.getCells()[s].getId(),t=o.getTable().getColumns();s=t.findIndex(function(t){if(t.getCreationTemplate()){return e.search(t.getCreationTemplate().getId())>-1?true:false}else{return false}})}return s};l._getMdcTableRows=function e(t){return t.findElements(true,function(e){return e.isA("sap.ui.table.Row")&&e.getTable().getParent()===t})};l._getObjectPageLayout=function e(t,n){if(n){return n}n=t;while(n&&!n.isA("sap.uxap.ObjectPageLayout")){n=n.getParent()}return n};l._navigationConfigured=function e(t){const n=sap.ui.require("sap/ui/core/Component"),i=t&&n.getOwnerComponentFor(t)&&n.getOwnerComponentFor(t).getNavigation();let o=false,s=false;if(i&&Object.keys(i).includes(t.getRowBinding().sPath)){o=i[t===null||t===void 0?void 0:t.getRowBinding().sPath]&&i[t===null||t===void 0?void 0:t.getRowBinding().sPath].detail&&i[t===null||t===void 0?void 0:t.getRowBinding().sPath].detail.route?true:false}s=o&&(t===null||t===void 0?void 0:t.getRowSettings().getRowActions())&&(t===null||t===void 0?void 0:t.getRowSettings().getRowActions()[0].mProperties.type.indexOf("Navigation"))!==-1;return s};l.setFocusToControl=function t(n){const i=this.oMessagePopover;if(i&&n&&n.focus){const e=()=>{n.focus()};if(!i.isOpen()){setTimeout(e,0)}else{const t=()=>{setTimeout(e,0);i.detachEvent("afterClose",t)};i.attachEvent("afterClose",t);i.close()}}else{e.warning("FE V4 : MessageButton : element doesn't have focus method for focusing.")}};l.escape=function e(t){return String(t).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};return i}(s),C=B(I.prototype,"customFilters",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),P=B(I.prototype,"messageChange",[_],{configurable:true,enumerable:true,writable:true,initializer:null}),I))||m);return G},false);
//# sourceMappingURL=MessageButton.js.map