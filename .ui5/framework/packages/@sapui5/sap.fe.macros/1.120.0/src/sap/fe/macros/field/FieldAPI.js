/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/controllerextensions/collaboration/ActivitySync","sap/fe/core/controllerextensions/collaboration/CollaborationCommon","sap/fe/core/helpers/ClassSupport","sap/ui/core/Core","sap/ui/core/message/Message","../MacroAPI"],function(e,t,i,n,r,o){"use strict";var a,l,s,u,c,d,p,f,g,b,h,y,v,m,F,P,I,A,C,w,O,M,z,L,B,E,x,j,R,S,G,D,T;var V=i.xmlEventHandler;var k=i.property;var H=i.event;var W=i.defineUI5Class;var _=i.association;var N=t.CollaborationFieldGroupPrefix;var q=t.Activity;function U(e,t,i,n){if(!i)return;Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function $(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function J(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;K(e,t)}function K(e,t){K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,i){t.__proto__=i;return t};return K(e,t)}function Q(e,t,i,n,r){var o={};Object.keys(n).forEach(function(e){o[e]=n[e]});o.enumerable=!!o.enumerable;o.configurable=!!o.configurable;if("value"in o||o.initializer){o.writable=true}o=i.slice().reverse().reduce(function(i,n){return n(e,t,i)||i},o);if(r&&o.initializer!==void 0){o.value=o.initializer?o.initializer.call(r):void 0;o.initializer=undefined}if(o.initializer===void 0){Object.defineProperty(e,t,o);o=null}return o}function X(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}function Y(e){if(e.isA("sap.fe.macros.controls.FieldWrapper")){const t=e;const i=t.getEditMode()==="Display"?[t.getContentDisplay()]:t.getContentEdit();if(i.length>=1){return i.length?i[0]:undefined}}else{return e}return undefined}let Z=(a=W("sap.fe.macros.field.FieldAPI",{returnTypes:["sap.fe.core.controls.FormElementWrapper"]}),l=k({type:"boolean"}),s=k({type:"boolean"}),u=k({type:"string"}),c=k({type:"string",expectedAnnotations:[],expectedTypes:["EntitySet","EntityType","Singleton","NavigationProperty","Property"]}),d=k({type:"string",expectedTypes:["EntitySet","EntityType","Singleton","NavigationProperty"]}),p=H(),f=H(),g=_({type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}),b=k({type:"boolean"}),h=k({type:"sap.fe.macros.FieldFormatOptions"}),y=k({type:"string"}),v=k({type:"boolean"}),m=k({type:"boolean"}),F=k({type:"string"}),P=V(),I=V(),a(A=(C=function(t){J(i,t);function i(){var e;for(var i=arguments.length,n=new Array(i),r=0;r<i;r++){n[r]=arguments[r]}e=t.call(this,...n)||this;U(e,"editable",w,$(e));U(e,"readOnly",O,$(e));U(e,"id",M,$(e));U(e,"metaPath",z,$(e));U(e,"contextPath",L,$(e));U(e,"change",B,$(e));U(e,"liveChange",E,$(e));U(e,"ariaLabelledBy",x,$(e));U(e,"required",j,$(e));U(e,"formatOptions",R,$(e));U(e,"semanticObject",S,$(e));U(e,"collaborationEnabled",G,$(e));U(e,"visible",D,$(e));U(e,"mainPropertyRelativePath",T,$(e));e.focusHandlersAttached=false;return e}var o=i.prototype;o.handleChange=function e(t){this.fireChange({value:this.getValue(),isValid:t.getParameter("valid")})};o.handleLiveChange=function e(t){this.fireEvent("liveChange")};i.getAPI=function e(i){return t.getAPI.call(this,i,"sap.fe.macros.field.FieldAPI")};o.onBeforeRendering=function e(){const t=function(e){return e.isA(["sap.m.Button","sap.fe.macros.controls.FieldWrapper","sap.ui.mdc.Field","sap.fe.macros.controls.FileWrapper"])};const i=this.content;if(i&&t(i)&&i.addAriaLabelledBy){const e=this.getAriaLabelledBy();for(let t=0;t<e.length;t++){const n=e[t];const r=i.getAriaLabelledBy()||[];if(r.indexOf(n)===-1){i.addAriaLabelledBy(n)}}}};i.getLastFocusId=function e(){return i.lastFocusId};i.getLastFocusFieldGroups=function e(){return i.lastFocusFieldGroups};i.setLastFocusInformation=function e(t){i.lastFocusId=t===null||t===void 0?void 0:t.getId();i.lastFocusFieldGroups=t===null||t===void 0?void 0:t.getFieldGroupIds().join(",")};o.getCollaborationPath=function e(){const t=this.getBindingContext();if(!this.mainPropertyRelativePath||!t){return undefined}const i=this.content;if((i===null||i===void 0?void 0:i.getProperty("editMode"))!=="Editable"){return undefined}return`${t.getPath()}/${this.mainPropertyRelativePath}`};o.sendFocusInMessage=function t(){const i=this.getCollaborationPath();if(i){e.send(this,{action:q.Lock,content:i})}};o.sendFocusOutMessage=function t(){const i=this.getCollaborationPath();if(i){e.send(this,{action:q.Unlock,content:i})}};o.handleContentFocusIn=function e(t){var r;if(!((r=this.getDomRef())!==null&&r!==void 0&&r.contains(t.relatedTarget))){if(i.getLastFocusId()!=this.getId()&&i.getLastFocusFieldGroups()===this.getFieldGroupIds().join(",")){const e=n.byId(i.getLastFocusId());e===null||e===void 0?void 0:e.sendFocusOutMessage()}i.setLastFocusInformation(this);this.sendFocusInMessage()}};o.handleContentFocusOut=function e(t){const r=t.getParameter("fieldGroupIds");if(r.some(e=>e.startsWith(N))){const e=t.getSource();let r=n.byId(n.getCurrentFocusedControlId());while(r&&r!==e){r=r.getParent()}if(r!==e){this.sendFocusOutMessage();if(i.getLastFocusId()===this.getId()){i.setLastFocusInformation(undefined)}}}};o.onAfterRendering=function e(){if(this.collaborationEnabled&&!this.focusHandlersAttached){var t,i;(t=this.content)===null||t===void 0?void 0:t.addEventDelegate({onfocusin:this.handleContentFocusIn},this);(i=this.content)===null||i===void 0?void 0:i.attachValidateFieldGroup(this.handleContentFocusOut,this);this.focusHandlersAttached=true}};o.enhanceAccessibilityState=function e(t,i){const n=this.getParent();if(n&&n.enhanceAccessibilityState){n.enhanceAccessibilityState(t,i)}return i};o.getAccessibilityInfo=function e(){const t=this.content;return t&&t.getAccessibilityInfo?t.getAccessibilityInfo():{}};o.getIdForLabel=function e(){const t=this.content;return t.getIdForLabel()};o.getValue=function e(){var t,i,n,r;let o=Y(this.content);if(this.collaborationEnabled&&(t=o)!==null&&t!==void 0&&t.isA("sap.m.HBox")){o=o.getItems()[0]}if((i=o)!==null&&i!==void 0&&i.isA("sap.m.CheckBox")){return o.getSelected()}else if((n=o)!==null&&n!==void 0&&n.isA("sap.m.InputBase")){return o.getValue()}else if((r=o)!==null&&r!==void 0&&r.isA("sap.ui.mdc.Field")){return o.getValue()}else{throw"getting value not yet implemented for this field type"}};o.addMessage=function e(t){const i=this.getMessageManager();const n=Y(this.content);let o;if(n!==null&&n!==void 0&&n.isA("sap.m.CheckBox")){var a;o=(a=n.getBinding("selected"))===null||a===void 0?void 0:a.getResolvedPath()}else if(n!==null&&n!==void 0&&n.isA("sap.m.InputBase")){var l;o=(l=n.getBinding("value"))===null||l===void 0?void 0:l.getResolvedPath()}else if(n!==null&&n!==void 0&&n.isA("sap.ui.mdc.Field")){o=n.getBinding("value").getResolvedPath()}const s=new r({target:o,type:t.type,message:t.message,processor:n===null||n===void 0?void 0:n.getModel(),description:t.description,persistent:t.persistent});i.addMessages(s);return s.getId()};o.removeMessage=function e(t){const i=this.getMessageManager();const n=i.getMessageModel().getData();const r=n.find(e=>e.id===t);if(r){i.removeMessages(r)}};o.getMessageManager=function e(){return n.getMessageManager()};return i}(o),w=Q(C.prototype,"editable",[l],{configurable:true,enumerable:true,writable:true,initializer:null}),O=Q(C.prototype,"readOnly",[s],{configurable:true,enumerable:true,writable:true,initializer:null}),M=Q(C.prototype,"id",[u],{configurable:true,enumerable:true,writable:true,initializer:null}),z=Q(C.prototype,"metaPath",[c],{configurable:true,enumerable:true,writable:true,initializer:null}),L=Q(C.prototype,"contextPath",[d],{configurable:true,enumerable:true,writable:true,initializer:null}),B=Q(C.prototype,"change",[p],{configurable:true,enumerable:true,writable:true,initializer:null}),E=Q(C.prototype,"liveChange",[f],{configurable:true,enumerable:true,writable:true,initializer:null}),x=Q(C.prototype,"ariaLabelledBy",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),j=Q(C.prototype,"required",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),R=Q(C.prototype,"formatOptions",[h],{configurable:true,enumerable:true,writable:true,initializer:null}),S=Q(C.prototype,"semanticObject",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),G=Q(C.prototype,"collaborationEnabled",[v],{configurable:true,enumerable:true,writable:true,initializer:null}),D=Q(C.prototype,"visible",[m],{configurable:true,enumerable:true,writable:true,initializer:null}),T=Q(C.prototype,"mainPropertyRelativePath",[F],{configurable:true,enumerable:true,writable:true,initializer:null}),Q(C.prototype,"handleChange",[P],Object.getOwnPropertyDescriptor(C.prototype,"handleChange"),C.prototype),Q(C.prototype,"handleLiveChange",[I],Object.getOwnPropertyDescriptor(C.prototype,"handleLiveChange"),C.prototype),C))||A);return Z},false);
//# sourceMappingURL=FieldAPI.js.map