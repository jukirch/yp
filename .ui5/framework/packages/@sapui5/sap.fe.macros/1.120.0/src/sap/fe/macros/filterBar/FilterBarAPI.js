/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/deepClone","sap/base/util/merge","sap/fe/core/helpers/ClassSupport","sap/fe/core/helpers/DraftEditState","sap/fe/core/helpers/SemanticDateOperators","sap/fe/macros/filter/FilterUtils","sap/fe/macros/filterBar/adapter/SelectionVariantToStateFilters","sap/fe/macros/filterBar/adapter/StateFilterToSelectionVariant","sap/ui/mdc/p13n/StateUtil","../MacroAPI"],function(e,t,r,i,n,a,o,l,s,u,c){"use strict";var p,f,d,g,h,b,y,v,F,m,S,w,C,E,P,z,O,V,B,x,I,T,_,D,A,M,j,k,U,$,N,R,L;var H=i.xmlEventHandler;var W=i.property;var q=i.event;var J=i.defineUI5Class;var G=i.aggregation;function K(e,t,r,i){if(!r)return;Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(i):void 0})}function Q(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function X(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;Y(e,t)}function Y(e,t){Y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return Y(e,t)}function Z(e,t,r,i,n){var a={};Object.keys(i).forEach(function(e){a[e]=i[e]});a.enumerable=!!a.enumerable;a.configurable=!!a.configurable;if("value"in a||a.initializer){a.writable=true}a=r.slice().reverse().reduce(function(r,i){return i(e,t,r)||r},a);if(n&&a.initializer!==void 0){a.value=a.initializer?a.initializer.call(n):void 0;a.initializer=undefined}if(a.initializer===void 0){Object.defineProperty(e,t,a);a=null}return a}function ee(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}let te=(p=J("sap.fe.macros.filterBar.FilterBarAPI",{returnTypes:["sap.ui.core.Control"]}),f=W({type:"string"}),d=W({type:"string",expectedAnnotations:["com.sap.vocabularies.UI.v1.SelectionFields"],expectedTypes:["EntitySet","EntityType"]}),g=W({type:"string",expectedTypes:["EntitySet","EntityType","NavigationProperty"]}),h=W({type:"boolean",defaultValue:false}),b=W({type:"boolean",defaultValue:true}),y=W({type:"boolean",defaultValue:true}),v=W({type:"boolean",defaultValue:false}),F=G({type:"sap.fe.macros.FilterField",multiple:true}),m=q(),S=q(),w=q(),C=q(),E=q(),P=q(),z=H(),O=H(),p(V=(B=function(i){X(c,i);function c(){var e;for(var t=arguments.length,r=new Array(t),n=0;n<t;n++){r[n]=arguments[n]}e=i.call(this,...r)||this;K(e,"id",x,Q(e));K(e,"metaPath",I,Q(e));K(e,"contextPath",T,Q(e));K(e,"liveMode",_,Q(e));K(e,"visible",D,Q(e));K(e,"showMessages",A,Q(e));K(e,"showClearButton",M,Q(e));K(e,"filterFields",j,Q(e));K(e,"search",k,Q(e));K(e,"internalSearch",U,Q(e));K(e,"filterChanged",$,Q(e));K(e,"afterClear",N,Q(e));K(e,"internalFilterChanged",R,Q(e));K(e,"stateChange",L,Q(e));e.isSemanticDateFilterApplied=()=>a.hasSemanticDateOperations(e.content.getConditions(),false);return e}var p=c.prototype;p.handleSearch=function e(t){const i=t.getSource();const n=t.getParameters();if(i){const e=i.getFilterConditions();const t=this._prepareEventParameters(i);this.fireInternalSearch(r({conditions:e},n));this.fireSearch(t)}};p.handleFilterChanged=function e(t){const i=t.getSource();const n=t.getParameters();if(i){const e=i.getFilterConditions();const t=this._prepareEventParameters(i);this.fireInternalFilterChanged(r({conditions:e},n));this.fireFilterChanged(t)}};p._prepareEventParameters=function e(t){const{parameters:r,filters:i,search:n}=o.getFilters(t);return{parameters:r,filters:i,search:n}};p.setFilterValues=function e(t,r,i){if(arguments.length===2){i=r;return o.setFilterValues(this.content,t,i)}return o.setFilterValues(this.content,t,r,i)};p.getActiveFiltersText=function e(){var t;const r=this.content;return(r===null||r===void 0?void 0:(t=r.getAssignedFiltersText())===null||t===void 0?void 0:t.filtersText)||""};p.getFilters=function e(){return o.getFilters(this.content)};p.triggerSearch=async function t(){const r=this.content;try{if(r){await r.waitForInitialization();return await r.triggerSearch()}}catch(t){const r=t instanceof Error?t.message:String(t);e.error(`FE : Buildingblock : FilterBar : ${r}`);throw Error(r)}};p.getSelectionVariant=async function t(){try{const e=this.content;const t=await u.retrieveExternalState(e);const r=t.filter;const i=e.data("parameters");return s.getSelectionVariantFromConditions(r,e.getPropertyHelper(),i)}catch(t){const r=this.getId();const i=t instanceof Error?t.message:String(t);e.error(`FilterBar Building Block (${r}) - get selection variant failed : ${i}`);throw Error(i)}};p.getMandatoryFilterPropertyNames=function e(){const t=this.content;return t.getPropertyInfoSet().filter(function(e){return e.required}).map(function(e){return e.conditionPath})};p.setSelectionVariant=async function t(r){try{const e=this.content,t=await this.convertSelectionVariantToStateFilters(r);await this.clearFilterValues(e);const i=await this._getFilterBarSupportedFields(e);const n=l.getStateToApply(i,t);return await u.applyExternalState(e,n)}catch(t){const r=t instanceof Error?t.message:String(t);e.error(`FE : Buildingblock : FilterBar : ${r}`);throw Error(r)}};p.convertSelectionVariantToStateFilters=async function e(t){const r=this.content;const i=await this._getFilterBarSupportedFields(r);if(!i.length){throw new Error("No valid metadata properties present for filter bar")}const n=this._getFilterBarInfoForConversion();const a=l.getStateFiltersFromSV(t,n,i)||{};return a};p._getFilterBarInfoForConversion=function e(){var t;const r=this.content,i=(t=r.getModel())===null||t===void 0?void 0:t.getMetaModel(),n=r.data("entityType"),a=r.data("useSemanticDateRange")==="true"||r.data("useSemanticDateRange")===true,o=r.getModel("viewData"),l=o.getData(),s=l===null||l===void 0?void 0:l.controlConfiguration,u=s===null||s===void 0?void 0:s["@com.sap.vocabularies.UI.v1.SelectionFields"],c=u===null||u===void 0?void 0:u.filterFields;return{metaModel:i,contextPath:n,useSemanticDateRange:a,filterFieldsConfig:c}};p.getParameters=function e(){const t=this.content;const r=t.data("parameters");if(r){return Array.isArray(r)?r:JSON.parse(r)}return[]};p._getFilterBarSupportedFields=async function e(t){await t.waitForInitialization();return t.getControlDelegate().fetchProperties(t)};p.clearFilterValues=async function e(t){await this._clearFilterValuesWithOptions(t);this.fireEvent("afterClear")};p._clearFilterValuesWithOptions=async function e(r,i){var a;if(!r){return}const o=await u.retrieveExternalState(r);const l="$editState";const s=n.ALL.id;const c=t((a=o.filter[l])===null||a===void 0?void 0:a[0]);const p=(c===null||c===void 0?void 0:c.values[0])===s;const f=i&&Object.keys(i).length>0&&i.clearEditFilter;for(const e of Object.keys(o.filter)){if(!f&&e===l&&p){continue}for(const t of o.filter[e]){t.filtered=false}}await u.applyExternalState(r,{filter:o.filter});if(!f&&c&&!p){c.values=[s];await u.applyExternalState(r,{filter:{[l]:[c]}})}r.cleanUpAllFilterFieldsInErrorState()};return c}(c),x=Z(B.prototype,"id",[f],{configurable:true,enumerable:true,writable:true,initializer:null}),I=Z(B.prototype,"metaPath",[d],{configurable:true,enumerable:true,writable:true,initializer:null}),T=Z(B.prototype,"contextPath",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),_=Z(B.prototype,"liveMode",[h],{configurable:true,enumerable:true,writable:true,initializer:null}),D=Z(B.prototype,"visible",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),A=Z(B.prototype,"showMessages",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),M=Z(B.prototype,"showClearButton",[v],{configurable:true,enumerable:true,writable:true,initializer:null}),j=Z(B.prototype,"filterFields",[F],{configurable:true,enumerable:true,writable:true,initializer:null}),k=Z(B.prototype,"search",[m],{configurable:true,enumerable:true,writable:true,initializer:null}),U=Z(B.prototype,"internalSearch",[S],{configurable:true,enumerable:true,writable:true,initializer:null}),$=Z(B.prototype,"filterChanged",[w],{configurable:true,enumerable:true,writable:true,initializer:null}),N=Z(B.prototype,"afterClear",[C],{configurable:true,enumerable:true,writable:true,initializer:null}),R=Z(B.prototype,"internalFilterChanged",[E],{configurable:true,enumerable:true,writable:true,initializer:null}),L=Z(B.prototype,"stateChange",[P],{configurable:true,enumerable:true,writable:true,initializer:null}),Z(B.prototype,"handleSearch",[z],Object.getOwnPropertyDescriptor(B.prototype,"handleSearch"),B.prototype),Z(B.prototype,"handleFilterChanged",[O],Object.getOwnPropertyDescriptor(B.prototype,"handleFilterChanged"),B.prototype),B))||V);return te},false);
//# sourceMappingURL=FilterBarAPI.js.map