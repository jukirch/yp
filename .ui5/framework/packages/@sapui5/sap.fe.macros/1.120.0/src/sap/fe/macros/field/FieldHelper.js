/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/converters/helpers/Key","sap/fe/core/helpers/BindingHelper","sap/fe/core/helpers/BindingToolkit","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/StableIdHelper","sap/fe/core/templating/FieldControlHelper","sap/fe/core/templating/UIFormatters","sap/fe/macros/CommonHelper","sap/fe/macros/internal/valuehelp/ValueListHelper","sap/ui/base/ManagedObject","sap/ui/model/odata/v4/AnnotationHelper"],function(e,t,n,a,i,r,o,s,l,c,u,f,m){"use strict";var p=l.getAlignmentExpression;var g=s.isRequiredExpression;var d=o.generate;var v=i.or;var b=i.ifElse;var y=i.equal;var P=i.constant;var $=i.compileExpression;var h=a.UI;var O=n.KeyHelper;const T="@Org.OData.Measures.V1.ISOCurrency",F="@Org.OData.Measures.V1.Unit";const D={isNotAlwaysHidden:function(e,t){const n=t.context;let a=false;if(e.Value&&e.Value.$Path){a=n.getObject("Value/$Path@com.sap.vocabularies.UI.v1.Hidden")}if(!a||a.$Path){a=n.getObject("@com.sap.vocabularies.UI.v1.Hidden");if(!a||a.$Path){a=false}}return!a},isRequired:function(e,t){if(t==="Display"||t==="ReadOnly"||t==="Disabled"){return false}if(e){if(f.bindingParser(e)){return"{= %"+e+" === 7}"}else{return e=="com.sap.vocabularies.Common.v1.FieldControlType/Mandatory"}}return false},getActionParameterVisibility:function(e,t){if(typeof e==="object"){if(e&&e.$If&&e.$If.length===3){const n={$If:[]};n.$If[0]=e.$If[0];n.$If[1]=e.$If[2];n.$If[2]=e.$If[1];return m.value(n,t)}else{return"{= !%{"+e.$Path+"} }"}}else if(typeof e==="boolean"){return m.value(!e,t)}else{return undefined}},propertyName:function(e,t){let n;if(typeof e==="string"){if(t.context.getPath().indexOf("$Path")>-1||t.context.getPath().indexOf("$PropertyPath")>-1){n=e}}else if(e.$Path||e.$PropertyPath){const a=e.$Path?"/$Path":"/$PropertyPath";const i=t.context.getPath();n=t.context.getObject(`${i+a}/$@sapui.name`)}else if(e.Value&&e.Value.$Path){n=e.Value.$Path}else{n=t.context.getObject("@sapui.name")}return n},fieldControl:function(e,t){const n=t&&t.context.getModel();const a=t&&t.context.getPath();const i=n&&n.createBindingContext(`${a}@com.sap.vocabularies.Common.v1.FieldControl`);const r=i&&i.getProperty();if(r){if(r.hasOwnProperty("$EnumMember")){return r.$EnumMember}else if(r.hasOwnProperty("$Path")){return m.value(r,{context:i})}}else{return undefined}},valueHelpProperty:function(e,t){const n=e.getPath();const a=e.getObject()||{};let i=a.$Path?`${n}/$Path`:n;const r=`${i}@`;const o=e.getObject(r);let s;if(o){s=o.hasOwnProperty(T)&&T||o.hasOwnProperty(F)&&F;if(s&&!t){const t=`${i+s}/$Path`;if(e.getObject(t)){i=t}}}return i},valueHelpPropertyForFilterField:function(e){return D.valueHelpProperty(e,true)},getIDForFieldValueHelp:function(e,t,n,a){if(e){return e}let i=a;if(n!==a){i=`${n}::${a}`}return d([t,i])},getValueHelpPropertyForFilterField:function(e,n,a,i,r,o,s,l){const u=D.propertyName(n,{context:e}),f=l==="true"||l===true;const m=e.getModel(),p=e.getPath(),g=c.getLocationForPropertyPath(m,p),d=t.getFilterRestrictionsByPath(g,m);if((a==="Edm.DateTimeOffset"||a==="Edm.Date")&&f&&d&&d.FilterAllowedExpressions&&d.FilterAllowedExpressions[u]&&(d.FilterAllowedExpressions[u].includes("SingleRange")||d.FilterAllowedExpressions[u].includes("SingleValue"))||a==="Edm.Boolean"&&!s){return undefined}return D.getIDForFieldValueHelp(null,i||"FilterFieldValueHelp",r,o)},computeFieldBaseDelegate:function(e,t){if(t){return JSON.stringify({name:e,payload:{retrieveTextFromValueList:t}})}return`{name: '${e}'}`},_getPrimaryIntents:function(t){const n=[];if(t){const e=sap.ushell&&sap.ushell.Container;const a=e&&e.getService("CrossApplicationNavigation");t.forEach(function(e){if(typeof e==="string"){n.push(a.getPrimaryIntent(e,{}))}})}return Promise.all(n).then(function(e){return e}).catch(function(t){e.error("Error fetching primary intents",t);return[]})},_checkIfSemanticObjectsHasPrimaryAction:function(e,t,n){const a=function(e,t,n){for(const a in e.semanticObjectUnavailableActions[n].actions){if(t.intent.split("-")[1].indexOf(e.semanticObjectUnavailableActions[n].actions[a])===0){return false}}return true};e.semanticPrimaryActions=t;const i=e.semanticObjects&&e.mainSemanticObject&&e.semanticPrimaryActions[e.semanticObjects.indexOf(e.mainSemanticObject)];const r=n.getShellServices().getHash();if(e.mainSemanticObject&&!!i&&i.intent!==r){for(const t in e.semanticObjectUnavailableActions){if(e.mainSemanticObject.indexOf(e.semanticObjectUnavailableActions[t].semanticObject)===0){return a(e,i,t)}}return true}else{return false}},checkPrimaryActions:function(t,n,a){return this._getPrimaryIntents(t&&t.semanticObjects).then(e=>n?{titleLink:e,hasTitleLink:this._checkIfSemanticObjectsHasPrimaryAction(t,e,a),payload:t}:this._checkIfSemanticObjectsHasPrimaryAction(t,e,a)).catch(function(t){e.error("Error in checkPrimaryActions",t)})},_getTitleLinkWithParameters:function(e,t){if(e&&e.titlelink){return e.titlelink}else{return t}},getPrimaryAction:function(e){return e.semanticPrimaryActions[e.semanticObjects.indexOf(e.mainSemanticObject)].intent?D._getTitleLinkWithParameters(e,e.semanticPrimaryActions[e.semanticObjects.indexOf(e.mainSemanticObject)].intent):e.primaryIntentAction},operators:function(e,n,a,i,o){if(!n||!o){return undefined}let s;const l=D.propertyName(n,{context:e});const u=e.getModel(),f=e.getPath(),m=c.getLocationForPropertyPath(u,f),p=n.$Type;if(p==="Edm.Guid"){return t.getOperatorsForGuidProperty()}o=o.slice(0,-1);const g=o.lastIndexOf("/")>0;const d=g&&o!==m||!g&&m.lastIndexOf("/")>0;const v=d&&m.substr(m.indexOf(o)+o.length+1)||"";const b=d&&v+"/"+l||l;if(!g){if(!d){s=t.getOperatorsForProperty(l,m,u,p,a,i)}else{s=t.getOperatorsForProperty(b,o,u,p,a,i);if(s.length===0){s=t.getOperatorsForProperty(l,m,u,p,a,i)}}}else if(!d){var y;s=t.getOperatorsForProperty(b,o,u,p,a,i);if(s.length===0){s=t.getOperatorsForProperty(l,r.getEntitySetPath(o),u,p,a,i)}return((y=s)===null||y===void 0?void 0:y.length)>0?s.toString():undefined}else{s=t.getOperatorsForProperty(b,o,u,p,a,i);if(s.length===0){s=t.getOperatorsForProperty(b,r.getEntitySetPath(o),u,p,a,i)}}if((!s||s.length===0)&&(p==="Edm.Date"||p==="Edm.DateTimeOffset")){s=t.getOperatorsForDateProperty(p)}return s.length>0?s.toString():undefined},getDataFieldDefault:function(e){const t=e.getModel().getObject(`${e.getPath()}@com.sap.vocabularies.UI.v1.DataFieldDefault`);return t?`${e.getPath()}@com.sap.vocabularies.UI.v1.DataFieldDefault`:e.getPath()},isDataFieldActionButtonVisible:function(e,t,n,a){return t["@com.sap.vocabularies.UI.v1.Hidden"]!==true&&(n!==true||a!==false)},getPressEventForDataFieldActionButton:function(e,t){var n;let a="Isolated";if(t.InvocationGrouping&&t.InvocationGrouping.$EnumMember==="com.sap.vocabularies.UI.v1.OperationGroupingType/ChangeSet"){a="ChangeSet"}let i=e.navigateAfterAction;i=i==="false"?false:true;const r=e===null||e===void 0?void 0:(n=e.entitySet)===null||n===void 0?void 0:n.getPath().split("/");const o=r[r.length-1];const s={contexts:"${$source>/}.getBindingContext()",invocationGrouping:c.addSingleQuotes(a),model:"${$source>/}.getModel()",label:c.addSingleQuotes(t.Label,true),isNavigable:i,entitySetName:c.addSingleQuotes(o)};return c.generateFunction(".editFlow.invokeAction",c.addSingleQuotes(t.Action),c.objectToString(s))},isNumericDataType:function(e){const t=e;if(t!==undefined){const e=["Edm.Int16","Edm.Int32","Edm.Int64","Edm.Byte","Edm.SByte","Edm.Single","Edm.Decimal","Edm.Double"];return!e.includes(t)?false:true}else{return false}},isDateOrTimeDataType:function(e){if(e!==undefined){const t=["Edm.DateTimeOffset","Edm.DateTime","Edm.Date","Edm.TimeOfDay","Edm.Time"];return t.includes(e)}else{return false}},isDateTimeDataType:function(e){if(e!==undefined){const t=["Edm.DateTimeOffset","Edm.DateTime"];return t.includes(e)}else{return false}},isDateDataType:function(e){return e==="Edm.Date"},isTimeDataType:function(e){if(e!==undefined){const t=["Edm.TimeOfDay","Edm.Time"];return t.includes(e)}else{return false}},getDataTypeForVisualization:function(e,t){var n,a;const i="@com.sap.vocabularies.Common.v1.Text",r="@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement";return(e===null||e===void 0?void 0:(n=e[r])===null||n===void 0?void 0:n.$EnumMember)!=="com.sap.vocabularies.UI.v1.TextArrangementType/TextSeparate"&&e!==null&&e!==void 0&&(a=e[i])!==null&&a!==void 0&&a.$Path?"Edm.String":t},getColumnAlignment:function(e,t){const n=t.collection.sPath,a=t.collection.oModel;if((e["$Type"]==="com.sap.vocabularies.UI.v1.DataFieldForAction"||e["$Type"]==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation")&&e.Inline&&e.IconUrl){return"Center"}const i=a.getObject(`${n}/@com.sap.vocabularies.Common.v1.SemanticKey`);if(e["$Type"]==="com.sap.vocabularies.UI.v1.DataField"){const t=e.Value.$Path;const n=i&&!i.every(function(e){return e.$PropertyPath!==t});if(n){return"Begin"}}return D.getDataFieldAlignment(e,a,n)},getPropertyAlignment:function(e,t,n){let a="Begin";const i=t?t.textAlignMode:"";switch(i){case"Form":if(this.isNumericDataType(e)){a="Begin";if(n){a=p(n,"Begin","End")}}break;default:if(this.isNumericDataType(e)||this.isDateOrTimeDataType(e)){a="Right"}break}return a},getDataFieldAlignment:function(e,t,n,a,i){let r,o="Begin",s,l;if(e["$Type"]==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){r=e.Target.$AnnotationPath;if(e.Target["$AnnotationPath"]&&e.Target["$AnnotationPath"].indexOf("com.sap.vocabularies.UI.v1.FieldGroup")>=0){const e=t.getObject(`${n}/${r}`);for(let c=0;c<e.Data.length;c++){s=t.getObject(`${n}/${r}/Data/${c.toString()}/Value/$Path/$Type`);l=t.getObject(`${n}/${r}/Data/${c.toString()}/Value/$Path@`);s=this.getDataTypeForVisualization(l,s);o=this.getPropertyAlignment(s,a,i);if(o==="Begin"){break}}return o}else if(e.Target["$AnnotationPath"]&&e.Target["$AnnotationPath"].indexOf("com.sap.vocabularies.UI.v1.DataPoint")>=0&&t.getObject(`${n}/${r}/Visualization/$EnumMember`)==="com.sap.vocabularies.UI.v1.VisualizationType/Rating"){return o}else{s=t.getObject(`${n}/${r}/$Type`);if(s==="com.sap.vocabularies.UI.v1.DataPointType"){s=t.getObject(`${n}/${r}/Value/$Path/$Type`);l=t.getObject(`${n}/${r}/Value/$Path@`);s=this.getDataTypeForVisualization(l,s)}o=this.getPropertyAlignment(s,a,i)}}else{r=e.Value.$Path;s=t.getObject(`${n}/${r}/$Type`);l=t.getObject(`${n}/${r}@`);s=this.getDataTypeForVisualization(l,s);if(!(t.getObject(`${n}/`)["$Key"].indexOf(r)===0)){o=this.getPropertyAlignment(s,a,i)}}return o},isDataFieldActionButtonEnabled:function(e,t,n,a){if(t!==true){return"true"}return(n===null?"{= !${#"+e.Action+"} ? false : true }":n)?a:"true"},computeLabelText:function(e,t){const n=t.context.getModel();let a=t.context.getPath();if(a.endsWith("/")){a=a.slice(0,a.lastIndexOf("/"))}const i=n.getObject(`${a}/Label`);if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"||e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){return undefined}if(i){return i}else if(i===""){return""}let r;if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){if(e.Target.$AnnotationPath.indexOf("@com.sap.vocabularies.UI.v1.DataPoint")>-1||e.Target.$AnnotationPath.indexOf("@com.sap.vocabularies.UI.v1.Chart")>-1){r=n.getObject(`${a}/Target/$AnnotationPath@/Title`)}if(e.Target.$AnnotationPath.indexOf("@com.sap.vocabularies.Communication.v1.Contact")>-1){r=n.getObject(`${a}/Target/$AnnotationPath@/fn/$Path@com.sap.vocabularies.Common.v1.Label`)}}if(r){return r}let o;if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){o=n.getObject(`${a}/Target/$AnnotationPath@/Label`)}if(o){return o}const s=n.getObject(`${a}/Value/$Path@com.sap.vocabularies.Common.v1.Label`);if(s){return s}let l;if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){l=n.getObject(`${a}/Target/$AnnotationPath/Value/$Path@com.sap.vocabularies.Common.v1.Label`)}if(l){return l}return""},buildExpressionForAlignItems:function(e){const t=P(e);const n=P("com.sap.vocabularies.UI.v1.VisualizationType/Progress");const a=P("com.sap.vocabularies.UI.v1.VisualizationType/Rating");return $(b(v(y(t,n),y(t,a)),P("Center"),b(h.IsEditable,P("Center"),P("Stretch"))))},hasValueHelpAnnotation:function(e){if(e){return!!(e["@com.sap.vocabularies.Common.v1.ValueListReferences"]||e["@com.sap.vocabularies.Common.v1.ValueListMapping"]||e["@com.sap.vocabularies.Common.v1.ValueList"])}return false},getAPDialogDisplayFormat:function(e,n){let a;const i=n.context.getModel();const r=n.context.getPath();const o=e.$Name||n.context.getProperty(`${r}@sapui.name`);const s=i.getObject(`${r}@`);const l=s["@com.sap.vocabularies.Common.v1.ValueList"]||s["@com.sap.vocabularies.Common.v1.ValueListMapping"]||s["@com.sap.vocabularies.Common.v1.ValueListReferences"];const c=function(e){const t=e.Parameters.find(function(e){return e.LocalDataProperty&&e.LocalDataProperty.$PropertyPath===o});return t&&t.ValueListProperty};let u;if(s["@com.sap.vocabularies.Common.v1.TextArrangement"]||s["@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement"]){return t.computeDisplayMode(s,undefined)}else if(l){if(l.CollectionPath){u=c(l);if(!u){return"Value"}a=i.getObject(`/${l.CollectionPath}/${u}@`);return a&&a["@com.sap.vocabularies.Common.v1.Text"]?t.computeDisplayMode(a,undefined):"Value"}else{return i.requestValueListInfo(r,true).then(function(e){u=c(e[""]);if(!u){return"Value"}a=e[""].$model.getMetaModel().getObject(`/${e[""]["CollectionPath"]}/${u}@`);return a&&a["@com.sap.vocabularies.Common.v1.Text"]?t.computeDisplayMode(a,undefined):"Value"})}}else{return"Value"}},getActionParameterDialogValueHelp:function(e,t,n){return this.hasValueHelpAnnotation(e)?d([t,n]):undefined},getValueHelpDelegate:function(e,t,n,a){const i={name:c.addSingleQuotes("sap/fe/macros/valuehelp/ValueHelpDelegate"),payload:{propertyPath:c.addSingleQuotes(u.getPropertyPath({UnboundAction:!e,EntityTypePath:t,Action:n,Property:a})),qualifiers:{},valueHelpQualifier:c.addSingleQuotes(""),isActionParameterDialog:true}};return c.objectToString(i)},getValueHelpDelegateForNonComputedVisibleKeyField:function(e){const t={name:c.addSingleQuotes("sap/fe/macros/valuehelp/ValueHelpDelegate"),payload:{propertyPath:c.addSingleQuotes(e),qualifiers:{},valueHelpQualifier:c.addSingleQuotes("")}};return c.objectToString(t)},_getEntitySetFromMultiLevel:function(e,t,n,a,i){let r=t.split("/").filter(Boolean);r=r.filter(function(e){return e!=="$NavigationPropertyBinding"});if(r.length>0){for(let t=a;t<r.length-i;t++){n=`/${e.getObject(`${n}/$NavigationPropertyBinding/${r[t]}`)}`}}return n},getBindingInfoForTextArrangement:function(e,t,n){if(t&&t.$EnumMember&&t.$EnumMember==="com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly"&&n){return`{${n.Value.$Path}}`}return undefined},getPathForIconSource:function(e){return"{= FIELDRUNTIME.getIconForMimeType(%{"+e+"@odata.mediaContentType})}"},getFilenameExpr:function(e,t){if(e){if(e.indexOf("{")===0){return"{= $"+e+" ? $"+e+" : $"+t+"}"}return e}return t},calculateMBfromByte:function(e){return e?(e/(1024*1024)).toFixed(6):undefined},getDownloadUrl:function(e){return e+"{= ${internal>/stickySessionToken} ? ('?SAP-ContextId=' + ${internal>/stickySessionToken}) : '' }"},getMarginClass:function(e){return e==="true"||e===true?"sapMTableContentMargin":undefined},getRequired:function(e,t,n){let a=P(false);if(t!==null){a=g(t===null||t===void 0?void 0:t.targetObject)}return $(v(a,n.indexOf(e)>-1))},isFieldPartOfForm:function(e,t){const n=O.generateKeyFromDataField(t.targetObject);const a=e.find(e=>e.key===n);return a?true:false}};D.fieldControl.requiresIContext=true;D.getAPDialogDisplayFormat.requiresIContext=true;D.computeLabelText.requiresIContext=true;D.getActionParameterVisibility.requiresIContext=true;return D},false);
//# sourceMappingURL=FieldHelper.js.map