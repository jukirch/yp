/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/ObjectPath","sap/fe/core/CommonUtils","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/MetaModelFunction","sap/fe/core/templating/PropertyHelper","sap/fe/core/templating/UIFormatters","sap/m/table/Util","sap/ui/core/Fragment","sap/ui/core/util/XMLPreprocessor","sap/ui/core/XMLTemplateProcessor","sap/ui/dom/units/Rem","sap/ui/mdc/valuehelp/content/Conditions","sap/ui/mdc/valuehelp/content/MDCTable","sap/ui/mdc/valuehelp/content/MTable","sap/ui/model/json/JSONModel"],function(e,t,n,o,a,i,r,l,s,u,c,d,p,f,m,g){"use strict";var v={};var h=r.getTypeConfig;var P=r.getDisplayMode;var y=i.getAssociatedUnitProperty;var C=i.getAssociatedTimezoneProperty;var b=i.getAssociatedTextProperty;var I=i.getAssociatedCurrencyProperty;var $=a.isPropertyFilterable;var V=a.getSortRestrictionsInfo;var T=o.convertTypes;const L=(e,t)=>!e.some(e=>e.path===t);const M="@com.sap.vocabularies.Common.v1.Label",_="@com.sap.vocabularies.Common.v1.Text",O="@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement",F="com.sap.vocabularies.Common.v1.ValueListParameterIn",x="com.sap.vocabularies.Common.v1.ValueListParameterConstant",S="com.sap.vocabularies.Common.v1.ValueListParameterOut",H="com.sap.vocabularies.Common.v1.ValueListParameterInOut",D="@com.sap.vocabularies.Common.v1.ValueListWithFixedValues";v.AnnotationLabel=M;v.AnnotationValueListWithFixedValues=D;v.AnnotationValueListParameterInOut=H;v.AnnotationValueListParameterOut=S;v.AnnotationValueListParameterConstant=x;v.AnnotationValueListParameterIn=F;v.AnnotationTextUITextArrangement=O;v.AnnotationText=_;function A(e){let t;const n=e.$model.getMetaModel();const o=n.getObject(`/${e.CollectionPath}@`)||{};const a=V(o);const i=e.Parameters.find(function(t){return(t.$Type==="com.sap.vocabularies.Common.v1.ValueListParameterInOut"||t.$Type==="com.sap.vocabularies.Common.v1.ValueListParameterOut"||t.$Type==="com.sap.vocabularies.Common.v1.ValueListParameterDisplayOnly")&&!(n.getObject(`/${e.CollectionPath}/${t.ValueListProperty}@com.sap.vocabularies.UI.v1.Hidden`)===true)});if(i){if(n.getObject(`/${e.CollectionPath}/${i.ValueListProperty}@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement/$EnumMember`)==="com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly"){t=n.getObject(`/${e.CollectionPath}/${i.ValueListProperty}@com.sap.vocabularies.Common.v1.Text/$Path`)}else{t=i.ValueListProperty}}if(t&&(!a.propertyInfo[t]||a.propertyInfo[t].sortable)){return t}else{return undefined}}function U(e,t){const n=t.find(function(t){return e.ValueListProperty===t.textColumnName});if(e.ValueListProperty===(n===null||n===void 0?void 0:n.textColumnName)&&!n.keyColumnHidden&&n.keyColumnDisplayFormat!=="Value"){return true}return undefined}function w(e){return e.Parameters.some(function(e){return e["@com.sap.vocabularies.UI.v1.Importance"]&&e["@com.sap.vocabularies.UI.v1.Importance"].$EnumMember==="com.sap.vocabularies.UI.v1.ImportanceType/High"})}function j(e){const t=e.getModel("viewData");if(t){const e=t.getData();if(e){const t=e.columns;if(t){return t.reduce(function(e,t){if(t.path&&t.path.indexOf("/")===-1){e=e?`${e},${t.path}`:t.path}return e},undefined)}}}return undefined}function N(e,t){const o=n.computeDisplayMode(e,undefined);const a=e&&e["@com.sap.vocabularies.Common.v1.Text"];const i=a&&e["@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement"];if(t){return a&&typeof a!=="string"&&a.$Path?o:"Value"}else{return i?o:"Value"}}const E={getValueListCollectionEntitySet:function(e){const t=e.getObject();return t.$model.getMetaModel().createBindingContext(`/${t.CollectionPath}`)},getTableDelegate:function(e){let t=A(e);if(t){t=`'${t}'`}return"{name: 'sap/fe/macros/internal/valuehelp/TableDelegate', payload: {collectionName: '"+e.CollectionPath+"'"+(t?", defaultSortPropertyName: "+t:"")+"}}"},getSortConditionsFromPresentationVariant:function(e,t){if(e.PresentationVariantQualifier!==undefined){const n=e.PresentationVariantQualifier?`#${e.PresentationVariantQualifier}`:"",o=`/${e.CollectionPath}/@com.sap.vocabularies.UI.v1.PresentationVariant${n}`;const a=e.$model.getMetaModel().getObject(o);if(a!==null&&a!==void 0&&a.SortOrder){const e={sorters:[]};a.SortOrder.forEach(function(n){var o;const a={},i=n===null||n===void 0?void 0:(o=n.Property)===null||o===void 0?void 0:o.$PropertyPath;if(t){a.path=i}else{a.name=i}if(n.Descending){a.descending=true}else{a.ascending=true}e.sorters.push(a)});return t?`sorter: ${JSON.stringify(e.sorters)}`:JSON.stringify(e)}}return},getPropertyPath:function(e){return!e.UnboundAction?`${e.EntityTypePath}/${e.Action}/${e.Property}`:`/${e.Action.substring(e.Action.lastIndexOf(".")+1)}/${e.Property}`},getValueListProperty:function(e){const t=e.getModel();const n=t.getObject("/");return n.$model.getMetaModel().createBindingContext(`/${n.CollectionPath}/${e.getObject()}`)},getColumnVisibility:function(e,t,n){const o=n&&!!n.valueHelpWithFixedValues,a=n.columnInfo,i=!U(t,a.columnInfos),r=a.isDialogTable;if(o||!o&&r||!o&&!w(e)){const e=a.columnInfos.find(function(e){return t.ValueListProperty===e.columnName&&e.hasHiddenAnnotation===true});return!e?i:false}else if(!o&&w(e)){return t&&t["@com.sap.vocabularies.UI.v1.Importance"]&&t["@com.sap.vocabularies.UI.v1.Importance"].$EnumMember==="com.sap.vocabularies.UI.v1.ImportanceType/High"?true:false}return true},getColumnVisibilityInfo:function(e,t,n,o){const a=e.$model.getMetaModel();const i=[];const r={isDialogTable:o,columnInfos:i};e.Parameters.forEach(function(t){const o=a.getObject(`/${e.CollectionPath}/${t.ValueListProperty}@`);const i=o&&o["@com.sap.vocabularies.Common.v1.Text"];let l={};if(i){l={keyColumnHidden:o["@com.sap.vocabularies.UI.v1.Hidden"]?true:false,keyColumnDisplayFormat:i&&N(o,n),textColumnName:i&&i.$Path,columnName:t.ValueListProperty,hasHiddenAnnotation:o&&o["@com.sap.vocabularies.UI.v1.Hidden"]?true:false}}else if(o&&o["@com.sap.vocabularies.UI.v1.Hidden"]){l={columnName:t.ValueListProperty,hasHiddenAnnotation:o&&o["@com.sap.vocabularies.UI.v1.Hidden"]?true:false}}r.columnInfos.push(l)});return r},getTableItemsParameters:function(e,t,n,o){const a=[`path: '/${e.CollectionPath}'`];const i=j(this);if(t){const e=i?`, '${i}'`:"";a.push(`parameters: {$$sharedRequest: false, $$updateGroupId: "donotsubmit", $$groupId: '${t}'${e}}`)}else if(i){a.push(`parameters: {$$sharedRequest: false, $$updateGroupId: "donotsubmit", $select: '${i}'}`)}const r=e.Parameters.some(function(e){return n||e.$Type==="com.sap.vocabularies.Common.v1.ValueListParameterIn"});a.push(`suspended: ${r}`);if(!o){a.push("length: 10")}const l=E.getSortConditionsFromPresentationVariant(e,n);if(l){a.push(l)}else if(o){const t=A(e);if(t){a.push(`sorter: [{path: '${t}', ascending: true}]`)}}return"{"+a.join(", ")+"}"},hasImportance:function(e){return w(e.getObject())?"Importance/High":"None"},getMinScreenWidth:function(e){return w(e)?"{= ${_VHUI>/minScreenWidth}}":"416px"},getColumnWidth:function(o){var a,i,r,s,u,c,d,p;if(n.isSmallDevice())return;const f=o.targetObject;let m=[f];const g=b(f)||I(f)||y(f)||C(f),v=(a=f.annotations)===null||a===void 0?void 0:(i=a.Common)===null||i===void 0?void 0:i.Text,$=v===null||v===void 0?void 0:(r=v.annotations)===null||r===void 0?void 0:(s=r.UI)===null||s===void 0?void 0:(u=s.TextArrangement)===null||u===void 0?void 0:u.toString(),V=(c=f.annotations)===null||c===void 0?void 0:(d=c.Common)===null||d===void 0?void 0:(p=d.Label)===null||p===void 0?void 0:p.toString(),T=$&&P(o);if(g){if(T==="Description"){m=[g]}else if(!v||T&&T!=="Value"){m.push(g)}}let L=0;const M=[];m.forEach(e=>{const n=h(e,undefined);const o=t.get(n.type);if(o){M.push(new o(n.formatOptions,n.constraints))}});const _=l.calcColumnWidth(M,V);L=_?parseFloat(_.replace("rem","")):0;if(L===0){e.error(`Cannot compute the column width for property: ${f.name}`)}return L<=20?L.toString()+"rem":"20rem"},getOutParameterPaths:function(e){let t="";e.forEach(function(e){if(e.$Type.endsWith("Out")){t+=`{${e.ValueListProperty}}`}});return t},entityIsSearchable:function(e,t){var n,o;const a=(n=e["@com.sap.vocabularies.Common.v1.ValueList"])===null||n===void 0?void 0:n.SearchSupported,i=(o=t["@Org.OData.Capabilities.V1.SearchRestrictions"])===null||o===void 0?void 0:o.Searchable;if(i===undefined&&a===false||i===true&&a===false||i===false){return false}return true},_getConditionPath:function(e,t,n){const o=n.split("/");let a="",i;while(o.length){let n=o.shift();i=i?`${i}/${n}`:n;const r=e.getObject(`${t}/${i}`);if(r&&r.$kind==="NavigationProperty"&&r.$isCollection){n+="*"}a=a?`${a}/${n}`:n}return a},_getColumnDefinitionFromSelectionFields:function(e,t){const n=[],o=e.getObject(`${t}/@`),a=o["@com.sap.vocabularies.UI.v1.SelectionFields"];if(a){a.forEach(function(o){var a;const i=`${t}/${o.$PropertyPath}`,r=E._getConditionPath(e,t,o.$PropertyPath),l=e.getObject(`${i}@`),s={path:r,label:l[M]||i,sortable:true,filterable:$(e,t,o.$PropertyPath,false),$Type:(a=e.getObject(i))===null||a===void 0?void 0:a.$Type};n.push(s)})}return n},_mergeColumnDefinitionsFromProperties:function(e,t,n,o,a){var i;let r=n,l=o.$Type;const s=a[M]||r,u=a[_];if(u&&((i=a[O])===null||i===void 0?void 0:i.$EnumMember)==="com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly"){r=u.$Path;const e=`/${t.CollectionPath}/${r}`;l=t.$model.getMetaModel().getObject(e).$Type}if(L(e,r)){const t={path:r,label:s,sortable:true,filterable:!a["@com.sap.vocabularies.UI.v1.HiddenFilter"],$Type:l};e.push(t)}},filterInOutParameters:function(e,t){return e.filter(function(e){return t.includes(e.parmeterType)})},getInParameters:function(e){return E.filterInOutParameters(e,[F,x,H])},getOutParameters:function(e){return E.filterInOutParameters(e,[S,H])},createVHUIModel:function(e,t,n){const o=new g({}),a=n.getObject(`${t}@`);e.setModel(o,"_VHUI");o.setProperty("/hasValueListRelevantQualifiers",!!a["@com.sap.vocabularies.Common.v1.ValueListRelevantQualifiers"]);o.setProperty("/propertyLabel",a[M]);return o},_getDialogTitle:function(e,t){var n;const o=e.getModel("_VHUI").getProperty("/propertyLabel");const a=(n=e.getControl())===null||n===void 0?void 0:n.getProperty("label");return e.getModel("_VHUI").getProperty("/hasValueListRelevantQualifiers")?t||o||a:a||o||t},destroyVHContent:function(e){if(e.getDialog()){e.getDialog().destroyContent()}if(e.getTypeahead()){e.getTypeahead().destroyContent()}},putDefaultQualifierFirst:function(e){const t=e.indexOf("");if(t>0){e.unshift(e[t]);e.splice(t+1,1)}return e},_getContextPrefix:function(e,t){if(e&&e.getPath()){const n=e.getPath().split("/");if(t.length-n.length>1){const e=[];for(let o=n.length;o<t.length-1;o++){e.push(t[o])}return`${e.join("/")}/`}}return""},_getVhParameter:function(e,t,n,o,a,i){let r="";const l=t.getBindingContext();if(e&&e.length>0){var s;if((s=t.getParent())!==null&&s!==void 0&&s.isA("sap.ui.mdc.Table")&&l&&E._parameterIsA(o,["com.sap.vocabularies.Common.v1.ValueListParameterIn","com.sap.vocabularies.Common.v1.ValueListParameterInOut"])){const e=i.split("/");if(e.length>1){const n=e[0];const o=a.getMetaContext(l.getPath());const s=t.getParent().getRowBinding().getPath();if(o.getObject(`${s}/$Partner`)===n){r=i}}}if(!r){r=e+">/conditions/"+i}}else{r=n+i}return{parmeterType:o.$Type,source:r,helpPath:o.ValueListProperty,constantValue:o.Constant,initialValueFilterEmpty:Boolean(o.InitialValueIsSignificant)}},_parameterIsA(e,t){return t.includes(e.$Type)},_enrichPath:function(e,t,n,o,a,i){if(!e.key&&E._parameterIsA(o,["com.sap.vocabularies.Common.v1.ValueListParameterOut","com.sap.vocabularies.Common.v1.ValueListParameterInOut"])&&n===a){var r;e.fieldPropertyPath=t;e.key=o.ValueListProperty;e.descriptionPath=((r=i[_])===null||r===void 0?void 0:r.$Path)||""}},_enrichKeys:function(e,t){if(E._parameterIsA(t,["com.sap.vocabularies.Common.v1.ValueListParameterOut","com.sap.vocabularies.Common.v1.ValueListParameterIn","com.sap.vocabularies.Common.v1.ValueListParameterInOut"])&&!e.includes(t.ValueListProperty)){e.push(t.ValueListProperty)}},_processParameters:function(t,n,o,a,i,r,l){const s=t.$model.getMetaModel(),u=`/${t.CollectionPath}`,c=s.getObject(`${u}/`);if(c===undefined){e.error(`Inconsistent value help metadata: Entity ${u} is not defined`);return}const d=E._getColumnDefinitionFromSelectionFields(s,u),p=[],f=c.$Key?[...c.$Key]:[];const m={fieldPropertyPath:"",descriptionPath:"",key:""};for(const e of t.Parameters){var g;const l=`/${t.CollectionPath}/${e.ValueListProperty}`,u=s.getObject(l),c=s.getObject(`${l}@`)||{},v=((g=e.LocalDataProperty)===null||g===void 0?void 0:g.$PropertyPath)||"";if(u){E._enrichPath(m,l,v,e,n,c);const o=e.ValueListProperty;E._mergeColumnDefinitionsFromProperties(d,t,o,u,c)}if(E._parameterIsA(e,["com.sap.vocabularies.Common.v1.ValueListParameterIn","com.sap.vocabularies.Common.v1.ValueListParameterOut","com.sap.vocabularies.Common.v1.ValueListParameterInOut"])&&v!==n){const t=E._getVhParameter(o,a,i,e,r,v);p.push(t)}if(e.$Type===x){p.push({parmeterType:e.$Type,source:e.ValueListProperty,helpPath:e.ValueListProperty,constantValue:e.Constant,initialValueFilterEmpty:Boolean(e.InitialValueIsSignificant)})}E._enrichKeys(f,e)}for(const e of f){if(L(d,e)){var v;const n={path:e,$Type:(v=s.getObject(`/${t.CollectionPath}/${m.key}`))===null||v===void 0?void 0:v.$Type,label:"",sortable:false,filterable:undefined};d.push(n)}}const h={keyPath:m.key,descriptionPath:m.descriptionPath,fieldPropertyPath:m.fieldPropertyPath,vhKeys:f,vhParameters:p,valueListInfo:t,columnDefs:d,valueHelpQualifier:l};return h},_logError:function(t,n){const o=n?n.status:undefined;const a=n instanceof Error?n.message:String(n);const i=o===404?`Metadata not found (${o}) for value help of property ${t}`:a;e.error(i)},getValueListInfo:async function(e,t,n,o){const a=e.getBindingContext(),i=n.conditionModel,r=[],l=t.split("/");try{const s=await o.requestValueListInfo(t,true,a);const u=E.putDefaultQualifierFirst(Object.keys(s)),c=l.pop();const d=n.useMultiValueField?E._getContextPrefix(a,l):"";for(const t of u){const n=s[t];const a=E._processParameters(n,c,i,e,d,o,n.$qualifier??t);if(a){r.push(a)}}}catch(n){this._logError(t,n);E.destroyVHContent(e)}return r},ALLFRAGMENTS:undefined,logFragment:undefined,_logTemplatedFragments:function(t,n,o){const a={path:t,fragmentName:n,fragment:o};if(e.getLevel()===e.Level.DEBUG){E.ALLFRAGMENTS=E.ALLFRAGMENTS||[];E.ALLFRAGMENTS.push(a)}if(E.logFragment){setTimeout(function(){E.logFragment(a)},0)}},_templateFragment:async function(e,t,o,a,i){const r=n.getTargetView(i);const l=n.getAppComponent(n.getTargetView(i));const d=t.valueListInfo,p=new g(d),f=d.$model.getMetaModel(),m=new g({converterType:"ListReport",columns:t.columnDefs||null});const v=await u.process(c.loadTemplate(e,"fragment"),{name:e},{bindingContexts:{valueList:p.createBindingContext("/"),contextPath:f.createBindingContext(`/${d.CollectionPath}/`),source:o.createBindingContext("/")},models:{valueList:p,contextPath:f,source:o,metaModel:f,viewData:m},appComponent:l});E._logTemplatedFragments(a,e,v);return await s.load({definition:v,controller:r.getController()})},_getContentId:function(e,t,n){const o=n?"Popover":"Dialog";return`${e}::${o}::qualifier::${t}`},_addInOutParametersToPayload:function(e,t){const n=t.valueHelpQualifier;if(!e.qualifiers){e.qualifiers={}}if(!e.qualifiers[n]){e.qualifiers[n]={vhKeys:t.vhKeys,vhParameters:t.vhParameters}}},_getValueHelpColumnDisplayFormat:function(e,t){const o=n.computeDisplayMode(e,undefined),a=e&&e[_],i=a&&e[O];if(t){return a&&typeof a!=="string"&&a.$Path?o:"Value"}else{return i?o:"Value"}},_getWidthInRem:function(e,t){let n=e.$().width();if(t&&n){n=.3*n}const o=n?parseFloat(String(d.fromPx(n))):0;return isNaN(o)?0:o},_getTableWidth:function(e,t,n){let o;const a=e.getColumns(),i=a&&a.filter(function(e){return e&&e.getVisible&&e.getVisible()})||[],r=i.length+(n?2.5:0),l=i.reduce(function(e,t){o=t.getWidth();if(o&&o.endsWith("px")){o=String(d.fromPx(o))}const n=parseFloat(o);return e+(isNaN(n)?9:n)},r);return`${Math.max(l,t)}em`},_getJSONModelForDialog:function(e,t,n,o){const a=false,i=true,r=E.getColumnVisibilityInfo(e.valueListInfo,t,a,i);return new g({id:n.getId(),groupId:o.requestGroupId,bSuggestion:false,columnInfo:r,valueHelpWithFixedValues:a})},_getJSONModelForCondition:function(e,t,n,o,a){const i=false,r=false,l=E.getColumnVisibilityInfo(e.valueListInfo,t,i,r);return new g({id:n.getId(),groupId:o.requestGroupId||undefined,bSuggestion:true,columnInfo:l,valueHelpWithFixedValues:i,descriptionPath:e.descriptionPath,keyPath:e.keyPath,propertyPath:t,caseSensitive:a})},_getJSONModelForTypeahead:function(e,t,n,o,a){const i=false,r=n.getId(),l=E.getColumnVisibilityInfo(e.valueListInfo,t,a,i);return new g({id:r,groupId:o.requestGroupId||undefined,bSuggestion:true,propertyPath:t,columnInfo:l,valueHelpWithFixedValues:a})},_createValueHelpTypeahead:async function(t,n,o,a,i,r){const l=r.getObject(`${t}@`),s=l[D]??false,u=this._getJSONModelForTypeahead(a,t,o,i,s);o.setKeyPath(a.keyPath);o.setDescriptionPath(a.descriptionPath);i.isValueListWithFixedValues=s;const c=a.valueListInfo.$model.getMetaModel().getObject(`/${a.valueListInfo.CollectionPath}@`)||{};o.setFilterFields(E.entityIsSearchable(l,c)?"$search":"");const d=await E._templateFragment("sap.fe.macros.internal.valuehelp.ValueListTable",a,u,t,n);d.setModel(a.valueListInfo.$model);e.info(`Value List- suggest Table XML content created [${t}]`,d.getMetadata().getName(),"MDC Templating");o.setTable(d);const p=n.getControl();if(p!==undefined&&(p.isA("sap.ui.mdc.FilterField")||p.isA("sap.ui.mdc.Field")||p.isA("sap.ui.mdc.MultiValueField"))){const e=s&&p.getMaxConditions()!==1?"MultiSelect":"SingleSelectMaster";d.setMode(e);const t=Boolean(i.isUnitValueHelp);const n=E._getTableWidth(d,E._getWidthInRem(p,t),e==="MultiSelect");d.setWidth(n)}},_createValueHelpDialog:async function(e,t,n,o,a,i,r){const l=n.getModel().getMetaModel().getObject(`${t}@`),s=this._getJSONModelForDialog(a,t,o,i);o.setKeyPath(a.keyPath);o.setDescriptionPath(a.descriptionPath);const u=a.valueListInfo.$model.getMetaModel().getObject(`/${a.valueListInfo.CollectionPath}@`)||{};o.setFilterFields(E.entityIsSearchable(l,u)?"$search":"");if(r){const l=n.getTypeahead().getContent()[0],s=l.getCaseSensitive();const u=this._getJSONModelForCondition(a,t,o,i,s);const c=await E._templateFragment("sap.fe.macros.internal.valuehelp.ValueListForCondition",a,u,t,n);c.setModel(e);r.addDependent(c);r.setValueHelp(c.getId());const d=c.getTypeahead().getContent()[0].getTable();const p=E._getTableWidth(d,0,false);d.setWidth(p)}const c=E._templateFragment("sap.fe.macros.internal.valuehelp.ValueListDialogTable",a,s,t,n);const d=E._templateFragment("sap.fe.macros.internal.valuehelp.ValueListFilterBar",a,s,t,n);const[p,f]=await Promise.all([c,d]);p.setModel(a.valueListInfo.$model);f.setModel(a.valueListInfo.$model);o.setFilterBar(f);o.setTable(p);p.setFilter(f.getId());p.initialized();p.setWidth("100%");const m=p;m._setShowP13nButton(false)},_getContentById:function(e,t){return e.find(function(e){return e.getId()===t})},_createPopoverContent:function(e,t,n){return new m({id:e,group:"group1",caseSensitive:t,useAsValueHelp:n})},_createDialogContent:function(e,t,n){return new f({id:e,group:"group1",caseSensitive:t,forceBind:n})},_showConditionsContent:function(e,t){let n=e.length&&e[e.length-1].getMetadata().getName()==="sap.ui.mdc.valuehelp.content.Conditions"?e[e.length-1]:undefined;if(n){n.setVisible(true)}else{n=new p;t.addContent(n)}return n},_alignOrCreateContent:function(e,t,n,o,a){const i=a.getContent();let r=E._getContentById(i,t);if(!r){const l=e.valueListInfo.FetchValues===2?false:true;r=E._createDialogContent(t,n,l);if(!o){a.addContent(r)}else{a.insertContent(r,i.length-1)}}return r},_prepareValueHelpTypeAhead:function(e,t,n,o,a,i){const r=t.getContent();let l=e.data("valuelistForValidation")||"";if(l===" "){l=""}const s=l?n.filter(function(e){return e.valueHelpQualifier===l})[0]:n[0];E._addInOutParametersToPayload(o,s);const u=E._getContentId(e.getId(),s.valueHelpQualifier,true);let c=E._getContentById(r,u);if(!c){const e=i.getUseAsValueHelp();c=E._createPopoverContent(u,a,e);t.insertContent(c,0)}else if(u!==r[0].getId()){t.removeContent(c);t.insertContent(c,0)}return{valueListInfo:s,content:c}},_prepareValueHelpDialog:function(e,t,o,a,i,r){const l=e.data("showConditionPanel")&&e.data("showConditionPanel")!=="false";const s=t.getContent();for(const e of s){e.setVisible(false)}const u=l?this._showConditionsContent(s,t):undefined;const c=e.getControl();const d=c&&c.isA("sap.ui.mdc.FilterField")?c.getOperators().length===0||c.getOperators().includes("EQ"):true;let p,f;for(const s of o){const o=s.valueHelpQualifier;E._addInOutParametersToPayload(a,s);const u=E._getContentId(e.getId(),o,false);const m=this._alignOrCreateContent(s,u,r,l,t);m.setVisible(d);if(s.valueListInfo.Label&&c){const e=n.getTranslatedTextFromExpBindingString(s.valueListInfo.Label,c);m.setTitle(e)}if(!f||i&&i===u){f=m;p=s}}if(!p||!f){throw new Error("selectedInfo or selectedContent undefined")}return{selectedInfo:p,selectedContent:f,conditionContent:u}},_addDescriptionInfosToPayload:function(e,t,n){if(e.valueHelpDescriptionPath!==t.descriptionPath){var o,a,i,r;const u=T(n);const c=(o=u.resolvePath(e.propertyPath).target)===null||o===void 0?void 0:(a=o.annotations)===null||a===void 0?void 0:(i=a.Common)===null||i===void 0?void 0:(r=i.Text)===null||r===void 0?void 0:r.path;e.valueHelpDescriptionPath=t.descriptionPath;e.valueHelpKeyPath=t.keyPath;if(c){var l,s;e.maxLength=e.valueHelpDescriptionPath?(l=u.resolvePath(`/${t.valueListInfo.CollectionPath}/${e.valueHelpDescriptionPath}`))===null||l===void 0?void 0:(s=l.target)===null||s===void 0?void 0:s.maxLength:undefined;e.propertyDescriptionPath=c}}},showValueList:async function(e,t,o){var a;const i=t.getParent(),r=t.isTypeahead(),l=e.propertyPath,s=((a=i.getControl())===null||a===void 0?void 0:a.getModel()).getMetaModel(),u=i.getModel("_VHUI")!==undefined?i.getModel("_VHUI"):E.createVHUIModel(i,l,s);u.setProperty("/isSuggestion",r);u.setProperty("/minScreenWidth",!r?"418px":undefined);try{const a=await E.getValueListInfo(i,l,e,s);const u=i.getTypeahead().getContent()[0],d=u.getCaseSensitive();if(r){const{valueListInfo:n,content:o}=E._prepareValueHelpTypeAhead(i,t,a,e,d,u);e.valueHelpQualifier=n.valueHelpQualifier;E._addDescriptionInfosToPayload(e,n,s);if(o.getTable()===undefined||o.getTable()===null){await E._createValueHelpTypeahead(l,i,o,n,e,s)}}else{const{selectedInfo:r,selectedContent:u,conditionContent:p}=E._prepareValueHelpDialog(i,t,a,e,o,d);e.valueHelpQualifier=r.valueHelpQualifier;E._addDescriptionInfosToPayload(e,r,s);const f=i.getControl();if(f){var c;const e=n.getTranslatedTextFromExpBindingString(E._getDialogTitle(i,(c=r.valueListInfo)===null||c===void 0?void 0:c.Label),f);t.setTitle(e)}if(u.getTable()===undefined||u.getTable()===null){await E._createValueHelpDialog(s,l,i,u,r,e,p)}}}catch(e){this._logError(l,e);E.destroyVHContent(i)}}};return E},false);
//# sourceMappingURL=ValueListHelper.js.map