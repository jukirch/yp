/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/buildingBlocks/BuildingBlockSupport","sap/fe/core/buildingBlocks/RuntimeBuildingBlock","sap/fe/core/CommonUtils","sap/fe/core/controls/CommandExecution","sap/fe/core/helpers/BindingHelper","sap/fe/core/helpers/BindingToolkit","sap/fe/core/helpers/ClassSupport","sap/m/Menu","sap/m/MenuButton","sap/m/MenuItem","sap/suite/ui/commons/collaboration/CollaborationHelper","sap/suite/ui/commons/collaboration/ServiceContainer","sap/ui/core/CustomData","sap/ui/performance/trace/FESRHelper","./ShareAPI","sap/fe/core/jsx-runtime/jsx"],function(e,t,i,n,r,o,a,s,l,u,c,d,p,f,m,b,v){"use strict";var h,g,S,y,_,M,I,w,O,A,B,T,C,E,P;function z(e){return new Promise((t,i)=>{sap.ui.require([e],i=>{if(!(i&&i.__esModule)){i=i===null||!(typeof i==="object"&&e.endsWith("/library"))?{default:i}:i;Object.defineProperty(i,"__esModule",{value:true})}t(i)},e=>{i(e)})})}var k={};var x=s.defineReference;var j=a.not;var D=a.constant;var N=a.compileExpression;var R=o.UI;var F=t.defineBuildingBlock;var H=t.blockAttribute;function L(e,t,i,n){if(!i)return;Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function U(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function J(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;V(e,t)}function V(e,t){V=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,i){t.__proto__=i;return t};return V(e,t)}function $(e,t,i,n,r){var o={};Object.keys(n).forEach(function(e){o[e]=n[e]});o.enumerable=!!o.enumerable;o.configurable=!!o.configurable;if("value"in o||o.initializer){o.writable=true}o=i.slice().reverse().reduce(function(i,n){return n(e,t,i)||i},o);if(r&&o.initializer!==void 0){o.value=o.initializer?o.initializer.call(r):void 0;o.initializer=undefined}if(o.initializer===void 0){Object.defineProperty(e,t,o);o=null}return o}function q(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}const W="COLLABORATION_MSTEAMS_CARD";let G=(h=F({name:"Share",namespace:"sap.fe.macros.internal",publicNamespace:"sap.fe.macros",returnTypes:["sap.fe.macros.share.ShareAPI"]}),g=H({type:"string",required:true,isPublic:true}),S=H({type:"boolean",isPublic:true,bindable:true}),y=H({type:"object",isPublic:false}),_=x(),M=x(),I=x(),h(w=(O=function(t){J(i,t);function i(){var e;for(var i=arguments.length,n=new Array(i),r=0;r<i;r++){n[r]=arguments[r]}e=t.call(this,...n)||this;L(e,"id",A,U(e));L(e,"visible",B,U(e));L(e,"msTeamsOptions",T,U(e));L(e,"menuButton",C,U(e));L(e,"menu",E,U(e));L(e,"saveAsTileMenuItem",P,U(e));return e}k=i;var o=i.prototype;o._initializeMenuItems=async function e(t,i){const n=await d.isTeamsModeActive();if(n){var r,o;(r=this.menuButton.current)===null||r===void 0?void 0:r.unbindProperty("visible",true);(o=this.menuButton.current)===null||o===void 0?void 0:o.setVisible(false);return}const a=t.getController();const s=i.getShellServices();const l=await s.waitForPluginsLoad();if(!l){var u;const e=(u=this.menuButton.current)===null||u===void 0?void 0:u.getAggregation("_control");e===null||e===void 0?void 0:e.attachEventOnce("press",{},()=>this._initializeMenuItems,this)}if(this.menu.current){this.menu.current.addItem(v(c,{text:this.getTranslatedText("T_SEMANTIC_CONTROL_SEND_EMAIL"),icon:"sap-icon://email",press:()=>a.share._triggerEmail()}));await this._addShellBasedMenuItems(a,s)}};o._addShellBasedMenuItems=async function e(t,i){var n,r,o;const a=i.hasUShell();const s=!!((n=(r=i.getUser()).isJamActive)!==null&&n!==void 0&&n.call(r));const l=await p.getServiceAsync();const u=l.getOptions({isShareAsCardEnabled:((o=this.msTeamsOptions)===null||o===void 0?void 0:o.enableCard)==="true"});if(a){if(s){var d,b;this===null||this===void 0?void 0:(d=this.menu)===null||d===void 0?void 0:(b=d.current)===null||b===void 0?void 0:b.addItem(v(c,{text:this.getTranslatedText("T_COMMON_SAPFE_SHARE_JAM"),icon:"sap-icon://share-2",press:()=>t.share._triggerShareToJam()}))}for(const e of u){var h,g,S,y;const t={text:e.text,icon:e.icon,visible:((h=e.subOptions)===null||h===void 0?void 0:h.length)===1&&e.subOptions[0].key===W?N(j(R.IsEditable)):undefined,items:[]};if(e!==null&&e!==void 0&&e.subOptions&&(e===null||e===void 0?void 0:(g=e.subOptions)===null||g===void 0?void 0:g.length)>0){t.items=[];e.subOptions.forEach(e=>{const i=new c({text:e.text,icon:e.icon,press:this.collaborationMenuItemPress,visible:e.key===W?N(j(R.IsEditable)):undefined,customData:new f({key:"collaborationData",value:e})});if(e.fesrStepName){m.setSemanticStepname(i,"press",e.fesrStepName)}t.items.push(i)})}else{t.press=this.collaborationMenuItemPress;t["customData"]=new f({key:"collaborationData",value:e})}const i=new c(t);if(t.press&&e.fesrStepName){m.setSemanticStepname(i,"press",e.fesrStepName)}this===null||this===void 0?void 0:(S=this.menu)===null||S===void 0?void 0:(y=S.current)===null||y===void 0?void 0:y.addItem(i)}const{default:e}=await z("sap/ushell/ui/footerbar/AddBookmarkButton");const i=new e;if(i.getEnabled()){var _,M;this===null||this===void 0?void 0:(_=this.menu)===null||_===void 0?void 0:(M=_.current)===null||M===void 0?void 0:M.addItem(v(c,{ref:this.saveAsTileMenuItem,text:i.getText(),icon:i.getIcon(),press:()=>t.share._saveAsTile(this.saveAsTileMenuItem.current),children:{dependents:[i]}}))}else{i.destroy()}}};o.collaborationMenuItemPress=async function t(i){const r=i.getSource();const o=await p.getServiceAsync();const a=n.getTargetView(r);const s=a.getController();await s.share._adaptShareMetadata();const l=a.getModel("shareInfo");if(l){const t=l.getData();const{collaborationInfo:i}=t;const n=r.data("collaborationData");if(n["key"]===W){const t=o.isFeatureFlagEnabled();const n=t?s.share.getCardDefinition():undefined;let r;if(n){const e=s.getAppComponent().getShellServices();const{semanticObject:t,action:i}=e.parseShellHash(document.location.hash);r=`${t}_${i}`}else{const i=!t?"Feature flag disabled in collaboration teams helper":"Card definition was not created";e.info(`FE V4 : Share block : share as Card : ${i}`)}i["cardManifest"]=n;i["cardId"]=r}o.share(n,i)}};o.getContent=function t(i,n){const o=v(b,{id:this.id,children:v(u,{ref:this.menuButton,icon:"sap-icon://action",visible:this.visible,tooltip:"{sap.fe.i18n>M_COMMON_SAPFE_ACTION_SHARE} (Ctrl+Shift+S)",children:v(l,{ref:this.menu})})});i.addDependent(v(r,{visible:this.visible,enabled:this.visible,command:"Share",execute:()=>{var e;return(e=this.menuButton.current)===null||e===void 0?void 0:e.getMenu().openBy(this.menuButton.current,true)}}));this.isInitialized=this._initializeMenuItems(i,n).catch(t=>{e.error(t)});return o};return i}(i),A=$(O.prototype,"id",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),B=$(O.prototype,"visible",[S],{configurable:true,enumerable:true,writable:true,initializer:function(){return D(true)}}),T=$(O.prototype,"msTeamsOptions",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),C=$(O.prototype,"menuButton",[_],{configurable:true,enumerable:true,writable:true,initializer:null}),E=$(O.prototype,"menu",[M],{configurable:true,enumerable:true,writable:true,initializer:null}),P=$(O.prototype,"saveAsTileMenuItem",[I],{configurable:true,enumerable:true,writable:true,initializer:null}),O))||w);k=G;return k},false);
//# sourceMappingURL=Share.block.js.map