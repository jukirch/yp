/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/buildingBlocks/BuildingBlockBase","sap/fe/core/buildingBlocks/BuildingBlockSupport","sap/fe/core/buildingBlocks/BuildingBlockTemplateProcessor","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/BindingToolkit","sap/fe/macros/situations/SituationsPopover"],function(e,t,r,i,n,a,o){"use strict";var s,l,u,c,p,f,d;var v={};var y=o.showPopover;var g=a.ref;var b=a.pathInModel;var m=a.ifElse;var h=a.greaterThan;var P=a.fn;var T=a.equal;var S=a.and;var B=n.convertMetaModelContext;var k=i.xml;var w=r.defineBuildingBlock;var O=r.blockAttribute;function $(e,t,r,i){if(!r)return;Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(i):void 0})}function z(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function j(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;M(e,t)}function M(e,t){M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return M(e,t)}function N(e,t,r,i,n){var a={};Object.keys(i).forEach(function(e){a[e]=i[e]});a.enumerable=!!a.enumerable;a.configurable=!!a.configurable;if("value"in a||a.initializer){a.writable=true}a=r.slice().reverse().reduce(function(r,i){return i(e,t,r)||r},a);if(n&&a.initializer!==void 0){a.value=a.initializer?a.initializer.call(n):void 0;a.initializer=undefined}if(a.initializer===void 0){Object.defineProperty(e,t,a);a=null}return a}function A(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}let E=(s=w({name:"SituationsIndicator",namespace:"sap.fe.macros.internal.situations"}),l=O({type:"sap.ui.model.Context",required:true}),u=O({type:"string",required:false}),s(c=(p=function(t){j(r,t);function r(){var e;for(var r=arguments.length,i=new Array(r),n=0;n<r;n++){i[n]=arguments[n]}e=t.call(this,...i)||this;$(e,"entitySet",f,z(e));$(e,"propertyPath",d,z(e));return e}v=r;r.getSituationsNavigationProperty=function t(r){let i;switch(r._type){case"NavigationProperty":i=r.targetType.navigationProperties;break;case"EntityType":i=r.navigationProperties;break;default:i=r.entityType.navigationProperties}const n=i.filter(e=>{var t,r;return!e.isCollection&&((t=e.targetType.annotations.Common)===null||t===void 0?void 0:(r=t.SAPObjectNodeType)===null||r===void 0?void 0:r.Name)==="BusinessSituation"});const a=n.length>=1?n[0]:undefined;if(n.length>1){const t=n.map(e=>`'${e.name}'`).join(", ");let i;switch(r._type){case"NavigationProperty":i=r.targetType.name;break;case"EntityType":i=r.name;break;default:i=r.entityType.name}e.error(`Entity type '${i}' has multiple paths to SAP Situations (${t}). Using '${a===null||a===void 0?void 0:a.name}'.\nHint: Make sure there is at most one navigation property whose target entity type is annotated with\n<Annotation Term="com.sap.vocabularies.Common.v1.SAPObjectNodeType">\n  <Record>\n    <PropertyValue Property="Name" String="BusinessSituation" />\n  </Record>\n</Annotation>.`)}return a};var i=r.prototype;i.getTemplate=function e(){const t=B(this.entitySet);if(!t){return}const i=r.getSituationsNavigationProperty(t);if(!i){return undefined}const n=b(`${i.name}/SitnNumberOfInstances`);let a;if(!this.propertyPath){a=h(n,0)}else{a=S(h(n,0),T(b("semanticKeyHasDraftIndicator","internal"),this.propertyPath))}const o=m(h(n,1),n,"");const s=m(T(n,1),this.getTranslatedText("situationsTooltipSingular"),P("formatMessage",[this.getTranslatedText("situationsTooltipPlural"),n]));const l=P(y,[g("$controller"),g("$event"),i.name]);return k`
			<m:Button core:require="{rt: 'sap/fe/macros/situations/SituationsPopover', formatMessage: 'sap/base/strings/formatMessage'}"
				type="Attention"
				icon="sap-icon://alert"
				text="${o}"
				tooltip="${s}"
				visible="${a}"
				press="${l}"
			/>`};return r}(t),f=N(p.prototype,"entitySet",[l],{configurable:true,enumerable:true,writable:true,initializer:null}),d=N(p.prototype,"propertyPath",[u],{configurable:true,enumerable:true,writable:true,initializer:null}),p))||c);v=E;return v},false);
//# sourceMappingURL=SituationsIndicator.block.js.map