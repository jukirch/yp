/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/helpers/BindingToolkit","sap/fe/macros/DelegateUtil","sap/fe/macros/field/FieldRuntime","sap/fe/macros/filter/FilterUtils","sap/ui/core/Component","sap/ui/core/format/NumberFormat","sap/ui/model/Filter"],function(t,e,n,i,o,a,r,s,c){"use strict";var l=n.pathInModel;var u=n.compileExpression;function f(t){let n=[];const i=t.data("hiddenFilters");if(i&&Array.isArray(i.paths)){i.paths.forEach(function(i){const o=e.getFiltersInfoForSV(t,i.annotationPath);n=n.concat(o.filters)})}return n}function g(t){let n=f(t);const i=t.getQuickFilter();if(i){const o=i.getSelectedKey()||i.getItems()[0].getKey();n=n.concat(e.getFiltersInfoForSV(t,o).filters)}return n}function m(t,e,n){let i;const o=t.data("rowsBindingInfo"),a=t.getModel();const r=n.batchGroupId||"",s=b(t);let l=Array.isArray(n.additionalFilters)?n.additionalFilters:[];const u=s.bindingPath?s.bindingPath:o.path;l=l.concat(s.filters).concat(p(t));const f=new c({filters:l,and:true});const g=a.bindList((e?`${e.getPath()}/`:"")+u,t.getBindingContext(),[],f);return g.fetchFilter(g.getContext()).then(function(t){i=a.bindProperty(`${g.getPath()}/$count`,g.getContext(),{$$groupId:r||"$auto",$filter:t[0],$search:s.search});return i.requestValue()}).then(function(t){i.destroy();g.destroy();return t})}function d(t){const e=s.getIntegerInstance({groupingEnabled:true});return e.format(t)}function b(t,e){const n=t.getParent().getTableDefinition();let i=e||[];function o(t){const e=t.getParent().getTableDefinition().aggregates;return Object.keys(e).map(function(t){return e[t].relativePath})}if(n.enableAnalytics){i=i.concat(o(t));if(!n.enableBasicSearch){i=i.concat(["search"])}}return a.getFilterInfo(t.getFilter(),{ignoredProperties:i,targetControl:t})}function p(t){const e=t.getP13nMode();if(e&&e.includes("Filter")){const e=(i.getCustomData(t,"sap_fe_ControlDelegate_propertyInfoMap")||[]).filter(function(t){return t&&!(t.filterable===false)}),n=a.getFilterInfo(t,{propertiesMetadata:e});if(n&&n.filters){return n.filters}}return[]}function h(t,e){const n=v.getFilterInfo(t,e);return{filters:n.filters.concat(g(t),v.getP13nFilters(t)),search:n.search,bindingPath:n.bindingPath}}function O(t){return P(t).promise}function F(t){const e=P(t);if(e.resolve){e.resolve(t);t.data("boundPromiseResolve",null)}}function P(t){if(!t.data("boundPromise")){let e;t.data("boundPromise",new Promise(function(t){e=t}));if(t.isBound()){e(t)}else{t.data("boundPromiseResolve",e)}}return{promise:t.data("boundPromise"),resolve:t.data("boundPromiseResolve")}}function j(n,a){const s=n.getView();const c=s.getBindingContext("internal");if(c){const f=i.getCustomData(a,"targetCollectionPath");if(f){const i=n.getOwnerComponent();const g=r.getOwnerComponentFor(i);const m=g.getMetaModel();const d=g.getShellServices();const b=o._fnFixHashQueryString(d.getHash());const p=a.getParent().getTableDefinition().columns;const h=[];const O=[];const F=[];let P="",j,v;let C;const $=[];let y,I;for(let t=0;t<p.length;t++){j=p[t].annotationPath;if(j){v=m.getObject(j);if(v&&v.$kind==="Property"){P=p[t].annotationPath}else if(v&&v.$Type==="com.sap.vocabularies.UI.v1.DataField"){P=`${f}/${m.getObject(`${j}/Value/$Path`)}`}}if(P!==""){const t=Object.keys(m.getObject(P+"@"));for(let n=0;n<t.length;n++){if(!F.includes(P)&&t[n].indexOf(`@${"com.sap.vocabularies.Common.v1.SemanticObject"}`)===0&&!t[n].includes(`@${"com.sap.vocabularies.Common.v1.SemanticObjectMapping"}`)&&!t[n].includes(`@${"com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions"}`)){I=/#(.*)/.exec(t[n]);y=I?I[1]:"";$.push(e.getSemanticObjectPromise(g,s,m,P,y));F.push(P)}}}P=""}if($.length===0){return Promise.resolve()}else{Promise.all($).then(function(t){const n=[];let i;const o=t.filter(function(t){if(t.semanticObject&&typeof t.semanticObject.semanticObject==="object"){i=u(l(t.semanticObject.semanticObject.$Path));t.semanticObject.semanticObject=i;t.semanticObjectForGetLinks[0].semanticObject=i;return true}else if(t){return t.semanticObject!==undefined}else{return false}});for(let t=0;t<o.length;t++){C=o[t];if(C&&C.semanticObject&&!(C.semanticObject.semanticObject.indexOf("{")===0)){h.push(C.semanticObjectForGetLinks);O.push({semanticObject:C.semanticObject&&C.semanticObject.semanticObject,unavailableActions:C.unavailableActions,path:o[t].semanticObjectPath});n.push(d.getLinksWithCache([C.semanticObjectForGetLinks]))}}return e.updateSemanticTargets(n,O,c,b)}).catch(function(e){t.error("fnGetSemanticTargetsFromTable: Cannot get Semantic Objects",e)})}}}}const v={getCountFormatted:d,getHiddenFilters:f,getListBindingForCount:m,getFilterInfo:b,getP13nFilters:p,getAllFilterInfo:h,whenBound:O,onTableBound:F,getSemanticTargetsFromTable:j};return v},false);
//# sourceMappingURL=Utils.js.map