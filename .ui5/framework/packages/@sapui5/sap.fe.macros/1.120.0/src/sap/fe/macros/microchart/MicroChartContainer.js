/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/helpers/ClassSupport","sap/fe/macros/library","sap/m/FlexBox","sap/m/Label","sap/m/library","sap/suite/ui/microchart/AreaMicroChart","sap/suite/ui/microchart/ColumnMicroChart","sap/suite/ui/microchart/ComparisonMicroChart","sap/suite/ui/microchart/LineMicroChart","sap/ui/core/Control","sap/ui/core/format/NumberFormat","sap/ui/model/odata/v4/ODataListBinding","sap/ui/model/odata/v4/ODataMetaModel","sap/ui/model/type/Date"],function(e,t,i,r,a,n,o,l,s,u,c,f,g,h,p){"use strict";var d,b,m,y,C,v,P,L,_,w,A,O,T,V,x,z,N,B,D,M,R,E,I,S,F,j,$,U,k,Y,G,q,X,H,Q;var J=t.property;var K=t.event;var W=t.defineUI5Class;var Z=t.aggregation;function ee(e,t,i,r){if(!i)return;Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function te(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function ie(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;re(e,t)}function re(e,t){re=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,i){t.__proto__=i;return t};return re(e,t)}function ae(e,t,i,r,a){var n={};Object.keys(r).forEach(function(e){n[e]=r[e]});n.enumerable=!!n.enumerable;n.configurable=!!n.configurable;if("value"in n||n.initializer){n.writable=true}n=i.slice().reverse().reduce(function(i,r){return r(e,t,i)||i},n);if(a&&n.initializer!==void 0){n.value=n.initializer?n.initializer.call(a):void 0;n.initializer=undefined}if(n.initializer===void 0){Object.defineProperty(e,t,n);n=null}return n}function ne(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}const oe=i.NavigationType;const le=n.ValueColor;let se=(d=W("sap.fe.macros.microchart.MicroChartContainer"),b=J({type:"boolean",defaultValue:false}),m=J({type:"string",defaultValue:undefined}),y=J({type:"string[]",defaultValue:[]}),C=J({type:"string",defaultValue:undefined}),v=J({type:"string[]",defaultValue:[]}),P=J({type:"int",defaultValue:undefined}),L=J({type:"int",defaultValue:1}),_=J({type:"int",defaultValue:undefined}),w=J({type:"string",defaultValue:""}),A=J({type:"string",defaultValue:""}),O=J({type:"sap.fe.macros.NavigationType",defaultValue:"None"}),T=J({type:"string",defaultValue:""}),V=K(),x=Z({type:"sap.ui.core.Control",multiple:false,isDefault:true}),z=Z({type:"sap.m.Label",multiple:false}),N=Z({type:"sap.ui.core.Control",multiple:true}),d(B=(D=function(t){ie(i,t);function i(){var e;for(var i=arguments.length,r=new Array(i),a=0;a<i;a++){r[a]=arguments[a]}e=t.call(this,...r)||this;ee(e,"showOnlyChart",M,te(e));ee(e,"uomPath",R,te(e));ee(e,"measures",E,te(e));ee(e,"dimension",I,te(e));ee(e,"dataPointQualifiers",S,te(e));ee(e,"measurePrecision",F,te(e));ee(e,"measureScale",j,te(e));ee(e,"dimensionPrecision",$,te(e));ee(e,"chartTitle",U,te(e));ee(e,"chartDescription",k,te(e));ee(e,"navigationType",Y,te(e));ee(e,"calendarPattern",G,te(e));ee(e,"onTitlePressed",q,te(e));ee(e,"microChart",X,te(e));ee(e,"_uomLabel",H,te(e));ee(e,"microChartTitle",Q,te(e));return e}i.render=function e(t,i){t.openStart("div",i);t.openEnd();if(!i.showOnlyChart){const e=i.microChartTitle;if(e){e.forEach(function(e){t.openStart("div");t.openEnd();t.renderControl(e);t.close("div")})}t.openStart("div");t.openEnd();const r=new a({text:i.chartDescription});t.renderControl(r);t.close("div")}const n=i.microChart;if(n){n.addStyleClass("sapUiTinyMarginTopBottom");t.renderControl(n);if(!i.showOnlyChart&&i.uomPath){const e=i._checkIfChartRequiresRuntimeLabels()?undefined:{text:{path:i.uomPath}},n=new a(e),o=new r({alignItems:"Start",justifyContent:"End",items:[n]});t.renderControl(o);i.setAggregation("_uomLabel",n)}}t.close("div")};var n=i.prototype;n.onBeforeRendering=function e(){const t=this._getListBindingForRuntimeLabels();if(t){t.detachEvent("change",this._setRuntimeChartLabelsAndUnitOfMeasure,this);this._olistBinding=undefined}};n.onAfterRendering=function e(){const t=this._getListBindingForRuntimeLabels();if(!this._checkIfChartRequiresRuntimeLabels()){return}if(t){t.attachEvent("change",this._setRuntimeChartLabelsAndUnitOfMeasure,this);this._olistBinding=t}};n.setShowOnlyChart=function e(t){if(!t&&this._olistBinding){this._setChartLabels()}this.setProperty("showOnlyChart",t,false)};n._checkIfChartRequiresRuntimeLabels=function e(){const t=this.microChart;return Boolean(t instanceof o||t instanceof l||t instanceof u||t instanceof s)};n._checkForChartLabelAggregations=function e(){const t=this.microChart;return Boolean(t instanceof o&&t.getAggregation("firstYLabel")&&t.getAggregation("lastYLabel")&&t.getAggregation("firstXLabel")&&t.getAggregation("lastXLabel")||t instanceof l&&t.getAggregation("leftTopLabel")&&t.getAggregation("rightTopLabel")&&t.getAggregation("leftBottomLabel")&&t.getAggregation("rightBottomLabel")||t instanceof u)};n._getListBindingForRuntimeLabels=function e(){const t=this.microChart;let i;if(t instanceof o){const e=t.getChart();i=e&&e.getBinding("points")}else if(t instanceof l){i=t.getBinding("columns")}else if(t instanceof u){const e=t.getLines();i=e&&e.length&&e[0].getBinding("points")}else if(t instanceof s){i=t.getBinding("data")}return i instanceof g?i:false};n._setRuntimeChartLabelsAndUnitOfMeasure=async function e(){const t=this._olistBinding,i=t===null||t===void 0?void 0:t.getContexts(),r=this.measures,a=this.dimension,n=this.uomPath,o=this.microChart,l=this._uomLabel;if(l&&n&&i&&i.length&&!this.showOnlyChart){l.setText(i[0].getObject(n))}else if(l){l.setText("")}if(!this._checkForChartLabelAggregations()){return}if(!i||!i.length){this._setChartLabels();return}const s=i[0],c=i[i.length-1],f=[],g=o instanceof u,h=s.getObject(a),p=c.getObject(a);let d,b,m={value:Infinity},y={value:-Infinity},C={value:Infinity},v={value:-Infinity};m=h==undefined?m:{context:s,value:h};y=p==undefined?y:{context:c,value:p};if(r!==null&&r!==void 0&&r.length){r.forEach((e,t)=>{d=s.getObject(e);b=c.getObject(e);v=b>v.value?{context:c,value:b,index:g?t:0}:v;C=d<C.value?{context:s,value:d,index:g?t:0}:C;if(g){f.push(this._getCriticalityFromPoint({context:c,value:b,index:t}))}})}this._setChartLabels(C.value,v.value,m.value,y.value);if(g){const e=await Promise.all(f);if(e!==null&&e!==void 0&&e.length){const t=o.getLines();t.forEach(function(t,i){t.setColor(e[i])})}}else{await this._setChartLabelsColors(v,C)}};n._setChartLabelsColors=async function e(t,i){const r=this.microChart;const a=await Promise.all([this._getCriticalityFromPoint(i),this._getCriticalityFromPoint(t)]);if(r instanceof o){r.getAggregation("firstYLabel").setProperty("color",a[0],true);r.getAggregation("lastYLabel").setProperty("color",a[1],true)}else if(r instanceof l){r.getAggregation("leftTopLabel").setProperty("color",a[0],true);r.getAggregation("rightTopLabel").setProperty("color",a[1],true)}};n._setChartLabels=function e(t,i,r,a){const n=this.microChart;t=this._formatDateAndNumberValue(t,this.measurePrecision,this.measureScale);i=this._formatDateAndNumberValue(i,this.measurePrecision,this.measureScale);r=this._formatDateAndNumberValue(r,this.dimensionPrecision,undefined,this.calendarPattern);a=this._formatDateAndNumberValue(a,this.dimensionPrecision,undefined,this.calendarPattern);if(n instanceof o){n.getAggregation("firstYLabel").setProperty("label",t,false);n.getAggregation("lastYLabel").setProperty("label",i,false);n.getAggregation("firstXLabel").setProperty("label",r,false);n.getAggregation("lastXLabel").setProperty("label",a,false)}else if(n instanceof l){n.getAggregation("leftTopLabel").setProperty("label",t,false);n.getAggregation("rightTopLabel").setProperty("label",i,false);n.getAggregation("leftBottomLabel").setProperty("label",r,false);n.getAggregation("rightBottomLabel").setProperty("label",a,false)}else if(n instanceof u){n.setProperty("leftTopLabel",t,false);n.setProperty("rightTopLabel",i,false);n.setProperty("leftBottomLabel",r,false);n.setProperty("rightBottomLabel",a,false)}};n._getCriticalityFromPoint=async function e(t){if(t!==null&&t!==void 0&&t.context){const e=this.getModel()&&this.getModel().getMetaModel(),i=this.dataPointQualifiers,r=e instanceof h&&t.context.getPath()&&e.getMetaPath(t.context.getPath());if(e&&typeof r==="string"){const a=await e.requestObject(`${r}/@${"com.sap.vocabularies.UI.v1.DataPoint"}${t.index!==undefined&&i[t.index]?`#${i[t.index]}`:""}`);if(a){let e=le.Neutral;const i=t.context;if(a.Criticality){e=this._criticality(a.Criticality,i)}else if(a.CriticalityCalculation){const r=a.CriticalityCalculation;const n=function(e){let t;if(e!==null&&e!==void 0&&e.$Path){t=i.getObject(e.$Path)}else if(e!==null&&e!==void 0&&e.hasOwnProperty("$Decimal")){t=e.$Decimal}return t};e=this._criticalityCalculation(r.ImprovementDirection.$EnumMember,t.value,n(r.DeviationRangeLowValue),n(r.ToleranceRangeLowValue),n(r.AcceptanceRangeLowValue),n(r.AcceptanceRangeHighValue),n(r.ToleranceRangeHighValue),n(r.DeviationRangeHighValue))}return e}}}return Promise.resolve(le.Neutral)};n._criticality=function t(i,r){let a,n;if(i.$Path){a=r.getObject(i.$Path);if(a==="Negative"||a.toString()==="1"){n=le.Error}else if(a==="Critical"||a.toString()==="2"){n=le.Critical}else if(a==="Positive"||a.toString()==="3"){n=le.Good}}else if(i.$EnumMember){a=i.$EnumMember;if(a.indexOf("com.sap.vocabularies.UI.v1.CriticalityType/Negative")>-1){n=le.Error}else if(a.indexOf("com.sap.vocabularies.UI.v1.CriticalityType/Positive")>-1){n=le.Good}else if(a.indexOf("com.sap.vocabularies.UI.v1.CriticalityType/Critical")>-1){n=le.Critical}}if(n===undefined){e.warning("Case not supported, returning the default Value Neutral");return le.Neutral}return n};n._criticalityCalculation=function t(i,r,a,n,o,l,s,u){let c;a=a==undefined?-Infinity:a;n=n==undefined?a:n;o=o==undefined?n:o;u=u==undefined?Infinity:u;s=s==undefined?u:s;l=l==undefined?s:l;if(i.includes("Minimize")){if(r<=l){c=le.Good}else if(r<=s){c=le.Neutral}else if(r<=u){c=le.Critical}else{c=le.Error}}else if(i.includes("Maximize")){if(r>=o){c=le.Good}else if(r>=n){c=le.Neutral}else if(r>=a){c=le.Critical}else{c=le.Error}}else if(i.includes("Target")){if(r<=l&&r>=o){c=le.Good}else if(r>=n&&r<o||r>l&&r<=s){c=le.Neutral}else if(r>=a&&r<n||r>s&&r<=u){c=le.Critical}else{c=le.Error}}if(c===undefined){e.warning("Case not supported, returning the default Value Neutral");return le.Neutral}return c};n._formatDateAndNumberValue=function e(t,i,r,a){if(a){return this._getSemanticsValueFormatter(a).formatValue(t,"string")}else if(!isNaN(t)){return this._getLabelNumberFormatter(i,r).format(t)}return t};n._getSemanticsValueFormatter=function e(t){if(!this._oDateType){this._oDateType=new p({style:"short",source:{pattern:t}})}return this._oDateType};n._getLabelNumberFormatter=function e(t,i){return f.getFloatInstance({style:"short",showScale:true,precision:typeof t==="number"&&t||0,decimals:typeof i==="number"&&i||0})};return i}(c),M=ae(D.prototype,"showOnlyChart",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),R=ae(D.prototype,"uomPath",[m],{configurable:true,enumerable:true,writable:true,initializer:null}),E=ae(D.prototype,"measures",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),I=ae(D.prototype,"dimension",[C],{configurable:true,enumerable:true,writable:true,initializer:null}),S=ae(D.prototype,"dataPointQualifiers",[v],{configurable:true,enumerable:true,writable:true,initializer:null}),F=ae(D.prototype,"measurePrecision",[P],{configurable:true,enumerable:true,writable:true,initializer:null}),j=ae(D.prototype,"measureScale",[L],{configurable:true,enumerable:true,writable:true,initializer:null}),$=ae(D.prototype,"dimensionPrecision",[_],{configurable:true,enumerable:true,writable:true,initializer:null}),U=ae(D.prototype,"chartTitle",[w],{configurable:true,enumerable:true,writable:true,initializer:null}),k=ae(D.prototype,"chartDescription",[A],{configurable:true,enumerable:true,writable:true,initializer:null}),Y=ae(D.prototype,"navigationType",[O],{configurable:true,enumerable:true,writable:true,initializer:null}),G=ae(D.prototype,"calendarPattern",[T],{configurable:true,enumerable:true,writable:true,initializer:null}),q=ae(D.prototype,"onTitlePressed",[V],{configurable:true,enumerable:true,writable:true,initializer:null}),X=ae(D.prototype,"microChart",[x],{configurable:true,enumerable:true,writable:true,initializer:null}),H=ae(D.prototype,"_uomLabel",[z],{configurable:true,enumerable:true,writable:true,initializer:null}),Q=ae(D.prototype,"microChartTitle",[N],{configurable:true,enumerable:true,writable:true,initializer:null}),D))||B);return se},false);
//# sourceMappingURL=MicroChartContainer.js.map