/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2023 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/converters/annotations/DataField","sap/fe/core/helpers/BindingHelper","sap/fe/core/helpers/BindingToolkit","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/CommonFormatters","sap/fe/core/templating/DataFieldFormatters","sap/fe/core/templating/DataModelPathHelper","sap/fe/core/templating/PropertyHelper","sap/fe/core/templating/SemanticObjectHelper","sap/fe/core/templating/UIFormatters","sap/ui/model/json/JSONModel","./FieldHelper"],function(e,t,i,n,a,o,r,l,s,d,u,c){"use strict";var v={};var g=s.hasSemanticObject;var f=s.getDynamicPathFromSemanticObject;var p=r.getContextRelativeTargetObjectPath;var m=r.getContextPropertyRestriction;var b=r.enhanceDataModelPath;var y=o.generateVisibleExpression;var h=n.isProperty;var O=n.isPathAnnotationExpression;var T=n.isNavigationProperty;var I=i.transformRecursively;var j=i.pathInModel;var P=i.or;var D=i.not;var U=i.isPathInModelExpression;var F=i.isComplexTypeExpression;var x=i.getExpressionFromAnnotation;var $=i.formatWithTypeInformation;var E=i.formatResult;var V=i.constant;var S=i.compileExpression;var C=t.UI;var B=e.isDataFieldForAnnotation;const M=function(e,t){return I(e,"PathInModel",e=>{let i=e;if(e.modelName===undefined){const n=b(t,e.path);i=a.getBindingWithTextArrangement(n,e)}return i})};v.addTextArrangementToBindingExpression=M;const A=function(e,t){return I(e,"PathInModel",e=>{let i=e;if(e.modelName===undefined){const n=b(t,e.path);i=$(n.targetObject,e)}return i})};v.formatValueRecursively=A;const W=function(e,t){return k(e,t,true)};v.getTextBindingExpression=W;const k=function(e,t){var i,n,o,r,l,s,u,c,v,g,f,m,y,h,T,I,P,D;let U=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;let $=arguments.length>3?arguments[3]:undefined;if(((i=e.targetObject)===null||i===void 0?void 0:i.$Type)==="com.sap.vocabularies.UI.v1.DataField"||((n=e.targetObject)===null||n===void 0?void 0:n.$Type)==="com.sap.vocabularies.UI.v1.DataPointType"||((o=e.targetObject)===null||o===void 0?void 0:o.$Type)==="com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath"||((r=e.targetObject)===null||r===void 0?void 0:r.$Type)==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"||((l=e.targetObject)===null||l===void 0?void 0:l.$Type)==="com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation"||((s=e.targetObject)===null||s===void 0?void 0:s.$Type)==="com.sap.vocabularies.UI.v1.DataFieldWithAction"){const t=x(e.targetObject.Value)??"";return S(t)}if(O(e.targetObject)&&e.targetObject.$target){e=b(e,e.targetObject.path)}const E=j(p(e));let V;if((u=e.targetObject)!==null&&u!==void 0&&(c=u.annotations)!==null&&c!==void 0&&(v=c.Measures)!==null&&v!==void 0&&v.Unit||(g=e.targetObject)!==null&&g!==void 0&&(f=g.annotations)!==null&&f!==void 0&&(m=f.Measures)!==null&&m!==void 0&&m.ISOCurrency){V=d.getBindingWithUnitOrCurrency(e,E);if((t===null||t===void 0?void 0:t.measureDisplayMode)==="Hidden"&&F(V)){V.formatOptions={...V.formatOptions,showMeasure:false}}}else if((y=e.targetObject)!==null&&y!==void 0&&(h=y.annotations)!==null&&h!==void 0&&(T=h.Common)!==null&&T!==void 0&&T.Timezone){V=d.getBindingWithTimezone(e,E,false,true,t.dateFormatOptions)}else if((I=e.targetObject)!==null&&I!==void 0&&(P=I.annotations)!==null&&P!==void 0&&(D=P.Common)!==null&&D!==void 0&&D.IsTimezone){V=d.getBindingForTimezone(e,E)}else{V=a.getBindingWithTextArrangement(e,E,t,$)}if(U){return V}return S(V)};v.getTextBinding=k;const N=function(e,t){let i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;let n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;let a=arguments.length>4?arguments[4]:undefined;let o=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;let r=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;if(O(e.targetObject)&&e.targetObject.$target){const t=e.targetEntityType.resolvePath(e.targetObject.path,true);e.targetObject=t.target;t.visitedObjects.forEach(t=>{if(T(t)){e.navigationProperties.push(t)}})}const l=e.targetObject;if(h(l)){let t=j(p(e));if(U(t)){var s,u,c,v,g,f,m,b;if((s=l.annotations)!==null&&s!==void 0&&(u=s.Communication)!==null&&u!==void 0&&u.IsEmailAddress){t.type="sap.fe.core.type.Email"}else if(!i&&((c=l.annotations)!==null&&c!==void 0&&(v=c.Measures)!==null&&v!==void 0&&v.ISOCurrency||(g=l.annotations)!==null&&g!==void 0&&(f=g.Measures)!==null&&f!==void 0&&f.Unit)){t=d.getBindingWithUnitOrCurrency(e,t,true,r?undefined:{showMeasure:false})}else if((m=e.targetObject.annotations)!==null&&m!==void 0&&(b=m.Common)!==null&&b!==void 0&&b.IsTimezone){t=d.getBindingForTimezone(e,t)}else{var y,I;const i=(y=e.targetObject.annotations)===null||y===void 0?void 0:(I=y.Common)===null||I===void 0?void 0:I.Timezone;if(i){t=d.getBindingWithTimezone(e,t,true)}else{t=$(l,t)}}if(U(t)){if(n){delete t.formatOptions;delete t.constraints;delete t.type}if(a){t.parameters=a}if(o){t.targetType="any"}}return S(t)}else{return""}}else if((l===null||l===void 0?void 0:l.$Type)==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"||(l===null||l===void 0?void 0:l.$Type)==="com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath"){return S(x(l.Value))}else{return""}};v.getValueBinding=N;const H=function(e,t){const i=l.getAssociatedTextPropertyPath(e.targetObject);if(i){const n=b(e,i);return N(n,t,true,false,{$$noPatch:true})}return undefined};v.getAssociatedTextBinding=H;const w=function(e,t){var i,n,a,o,r;const l=(e===null||e===void 0?void 0:(i=e.targetEntityType)===null||i===void 0?void 0:i.navigationProperties)||[];const s=(e===null||e===void 0?void 0:(n=e.targetEntityType)===null||n===void 0?void 0:(a=n.annotations)===null||a===void 0?void 0:(o=a.Common)===null||o===void 0?void 0:o.SemanticKey)||[];let d=false;l.forEach(e=>{if(e.referentialConstraint&&e.referentialConstraint.length){e.referentialConstraint.forEach(i=>{if((i===null||i===void 0?void 0:i.sourceProperty)===t.name){var n,a,o;if(e!==null&&e!==void 0&&(n=e.targetType)!==null&&n!==void 0&&(a=n.annotations)!==null&&a!==void 0&&(o=a.UI)!==null&&o!==void 0&&o.QuickViewFacets){d=true}}})}});if(((r=e.contextLocation)===null||r===void 0?void 0:r.targetEntitySet)!==e.targetEntitySet){var u,c,v;const i=s.some(function(e){var i;return(e===null||e===void 0?void 0:(i=e.$target)===null||i===void 0?void 0:i.name)===t.name});if((i||t.isKey)&&e!==null&&e!==void 0&&(u=e.targetEntityType)!==null&&u!==void 0&&(c=u.annotations)!==null&&c!==void 0&&(v=c.UI)!==null&&v!==void 0&&v.QuickViewFacets){d=true}}return d};v.isUsedInNavigationWithQuickViewFacets=w;const z=function(e,t){var i,n,a;const o=O(e)&&e.$target||e;if(!((i=o.annotations)!==null&&i!==void 0&&(n=i.Common)!==null&&n!==void 0&&n.Text)&&!((a=o.annotations)!==null&&a!==void 0&&a.Measures)&&l.hasValueHelp(o)&&t.textAlignMode==="Form"){return true}return false};v.isRetrieveTextFromValueListEnabled=z;const R=function(e,t,i){var n,a,o,r,s,d;let u=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;let v=((n=e.targetObject.Value)===null||n===void 0?void 0:n.$target.type)||((a=e.targetObject.Target)===null||a===void 0?void 0:a.$target.Value.$target.type);if(l.isKey(((o=e.targetObject.Value)===null||o===void 0?void 0:o.$target)||((r=e.targetObject.Target)===null||r===void 0?void 0:(s=r.$target)===null||s===void 0?void 0:(d=s.Value)===null||d===void 0?void 0:d.$target))){return"Begin"}if(u&&t.displayMode&&["Description","DescriptionValue","ValueDescription"].includes(t.displayMode)){var g,f,p,m,b;const t=(g=e.targetObject.Value)===null||g===void 0?void 0:(f=g.$target.annotations)===null||f===void 0?void 0:(p=f.Common)===null||p===void 0?void 0:p.Text;const i=t===null||t===void 0?void 0:(m=t.annotations)===null||m===void 0?void 0:(b=m.UI)===null||b===void 0?void 0:b.TextArrangement.valueOf();if(t&&i!=="UI.TextArrangementType/TextSeparate"){v=t.$target.type}}return c.getPropertyAlignment(v,t,i)};v.getTextAlignment=R;const Q=function(e,t){const i=e.targetObject;return S(y(i,t))};v.getVisibleExpression=Q;const L=function(e){if(!e.targetObject){return""}if(typeof e.targetObject==="string"){return e.targetObject}return k(e,{})};v.getQuickViewBinding=L;const K=function(e){var t,i,n,a,o,r,l,s,d,u;const c=e.targetObject;if(c!==null&&c!==void 0&&c.Url&&c.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){return"link"}if(c!==null&&c!==void 0&&(t=c.Value.$target)!==null&&t!==void 0&&(i=t.annotations)!==null&&i!==void 0&&(n=i.Communication)!==null&&n!==void 0&&n.IsEmailAddress||(a=c.annotations)!==null&&a!==void 0&&(o=a.Communication)!==null&&o!==void 0&&o.IsEmailAddress){return"email"}if(c!==null&&c!==void 0&&(r=c.Value.$target)!==null&&r!==void 0&&(l=r.annotations)!==null&&l!==void 0&&(s=l.Communication)!==null&&s!==void 0&&s.IsPhoneNumber||(d=c.annotations)!==null&&d!==void 0&&(u=d.Communication)!==null&&u!==void 0&&u.IsPhoneNumber){return"phone"}return"text"};v.getQuickViewType=K;const G=function(e,t){const i=[];let n;let a;if(e){const o=Object.keys(e).filter(function(e){return e==="SemanticObject"||e.startsWith("SemanticObject#")});for(const r of o){a=e[r];n=S(x(a));if(!t||t&&O(a)){i.push({key:f(n)||n,value:n})}}}return i};v.getSemanticObjectExpressionToResolve=G;const J=function(e){if(e.length>0){let t="";let i="";const n=[];for(let a=0;a<e.length;a++){t=e[a].key;i=S(x(e[a].value));n.push({key:t,value:i})}const a=new u(n);a.$$valueAsPromise=true;const o=a.createBindingContext("/");return o}else{return new u([]).createBindingContext("/")}};v.getSemanticObjects=J;const q=function(e,t,i){if(e.wrap===false){return false}if(t!=="Edm.String"){return i}if(e.editMode==="Display"){return true}if(e.editMode.indexOf("{")>-1){return S(P(D(C.IsEditable),i))}return i};v.getMultipleLinesForDataField=q;const X=function(e,t){const i=l.getAssociatedUnitProperty(e);const n=l.getAssociatedCurrencyProperty(e);return l.hasValueHelp(e)&&e.type!=="Edm.Boolean"||t!=="Hidden"&&(i&&l.hasValueHelp(i)||n&&l.hasValueHelp(n))};const Y=function(e,t,i,n){var a,o,r,l,s,d,u,c,v,g,f,p;const m=i.targetObject;if(!h(m)||["com.sap.vocabularies.UI.v1.DataFieldForAction","com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath","com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"].includes(t.$Type)){e.editStyle=null;return}if(!n){var b,y,O,T,I,j;e.valueBindingExpression=N(i,e.formatOptions);const n=((b=t.annotations)===null||b===void 0?void 0:(y=b.UI)===null||y===void 0?void 0:y.Placeholder)||((O=t.Value)===null||O===void 0?void 0:(T=O.$target)===null||T===void 0?void 0:(I=T.annotations)===null||I===void 0?void 0:(j=I.UI)===null||j===void 0?void 0:j.Placeholder);if(n){e.editStylePlaceholder=S(x(n))}}const P=B(t)?(a=t.Target)===null||a===void 0?void 0:a.$target:t;if((P===null||P===void 0?void 0:P.Visualization)==="UI.VisualizationType/Rating"){var D,U;e.editStyle="RatingIndicator";if((D=P.annotations)!==null&&D!==void 0&&(U=D.Common)!==null&&U!==void 0&&U.QuickInfo){var F,$;e.ratingIndicatorTooltip=S(x((F=P.annotations)===null||F===void 0?void 0:($=F.Common)===null||$===void 0?void 0:$.QuickInfo))}e.ratingIndicatorTargetValue=S(x(P.TargetValue));return}if(X(m,(o=e.formatOptions)===null||o===void 0?void 0:o.measureDisplayMode)||((r=e.formatOptions)===null||r===void 0?void 0:r.measureDisplayMode)!=="Hidden"&&((l=m.annotations)!==null&&l!==void 0&&(s=l.Measures)!==null&&s!==void 0&&s.ISOCurrency||(d=m.annotations)!==null&&d!==void 0&&(u=d.Measures)!==null&&u!==void 0&&u.Unit)){if(!n){var E;e.textBindingExpression=H(i,e.formatOptions);if(((E=e.formatOptions)===null||E===void 0?void 0:E.measureDisplayMode)!=="Hidden"){e.valueBindingExpression=N(i,e.formatOptions,false,false,undefined,false,true)}}e.editStyle="InputWithValueHelp";return}switch(m.type){case"Edm.Date":e.editStyle="DatePicker";return;case"Edm.Time":case"Edm.TimeOfDay":e.editStyle="TimePicker";return;case"Edm.DateTime":case"Edm.DateTimeOffset":e.editStyle="DateTimePicker";if(!((c=m.annotations)!==null&&c!==void 0&&(v=c.Common)!==null&&v!==void 0&&v.Timezone)){e.showTimezone=undefined}else{e.showTimezone=true}return;case"Edm.Boolean":e.editStyle="CheckBox";return;case"Edm.Stream":e.editStyle="File";return;case"Edm.String":if((g=m.annotations)!==null&&g!==void 0&&(f=g.UI)!==null&&f!==void 0&&(p=f.MultiLineText)!==null&&p!==void 0&&p.valueOf()){e.editStyle="TextArea";return}break;default:e.editStyle="Input"}e.editStyle="Input"};v.setEditStyleProperties=Y;const Z=e=>{var t,i,n,a;const o=e.targetObject;if(s.hasSemanticObject(o)){return true}const r=e!==null&&e!==void 0&&(t=e.navigationProperties)!==null&&t!==void 0&&t.length?e===null||e===void 0?void 0:e.navigationProperties[(e===null||e===void 0?void 0:(i=e.navigationProperties)===null||i===void 0?void 0:i.length)-1]:null;if(!r||(n=e.contextLocation)!==null&&n!==void 0&&(a=n.navigationProperties)!==null&&a!==void 0&&a.find(e=>e.name===r.name)){return false}return s.hasSemanticObject(r)};v.hasSemanticObjectInNavigationOrProperty=Z;const _=e=>{if(!e.targetObject){return undefined}let t="";if(e.targetObject.term==="com.sap.vocabularies.UI.v1.DataPoint"){e.targetObject.$Type=e.targetObject.$Type||"com.sap.vocabularies.UI.v1.DataPointType"}switch(e.targetObject.$Type){case"com.sap.vocabularies.UI.v1.DataField":case"com.sap.vocabularies.UI.v1.DataPointType":case"com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath":case"com.sap.vocabularies.UI.v1.DataFieldWithUrl":case"com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation":case"com.sap.vocabularies.UI.v1.DataFieldWithAction":if(typeof e.targetObject.Value==="object"){t=e.targetObject.Value.path}break;case"com.sap.vocabularies.UI.v1.DataFieldForAnnotation":if(e.targetObject.Target.$target){if(e.targetObject.Target.$target.$Type==="com.sap.vocabularies.UI.v1.DataField"||e.targetObject.Target.$target.$Type==="com.sap.vocabularies.UI.v1.DataPointType"){if(e.targetObject.Target.value.indexOf("/")>0){var i;t=e.targetObject.Target.value.replace(/\/@.*/,`/${(i=e.targetObject.Target.$target.Value)===null||i===void 0?void 0:i.path}`)}else{var n;t=(n=e.targetObject.Target.$target.Value)===null||n===void 0?void 0:n.path}}else{var a;t=(a=e.targetObject.Target)===null||a===void 0?void 0:a.path}}break}if(t&&t.length>0){return b(e,t)}else{return undefined}};v.getDataModelObjectPathForValue=_;const ee=e=>{let t;if(g(e.targetObject)){t=e.targetObject}else if(e.navigationProperties.length>0){for(const n of e.navigationProperties){var i;if(!((i=e.contextLocation)!==null&&i!==void 0&&i.navigationProperties.find(e=>e.fullyQualifiedName===n.fullyQualifiedName))&&!t&&g(n)){t=n}}}return t};v.getPropertyWithSemanticObject=ee;const te=e=>{const t=m(e,e=>{var t;return e===null||e===void 0?void 0:(t=e.InsertRestrictions)===null||t===void 0?void 0:t.NonInsertableProperties});return t.some(t=>{var i,n;return(t===null||t===void 0?void 0:(i=t.$target)===null||i===void 0?void 0:i.fullyQualifiedName)===((n=e.targetObject)===null||n===void 0?void 0:n.fullyQualifiedName)})};v.hasPropertyInsertRestrictions=te;const ie=e=>e?S(E([V(e),j("semanticKeyHasDraftIndicator","internal"),j("HasDraftEntity"),j("IsActiveEntity"),j("hideDraftInfo","pageInternal")],"sap.fe.macros.field.FieldRuntime.isDraftIndicatorVisible")):"false";v.getDraftIndicatorVisibleBinding=ie;return v},false);
//# sourceMappingURL=FieldTemplating.js.map